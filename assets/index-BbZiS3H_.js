(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))S(R);new MutationObserver(R=>{for(const O of R)if(O.type==="childList")for(const M of O.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&S(M)}).observe(document,{childList:!0,subtree:!0});function T(R){const O={};return R.integrity&&(O.integrity=R.integrity),R.referrerPolicy&&(O.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?O.credentials="include":R.crossOrigin==="anonymous"?O.credentials="omit":O.credentials="same-origin",O}function S(R){if(R.ep)return;R.ep=!0;const O=T(R);fetch(R.href,O)}})();function Ax(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var Ky={exports:{}},Nm={};var G0;function Z1(){if(G0)return Nm;G0=1;var d=Symbol.for("react.transitional.element"),y=Symbol.for("react.fragment");function T(S,R,O){var M=null;if(O!==void 0&&(M=""+O),R.key!==void 0&&(M=""+R.key),"key"in R){O={};for(var u in R)u!=="key"&&(O[u]=R[u])}else O=R;return R=O.ref,{$$typeof:d,type:S,key:M,ref:R!==void 0?R:null,props:O}}return Nm.Fragment=y,Nm.jsx=T,Nm.jsxs=T,Nm}var q0;function H1(){return q0||(q0=1,Ky.exports=Z1()),Ky.exports}var he=H1(),Qy={exports:{}},ai={};var Z0;function $1(){if(Z0)return ai;Z0=1;var d=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),O=Symbol.for("react.consumer"),M=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),j=Symbol.for("react.suspense"),Z=Symbol.for("react.memo"),X=Symbol.for("react.lazy"),te=Symbol.for("react.activity"),de=Symbol.iterator;function Ae(Me){return Me===null||typeof Me!="object"?null:(Me=de&&Me[de]||Me["@@iterator"],typeof Me=="function"?Me:null)}var Ce={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},De=Object.assign,oe={};function We(Me,ot,Mt){this.props=Me,this.context=ot,this.refs=oe,this.updater=Mt||Ce}We.prototype.isReactComponent={},We.prototype.setState=function(Me,ot){if(typeof Me!="object"&&typeof Me!="function"&&Me!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Me,ot,"setState")},We.prototype.forceUpdate=function(Me){this.updater.enqueueForceUpdate(this,Me,"forceUpdate")};function Ze(){}Ze.prototype=We.prototype;function $e(Me,ot,Mt){this.props=Me,this.context=ot,this.refs=oe,this.updater=Mt||Ce}var Ct=$e.prototype=new Ze;Ct.constructor=$e,De(Ct,We.prototype),Ct.isPureReactComponent=!0;var Ke=Array.isArray;function vt(){}var mt={H:null,A:null,T:null,S:null},Et=Object.prototype.hasOwnProperty;function Xt(Me,ot,Mt){var zt=Mt.ref;return{$$typeof:d,type:Me,key:ot,ref:zt!==void 0?zt:null,props:Mt}}function ct(Me,ot){return Xt(Me.type,ot,Me.props)}function Yt(Me){return typeof Me=="object"&&Me!==null&&Me.$$typeof===d}function ki(Me){var ot={"=":"=0",":":"=2"};return"$"+Me.replace(/[=:]/g,function(Mt){return ot[Mt]})}var wn=/\/+/g;function mr(Me,ot){return typeof Me=="object"&&Me!==null&&Me.key!=null?ki(""+Me.key):ot.toString(36)}function Bn(Me){switch(Me.status){case"fulfilled":return Me.value;case"rejected":throw Me.reason;default:switch(typeof Me.status=="string"?Me.then(vt,vt):(Me.status="pending",Me.then(function(ot){Me.status==="pending"&&(Me.status="fulfilled",Me.value=ot)},function(ot){Me.status==="pending"&&(Me.status="rejected",Me.reason=ot)})),Me.status){case"fulfilled":return Me.value;case"rejected":throw Me.reason}}throw Me}function tt(Me,ot,Mt,zt,Ot){var Wt=typeof Me;(Wt==="undefined"||Wt==="boolean")&&(Me=null);var li=!1;if(Me===null)li=!0;else switch(Wt){case"bigint":case"string":case"number":li=!0;break;case"object":switch(Me.$$typeof){case d:case y:li=!0;break;case X:return li=Me._init,tt(li(Me._payload),ot,Mt,zt,Ot)}}if(li)return Ot=Ot(Me),li=zt===""?"."+mr(Me,0):zt,Ke(Ot)?(Mt="",li!=null&&(Mt=li.replace(wn,"$&/")+"/"),tt(Ot,ot,Mt,"",function(Er){return Er})):Ot!=null&&(Yt(Ot)&&(Ot=ct(Ot,Mt+(Ot.key==null||Me&&Me.key===Ot.key?"":(""+Ot.key).replace(wn,"$&/")+"/")+li)),ot.push(Ot)),1;li=0;var Bi=zt===""?".":zt+":";if(Ke(Me))for(var Hi=0;Hi<Me.length;Hi++)zt=Me[Hi],Wt=Bi+mr(zt,Hi),li+=tt(zt,ot,Mt,Wt,Ot);else if(Hi=Ae(Me),typeof Hi=="function")for(Me=Hi.call(Me),Hi=0;!(zt=Me.next()).done;)zt=zt.value,Wt=Bi+mr(zt,Hi++),li+=tt(zt,ot,Mt,Wt,Ot);else if(Wt==="object"){if(typeof Me.then=="function")return tt(Bn(Me),ot,Mt,zt,Ot);throw ot=String(Me),Error("Objects are not valid as a React child (found: "+(ot==="[object Object]"?"object with keys {"+Object.keys(Me).join(", ")+"}":ot)+"). If you meant to render a collection of children, use an array instead.")}return li}function ht(Me,ot,Mt){if(Me==null)return Me;var zt=[],Ot=0;return tt(Me,zt,"","",function(Wt){return ot.call(Mt,Wt,Ot++)}),zt}function Rt(Me){if(Me._status===-1){var ot=Me._result;ot=ot(),ot.then(function(Mt){(Me._status===0||Me._status===-1)&&(Me._status=1,Me._result=Mt)},function(Mt){(Me._status===0||Me._status===-1)&&(Me._status=2,Me._result=Mt)}),Me._status===-1&&(Me._status=0,Me._result=ot)}if(Me._status===1)return Me._result.default;throw Me._result}var It=typeof reportError=="function"?reportError:function(Me){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ot=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Me=="object"&&Me!==null&&typeof Me.message=="string"?String(Me.message):String(Me),error:Me});if(!window.dispatchEvent(ot))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Me);return}console.error(Me)},si={map:ht,forEach:function(Me,ot,Mt){ht(Me,function(){ot.apply(this,arguments)},Mt)},count:function(Me){var ot=0;return ht(Me,function(){ot++}),ot},toArray:function(Me){return ht(Me,function(ot){return ot})||[]},only:function(Me){if(!Yt(Me))throw Error("React.Children.only expected to receive a single React element child.");return Me}};return ai.Activity=te,ai.Children=si,ai.Component=We,ai.Fragment=T,ai.Profiler=R,ai.PureComponent=$e,ai.StrictMode=S,ai.Suspense=j,ai.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=mt,ai.__COMPILER_RUNTIME={__proto__:null,c:function(Me){return mt.H.useMemoCache(Me)}},ai.cache=function(Me){return function(){return Me.apply(null,arguments)}},ai.cacheSignal=function(){return null},ai.cloneElement=function(Me,ot,Mt){if(Me==null)throw Error("The argument must be a React element, but you passed "+Me+".");var zt=De({},Me.props),Ot=Me.key;if(ot!=null)for(Wt in ot.key!==void 0&&(Ot=""+ot.key),ot)!Et.call(ot,Wt)||Wt==="key"||Wt==="__self"||Wt==="__source"||Wt==="ref"&&ot.ref===void 0||(zt[Wt]=ot[Wt]);var Wt=arguments.length-2;if(Wt===1)zt.children=Mt;else if(1<Wt){for(var li=Array(Wt),Bi=0;Bi<Wt;Bi++)li[Bi]=arguments[Bi+2];zt.children=li}return Xt(Me.type,Ot,zt)},ai.createContext=function(Me){return Me={$$typeof:M,_currentValue:Me,_currentValue2:Me,_threadCount:0,Provider:null,Consumer:null},Me.Provider=Me,Me.Consumer={$$typeof:O,_context:Me},Me},ai.createElement=function(Me,ot,Mt){var zt,Ot={},Wt=null;if(ot!=null)for(zt in ot.key!==void 0&&(Wt=""+ot.key),ot)Et.call(ot,zt)&&zt!=="key"&&zt!=="__self"&&zt!=="__source"&&(Ot[zt]=ot[zt]);var li=arguments.length-2;if(li===1)Ot.children=Mt;else if(1<li){for(var Bi=Array(li),Hi=0;Hi<li;Hi++)Bi[Hi]=arguments[Hi+2];Ot.children=Bi}if(Me&&Me.defaultProps)for(zt in li=Me.defaultProps,li)Ot[zt]===void 0&&(Ot[zt]=li[zt]);return Xt(Me,Wt,Ot)},ai.createRef=function(){return{current:null}},ai.forwardRef=function(Me){return{$$typeof:u,render:Me}},ai.isValidElement=Yt,ai.lazy=function(Me){return{$$typeof:X,_payload:{_status:-1,_result:Me},_init:Rt}},ai.memo=function(Me,ot){return{$$typeof:Z,type:Me,compare:ot===void 0?null:ot}},ai.startTransition=function(Me){var ot=mt.T,Mt={};mt.T=Mt;try{var zt=Me(),Ot=mt.S;Ot!==null&&Ot(Mt,zt),typeof zt=="object"&&zt!==null&&typeof zt.then=="function"&&zt.then(vt,It)}catch(Wt){It(Wt)}finally{ot!==null&&Mt.types!==null&&(ot.types=Mt.types),mt.T=ot}},ai.unstable_useCacheRefresh=function(){return mt.H.useCacheRefresh()},ai.use=function(Me){return mt.H.use(Me)},ai.useActionState=function(Me,ot,Mt){return mt.H.useActionState(Me,ot,Mt)},ai.useCallback=function(Me,ot){return mt.H.useCallback(Me,ot)},ai.useContext=function(Me){return mt.H.useContext(Me)},ai.useDebugValue=function(){},ai.useDeferredValue=function(Me,ot){return mt.H.useDeferredValue(Me,ot)},ai.useEffect=function(Me,ot){return mt.H.useEffect(Me,ot)},ai.useEffectEvent=function(Me){return mt.H.useEffectEvent(Me)},ai.useId=function(){return mt.H.useId()},ai.useImperativeHandle=function(Me,ot,Mt){return mt.H.useImperativeHandle(Me,ot,Mt)},ai.useInsertionEffect=function(Me,ot){return mt.H.useInsertionEffect(Me,ot)},ai.useLayoutEffect=function(Me,ot){return mt.H.useLayoutEffect(Me,ot)},ai.useMemo=function(Me,ot){return mt.H.useMemo(Me,ot)},ai.useOptimistic=function(Me,ot){return mt.H.useOptimistic(Me,ot)},ai.useReducer=function(Me,ot,Mt){return mt.H.useReducer(Me,ot,Mt)},ai.useRef=function(Me){return mt.H.useRef(Me)},ai.useState=function(Me){return mt.H.useState(Me)},ai.useSyncExternalStore=function(Me,ot,Mt){return mt.H.useSyncExternalStore(Me,ot,Mt)},ai.useTransition=function(){return mt.H.useTransition()},ai.version="19.2.3",ai}var H0;function Z_(){return H0||(H0=1,Qy.exports=$1()),Qy.exports}var we=Z_();const X1=Ax(we);var Jy={exports:{}},Vm={},e_={exports:{}},t_={};var $0;function Y1(){return $0||($0=1,(function(d){function y(tt,ht){var Rt=tt.length;tt.push(ht);e:for(;0<Rt;){var It=Rt-1>>>1,si=tt[It];if(0<R(si,ht))tt[It]=ht,tt[Rt]=si,Rt=It;else break e}}function T(tt){return tt.length===0?null:tt[0]}function S(tt){if(tt.length===0)return null;var ht=tt[0],Rt=tt.pop();if(Rt!==ht){tt[0]=Rt;e:for(var It=0,si=tt.length,Me=si>>>1;It<Me;){var ot=2*(It+1)-1,Mt=tt[ot],zt=ot+1,Ot=tt[zt];if(0>R(Mt,Rt))zt<si&&0>R(Ot,Mt)?(tt[It]=Ot,tt[zt]=Rt,It=zt):(tt[It]=Mt,tt[ot]=Rt,It=ot);else if(zt<si&&0>R(Ot,Rt))tt[It]=Ot,tt[zt]=Rt,It=zt;else break e}}return ht}function R(tt,ht){var Rt=tt.sortIndex-ht.sortIndex;return Rt!==0?Rt:tt.id-ht.id}if(d.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var O=performance;d.unstable_now=function(){return O.now()}}else{var M=Date,u=M.now();d.unstable_now=function(){return M.now()-u}}var j=[],Z=[],X=1,te=null,de=3,Ae=!1,Ce=!1,De=!1,oe=!1,We=typeof setTimeout=="function"?setTimeout:null,Ze=typeof clearTimeout=="function"?clearTimeout:null,$e=typeof setImmediate<"u"?setImmediate:null;function Ct(tt){for(var ht=T(Z);ht!==null;){if(ht.callback===null)S(Z);else if(ht.startTime<=tt)S(Z),ht.sortIndex=ht.expirationTime,y(j,ht);else break;ht=T(Z)}}function Ke(tt){if(De=!1,Ct(tt),!Ce)if(T(j)!==null)Ce=!0,vt||(vt=!0,ki());else{var ht=T(Z);ht!==null&&Bn(Ke,ht.startTime-tt)}}var vt=!1,mt=-1,Et=5,Xt=-1;function ct(){return oe?!0:!(d.unstable_now()-Xt<Et)}function Yt(){if(oe=!1,vt){var tt=d.unstable_now();Xt=tt;var ht=!0;try{e:{Ce=!1,De&&(De=!1,Ze(mt),mt=-1),Ae=!0;var Rt=de;try{t:{for(Ct(tt),te=T(j);te!==null&&!(te.expirationTime>tt&&ct());){var It=te.callback;if(typeof It=="function"){te.callback=null,de=te.priorityLevel;var si=It(te.expirationTime<=tt);if(tt=d.unstable_now(),typeof si=="function"){te.callback=si,Ct(tt),ht=!0;break t}te===T(j)&&S(j),Ct(tt)}else S(j);te=T(j)}if(te!==null)ht=!0;else{var Me=T(Z);Me!==null&&Bn(Ke,Me.startTime-tt),ht=!1}}break e}finally{te=null,de=Rt,Ae=!1}ht=void 0}}finally{ht?ki():vt=!1}}}var ki;if(typeof $e=="function")ki=function(){$e(Yt)};else if(typeof MessageChannel<"u"){var wn=new MessageChannel,mr=wn.port2;wn.port1.onmessage=Yt,ki=function(){mr.postMessage(null)}}else ki=function(){We(Yt,0)};function Bn(tt,ht){mt=We(function(){tt(d.unstable_now())},ht)}d.unstable_IdlePriority=5,d.unstable_ImmediatePriority=1,d.unstable_LowPriority=4,d.unstable_NormalPriority=3,d.unstable_Profiling=null,d.unstable_UserBlockingPriority=2,d.unstable_cancelCallback=function(tt){tt.callback=null},d.unstable_forceFrameRate=function(tt){0>tt||125<tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Et=0<tt?Math.floor(1e3/tt):5},d.unstable_getCurrentPriorityLevel=function(){return de},d.unstable_next=function(tt){switch(de){case 1:case 2:case 3:var ht=3;break;default:ht=de}var Rt=de;de=ht;try{return tt()}finally{de=Rt}},d.unstable_requestPaint=function(){oe=!0},d.unstable_runWithPriority=function(tt,ht){switch(tt){case 1:case 2:case 3:case 4:case 5:break;default:tt=3}var Rt=de;de=tt;try{return ht()}finally{de=Rt}},d.unstable_scheduleCallback=function(tt,ht,Rt){var It=d.unstable_now();switch(typeof Rt=="object"&&Rt!==null?(Rt=Rt.delay,Rt=typeof Rt=="number"&&0<Rt?It+Rt:It):Rt=It,tt){case 1:var si=-1;break;case 2:si=250;break;case 5:si=1073741823;break;case 4:si=1e4;break;default:si=5e3}return si=Rt+si,tt={id:X++,callback:ht,priorityLevel:tt,startTime:Rt,expirationTime:si,sortIndex:-1},Rt>It?(tt.sortIndex=Rt,y(Z,tt),T(j)===null&&tt===T(Z)&&(De?(Ze(mt),mt=-1):De=!0,Bn(Ke,Rt-It))):(tt.sortIndex=si,y(j,tt),Ce||Ae||(Ce=!0,vt||(vt=!0,ki()))),tt},d.unstable_shouldYield=ct,d.unstable_wrapCallback=function(tt){var ht=de;return function(){var Rt=de;de=ht;try{return tt.apply(this,arguments)}finally{de=Rt}}}})(t_)),t_}var X0;function W1(){return X0||(X0=1,e_.exports=Y1()),e_.exports}var i_={exports:{}},Ba={};var Y0;function K1(){if(Y0)return Ba;Y0=1;var d=Z_();function y(j){var Z="https://react.dev/errors/"+j;if(1<arguments.length){Z+="?args[]="+encodeURIComponent(arguments[1]);for(var X=2;X<arguments.length;X++)Z+="&args[]="+encodeURIComponent(arguments[X])}return"Minified React error #"+j+"; visit "+Z+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function T(){}var S={d:{f:T,r:function(){throw Error(y(522))},D:T,C:T,L:T,m:T,X:T,S:T,M:T},p:0,findDOMNode:null},R=Symbol.for("react.portal");function O(j,Z,X){var te=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:R,key:te==null?null:""+te,children:j,containerInfo:Z,implementation:X}}var M=d.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(j,Z){if(j==="font")return"";if(typeof Z=="string")return Z==="use-credentials"?Z:""}return Ba.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,Ba.createPortal=function(j,Z){var X=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Z||Z.nodeType!==1&&Z.nodeType!==9&&Z.nodeType!==11)throw Error(y(299));return O(j,Z,null,X)},Ba.flushSync=function(j){var Z=M.T,X=S.p;try{if(M.T=null,S.p=2,j)return j()}finally{M.T=Z,S.p=X,S.d.f()}},Ba.preconnect=function(j,Z){typeof j=="string"&&(Z?(Z=Z.crossOrigin,Z=typeof Z=="string"?Z==="use-credentials"?Z:"":void 0):Z=null,S.d.C(j,Z))},Ba.prefetchDNS=function(j){typeof j=="string"&&S.d.D(j)},Ba.preinit=function(j,Z){if(typeof j=="string"&&Z&&typeof Z.as=="string"){var X=Z.as,te=u(X,Z.crossOrigin),de=typeof Z.integrity=="string"?Z.integrity:void 0,Ae=typeof Z.fetchPriority=="string"?Z.fetchPriority:void 0;X==="style"?S.d.S(j,typeof Z.precedence=="string"?Z.precedence:void 0,{crossOrigin:te,integrity:de,fetchPriority:Ae}):X==="script"&&S.d.X(j,{crossOrigin:te,integrity:de,fetchPriority:Ae,nonce:typeof Z.nonce=="string"?Z.nonce:void 0})}},Ba.preinitModule=function(j,Z){if(typeof j=="string")if(typeof Z=="object"&&Z!==null){if(Z.as==null||Z.as==="script"){var X=u(Z.as,Z.crossOrigin);S.d.M(j,{crossOrigin:X,integrity:typeof Z.integrity=="string"?Z.integrity:void 0,nonce:typeof Z.nonce=="string"?Z.nonce:void 0})}}else Z==null&&S.d.M(j)},Ba.preload=function(j,Z){if(typeof j=="string"&&typeof Z=="object"&&Z!==null&&typeof Z.as=="string"){var X=Z.as,te=u(X,Z.crossOrigin);S.d.L(j,X,{crossOrigin:te,integrity:typeof Z.integrity=="string"?Z.integrity:void 0,nonce:typeof Z.nonce=="string"?Z.nonce:void 0,type:typeof Z.type=="string"?Z.type:void 0,fetchPriority:typeof Z.fetchPriority=="string"?Z.fetchPriority:void 0,referrerPolicy:typeof Z.referrerPolicy=="string"?Z.referrerPolicy:void 0,imageSrcSet:typeof Z.imageSrcSet=="string"?Z.imageSrcSet:void 0,imageSizes:typeof Z.imageSizes=="string"?Z.imageSizes:void 0,media:typeof Z.media=="string"?Z.media:void 0})}},Ba.preloadModule=function(j,Z){if(typeof j=="string")if(Z){var X=u(Z.as,Z.crossOrigin);S.d.m(j,{as:typeof Z.as=="string"&&Z.as!=="script"?Z.as:void 0,crossOrigin:X,integrity:typeof Z.integrity=="string"?Z.integrity:void 0})}else S.d.m(j)},Ba.requestFormReset=function(j){S.d.r(j)},Ba.unstable_batchedUpdates=function(j,Z){return j(Z)},Ba.useFormState=function(j,Z,X){return M.H.useFormState(j,Z,X)},Ba.useFormStatus=function(){return M.H.useHostTransitionStatus()},Ba.version="19.2.3",Ba}var W0;function Q1(){if(W0)return i_.exports;W0=1;function d(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(d)}catch(y){console.error(y)}}return d(),i_.exports=K1(),i_.exports}var K0;function J1(){if(K0)return Vm;K0=1;var d=W1(),y=Z_(),T=Q1();function S(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)s+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function R(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function O(r){var s=r,h=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(h=s.return),r=s.return;while(r)}return s.tag===3?h:null}function M(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function u(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function j(r){if(O(r)!==r)throw Error(S(188))}function Z(r){var s=r.alternate;if(!s){if(s=O(r),s===null)throw Error(S(188));return s!==r?null:r}for(var h=r,_=s;;){var A=h.return;if(A===null)break;var P=A.alternate;if(P===null){if(_=A.return,_!==null){h=_;continue}break}if(A.child===P.child){for(P=A.child;P;){if(P===h)return j(A),r;if(P===_)return j(A),s;P=P.sibling}throw Error(S(188))}if(h.return!==_.return)h=A,_=P;else{for(var U=!1,ee=A.child;ee;){if(ee===h){U=!0,h=A,_=P;break}if(ee===_){U=!0,_=A,h=P;break}ee=ee.sibling}if(!U){for(ee=P.child;ee;){if(ee===h){U=!0,h=P,_=A;break}if(ee===_){U=!0,_=P,h=A;break}ee=ee.sibling}if(!U)throw Error(S(189))}}if(h.alternate!==_)throw Error(S(190))}if(h.tag!==3)throw Error(S(188));return h.stateNode.current===h?r:s}function X(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=X(r),s!==null)return s;r=r.sibling}return null}var te=Object.assign,de=Symbol.for("react.element"),Ae=Symbol.for("react.transitional.element"),Ce=Symbol.for("react.portal"),De=Symbol.for("react.fragment"),oe=Symbol.for("react.strict_mode"),We=Symbol.for("react.profiler"),Ze=Symbol.for("react.consumer"),$e=Symbol.for("react.context"),Ct=Symbol.for("react.forward_ref"),Ke=Symbol.for("react.suspense"),vt=Symbol.for("react.suspense_list"),mt=Symbol.for("react.memo"),Et=Symbol.for("react.lazy"),Xt=Symbol.for("react.activity"),ct=Symbol.for("react.memo_cache_sentinel"),Yt=Symbol.iterator;function ki(r){return r===null||typeof r!="object"?null:(r=Yt&&r[Yt]||r["@@iterator"],typeof r=="function"?r:null)}var wn=Symbol.for("react.client.reference");function mr(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===wn?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case De:return"Fragment";case We:return"Profiler";case oe:return"StrictMode";case Ke:return"Suspense";case vt:return"SuspenseList";case Xt:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case Ce:return"Portal";case $e:return r.displayName||"Context";case Ze:return(r._context.displayName||"Context")+".Consumer";case Ct:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case mt:return s=r.displayName||null,s!==null?s:mr(r.type)||"Memo";case Et:s=r._payload,r=r._init;try{return mr(r(s))}catch{}}return null}var Bn=Array.isArray,tt=y.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ht=T.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Rt={pending:!1,data:null,method:null,action:null},It=[],si=-1;function Me(r){return{current:r}}function ot(r){0>si||(r.current=It[si],It[si]=null,si--)}function Mt(r,s){si++,It[si]=r.current,r.current=s}var zt=Me(null),Ot=Me(null),Wt=Me(null),li=Me(null);function Bi(r,s){switch(Mt(Wt,s),Mt(Ot,r),Mt(zt,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?gu(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=gu(s),r=gm(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ot(zt),Mt(zt,r)}function Hi(){ot(zt),ot(Ot),ot(Wt)}function Er(r){r.memoizedState!==null&&Mt(li,r);var s=zt.current,h=gm(s,r.type);s!==h&&(Mt(Ot,r),Mt(zt,h))}function so(r){Ot.current===r&&(ot(zt),ot(Ot)),li.current===r&&(ot(li),Ah._currentValue=Rt)}var Kr,kl;function sn(r){if(Kr===void 0)try{throw Error()}catch(h){var s=h.stack.trim().match(/\n( *(at )?)/);Kr=s&&s[1]||"",kl=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Kr+r+kl}var Br=!1;function ga(r,s){if(!r||Br)return"";Br=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var _={DetermineComponentFrameRoot:function(){try{if(s){var lt=function(){throw Error()};if(Object.defineProperty(lt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(lt,[])}catch(Xe){var qe=Xe}Reflect.construct(r,[],lt)}else{try{lt.call()}catch(Xe){qe=Xe}r.call(lt.prototype)}}else{try{throw Error()}catch(Xe){qe=Xe}(lt=r())&&typeof lt.catch=="function"&&lt.catch(function(){})}}catch(Xe){if(Xe&&qe&&typeof Xe.stack=="string")return[Xe.stack,qe.stack]}return[null,null]}};_.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var A=Object.getOwnPropertyDescriptor(_.DetermineComponentFrameRoot,"name");A&&A.configurable&&Object.defineProperty(_.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var P=_.DetermineComponentFrameRoot(),U=P[0],ee=P[1];if(U&&ee){var be=U.split(`
`),Ge=ee.split(`
`);for(A=_=0;_<be.length&&!be[_].includes("DetermineComponentFrameRoot");)_++;for(;A<Ge.length&&!Ge[A].includes("DetermineComponentFrameRoot");)A++;if(_===be.length||A===Ge.length)for(_=be.length-1,A=Ge.length-1;1<=_&&0<=A&&be[_]!==Ge[A];)A--;for(;1<=_&&0<=A;_--,A--)if(be[_]!==Ge[A]){if(_!==1||A!==1)do if(_--,A--,0>A||be[_]!==Ge[A]){var it=`
`+be[_].replace(" at new "," at ");return r.displayName&&it.includes("<anonymous>")&&(it=it.replace("<anonymous>",r.displayName)),it}while(1<=_&&0<=A);break}}}finally{Br=!1,Error.prepareStackTrace=h}return(h=r?r.displayName||r.name:"")?sn(h):""}function hn(r,s){switch(r.tag){case 26:case 27:case 5:return sn(r.type);case 16:return sn("Lazy");case 13:return r.child!==s&&s!==null?sn("Suspense Fallback"):sn("Suspense");case 19:return sn("SuspenseList");case 0:case 15:return ga(r.type,!1);case 11:return ga(r.type.render,!1);case 1:return ga(r.type,!0);case 31:return sn("Activity");default:return""}}function Ls(r){try{var s="",h=null;do s+=hn(r,h),h=r,r=r.return;while(r);return s}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}var ks=Object.prototype.hasOwnProperty,oo=d.unstable_scheduleCallback,rs=d.unstable_cancelCallback,Fa=d.unstable_shouldYield,Bl=d.unstable_requestPaint,Wn=d.unstable_now,Or=d.unstable_getCurrentPriorityLevel,Re=d.unstable_ImmediatePriority,W=d.unstable_UserBlockingPriority,Y=d.unstable_NormalPriority,ie=d.unstable_LowPriority,_e=d.unstable_IdlePriority,xe=d.log,Be=d.unstable_setDisableYieldValue,Pe=null,Te=null;function Oe(r){if(typeof xe=="function"&&Be(r),Te&&typeof Te.setStrictMode=="function")try{Te.setStrictMode(Pe,r)}catch{}}var Je=Math.clz32?Math.clz32:Pt,et=Math.log,wt=Math.LN2;function Pt(r){return r>>>=0,r===0?32:31-(et(r)/wt|0)|0}var Vt=256,bi=262144,ci=4194304;function Ie(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Si(r,s,h){var _=r.pendingLanes;if(_===0)return 0;var A=0,P=r.suspendedLanes,U=r.pingedLanes;r=r.warmLanes;var ee=_&134217727;return ee!==0?(_=ee&~P,_!==0?A=Ie(_):(U&=ee,U!==0?A=Ie(U):h||(h=ee&~r,h!==0&&(A=Ie(h))))):(ee=_&~P,ee!==0?A=Ie(ee):U!==0?A=Ie(U):h||(h=_&~r,h!==0&&(A=Ie(h)))),A===0?0:s!==0&&s!==A&&(s&P)===0&&(P=A&-A,h=s&-s,P>=h||P===32&&(h&4194048)!==0)?s:A}function Cn(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function qt(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Mi(){var r=ci;return ci<<=1,(ci&62914560)===0&&(ci=4194304),r}function Un(r){for(var s=[],h=0;31>h;h++)s.push(r);return s}function Di(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function dn(r,s,h,_,A,P){var U=r.pendingLanes;r.pendingLanes=h,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=h,r.entangledLanes&=h,r.errorRecoveryDisabledLanes&=h,r.shellSuspendCounter=0;var ee=r.entanglements,be=r.expirationTimes,Ge=r.hiddenUpdates;for(h=U&~h;0<h;){var it=31-Je(h),lt=1<<it;ee[it]=0,be[it]=-1;var qe=Ge[it];if(qe!==null)for(Ge[it]=null,it=0;it<qe.length;it++){var Xe=qe[it];Xe!==null&&(Xe.lane&=-536870913)}h&=~lt}_!==0&&Oi(r,_,0),P!==0&&A===0&&r.tag!==0&&(r.suspendedLanes|=P&~(U&~s))}function Oi(r,s,h){r.pendingLanes|=s,r.suspendedLanes&=~s;var _=31-Je(s);r.entangledLanes|=s,r.entanglements[_]=r.entanglements[_]|1073741824|h&261930}function Dn(r,s){var h=r.entangledLanes|=s;for(r=r.entanglements;h;){var _=31-Je(h),A=1<<_;A&s|r[_]&s&&(r[_]|=s),h&=~A}}function Ol(r,s){var h=s&-s;return h=(h&42)!==0?1:Uo(h),(h&(r.suspendedLanes|s))!==0?0:h}function Uo(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function ut(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function gr(){var r=ht.p;return r!==0?r:(r=window.event,r===void 0?32:Mc(r.type))}function yr(r,s){var h=ht.p;try{return ht.p=r,s()}finally{ht.p=h}}var ja=Math.random().toString(36).slice(2),qi="__reactFiber$"+ja,pt="__reactProps$"+ja,Ht="__reactContainer$"+ja,Jt="__reactEvents$"+ja,Qr="__reactListeners$"+ja,Rc="__reactHandles$"+ja,as="__reactResources$"+ja,Zt="__reactMarker$"+ja;function Go(r){delete r[qi],delete r[pt],delete r[Jt],delete r[Qr],delete r[Rc]}function ss(r){var s=r[qi];if(s)return s;for(var h=r.parentNode;h;){if(s=h[Ht]||h[qi]){if(h=s.alternate,s.child!==null||h!==null&&h.child!==null)for(r=Ad(r);r!==null;){if(h=r[qi])return h;r=Ad(r)}return s}r=h,h=r.parentNode}return null}function Bs(r){if(r=r[qi]||r[Ht]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function os(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(S(33))}function ls(r){var s=r[as];return s||(s=r[as]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function fn(r){r[Zt]=!0}var Fl=new Set,_r={};function hi(r,s){Os(r,s),Os(r+"Capture",s)}function Os(r,s){for(_r[r]=s,r=0;r<s.length;r++)Fl.add(s[r])}var jl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Nl={},lo={};function Na(r){return ks.call(lo,r)?!0:ks.call(Nl,r)?!1:jl.test(r)?lo[r]=!0:(Nl[r]=!0,!1)}function Pu(r,s,h){if(Na(s))if(h===null)r.removeAttribute(s);else{switch(typeof h){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var _=s.toLowerCase().slice(0,5);if(_!=="data-"&&_!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+h)}}function us(r,s,h){if(h===null)r.removeAttribute(s);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+h)}}function ya(r,s,h,_){if(_===null)r.removeAttribute(h);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(h);return}r.setAttributeNS(s,h,""+_)}}function yi(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function kh(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Qd(r,s,h){var _=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var A=_.get,P=_.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return A.call(this)},set:function(U){h=""+U,P.call(this,U)}}),Object.defineProperty(r,s,{enumerable:_.enumerable}),{getValue:function(){return h},setValue:function(U){h=""+U},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function qo(r){if(!r._valueTracker){var s=kh(r)?"checked":"value";r._valueTracker=Qd(r,s,""+r[s])}}function Bh(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var h=s.getValue(),_="";return r&&(_=kh(r)?r.checked?"true":"false":r.value),r=_,r!==h?(s.setValue(r),!0):!1}function zu(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Jd=/[\n"\\]/g;function Ar(r){return r.replace(Jd,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Ru(r,s,h,_,A,P,U,ee){r.name="",U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?r.type=U:r.removeAttribute("type"),s!=null?U==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+yi(s)):r.value!==""+yi(s)&&(r.value=""+yi(s)):U!=="submit"&&U!=="reset"||r.removeAttribute("value"),s!=null?Iu(r,U,yi(s)):h!=null?Iu(r,U,yi(h)):_!=null&&r.removeAttribute("value"),A==null&&P!=null&&(r.defaultChecked=!!P),A!=null&&(r.checked=A&&typeof A!="function"&&typeof A!="symbol"),ee!=null&&typeof ee!="function"&&typeof ee!="symbol"&&typeof ee!="boolean"?r.name=""+yi(ee):r.removeAttribute("name")}function Ic(r,s,h,_,A,P,U,ee){if(P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(r.type=P),s!=null||h!=null){if(!(P!=="submit"&&P!=="reset"||s!=null)){qo(r);return}h=h!=null?""+yi(h):"",s=s!=null?""+yi(s):h,ee||s===r.value||(r.value=s),r.defaultValue=s}_=_??A,_=typeof _!="function"&&typeof _!="symbol"&&!!_,r.checked=ee?r.checked:!!_,r.defaultChecked=!!_,U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(r.name=U),qo(r)}function Iu(r,s,h){s==="number"&&zu(r.ownerDocument)===r||r.defaultValue===""+h||(r.defaultValue=""+h)}function uo(r,s,h,_){if(r=r.options,s){s={};for(var A=0;A<h.length;A++)s["$"+h[A]]=!0;for(h=0;h<r.length;h++)A=s.hasOwnProperty("$"+r[h].value),r[h].selected!==A&&(r[h].selected=A),A&&_&&(r[h].defaultSelected=!0)}else{for(h=""+yi(h),s=null,A=0;A<r.length;A++){if(r[A].value===h){r[A].selected=!0,_&&(r[A].defaultSelected=!0);return}s!==null||r[A].disabled||(s=r[A])}s!==null&&(s.selected=!0)}}function ef(r,s,h){if(s!=null&&(s=""+yi(s),s!==r.value&&(r.value=s),h==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=h!=null?""+yi(h):""}function Vl(r,s,h,_){if(s==null){if(_!=null){if(h!=null)throw Error(S(92));if(Bn(_)){if(1<_.length)throw Error(S(93));_=_[0]}h=_}h==null&&(h=""),s=h}h=yi(s),r.defaultValue=h,_=r.textContent,_===h&&_!==""&&_!==null&&(r.value=_),qo(r)}function Fs(r,s){if(s){var h=r.firstChild;if(h&&h===r.lastChild&&h.nodeType===3){h.nodeValue=s;return}}r.textContent=s}var tf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Zo(r,s,h){var _=s.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?_?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":_?r.setProperty(s,h):typeof h!="number"||h===0||tf.has(s)?s==="float"?r.cssFloat=h:r[s]=(""+h).trim():r[s]=h+"px"}function Lc(r,s,h){if(s!=null&&typeof s!="object")throw Error(S(62));if(r=r.style,h!=null){for(var _ in h)!h.hasOwnProperty(_)||s!=null&&s.hasOwnProperty(_)||(_.indexOf("--")===0?r.setProperty(_,""):_==="float"?r.cssFloat="":r[_]="");for(var A in s)_=s[A],s.hasOwnProperty(A)&&h[A]!==_&&Zo(r,A,_)}else for(var P in s)s.hasOwnProperty(P)&&Zo(r,P,s[P])}function Ho(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var co=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ul=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Qt(r){return Ul.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Va(){}var Oh=null;function Lu(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Gn=null,Pn=null;function Qi(r){var s=Bs(r);if(s&&(r=s.stateNode)){var h=r[pt]||null;e:switch(r=s.stateNode,s.type){case"input":if(Ru(r,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),s=h.name,h.type==="radio"&&s!=null){for(h=r;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+Ar(""+s)+'"][type="radio"]'),s=0;s<h.length;s++){var _=h[s];if(_!==r&&_.form===r.form){var A=_[pt]||null;if(!A)throw Error(S(90));Ru(_,A.value,A.defaultValue,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name)}}for(s=0;s<h.length;s++)_=h[s],_.form===r.form&&Bh(_)}break e;case"textarea":ef(r,h.value,h.defaultValue);break e;case"select":s=h.value,s!=null&&uo(r,!!h.multiple,s,!1)}}}var jt=!1;function Fi(r,s,h){if(jt)return r(s,h);jt=!0;try{var _=r(s);return _}finally{if(jt=!1,(Gn!==null||Pn!==null)&&(vd(),Gn&&(s=Gn,r=Pn,Pn=Gn=null,Qi(s),r)))for(s=0;s<r.length;s++)Qi(r[s])}}function _a(r,s){var h=r.stateNode;if(h===null)return null;var _=h[pt]||null;if(_===null)return null;h=_[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(r=r.type,_=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!_;break e;default:r=!1}if(r)return null;if(h&&typeof h!="function")throw Error(S(231,s,typeof h));return h}var pn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Cr=!1;if(pn)try{var qn={};Object.defineProperty(qn,"passive",{get:function(){Cr=!0}}),window.addEventListener("test",qn,qn),window.removeEventListener("test",qn,qn)}catch{Cr=!1}var Jr=null,cs=null,Ji=null;function ho(){if(Ji)return Ji;var r,s=cs,h=s.length,_,A="value"in Jr?Jr.value:Jr.textContent,P=A.length;for(r=0;r<h&&s[r]===A[r];r++);var U=h-r;for(_=1;_<=U&&s[h-_]===A[P-_];_++);return Ji=A.slice(r,1<_?1-_:void 0)}function ea(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function $o(){return!0}function Dr(){return!1}function On(r){function s(h,_,A,P,U){this._reactName=h,this._targetInst=A,this.type=_,this.nativeEvent=P,this.target=U,this.currentTarget=null;for(var ee in r)r.hasOwnProperty(ee)&&(h=r[ee],this[ee]=h?h(P):P[ee]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?$o:Dr,this.isPropagationStopped=Dr,this}return te(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=$o)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=$o)},persist:function(){},isPersistent:$o}),s}var Pr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ku=On(Pr),Xo=te({},Pr,{view:0,detail:0}),Yo=On(Xo),Pi,fo,ni,$t=te({},Xo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fu,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==ni&&(ni&&r.type==="mousemove"?(Pi=r.screenX-ni.screenX,fo=r.screenY-ni.screenY):fo=Pi=0,ni=r),Pi)},movementY:function(r){return"movementY"in r?r.movementY:fo}}),Wo=On($t),di=te({},$t,{dataTransfer:0}),Bu=On(di),va=te({},Xo,{relatedTarget:0}),po=On(va),mo=te({},Pr,{animationName:0,elapsedTime:0,pseudoElement:0}),nf=On(mo),Ou=te({},Pr,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Fh=On(Ou),Lp=te({},Pr,{data:0}),jh=On(Lp),zr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},en={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ko(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=en[r])?!!s[r]:!1}function Fu(){return Ko}var ju=te({},Xo,{key:function(r){if(r.key){var s=zr[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=ea(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?hs[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fu,charCode:function(r){return r.type==="keypress"?ea(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ea(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),mn=On(ju),rf=te({},$t,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kc=On(rf),af=te({},Xo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fu}),kp=On(af),Gl=te({},Pr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Bc=On(Gl),ql=te({},$t,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Nh=On(ql),Nu=te({},Pr,{newState:0,oldState:0}),Zl=On(Nu),Hl=[9,13,27,32],Tn=pn&&"CompositionEvent"in window,$l=null;pn&&"documentMode"in document&&($l=document.documentMode);var Xl=pn&&"TextEvent"in window&&!$l,Yl=pn&&(!Tn||$l&&8<$l&&11>=$l),go=" ",sf=!1;function Vu(r,s){switch(r){case"keyup":return Hl.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function of(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Ua=!1;function Oc(r,s){switch(r){case"compositionend":return of(s);case"keypress":return s.which!==32?null:(sf=!0,go);case"textInput":return r=s.data,r===go&&sf?null:r;default:return null}}function lf(r,s){if(Ua)return r==="compositionend"||!Tn&&Vu(r,s)?(r=ho(),Ji=cs=Jr=null,Ua=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Yl&&s.locale!=="ko"?null:s.data;default:return null}}var uf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Fc(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!uf[r.type]:s==="textarea"}function jc(r,s,h,_){Gn?Pn?Pn.push(_):Pn=[_]:Gn=_,s=Td(s,"onChange"),0<s.length&&(h=new ku("onChange","change",null,h,_),r.push({event:h,listeners:s}))}var Qo=null,Wl=null;function cf(r){Ng(r,0)}function Uu(r){var s=os(r);if(Bh(s))return r}function yo(r,s){if(r==="change")return s}var Vh=!1;if(pn){var Gu;if(pn){var _o="oninput"in document;if(!_o){var Uh=document.createElement("div");Uh.setAttribute("oninput","return;"),_o=typeof Uh.oninput=="function"}Gu=_o}else Gu=!1;Vh=Gu&&(!document.documentMode||9<document.documentMode)}function qu(){Qo&&(Qo.detachEvent("onpropertychange",hf),Wl=Qo=null)}function hf(r){if(r.propertyName==="value"&&Uu(Wl)){var s=[];jc(s,Wl,r,Lu(r)),Fi(cf,s)}}function Bp(r,s,h){r==="focusin"?(qu(),Qo=s,Wl=h,Qo.attachEvent("onpropertychange",hf)):r==="focusout"&&qu()}function df(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Uu(Wl)}function Zu(r,s){if(r==="click")return Uu(s)}function ff(r,s){if(r==="input"||r==="change")return Uu(s)}function Gh(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Fr=typeof Object.is=="function"?Object.is:Gh;function vo(r,s){if(Fr(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var h=Object.keys(r),_=Object.keys(s);if(h.length!==_.length)return!1;for(_=0;_<h.length;_++){var A=h[_];if(!ks.call(s,A)||!Fr(r[A],s[A]))return!1}return!0}function xa(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Hu(r,s){var h=xa(r);r=0;for(var _;h;){if(h.nodeType===3){if(_=r+h.textContent.length,r<=s&&_>=s)return{node:h,offset:s-r};r=_}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=xa(h)}}function Nc(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?Nc(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function Vc(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=zu(r.document);s instanceof r.HTMLIFrameElement;){try{var h=typeof s.contentWindow.location.href=="string"}catch{h=!1}if(h)r=s.contentWindow;else break;s=zu(r.document)}return s}function $u(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var Uc=pn&&"documentMode"in document&&11>=document.documentMode,ba=null,Xu=null,Yu=null,Gc=!1;function pf(r,s,h){var _=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Gc||ba==null||ba!==zu(_)||(_=ba,"selectionStart"in _&&$u(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),Yu&&vo(Yu,_)||(Yu=_,_=Td(Xu,"onSelect"),0<_.length&&(s=new ku("onSelect","select",null,s,h),r.push({event:s,listeners:_}),s.target=ba)))}function Jo(r,s){var h={};return h[r.toLowerCase()]=s.toLowerCase(),h["Webkit"+r]="webkit"+s,h["Moz"+r]="moz"+s,h}var el={animationend:Jo("Animation","AnimationEnd"),animationiteration:Jo("Animation","AnimationIteration"),animationstart:Jo("Animation","AnimationStart"),transitionrun:Jo("Transition","TransitionRun"),transitionstart:Jo("Transition","TransitionStart"),transitioncancel:Jo("Transition","TransitionCancel"),transitionend:Jo("Transition","TransitionEnd")},qh={},_i={};pn&&(_i=document.createElement("div").style,"AnimationEvent"in window||(delete el.animationend.animation,delete el.animationiteration.animation,delete el.animationstart.animation),"TransitionEvent"in window||delete el.transitionend.transition);function ds(r){if(qh[r])return qh[r];if(!el[r])return r;var s=el[r],h;for(h in s)if(s.hasOwnProperty(h)&&h in _i)return qh[r]=s[h];return r}var Wu=ds("animationend"),Ku=ds("animationiteration"),qc=ds("animationstart"),tl=ds("transitionrun"),Qu=ds("transitionstart"),Kl=ds("transitioncancel"),ta=ds("transitionend"),Zh=new Map,Zc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Zc.push("scrollEnd");function ia(r,s){Zh.set(r,s),hi(s,[r])}var fs=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Rr=[],js=0,il=0;function nl(){for(var r=js,s=il=js=0;s<r;){var h=Rr[s];Rr[s++]=null;var _=Rr[s];Rr[s++]=null;var A=Rr[s];Rr[s++]=null;var P=Rr[s];if(Rr[s++]=null,_!==null&&A!==null){var U=_.pending;U===null?A.next=A:(A.next=U.next,U.next=A),_.pending=A}P!==0&&Hh(h,A,P)}}function Ju(r,s,h,_){Rr[js++]=r,Rr[js++]=s,Rr[js++]=h,Rr[js++]=_,il|=_,r.lanes|=_,r=r.alternate,r!==null&&(r.lanes|=_)}function xo(r,s,h,_){return Ju(r,s,h,_),Ql(r)}function wa(r,s){return Ju(r,null,null,s),Ql(r)}function Hh(r,s,h){r.lanes|=h;var _=r.alternate;_!==null&&(_.lanes|=h);for(var A=!1,P=r.return;P!==null;)P.childLanes|=h,_=P.alternate,_!==null&&(_.childLanes|=h),P.tag===22&&(r=P.stateNode,r===null||r._visibility&1||(A=!0)),r=P,P=P.return;return r.tag===3?(P=r.stateNode,A&&s!==null&&(A=31-Je(h),r=P.hiddenUpdates,_=r[A],_===null?r[A]=[s]:_.push(s),s.lane=h|536870912),P):null}function Ql(r){if(50<_d)throw _d=0,em=null,Error(S(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var Kt={};function Hc(r,s,h,_){this.tag=r,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function na(r,s,h,_){return new Hc(r,s,h,_)}function $c(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ra(r,s){var h=r.alternate;return h===null?(h=na(r.tag,s,r.key,r.mode),h.elementType=r.elementType,h.type=r.type,h.stateNode=r.stateNode,h.alternate=r,r.alternate=h):(h.pendingProps=s,h.type=r.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=r.flags&65011712,h.childLanes=r.childLanes,h.lanes=r.lanes,h.child=r.child,h.memoizedProps=r.memoizedProps,h.memoizedState=r.memoizedState,h.updateQueue=r.updateQueue,s=r.dependencies,h.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},h.sibling=r.sibling,h.index=r.index,h.ref=r.ref,h.refCleanup=r.refCleanup,h}function mf(r,s){r.flags&=65011714;var h=r.alternate;return h===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=h.childLanes,r.lanes=h.lanes,r.child=h.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=h.memoizedProps,r.memoizedState=h.memoizedState,r.updateQueue=h.updateQueue,r.type=h.type,s=h.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function Xc(r,s,h,_,A,P){var U=0;if(_=r,typeof r=="function")$c(r)&&(U=1);else if(typeof r=="string")U=lp(r,h,zt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case Xt:return r=na(31,h,s,A),r.elementType=Xt,r.lanes=P,r;case De:return bo(h.children,A,P,s);case oe:U=8,A|=24;break;case We:return r=na(12,h,s,A|2),r.elementType=We,r.lanes=P,r;case Ke:return r=na(13,h,s,A),r.elementType=Ke,r.lanes=P,r;case vt:return r=na(19,h,s,A),r.elementType=vt,r.lanes=P,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case $e:U=10;break e;case Ze:U=9;break e;case Ct:U=11;break e;case mt:U=14;break e;case Et:U=16,_=null;break e}U=29,h=Error(S(130,r===null?"null":typeof r,"")),_=null}return s=na(U,h,s,A),s.elementType=r,s.type=_,s.lanes=P,s}function bo(r,s,h,_){return r=na(7,r,_,s),r.lanes=h,r}function $h(r,s,h){return r=na(6,r,null,s),r.lanes=h,r}function Yc(r){var s=na(18,null,null,0);return s.stateNode=r,s}function wo(r,s,h){return s=na(4,r.children!==null?r.children:[],r.key,s),s.lanes=h,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var Jl=new WeakMap;function Ir(r,s){if(typeof r=="object"&&r!==null){var h=Jl.get(r);return h!==void 0?h:(s={value:r,source:s,stack:Ls(s)},Jl.set(r,s),s)}return{value:r,source:s,stack:Ls(s)}}var To=[],So=0,rl=null,Mo=0,Zn=[],Kn=0,ps=null,ms=1,jr="";function Ns(r,s){To[So++]=Mo,To[So++]=rl,rl=r,Mo=s}function Xh(r,s,h){Zn[Kn++]=ms,Zn[Kn++]=jr,Zn[Kn++]=ps,ps=r;var _=ms;r=jr;var A=32-Je(_)-1;_&=~(1<<A),h+=1;var P=32-Je(s)+A;if(30<P){var U=A-A%5;P=(_&(1<<U)-1).toString(32),_>>=U,A-=U,ms=1<<32-Je(s)+A|h<<A|_,jr=P+r}else ms=1<<P|h<<A|_,jr=r}function al(r){r.return!==null&&(Ns(r,1),Xh(r,1,0))}function eu(r){for(;r===rl;)rl=To[--So],To[So]=null,Mo=To[--So],To[So]=null;for(;r===ps;)ps=Zn[--Kn],Zn[Kn]=null,jr=Zn[--Kn],Zn[Kn]=null,ms=Zn[--Kn],Zn[Kn]=null}function Yh(r,s){Zn[Kn++]=ms,Zn[Kn++]=jr,Zn[Kn++]=ps,ms=s.id,jr=s.overflow,ps=r}var Qn=null,ji=null,ui=!1,Vs=null,aa=!1,on=Error(S(519));function Nr(r){var s=Error(S(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Us(Ir(s,r)),on}function Vr(r){var s=r.stateNode,h=r.type,_=r.memoizedProps;switch(s[qi]=r,s[pt]=_,h){case"dialog":gi("cancel",s),gi("close",s);break;case"iframe":case"object":case"embed":gi("load",s);break;case"video":case"audio":for(h=0;h<mu.length;h++)gi(mu[h],s);break;case"source":gi("error",s);break;case"img":case"image":case"link":gi("error",s),gi("load",s);break;case"details":gi("toggle",s);break;case"input":gi("invalid",s),Ic(s,_.value,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name,!0);break;case"select":gi("invalid",s);break;case"textarea":gi("invalid",s),Vl(s,_.value,_.defaultValue,_.children)}h=_.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||s.textContent===""+h||_.suppressHydrationWarning===!0||pm(s.textContent,h)?(_.popover!=null&&(gi("beforetoggle",s),gi("toggle",s)),_.onScroll!=null&&gi("scroll",s),_.onScrollEnd!=null&&gi("scrollend",s),_.onClick!=null&&(s.onclick=Va),s=!0):s=!1,s||Nr(r,!0)}function ec(r){for(Qn=r.return;Qn;)switch(Qn.tag){case 5:case 31:case 13:aa=!1;return;case 27:case 3:aa=!0;return;default:Qn=Qn.return}}function gs(r){if(r!==Qn)return!1;if(!ui)return ec(r),ui=!0,!1;var s=r.tag,h;if((h=s!==3&&s!==27)&&((h=s===5)&&(h=r.type,h=!(h!=="form"&&h!=="button")||tp(r.type,r.memoizedProps)),h=!h),h&&ji&&Nr(r),ec(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(317));ji=sr(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(317));ji=sr(r)}else s===27?(s=ji,_u(r.type)?(r=fa,fa=null,ji=r):ji=s):ji=Qn?es(r.stateNode.nextSibling):null;return!0}function ys(){ji=Qn=null,ui=!1}function _s(){var r=Vs;return r!==null&&(Ra===null?Ra=r:Ra.push.apply(Ra,r),Vs=null),r}function Us(r){Vs===null?Vs=[r]:Vs.push(r)}var Gs=Me(null),Ta=null,vs=null;function qs(r,s,h){Mt(Gs,s._currentValue),s._currentValue=h}function xs(r){r._currentValue=Gs.current,ot(Gs)}function Wc(r,s,h){for(;r!==null;){var _=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,_!==null&&(_.childLanes|=s)):_!==null&&(_.childLanes&s)!==s&&(_.childLanes|=s),r===h)break;r=r.return}}function Kc(r,s,h,_){var A=r.child;for(A!==null&&(A.return=r);A!==null;){var P=A.dependencies;if(P!==null){var U=A.child;P=P.firstContext;e:for(;P!==null;){var ee=P;P=A;for(var be=0;be<s.length;be++)if(ee.context===s[be]){P.lanes|=h,ee=P.alternate,ee!==null&&(ee.lanes|=h),Wc(P.return,h,r),_||(U=null);break e}P=ee.next}}else if(A.tag===18){if(U=A.return,U===null)throw Error(S(341));U.lanes|=h,P=U.alternate,P!==null&&(P.lanes|=h),Wc(U,h,r),U=null}else U=A.child;if(U!==null)U.return=A;else for(U=A;U!==null;){if(U===r){U=null;break}if(A=U.sibling,A!==null){A.return=U.return,U=A;break}U=U.return}A=U}}function sa(r,s,h,_){r=null;for(var A=s,P=!1;A!==null;){if(!P){if((A.flags&524288)!==0)P=!0;else if((A.flags&262144)!==0)break}if(A.tag===10){var U=A.alternate;if(U===null)throw Error(S(387));if(U=U.memoizedProps,U!==null){var ee=A.type;Fr(A.pendingProps.value,U.value)||(r!==null?r.push(ee):r=[ee])}}else if(A===li.current){if(U=A.alternate,U===null)throw Error(S(387));U.memoizedState.memoizedState!==A.memoizedState.memoizedState&&(r!==null?r.push(Ah):r=[Ah])}A=A.return}r!==null&&Kc(s,r,h,_),s.flags|=262144}function tu(r){for(r=r.firstContext;r!==null;){if(!Fr(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Zs(r){Ta=r,vs=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function zn(r){return Qc(Ta,r)}function tc(r,s){return Ta===null&&Zs(r),Qc(r,s)}function Qc(r,s){var h=s._currentValue;if(s={context:s,memoizedValue:h,next:null},vs===null){if(r===null)throw Error(S(308));vs=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else vs=vs.next=s;return h}var Wh=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(h,_){r.push(_)}};this.abort=function(){s.aborted=!0,r.forEach(function(h){return h()})}},gf=d.unstable_scheduleCallback,Kh=d.unstable_NormalPriority,Sn={$$typeof:$e,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function bs(){return{controller:new Wh,data:new Map,refCount:0}}function iu(r){r.refCount--,r.refCount===0&&gf(Kh,function(){r.controller.abort()})}var vr=null,oa=0,sl=0,xr=null;function Op(r,s){if(vr===null){var h=vr=[];oa=0,sl=um(),xr={status:"pending",value:void 0,then:function(_){h.push(_)}}}return oa++,s.then(nu,nu),s}function nu(){if(--oa===0&&vr!==null){xr!==null&&(xr.status="fulfilled");var r=vr;vr=null,sl=0,xr=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function ic(r,s){var h=[],_={status:"pending",value:null,reason:null,then:function(A){h.push(A)}};return r.then(function(){_.status="fulfilled",_.value=s;for(var A=0;A<h.length;A++)(0,h[A])(s)},function(A){for(_.status="rejected",_.reason=A,A=0;A<h.length;A++)(0,h[A])(void 0)}),_}var Hn=tt.S;tt.S=function(r,s){Tg=Wn(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Op(r,s),Hn!==null&&Hn(r,s)};var Ga=Me(null);function Jc(){var r=Ga.current;return r!==null?r:rn.pooledCache}function eh(r,s){s===null?Mt(Ga,Ga.current):Mt(Ga,s.pool)}function yf(){var r=Jc();return r===null?null:{parent:Sn._currentValue,pool:r}}var qa=Error(S(460)),Eo=Error(S(474)),Ur=Error(S(542)),xt={then:function(){}};function nc(r){return r=r.status,r==="fulfilled"||r==="rejected"}function th(r,s,h){switch(h=r[h],h===void 0?r.push(s):h!==s&&(s.then(Va,Va),s=h),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,ih(r),r;default:if(typeof s.status=="string")s.then(Va,Va);else{if(r=rn,r!==null&&100<r.shellSuspendCounter)throw Error(S(482));r=s,r.status="pending",r.then(function(_){if(s.status==="pending"){var A=s;A.status="fulfilled",A.value=_}},function(_){if(s.status==="pending"){var A=s;A.status="rejected",A.reason=_}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,ih(r),r}throw Za=s,qa}}function Sa(r){try{var s=r._init;return s(r._payload)}catch(h){throw h!==null&&typeof h=="object"&&typeof h.then=="function"?(Za=h,qa):h}}var Za=null;function ru(){if(Za===null)throw Error(S(459));var r=Za;return Za=null,r}function ih(r){if(r===qa||r===Ur)throw Error(S(483))}var ws=null,ol=0;function rc(r){var s=ol;return ol+=1,ws===null&&(ws=[]),th(ws,r,s)}function Ts(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function nh(r,s){throw s.$$typeof===de?Error(S(525)):(r=Object.prototype.toString.call(s),Error(S(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function ac(r){function s(ze,Ee){if(r){var Ve=ze.deletions;Ve===null?(ze.deletions=[Ee],ze.flags|=16):Ve.push(Ee)}}function h(ze,Ee){if(!r)return null;for(;Ee!==null;)s(ze,Ee),Ee=Ee.sibling;return null}function _(ze){for(var Ee=new Map;ze!==null;)ze.key!==null?Ee.set(ze.key,ze):Ee.set(ze.index,ze),ze=ze.sibling;return Ee}function A(ze,Ee){return ze=ra(ze,Ee),ze.index=0,ze.sibling=null,ze}function P(ze,Ee,Ve){return ze.index=Ve,r?(Ve=ze.alternate,Ve!==null?(Ve=Ve.index,Ve<Ee?(ze.flags|=67108866,Ee):Ve):(ze.flags|=67108866,Ee)):(ze.flags|=1048576,Ee)}function U(ze){return r&&ze.alternate===null&&(ze.flags|=67108866),ze}function ee(ze,Ee,Ve,at){return Ee===null||Ee.tag!==6?(Ee=$h(Ve,ze.mode,at),Ee.return=ze,Ee):(Ee=A(Ee,Ve),Ee.return=ze,Ee)}function be(ze,Ee,Ve,at){var Nt=Ve.type;return Nt===De?it(ze,Ee,Ve.props.children,at,Ve.key):Ee!==null&&(Ee.elementType===Nt||typeof Nt=="object"&&Nt!==null&&Nt.$$typeof===Et&&Sa(Nt)===Ee.type)?(Ee=A(Ee,Ve.props),Ts(Ee,Ve),Ee.return=ze,Ee):(Ee=Xc(Ve.type,Ve.key,Ve.props,null,ze.mode,at),Ts(Ee,Ve),Ee.return=ze,Ee)}function Ge(ze,Ee,Ve,at){return Ee===null||Ee.tag!==4||Ee.stateNode.containerInfo!==Ve.containerInfo||Ee.stateNode.implementation!==Ve.implementation?(Ee=wo(Ve,ze.mode,at),Ee.return=ze,Ee):(Ee=A(Ee,Ve.children||[]),Ee.return=ze,Ee)}function it(ze,Ee,Ve,at,Nt){return Ee===null||Ee.tag!==7?(Ee=bo(Ve,ze.mode,at,Nt),Ee.return=ze,Ee):(Ee=A(Ee,Ve),Ee.return=ze,Ee)}function lt(ze,Ee,Ve){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return Ee=$h(""+Ee,ze.mode,Ve),Ee.return=ze,Ee;if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case Ae:return Ve=Xc(Ee.type,Ee.key,Ee.props,null,ze.mode,Ve),Ts(Ve,Ee),Ve.return=ze,Ve;case Ce:return Ee=wo(Ee,ze.mode,Ve),Ee.return=ze,Ee;case Et:return Ee=Sa(Ee),lt(ze,Ee,Ve)}if(Bn(Ee)||ki(Ee))return Ee=bo(Ee,ze.mode,Ve,null),Ee.return=ze,Ee;if(typeof Ee.then=="function")return lt(ze,rc(Ee),Ve);if(Ee.$$typeof===$e)return lt(ze,tc(ze,Ee),Ve);nh(ze,Ee)}return null}function qe(ze,Ee,Ve,at){var Nt=Ee!==null?Ee.key:null;if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number"||typeof Ve=="bigint")return Nt!==null?null:ee(ze,Ee,""+Ve,at);if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case Ae:return Ve.key===Nt?be(ze,Ee,Ve,at):null;case Ce:return Ve.key===Nt?Ge(ze,Ee,Ve,at):null;case Et:return Ve=Sa(Ve),qe(ze,Ee,Ve,at)}if(Bn(Ve)||ki(Ve))return Nt!==null?null:it(ze,Ee,Ve,at,null);if(typeof Ve.then=="function")return qe(ze,Ee,rc(Ve),at);if(Ve.$$typeof===$e)return qe(ze,Ee,tc(ze,Ve),at);nh(ze,Ve)}return null}function Xe(ze,Ee,Ve,at,Nt){if(typeof at=="string"&&at!==""||typeof at=="number"||typeof at=="bigint")return ze=ze.get(Ve)||null,ee(Ee,ze,""+at,Nt);if(typeof at=="object"&&at!==null){switch(at.$$typeof){case Ae:return ze=ze.get(at.key===null?Ve:at.key)||null,be(Ee,ze,at,Nt);case Ce:return ze=ze.get(at.key===null?Ve:at.key)||null,Ge(Ee,ze,at,Nt);case Et:return at=Sa(at),Xe(ze,Ee,Ve,at,Nt)}if(Bn(at)||ki(at))return ze=ze.get(Ve)||null,it(Ee,ze,at,Nt,null);if(typeof at.then=="function")return Xe(ze,Ee,Ve,rc(at),Nt);if(at.$$typeof===$e)return Xe(ze,Ee,Ve,tc(Ee,at),Nt);nh(Ee,at)}return null}function Lt(ze,Ee,Ve,at){for(var Nt=null,Ii=null,kt=Ee,Ft=Ee=0,fi=null;kt!==null&&Ft<Ve.length;Ft++){kt.index>Ft?(fi=kt,kt=null):fi=kt.sibling;var Ci=qe(ze,kt,Ve[Ft],at);if(Ci===null){kt===null&&(kt=fi);break}r&&kt&&Ci.alternate===null&&s(ze,kt),Ee=P(Ci,Ee,Ft),Ii===null?Nt=Ci:Ii.sibling=Ci,Ii=Ci,kt=fi}if(Ft===Ve.length)return h(ze,kt),ui&&Ns(ze,Ft),Nt;if(kt===null){for(;Ft<Ve.length;Ft++)kt=lt(ze,Ve[Ft],at),kt!==null&&(Ee=P(kt,Ee,Ft),Ii===null?Nt=kt:Ii.sibling=kt,Ii=kt);return ui&&Ns(ze,Ft),Nt}for(kt=_(kt);Ft<Ve.length;Ft++)fi=Xe(kt,ze,Ft,Ve[Ft],at),fi!==null&&(r&&fi.alternate!==null&&kt.delete(fi.key===null?Ft:fi.key),Ee=P(fi,Ee,Ft),Ii===null?Nt=fi:Ii.sibling=fi,Ii=fi);return r&&kt.forEach(function(Cl){return s(ze,Cl)}),ui&&Ns(ze,Ft),Nt}function Ut(ze,Ee,Ve,at){if(Ve==null)throw Error(S(151));for(var Nt=null,Ii=null,kt=Ee,Ft=Ee=0,fi=null,Ci=Ve.next();kt!==null&&!Ci.done;Ft++,Ci=Ve.next()){kt.index>Ft?(fi=kt,kt=null):fi=kt.sibling;var Cl=qe(ze,kt,Ci.value,at);if(Cl===null){kt===null&&(kt=fi);break}r&&kt&&Cl.alternate===null&&s(ze,kt),Ee=P(Cl,Ee,Ft),Ii===null?Nt=Cl:Ii.sibling=Cl,Ii=Cl,kt=fi}if(Ci.done)return h(ze,kt),ui&&Ns(ze,Ft),Nt;if(kt===null){for(;!Ci.done;Ft++,Ci=Ve.next())Ci=lt(ze,Ci.value,at),Ci!==null&&(Ee=P(Ci,Ee,Ft),Ii===null?Nt=Ci:Ii.sibling=Ci,Ii=Ci);return ui&&Ns(ze,Ft),Nt}for(kt=_(kt);!Ci.done;Ft++,Ci=Ve.next())Ci=Xe(kt,ze,Ft,Ci.value,at),Ci!==null&&(r&&Ci.alternate!==null&&kt.delete(Ci.key===null?Ft:Ci.key),Ee=P(Ci,Ee,Ft),Ii===null?Nt=Ci:Ii.sibling=Ci,Ii=Ci);return r&&kt.forEach(function(Bm){return s(ze,Bm)}),ui&&Ns(ze,Ft),Nt}function Xi(ze,Ee,Ve,at){if(typeof Ve=="object"&&Ve!==null&&Ve.type===De&&Ve.key===null&&(Ve=Ve.props.children),typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case Ae:e:{for(var Nt=Ve.key;Ee!==null;){if(Ee.key===Nt){if(Nt=Ve.type,Nt===De){if(Ee.tag===7){h(ze,Ee.sibling),at=A(Ee,Ve.props.children),at.return=ze,ze=at;break e}}else if(Ee.elementType===Nt||typeof Nt=="object"&&Nt!==null&&Nt.$$typeof===Et&&Sa(Nt)===Ee.type){h(ze,Ee.sibling),at=A(Ee,Ve.props),Ts(at,Ve),at.return=ze,ze=at;break e}h(ze,Ee);break}else s(ze,Ee);Ee=Ee.sibling}Ve.type===De?(at=bo(Ve.props.children,ze.mode,at,Ve.key),at.return=ze,ze=at):(at=Xc(Ve.type,Ve.key,Ve.props,null,ze.mode,at),Ts(at,Ve),at.return=ze,ze=at)}return U(ze);case Ce:e:{for(Nt=Ve.key;Ee!==null;){if(Ee.key===Nt)if(Ee.tag===4&&Ee.stateNode.containerInfo===Ve.containerInfo&&Ee.stateNode.implementation===Ve.implementation){h(ze,Ee.sibling),at=A(Ee,Ve.children||[]),at.return=ze,ze=at;break e}else{h(ze,Ee);break}else s(ze,Ee);Ee=Ee.sibling}at=wo(Ve,ze.mode,at),at.return=ze,ze=at}return U(ze);case Et:return Ve=Sa(Ve),Xi(ze,Ee,Ve,at)}if(Bn(Ve))return Lt(ze,Ee,Ve,at);if(ki(Ve)){if(Nt=ki(Ve),typeof Nt!="function")throw Error(S(150));return Ve=Nt.call(Ve),Ut(ze,Ee,Ve,at)}if(typeof Ve.then=="function")return Xi(ze,Ee,rc(Ve),at);if(Ve.$$typeof===$e)return Xi(ze,Ee,tc(ze,Ve),at);nh(ze,Ve)}return typeof Ve=="string"&&Ve!==""||typeof Ve=="number"||typeof Ve=="bigint"?(Ve=""+Ve,Ee!==null&&Ee.tag===6?(h(ze,Ee.sibling),at=A(Ee,Ve),at.return=ze,ze=at):(h(ze,Ee),at=$h(Ve,ze.mode,at),at.return=ze,ze=at),U(ze)):h(ze,Ee)}return function(ze,Ee,Ve,at){try{ol=0;var Nt=Xi(ze,Ee,Ve,at);return ws=null,Nt}catch(kt){if(kt===qa||kt===Ur)throw kt;var Ii=na(29,kt,null,ze.mode);return Ii.lanes=at,Ii.return=ze,Ii}}}var Ss=ac(!0),Qh=ac(!1),Ms=!1;function rh(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function sc(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Es(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Hs(r,s,h){var _=r.updateQueue;if(_===null)return null;if(_=_.shared,(Ui&2)!==0){var A=_.pending;return A===null?s.next=s:(s.next=A.next,A.next=s),_.pending=s,s=Ql(r),Hh(r,null,h),s}return Ju(r,_,s,h),Ql(r)}function Ma(r,s,h){if(s=s.updateQueue,s!==null&&(s=s.shared,(h&4194048)!==0)){var _=s.lanes;_&=r.pendingLanes,h|=_,s.lanes=h,Dn(r,h)}}function Ei(r,s){var h=r.updateQueue,_=r.alternate;if(_!==null&&(_=_.updateQueue,h===_)){var A=null,P=null;if(h=h.firstBaseUpdate,h!==null){do{var U={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};P===null?A=P=U:P=P.next=U,h=h.next}while(h!==null);P===null?A=P=s:P=P.next=s}else A=P=s;h={baseState:_.baseState,firstBaseUpdate:A,lastBaseUpdate:P,shared:_.shared,callbacks:_.callbacks},r.updateQueue=h;return}r=h.lastBaseUpdate,r===null?h.firstBaseUpdate=s:r.next=s,h.lastBaseUpdate=s}var Jh=!1;function $s(){if(Jh){var r=xr;if(r!==null)throw r}}function Ao(r,s,h,_){Jh=!1;var A=r.updateQueue;Ms=!1;var P=A.firstBaseUpdate,U=A.lastBaseUpdate,ee=A.shared.pending;if(ee!==null){A.shared.pending=null;var be=ee,Ge=be.next;be.next=null,U===null?P=Ge:U.next=Ge,U=be;var it=r.alternate;it!==null&&(it=it.updateQueue,ee=it.lastBaseUpdate,ee!==U&&(ee===null?it.firstBaseUpdate=Ge:ee.next=Ge,it.lastBaseUpdate=be))}if(P!==null){var lt=A.baseState;U=0,it=Ge=be=null,ee=P;do{var qe=ee.lane&-536870913,Xe=qe!==ee.lane;if(Xe?(mi&qe)===qe:(_&qe)===qe){qe!==0&&qe===sl&&(Jh=!0),it!==null&&(it=it.next={lane:0,tag:ee.tag,payload:ee.payload,callback:null,next:null});e:{var Lt=r,Ut=ee;qe=s;var Xi=h;switch(Ut.tag){case 1:if(Lt=Ut.payload,typeof Lt=="function"){lt=Lt.call(Xi,lt,qe);break e}lt=Lt;break e;case 3:Lt.flags=Lt.flags&-65537|128;case 0:if(Lt=Ut.payload,qe=typeof Lt=="function"?Lt.call(Xi,lt,qe):Lt,qe==null)break e;lt=te({},lt,qe);break e;case 2:Ms=!0}}qe=ee.callback,qe!==null&&(r.flags|=64,Xe&&(r.flags|=8192),Xe=A.callbacks,Xe===null?A.callbacks=[qe]:Xe.push(qe))}else Xe={lane:qe,tag:ee.tag,payload:ee.payload,callback:ee.callback,next:null},it===null?(Ge=it=Xe,be=lt):it=it.next=Xe,U|=qe;if(ee=ee.next,ee===null){if(ee=A.shared.pending,ee===null)break;Xe=ee,ee=Xe.next,Xe.next=null,A.lastBaseUpdate=Xe,A.shared.pending=null}}while(!0);it===null&&(be=lt),A.baseState=be,A.firstBaseUpdate=Ge,A.lastBaseUpdate=it,P===null&&(A.shared.lanes=0),bl|=U,r.lanes=U,r.memoizedState=lt}}function oc(r,s){if(typeof r!="function")throw Error(S(191,r));r.call(s)}function ah(r,s){var h=r.callbacks;if(h!==null)for(r.callbacks=null,r=0;r<h.length;r++)oc(h[r],s)}var ll=Me(null),lc=Me(0);function ed(r,s){r=xl,Mt(lc,r),Mt(ll,s),xl=r|s.baseLanes}function la(){Mt(lc,xl),Mt(ll,ll.current)}function ul(){xl=lc.current,ot(ll),ot(lc)}var Tt=Me(null),Dt=null;function Ea(r){var s=r.alternate;Mt(gn,gn.current&1),Mt(Tt,r),Dt===null&&(s===null||ll.current!==null||s.memoizedState!==null)&&(Dt=r)}function au(r){Mt(gn,gn.current),Mt(Tt,r),Dt===null&&(Dt=r)}function uc(r){r.tag===22?(Mt(gn,gn.current),Mt(Tt,r),Dt===null&&(Dt=r)):Mn()}function Mn(){Mt(gn,gn.current),Mt(Tt,Tt.current)}function ln(r){ot(Tt),Dt===r&&(Dt=null),ot(gn)}var gn=Me(0);function cc(r){for(var s=r;s!==null;){if(s.tag===13){var h=s.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||Hr(h)||jn(h)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Xs=0,ii=null,wi=null,ti=null,tn=!1,Aa=!1,Ha=!1,cl=0,hl=0,Ys=null,td=0;function Yi(){throw Error(S(321))}function $a(r,s){if(s===null)return!1;for(var h=0;h<s.length&&h<r.length;h++)if(!Fr(r[h],s[h]))return!1;return!0}function su(r,s,h,_,A,P){return Xs=P,ii=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,tt.H=r===null||r.memoizedState===null?Vi:Rn,Ha=!1,P=h(_,A),Ha=!1,Aa&&(P=hc(s,h,_,A)),ou(r),P}function ou(r){tt.H=Ai;var s=wi!==null&&wi.next!==null;if(Xs=0,ti=wi=ii=null,tn=!1,hl=0,Ys=null,s)throw Error(S(300));r===null||tr||(r=r.dependencies,r!==null&&tu(r)&&(tr=!0))}function hc(r,s,h,_){ii=r;var A=0;do{if(Aa&&(Ys=null),hl=0,Aa=!1,25<=A)throw Error(S(301));if(A+=1,ti=wi=null,r.updateQueue!=null){var P=r.updateQueue;P.lastEffect=null,P.events=null,P.stores=null,P.memoCache!=null&&(P.memoCache.index=0)}tt.H=Fn,P=s(h,_)}while(Aa);return P}function dc(){var r=tt.H,s=r.useState()[0];return s=typeof s.then=="function"?dl(s):s,r=r.useState()[0],(wi!==null?wi.memoizedState:null)!==r&&(ii.flags|=1024),s}function fc(){var r=cl!==0;return cl=0,r}function Co(r,s,h){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~h}function Ws(r){if(tn){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}tn=!1}Xs=0,ti=wi=ii=null,Aa=!1,hl=cl=0,Ys=null}function cr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ti===null?ii.memoizedState=ti=r:ti=ti.next=r,ti}function nn(){if(wi===null){var r=ii.alternate;r=r!==null?r.memoizedState:null}else r=wi.next;var s=ti===null?ii.memoizedState:ti.next;if(s!==null)ti=s,wi=r;else{if(r===null)throw ii.alternate===null?Error(S(467)):Error(S(310));wi=r,r={memoizedState:wi.memoizedState,baseState:wi.baseState,baseQueue:wi.baseQueue,queue:wi.queue,next:null},ti===null?ii.memoizedState=ti=r:ti=ti.next=r}return ti}function As(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function dl(r){var s=hl;return hl+=1,Ys===null&&(Ys=[]),r=th(Ys,r,s),s=ii,(ti===null?s.memoizedState:ti.next)===null&&(s=s.alternate,tt.H=s===null||s.memoizedState===null?Vi:Rn),r}function fl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return dl(r);if(r.$$typeof===$e)return zn(r)}throw Error(S(438,String(r)))}function lu(r){var s=null,h=ii.updateQueue;if(h!==null&&(s=h.memoCache),s==null){var _=ii.alternate;_!==null&&(_=_.updateQueue,_!==null&&(_=_.memoCache,_!=null&&(s={data:_.data.map(function(A){return A.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),h===null&&(h=As(),ii.updateQueue=h),h.memoCache=s,h=s.data[s.index],h===void 0)for(h=s.data[s.index]=Array(r),_=0;_<r;_++)h[_]=ct;return s.index++,h}function Xa(r,s){return typeof s=="function"?s(r):s}function g(r){var s=nn();return t(s,wi,r)}function t(r,s,h){var _=r.queue;if(_===null)throw Error(S(311));_.lastRenderedReducer=h;var A=r.baseQueue,P=_.pending;if(P!==null){if(A!==null){var U=A.next;A.next=P.next,P.next=U}s.baseQueue=A=P,_.pending=null}if(P=r.baseState,A===null)r.memoizedState=P;else{s=A.next;var ee=U=null,be=null,Ge=s,it=!1;do{var lt=Ge.lane&-536870913;if(lt!==Ge.lane?(mi&lt)===lt:(Xs&lt)===lt){var qe=Ge.revertLane;if(qe===0)be!==null&&(be=be.next={lane:0,revertLane:0,gesture:null,action:Ge.action,hasEagerState:Ge.hasEagerState,eagerState:Ge.eagerState,next:null}),lt===sl&&(it=!0);else if((Xs&qe)===qe){Ge=Ge.next,qe===sl&&(it=!0);continue}else lt={lane:0,revertLane:Ge.revertLane,gesture:null,action:Ge.action,hasEagerState:Ge.hasEagerState,eagerState:Ge.eagerState,next:null},be===null?(ee=be=lt,U=P):be=be.next=lt,ii.lanes|=qe,bl|=qe;lt=Ge.action,Ha&&h(P,lt),P=Ge.hasEagerState?Ge.eagerState:h(P,lt)}else qe={lane:lt,revertLane:Ge.revertLane,gesture:Ge.gesture,action:Ge.action,hasEagerState:Ge.hasEagerState,eagerState:Ge.eagerState,next:null},be===null?(ee=be=qe,U=P):be=be.next=qe,ii.lanes|=lt,bl|=lt;Ge=Ge.next}while(Ge!==null&&Ge!==s);if(be===null?U=P:be.next=ee,!Fr(P,r.memoizedState)&&(tr=!0,it&&(h=xr,h!==null)))throw h;r.memoizedState=P,r.baseState=U,r.baseQueue=be,_.lastRenderedState=P}return A===null&&(_.lanes=0),[r.memoizedState,_.dispatch]}function a(r){var s=nn(),h=s.queue;if(h===null)throw Error(S(311));h.lastRenderedReducer=r;var _=h.dispatch,A=h.pending,P=s.memoizedState;if(A!==null){h.pending=null;var U=A=A.next;do P=r(P,U.action),U=U.next;while(U!==A);Fr(P,s.memoizedState)||(tr=!0),s.memoizedState=P,s.baseQueue===null&&(s.baseState=P),h.lastRenderedState=P}return[P,_]}function l(r,s,h){var _=ii,A=nn(),P=ui;if(P){if(h===void 0)throw Error(S(407));h=h()}else h=s();var U=!Fr((wi||A).memoizedState,h);if(U&&(A.memoizedState=h,tr=!0),A=A.queue,je(b.bind(null,_,A,r),[r]),A.getSnapshot!==s||U||ti!==null&&ti.memoizedState.tag&1){if(_.flags|=2048,fe(9,{destroy:void 0},v.bind(null,_,A,h,s),null),rn===null)throw Error(S(349));P||(Xs&127)!==0||f(_,s,h)}return h}function f(r,s,h){r.flags|=16384,r={getSnapshot:s,value:h},s=ii.updateQueue,s===null?(s=As(),ii.updateQueue=s,s.stores=[r]):(h=s.stores,h===null?s.stores=[r]:h.push(r))}function v(r,s,h,_){s.value=h,s.getSnapshot=_,E(s)&&D(r)}function b(r,s,h){return h(function(){E(s)&&D(r)})}function E(r){var s=r.getSnapshot;r=r.value;try{var h=s();return!Fr(r,h)}catch{return!0}}function D(r){var s=wa(r,2);s!==null&&La(s,r,2)}function I(r){var s=cr();if(typeof r=="function"){var h=r;if(r=h(),Ha){Oe(!0);try{h()}finally{Oe(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xa,lastRenderedState:r},s}function k(r,s,h,_){return r.baseState=h,t(r,wi,typeof _=="function"?_:Xa)}function V(r,s,h,_,A){if(ua(r))throw Error(S(485));if(r=s.action,r!==null){var P={payload:A,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(U){P.listeners.push(U)}};tt.T!==null?h(!0):P.isTransition=!1,_(P),h=s.pending,h===null?(P.next=s.pending=P,N(s,P)):(P.next=h.next,s.pending=h.next=P)}}function N(r,s){var h=s.action,_=s.payload,A=r.state;if(s.isTransition){var P=tt.T,U={};tt.T=U;try{var ee=h(A,_),be=tt.S;be!==null&&be(U,ee),H(r,s,ee)}catch(Ge){re(r,s,Ge)}finally{P!==null&&U.types!==null&&(P.types=U.types),tt.T=P}}else try{P=h(A,_),H(r,s,P)}catch(Ge){re(r,s,Ge)}}function H(r,s,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(_){K(r,s,_)},function(_){return re(r,s,_)}):K(r,s,h)}function K(r,s,h){s.status="fulfilled",s.value=h,se(s),r.state=h,s=r.pending,s!==null&&(h=s.next,h===s?r.pending=null:(h=h.next,s.next=h,N(r,h)))}function re(r,s,h){var _=r.pending;if(r.pending=null,_!==null){_=_.next;do s.status="rejected",s.reason=h,se(s),s=s.next;while(s!==_)}r.action=null}function se(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function ae(r,s){return s}function ue(r,s){if(ui){var h=rn.formState;if(h!==null){e:{var _=ii;if(ui){if(ji){t:{for(var A=ji,P=aa;A.nodeType!==8;){if(!P){A=null;break t}if(A=es(A.nextSibling),A===null){A=null;break t}}P=A.data,A=P==="F!"||P==="F"?A:null}if(A){ji=es(A.nextSibling),_=A.data==="F!";break e}}Nr(_)}_=!1}_&&(s=h[0])}}return h=cr(),h.memoizedState=h.baseState=s,_={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ae,lastRenderedState:s},h.queue=_,h=uu.bind(null,ii,_),_.dispatch=h,_=I(!1),P=qr.bind(null,ii,!1,_.queue),_=cr(),A={state:s,dispatch:null,action:r,pending:null},_.queue=A,h=V.bind(null,ii,A,P,h),A.dispatch=h,_.memoizedState=r,[s,h,!1]}function ge(r){var s=nn();return le(s,wi,r)}function le(r,s,h){if(s=t(r,s,ae)[0],r=g(Xa)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var _=dl(s)}catch(U){throw U===qa?Ur:U}else _=s;s=nn();var A=s.queue,P=A.dispatch;return h!==s.memoizedState&&(ii.flags|=2048,fe(9,{destroy:void 0},me.bind(null,A,h),null)),[_,P,r]}function me(r,s){r.action=s}function ve(r){var s=nn(),h=wi;if(h!==null)return le(s,h,r);nn(),s=s.memoizedState,h=nn();var _=h.queue.dispatch;return h.memoizedState=r,[s,_,!1]}function fe(r,s,h,_){return r={tag:r,create:h,deps:_,inst:s,next:null},s=ii.updateQueue,s===null&&(s=As(),ii.updateQueue=s),h=s.lastEffect,h===null?s.lastEffect=r.next=r:(_=h.next,h.next=r,r.next=_,s.lastEffect=r),r}function Se(){return nn().memoizedState}function Ne(r,s,h,_){var A=cr();ii.flags|=r,A.memoizedState=fe(1|s,{destroy:void 0},h,_===void 0?null:_)}function Le(r,s,h,_){var A=nn();_=_===void 0?null:_;var P=A.memoizedState.inst;wi!==null&&_!==null&&$a(_,wi.memoizedState.deps)?A.memoizedState=fe(s,P,h,_):(ii.flags|=r,A.memoizedState=fe(1|s,P,h,_))}function Fe(r,s){Ne(8390656,8,r,s)}function je(r,s){Le(2048,8,r,s)}function dt(r){ii.flags|=4;var s=ii.updateQueue;if(s===null)s=As(),ii.updateQueue=s,s.events=[r];else{var h=s.events;h===null?s.events=[r]:h.push(r)}}function ft(r){var s=nn().memoizedState;return dt({ref:s,nextImpl:r}),function(){if((Ui&2)!==0)throw Error(S(440));return s.impl.apply(void 0,arguments)}}function nt(r,s){return Le(4,2,r,s)}function gt(r,s){return Le(4,4,r,s)}function Gt(r,s){if(typeof s=="function"){r=r();var h=s(r);return function(){typeof h=="function"?h():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function Ti(r,s,h){h=h!=null?h.concat([r]):null,Le(4,4,Gt.bind(null,s,r),h)}function Zi(){}function Ni(r,s){var h=nn();s=s===void 0?null:s;var _=h.memoizedState;return s!==null&&$a(s,_[1])?_[0]:(h.memoizedState=[r,s],r)}function Wi(r,s){var h=nn();s=s===void 0?null:s;var _=h.memoizedState;if(s!==null&&$a(s,_[1]))return _[0];if(_=r(),Ha){Oe(!0);try{r()}finally{Oe(!1)}}return h.memoizedState=[_,s],_}function zi(r,s,h){return h===void 0||(Xs&1073741824)!==0&&(mi&261930)===0?r.memoizedState=s:(r.memoizedState=h,r=Mg(),ii.lanes|=r,bl|=r,h)}function un(r,s,h,_){return Fr(h,s)?h:ll.current!==null?(r=zi(r,h,_),Fr(r,s)||(tr=!0),r):(Xs&42)===0||(Xs&1073741824)!==0&&(mi&261930)===0?(tr=!0,r.memoizedState=h):(r=Mg(),ii.lanes|=r,bl|=r,s)}function Ki(r,s,h,_,A){var P=ht.p;ht.p=P!==0&&8>P?P:8;var U=tt.T,ee={};tt.T=ee,qr(r,!1,s,h);try{var be=A(),Ge=tt.S;if(Ge!==null&&Ge(ee,be),be!==null&&typeof be=="object"&&typeof be.then=="function"){var it=ic(be,_);Wa(r,s,it,Ia(r))}else Wa(r,s,_,Ia(r))}catch(lt){Wa(r,s,{then:function(){},status:"rejected",reason:lt},Ia())}finally{ht.p=P,U!==null&&ee.types!==null&&(U.types=ee.types),tt.T=U}}function Jn(){}function yn(r,s,h,_){if(r.tag!==5)throw Error(S(476));var A=_n(r).queue;Ki(r,A,s,Rt,h===null?Jn:function(){return er(r),h(_)})}function _n(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:Rt,baseState:Rt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xa,lastRenderedState:Rt},next:null};var h={};return s.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xa,lastRenderedState:h},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function er(r){var s=_n(r);s.next===null&&(s=r.alternate.memoizedState),Wa(r,s.next.queue,{},Ia())}function Cs(){return zn(Ah)}function Ds(){return nn().memoizedState}function Ya(){return nn().memoizedState}function Gr(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var h=Ia();r=Es(h);var _=Hs(s,r,h);_!==null&&(La(_,s,h),Ma(_,s,h)),s={cache:bs()},r.payload=s;return}s=s.return}}function pl(r,s,h){var _=Ia();h={lane:_,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},ua(r)?Ca(s,h):(h=xo(r,s,h,_),h!==null&&(La(h,r,_),Da(h,s,_)))}function uu(r,s,h){var _=Ia();Wa(r,s,h,_)}function Wa(r,s,h,_){var A={lane:_,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null};if(ua(r))Ca(s,A);else{var P=r.alternate;if(r.lanes===0&&(P===null||P.lanes===0)&&(P=s.lastRenderedReducer,P!==null))try{var U=s.lastRenderedState,ee=P(U,h);if(A.hasEagerState=!0,A.eagerState=ee,Fr(ee,U))return Ju(r,s,A,0),rn===null&&nl(),!1}catch{}if(h=xo(r,s,A,_),h!==null)return La(h,r,_),Da(h,s,_),!0}return!1}function qr(r,s,h,_){if(_={lane:2,revertLane:um(),gesture:null,action:_,hasEagerState:!1,eagerState:null,next:null},ua(r)){if(s)throw Error(S(479))}else s=xo(r,h,_,2),s!==null&&La(s,r,2)}function ua(r){var s=r.alternate;return r===ii||s!==null&&s===ii}function Ca(r,s){Aa=tn=!0;var h=r.pending;h===null?s.next=s:(s.next=h.next,h.next=s),r.pending=s}function Da(r,s,h){if((h&4194048)!==0){var _=s.lanes;_&=r.pendingLanes,h|=_,s.lanes=h,Dn(r,h)}}var Ai={readContext:zn,use:fl,useCallback:Yi,useContext:Yi,useEffect:Yi,useImperativeHandle:Yi,useLayoutEffect:Yi,useInsertionEffect:Yi,useMemo:Yi,useReducer:Yi,useRef:Yi,useState:Yi,useDebugValue:Yi,useDeferredValue:Yi,useTransition:Yi,useSyncExternalStore:Yi,useId:Yi,useHostTransitionStatus:Yi,useFormState:Yi,useActionState:Yi,useOptimistic:Yi,useMemoCache:Yi,useCacheRefresh:Yi};Ai.useEffectEvent=Yi;var Vi={readContext:zn,use:fl,useCallback:function(r,s){return cr().memoizedState=[r,s===void 0?null:s],r},useContext:zn,useEffect:Fe,useImperativeHandle:function(r,s,h){h=h!=null?h.concat([r]):null,Ne(4194308,4,Gt.bind(null,s,r),h)},useLayoutEffect:function(r,s){return Ne(4194308,4,r,s)},useInsertionEffect:function(r,s){Ne(4,2,r,s)},useMemo:function(r,s){var h=cr();s=s===void 0?null:s;var _=r();if(Ha){Oe(!0);try{r()}finally{Oe(!1)}}return h.memoizedState=[_,s],_},useReducer:function(r,s,h){var _=cr();if(h!==void 0){var A=h(s);if(Ha){Oe(!0);try{h(s)}finally{Oe(!1)}}}else A=s;return _.memoizedState=_.baseState=A,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:A},_.queue=r,r=r.dispatch=pl.bind(null,ii,r),[_.memoizedState,r]},useRef:function(r){var s=cr();return r={current:r},s.memoizedState=r},useState:function(r){r=I(r);var s=r.queue,h=uu.bind(null,ii,s);return s.dispatch=h,[r.memoizedState,h]},useDebugValue:Zi,useDeferredValue:function(r,s){var h=cr();return zi(h,r,s)},useTransition:function(){var r=I(!1);return r=Ki.bind(null,ii,r.queue,!0,!1),cr().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,h){var _=ii,A=cr();if(ui){if(h===void 0)throw Error(S(407));h=h()}else{if(h=s(),rn===null)throw Error(S(349));(mi&127)!==0||f(_,s,h)}A.memoizedState=h;var P={value:h,getSnapshot:s};return A.queue=P,Fe(b.bind(null,_,P,r),[r]),_.flags|=2048,fe(9,{destroy:void 0},v.bind(null,_,P,h,s),null),h},useId:function(){var r=cr(),s=rn.identifierPrefix;if(ui){var h=jr,_=ms;h=(_&~(1<<32-Je(_)-1)).toString(32)+h,s="_"+s+"R_"+h,h=cl++,0<h&&(s+="H"+h.toString(32)),s+="_"}else h=td++,s="_"+s+"r_"+h.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:Cs,useFormState:ue,useActionState:ue,useOptimistic:function(r){var s=cr();s.memoizedState=s.baseState=r;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=h,s=qr.bind(null,ii,!0,h),h.dispatch=s,[r,s]},useMemoCache:lu,useCacheRefresh:function(){return cr().memoizedState=Gr.bind(null,ii)},useEffectEvent:function(r){var s=cr(),h={impl:r};return s.memoizedState=h,function(){if((Ui&2)!==0)throw Error(S(440));return h.impl.apply(void 0,arguments)}}},Rn={readContext:zn,use:fl,useCallback:Ni,useContext:zn,useEffect:je,useImperativeHandle:Ti,useInsertionEffect:nt,useLayoutEffect:gt,useMemo:Wi,useReducer:g,useRef:Se,useState:function(){return g(Xa)},useDebugValue:Zi,useDeferredValue:function(r,s){var h=nn();return un(h,wi.memoizedState,r,s)},useTransition:function(){var r=g(Xa)[0],s=nn().memoizedState;return[typeof r=="boolean"?r:dl(r),s]},useSyncExternalStore:l,useId:Ds,useHostTransitionStatus:Cs,useFormState:ge,useActionState:ge,useOptimistic:function(r,s){var h=nn();return k(h,wi,r,s)},useMemoCache:lu,useCacheRefresh:Ya};Rn.useEffectEvent=ft;var Fn={readContext:zn,use:fl,useCallback:Ni,useContext:zn,useEffect:je,useImperativeHandle:Ti,useInsertionEffect:nt,useLayoutEffect:gt,useMemo:Wi,useReducer:a,useRef:Se,useState:function(){return a(Xa)},useDebugValue:Zi,useDeferredValue:function(r,s){var h=nn();return wi===null?zi(h,r,s):un(h,wi.memoizedState,r,s)},useTransition:function(){var r=a(Xa)[0],s=nn().memoizedState;return[typeof r=="boolean"?r:dl(r),s]},useSyncExternalStore:l,useId:Ds,useHostTransitionStatus:Cs,useFormState:ve,useActionState:ve,useOptimistic:function(r,s){var h=nn();return wi!==null?k(h,wi,r,s):(h.baseState=r,[r,h.queue.dispatch])},useMemoCache:lu,useCacheRefresh:Ya};Fn.useEffectEvent=ft;function sh(r,s,h,_){s=r.memoizedState,h=h(_,s),h=h==null?s:te({},s,h),r.memoizedState=h,r.lanes===0&&(r.updateQueue.baseState=h)}var oh={enqueueSetState:function(r,s,h){r=r._reactInternals;var _=Ia(),A=Es(_);A.payload=s,h!=null&&(A.callback=h),s=Hs(r,A,_),s!==null&&(La(s,r,_),Ma(s,r,_))},enqueueReplaceState:function(r,s,h){r=r._reactInternals;var _=Ia(),A=Es(_);A.tag=1,A.payload=s,h!=null&&(A.callback=h),s=Hs(r,A,_),s!==null&&(La(s,r,_),Ma(s,r,_))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var h=Ia(),_=Es(h);_.tag=2,s!=null&&(_.callback=s),s=Hs(r,_,h),s!==null&&(La(s,r,h),Ma(s,r,h))}};function Do(r,s,h,_,A,P,U){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(_,P,U):s.prototype&&s.prototype.isPureReactComponent?!vo(h,_)||!vo(A,P):!0}function _f(r,s,h,_){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(h,_),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(h,_),s.state!==r&&oh.enqueueReplaceState(s,s.state,null)}function Po(r,s){var h=s;if("ref"in s){h={};for(var _ in s)_!=="ref"&&(h[_]=s[_])}if(r=r.defaultProps){h===s&&(h=te({},h));for(var A in r)h[A]===void 0&&(h[A]=r[A])}return h}function lh(r){fs(r)}function Ks(r){console.error(r)}function Qs(r){fs(r)}function Ka(r,s){try{var h=r.onUncaughtError;h(s.value,{componentStack:s.stack})}catch(_){setTimeout(function(){throw _})}}function uh(r,s,h){try{var _=r.onCaughtError;_(h.value,{componentStack:h.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(A){setTimeout(function(){throw A})}}function pc(r,s,h){return h=Es(h),h.tag=3,h.payload={element:null},h.callback=function(){Ka(r,s)},h}function mc(r){return r=Es(r),r.tag=3,r}function gc(r,s,h,_){var A=h.type.getDerivedStateFromError;if(typeof A=="function"){var P=_.value;r.payload=function(){return A(P)},r.callback=function(){uh(s,h,_)}}var U=h.stateNode;U!==null&&typeof U.componentDidCatch=="function"&&(r.callback=function(){uh(s,h,_),typeof A!="function"&&(wl===null?wl=new Set([this]):wl.add(this));var ee=_.stack;this.componentDidCatch(_.value,{componentStack:ee!==null?ee:""})})}function vf(r,s,h,_,A){if(h.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){if(s=h.alternate,s!==null&&sa(s,h,A,!0),h=Tt.current,h!==null){switch(h.tag){case 31:case 13:return Dt===null?xd():h.alternate===null&&In===0&&(In=3),h.flags&=-257,h.flags|=65536,h.lanes=A,_===xt?h.flags|=16384:(s=h.updateQueue,s===null?h.updateQueue=new Set([_]):s.add(_),qf(r,_,A)),!1;case 22:return h.flags|=65536,_===xt?h.flags|=16384:(s=h.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([_])},h.updateQueue=s):(h=s.retryQueue,h===null?s.retryQueue=new Set([_]):h.add(_)),qf(r,_,A)),!1}throw Error(S(435,h.tag))}return qf(r,_,A),xd(),!1}if(ui)return s=Tt.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=A,_!==on&&(r=Error(S(422),{cause:_}),Us(Ir(r,h)))):(_!==on&&(s=Error(S(423),{cause:_}),Us(Ir(s,h))),r=r.current.alternate,r.flags|=65536,A&=-A,r.lanes|=A,_=Ir(_,h),A=pc(r.stateNode,_,A),Ei(r,A),In!==4&&(In=2)),!1;var P=Error(S(520),{cause:_});if(P=Ir(P,h),gd===null?gd=[P]:gd.push(P),In!==4&&(In=2),s===null)return!0;_=Ir(_,h),h=s;do{switch(h.tag){case 3:return h.flags|=65536,r=A&-A,h.lanes|=r,r=pc(h.stateNode,_,r),Ei(h,r),!1;case 1:if(s=h.type,P=h.stateNode,(h.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||P!==null&&typeof P.componentDidCatch=="function"&&(wl===null||!wl.has(P))))return h.flags|=65536,A&=-A,h.lanes|=A,A=mc(A),gc(A,r,h,_),Ei(h,A),!1}h=h.return}while(h!==null);return!1}var xf=Error(S(461)),tr=!1;function hr(r,s,h,_){s.child=r===null?Qh(s,null,h,_):Ss(s,r.child,h,_)}function lg(r,s,h,_,A){h=h.render;var P=s.ref;if("ref"in _){var U={};for(var ee in _)ee!=="ref"&&(U[ee]=_[ee])}else U=_;return Zs(s),_=su(r,s,h,U,P,A),ee=fc(),r!==null&&!tr?(Co(r,s,A),Ro(r,s,A)):(ui&&ee&&al(s),s.flags|=1,hr(r,s,_,A),s.child)}function bf(r,s,h,_,A){if(r===null){var P=h.type;return typeof P=="function"&&!$c(P)&&P.defaultProps===void 0&&h.compare===null?(s.tag=15,s.type=P,Fp(r,s,P,_,A)):(r=Xc(h.type,null,_,s,s.mode,A),r.ref=s.ref,r.return=s,s.child=r)}if(P=r.child,!rd(r,A)){var U=P.memoizedProps;if(h=h.compare,h=h!==null?h:vo,h(U,_)&&r.ref===s.ref)return Ro(r,s,A)}return s.flags|=1,r=ra(P,_),r.ref=s.ref,r.return=s,s.child=r}function Fp(r,s,h,_,A){if(r!==null){var P=r.memoizedProps;if(vo(P,_)&&r.ref===s.ref)if(tr=!1,s.pendingProps=_=P,rd(r,A))(r.flags&131072)!==0&&(tr=!0);else return s.lanes=r.lanes,Ro(r,s,A)}return Np(r,s,h,_,A)}function jp(r,s,h,_){var A=_.children,P=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),_.mode==="hidden"){if((s.flags&128)!==0){if(P=P!==null?P.baseLanes|h:h,r!==null){for(_=s.child=r.child,A=0;_!==null;)A=A|_.lanes|_.childLanes,_=_.sibling;_=A&~P}else _=0,s.child=null;return ug(r,s,P,h,_)}if((h&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&eh(s,P!==null?P.cachePool:null),P!==null?ed(s,P):la(),uc(s);else return _=s.lanes=536870912,ug(r,s,P!==null?P.baseLanes|h:h,h,_)}else P!==null?(eh(s,P.cachePool),ed(s,P),Mn(),s.memoizedState=null):(r!==null&&eh(s,null),la(),Mn());return hr(r,s,A,h),s.child}function zo(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function ug(r,s,h,_,A){var P=Jc();return P=P===null?null:{parent:Sn._currentValue,pool:P},s.memoizedState={baseLanes:h,cachePool:P},r!==null&&eh(s,null),la(),uc(s),r!==null&&sa(r,s,_,!0),s.childLanes=A,null}function ml(r,s){return s=Ef({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function id(r,s,h){return Ss(s,r.child,null,h),r=ml(s,s.pendingProps),r.flags|=2,ln(s),s.memoizedState=null,r}function wf(r,s,h){var _=s.pendingProps,A=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(ui){if(_.mode==="hidden")return r=ml(s,_),s.lanes=536870912,zo(null,r);if(au(s),(r=ji)?(r=vu(r,aa),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:ps!==null?{id:ms,overflow:jr}:null,retryLane:536870912,hydrationErrors:null},h=Yc(r),h.return=s,s.child=h,Qn=s,ji=null)):r=null,r===null)throw Nr(s);return s.lanes=536870912,null}return ml(s,_)}var P=r.memoizedState;if(P!==null){var U=P.dehydrated;if(au(s),A)if(s.flags&256)s.flags&=-257,s=id(r,s,h);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(S(558));else if(tr||sa(r,s,h,!1),A=(h&r.childLanes)!==0,tr||A){if(_=rn,_!==null&&(U=Ol(_,h),U!==0&&U!==P.retryLane))throw P.retryLane=U,wa(r,U),La(_,r,U),xf;xd(),s=id(r,s,h)}else r=P.treeContext,ji=es(U.nextSibling),Qn=s,ui=!0,Vs=null,aa=!1,r!==null&&Yh(s,r),s=ml(s,_),s.flags|=4096;return s}return r=ra(r.child,{mode:_.mode,children:_.children}),r.ref=s.ref,s.child=r,r.return=s,r}function Tf(r,s){var h=s.ref;if(h===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(S(284));(r===null||r.ref!==h)&&(s.flags|=4194816)}}function Np(r,s,h,_,A){return Zs(s),h=su(r,s,h,_,void 0,A),_=fc(),r!==null&&!tr?(Co(r,s,A),Ro(r,s,A)):(ui&&_&&al(s),s.flags|=1,hr(r,s,h,A),s.child)}function cg(r,s,h,_,A,P){return Zs(s),s.updateQueue=null,h=hc(s,_,h,A),ou(r),_=fc(),r!==null&&!tr?(Co(r,s,P),Ro(r,s,P)):(ui&&_&&al(s),s.flags|=1,hr(r,s,h,P),s.child)}function hg(r,s,h,_,A){if(Zs(s),s.stateNode===null){var P=Kt,U=h.contextType;typeof U=="object"&&U!==null&&(P=zn(U)),P=new h(_,P),s.memoizedState=P.state!==null&&P.state!==void 0?P.state:null,P.updater=oh,s.stateNode=P,P._reactInternals=s,P=s.stateNode,P.props=_,P.state=s.memoizedState,P.refs={},rh(s),U=h.contextType,P.context=typeof U=="object"&&U!==null?zn(U):Kt,P.state=s.memoizedState,U=h.getDerivedStateFromProps,typeof U=="function"&&(sh(s,h,U,_),P.state=s.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof P.getSnapshotBeforeUpdate=="function"||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(U=P.state,typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount(),U!==P.state&&oh.enqueueReplaceState(P,P.state,null),Ao(s,_,P,A),$s(),P.state=s.memoizedState),typeof P.componentDidMount=="function"&&(s.flags|=4194308),_=!0}else if(r===null){P=s.stateNode;var ee=s.memoizedProps,be=Po(h,ee);P.props=be;var Ge=P.context,it=h.contextType;U=Kt,typeof it=="object"&&it!==null&&(U=zn(it));var lt=h.getDerivedStateFromProps;it=typeof lt=="function"||typeof P.getSnapshotBeforeUpdate=="function",ee=s.pendingProps!==ee,it||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(ee||Ge!==U)&&_f(s,P,_,U),Ms=!1;var qe=s.memoizedState;P.state=qe,Ao(s,_,P,A),$s(),Ge=s.memoizedState,ee||qe!==Ge||Ms?(typeof lt=="function"&&(sh(s,h,lt,_),Ge=s.memoizedState),(be=Ms||Do(s,h,be,_,qe,Ge,U))?(it||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(s.flags|=4194308)):(typeof P.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=_,s.memoizedState=Ge),P.props=_,P.state=Ge,P.context=U,_=be):(typeof P.componentDidMount=="function"&&(s.flags|=4194308),_=!1)}else{P=s.stateNode,sc(r,s),U=s.memoizedProps,it=Po(h,U),P.props=it,lt=s.pendingProps,qe=P.context,Ge=h.contextType,be=Kt,typeof Ge=="object"&&Ge!==null&&(be=zn(Ge)),ee=h.getDerivedStateFromProps,(Ge=typeof ee=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(U!==lt||qe!==be)&&_f(s,P,_,be),Ms=!1,qe=s.memoizedState,P.state=qe,Ao(s,_,P,A),$s();var Xe=s.memoizedState;U!==lt||qe!==Xe||Ms||r!==null&&r.dependencies!==null&&tu(r.dependencies)?(typeof ee=="function"&&(sh(s,h,ee,_),Xe=s.memoizedState),(it=Ms||Do(s,h,it,_,qe,Xe,be)||r!==null&&r.dependencies!==null&&tu(r.dependencies))?(Ge||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(_,Xe,be),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(_,Xe,be)),typeof P.componentDidUpdate=="function"&&(s.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof P.componentDidUpdate!="function"||U===r.memoizedProps&&qe===r.memoizedState||(s.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||U===r.memoizedProps&&qe===r.memoizedState||(s.flags|=1024),s.memoizedProps=_,s.memoizedState=Xe),P.props=_,P.state=Xe,P.context=be,_=it):(typeof P.componentDidUpdate!="function"||U===r.memoizedProps&&qe===r.memoizedState||(s.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||U===r.memoizedProps&&qe===r.memoizedState||(s.flags|=1024),_=!1)}return P=_,Tf(r,s),_=(s.flags&128)!==0,P||_?(P=s.stateNode,h=_&&typeof h.getDerivedStateFromError!="function"?null:P.render(),s.flags|=1,r!==null&&_?(s.child=Ss(s,r.child,null,A),s.child=Ss(s,null,h,A)):hr(r,s,h,A),s.memoizedState=P.state,r=s.child):r=Ro(r,s,A),r}function dg(r,s,h,_){return ys(),s.flags|=256,hr(r,s,h,_),s.child}var Sf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function nd(r){return{baseLanes:r,cachePool:yf()}}function Mf(r,s,h){return r=r!==null?r.childLanes&~h:0,s&&(r|=Lr),r}function Vp(r,s,h){var _=s.pendingProps,A=!1,P=(s.flags&128)!==0,U;if((U=P)||(U=r!==null&&r.memoizedState===null?!1:(gn.current&2)!==0),U&&(A=!0,s.flags&=-129),U=(s.flags&32)!==0,s.flags&=-33,r===null){if(ui){if(A?Ea(s):Mn(),(r=ji)?(r=vu(r,aa),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:ps!==null?{id:ms,overflow:jr}:null,retryLane:536870912,hydrationErrors:null},h=Yc(r),h.return=s,s.child=h,Qn=s,ji=null)):r=null,r===null)throw Nr(s);return jn(r)?s.lanes=32:s.lanes=536870912,null}var ee=_.children;return _=_.fallback,A?(Mn(),A=s.mode,ee=Ef({mode:"hidden",children:ee},A),_=bo(_,A,h,null),ee.return=s,_.return=s,ee.sibling=_,s.child=ee,_=s.child,_.memoizedState=nd(h),_.childLanes=Mf(r,U,h),s.memoizedState=Sf,zo(null,_)):(Ea(s),Up(s,ee))}var be=r.memoizedState;if(be!==null&&(ee=be.dehydrated,ee!==null)){if(P)s.flags&256?(Ea(s),s.flags&=-257,s=Af(r,s,h)):s.memoizedState!==null?(Mn(),s.child=r.child,s.flags|=128,s=null):(Mn(),ee=_.fallback,A=s.mode,_=Ef({mode:"visible",children:_.children},A),ee=bo(ee,A,h,null),ee.flags|=2,_.return=s,ee.return=s,_.sibling=ee,s.child=_,Ss(s,r.child,null,h),_=s.child,_.memoizedState=nd(h),_.childLanes=Mf(r,U,h),s.memoizedState=Sf,s=zo(null,_));else if(Ea(s),jn(ee)){if(U=ee.nextSibling&&ee.nextSibling.dataset,U)var Ge=U.dgst;U=Ge,_=Error(S(419)),_.stack="",_.digest=U,Us({value:_,source:null,stack:null}),s=Af(r,s,h)}else if(tr||sa(r,s,h,!1),U=(h&r.childLanes)!==0,tr||U){if(U=rn,U!==null&&(_=Ol(U,h),_!==0&&_!==be.retryLane))throw be.retryLane=_,wa(r,_),La(U,r,_),xf;Hr(ee)||xd(),s=Af(r,s,h)}else Hr(ee)?(s.flags|=192,s.child=r.child,s=null):(r=be.treeContext,ji=es(ee.nextSibling),Qn=s,ui=!0,Vs=null,aa=!1,r!==null&&Yh(s,r),s=Up(s,_.children),s.flags|=4096);return s}return A?(Mn(),ee=_.fallback,A=s.mode,be=r.child,Ge=be.sibling,_=ra(be,{mode:"hidden",children:_.children}),_.subtreeFlags=be.subtreeFlags&65011712,Ge!==null?ee=ra(Ge,ee):(ee=bo(ee,A,h,null),ee.flags|=2),ee.return=s,_.return=s,_.sibling=ee,s.child=_,zo(null,_),_=s.child,ee=r.child.memoizedState,ee===null?ee=nd(h):(A=ee.cachePool,A!==null?(be=Sn._currentValue,A=A.parent!==be?{parent:be,pool:be}:A):A=yf(),ee={baseLanes:ee.baseLanes|h,cachePool:A}),_.memoizedState=ee,_.childLanes=Mf(r,U,h),s.memoizedState=Sf,zo(r.child,_)):(Ea(s),h=r.child,r=h.sibling,h=ra(h,{mode:"visible",children:_.children}),h.return=s,h.sibling=null,r!==null&&(U=s.deletions,U===null?(s.deletions=[r],s.flags|=16):U.push(r)),s.child=h,s.memoizedState=null,h)}function Up(r,s){return s=Ef({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function Ef(r,s){return r=na(22,r,null,s),r.lanes=0,r}function Af(r,s,h){return Ss(s,r.child,null,h),r=Up(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function Gp(r,s,h){r.lanes|=s;var _=r.alternate;_!==null&&(_.lanes|=s),Wc(r.return,s,h)}function qp(r,s,h,_,A,P){var U=r.memoizedState;U===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:_,tail:h,tailMode:A,treeForkCount:P}:(U.isBackwards=s,U.rendering=null,U.renderingStartTime=0,U.last=_,U.tail=h,U.tailMode=A,U.treeForkCount=P)}function Cf(r,s,h){var _=s.pendingProps,A=_.revealOrder,P=_.tail;_=_.children;var U=gn.current,ee=(U&2)!==0;if(ee?(U=U&1|2,s.flags|=128):U&=1,Mt(gn,U),hr(r,s,_,h),_=ui?Mo:0,!ee&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Gp(r,h,s);else if(r.tag===19)Gp(r,h,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(A){case"forwards":for(h=s.child,A=null;h!==null;)r=h.alternate,r!==null&&cc(r)===null&&(A=h),h=h.sibling;h=A,h===null?(A=s.child,s.child=null):(A=h.sibling,h.sibling=null),qp(s,!1,A,h,P,_);break;case"backwards":case"unstable_legacy-backwards":for(h=null,A=s.child,s.child=null;A!==null;){if(r=A.alternate,r!==null&&cc(r)===null){s.child=A;break}r=A.sibling,A.sibling=h,h=A,A=r}qp(s,!0,h,null,P,_);break;case"together":qp(s,!1,null,null,void 0,_);break;default:s.memoizedState=null}return s.child}function Ro(r,s,h){if(r!==null&&(s.dependencies=r.dependencies),bl|=s.lanes,(h&s.childLanes)===0)if(r!==null){if(sa(r,s,h,!1),(h&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(S(153));if(s.child!==null){for(r=s.child,h=ra(r,r.pendingProps),s.child=h,h.return=s;r.sibling!==null;)r=r.sibling,h=h.sibling=ra(r,r.pendingProps),h.return=s;h.sibling=null}return s.child}function rd(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&tu(r)))}function ad(r,s,h){switch(s.tag){case 3:Bi(s,s.stateNode.containerInfo),qs(s,Sn,r.memoizedState.cache),ys();break;case 27:case 5:Er(s);break;case 4:Bi(s,s.stateNode.containerInfo);break;case 10:qs(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,au(s),null;break;case 13:var _=s.memoizedState;if(_!==null)return _.dehydrated!==null?(Ea(s),s.flags|=128,null):(h&s.child.childLanes)!==0?Vp(r,s,h):(Ea(s),r=Ro(r,s,h),r!==null?r.sibling:null);Ea(s);break;case 19:var A=(r.flags&128)!==0;if(_=(h&s.childLanes)!==0,_||(sa(r,s,h,!1),_=(h&s.childLanes)!==0),A){if(_)return Cf(r,s,h);s.flags|=128}if(A=s.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),Mt(gn,gn.current),_)break;return null;case 22:return s.lanes=0,jp(r,s,h,s.pendingProps);case 24:qs(s,Sn,r.memoizedState.cache)}return Ro(r,s,h)}function Zr(r,s,h){if(r!==null)if(r.memoizedProps!==s.pendingProps)tr=!0;else{if(!rd(r,h)&&(s.flags&128)===0)return tr=!1,ad(r,s,h);tr=(r.flags&131072)!==0}else tr=!1,ui&&(s.flags&1048576)!==0&&Xh(s,Mo,s.index);switch(s.lanes=0,s.tag){case 16:e:{var _=s.pendingProps;if(r=Sa(s.elementType),s.type=r,typeof r=="function")$c(r)?(_=Po(r,_),s.tag=1,s=hg(null,s,r,_,h)):(s.tag=0,s=Np(null,s,r,_,h));else{if(r!=null){var A=r.$$typeof;if(A===Ct){s.tag=11,s=lg(null,s,r,_,h);break e}else if(A===mt){s.tag=14,s=bf(null,s,r,_,h);break e}}throw s=mr(r)||r,Error(S(306,s,""))}}return s;case 0:return Np(r,s,s.type,s.pendingProps,h);case 1:return _=s.type,A=Po(_,s.pendingProps),hg(r,s,_,A,h);case 3:e:{if(Bi(s,s.stateNode.containerInfo),r===null)throw Error(S(387));_=s.pendingProps;var P=s.memoizedState;A=P.element,sc(r,s),Ao(s,_,null,h);var U=s.memoizedState;if(_=U.cache,qs(s,Sn,_),_!==P.cache&&Kc(s,[Sn],h,!0),$s(),_=U.element,P.isDehydrated)if(P={element:_,isDehydrated:!1,cache:U.cache},s.updateQueue.baseState=P,s.memoizedState=P,s.flags&256){s=dg(r,s,_,h);break e}else if(_!==A){A=Ir(Error(S(424)),s),Us(A),s=dg(r,s,_,h);break e}else for(r=s.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,ji=es(r.firstChild),Qn=s,ui=!0,Vs=null,aa=!0,h=Qh(s,null,_,h),s.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(ys(),_===A){s=Ro(r,s,h);break e}hr(r,s,_,h)}s=s.child}return s;case 26:return Tf(r,s),r===null?(h=Sm(s.type,null,s.pendingProps,null))?s.memoizedState=h:ui||(h=s.type,r=s.pendingProps,_=Ed(Wt.current).createElement(h),_[qi]=s,_[pt]=r,fr(_,h,r),fn(_),s.stateNode=_):s.memoizedState=Sm(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return Er(s),r===null&&ui&&(_=s.stateNode=Hg(s.type,s.pendingProps,Wt.current),Qn=s,aa=!0,A=ji,_u(s.type)?(fa=A,ji=es(_.firstChild)):ji=A),hr(r,s,s.pendingProps.children,h),Tf(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&ui&&((A=_=ji)&&(_=br(_,s.type,s.pendingProps,aa),_!==null?(s.stateNode=_,Qn=s,ji=es(_.firstChild),aa=!1,A=!0):A=!1),A||Nr(s)),Er(s),A=s.type,P=s.pendingProps,U=r!==null?r.memoizedProps:null,_=P.children,tp(A,P)?_=null:U!==null&&tp(A,U)&&(s.flags|=32),s.memoizedState!==null&&(A=su(r,s,dc,null,null,h),Ah._currentValue=A),Tf(r,s),hr(r,s,_,h),s.child;case 6:return r===null&&ui&&((r=h=ji)&&(h=no(h,s.pendingProps,aa),h!==null?(s.stateNode=h,Qn=s,ji=null,r=!0):r=!1),r||Nr(s)),null;case 13:return Vp(r,s,h);case 4:return Bi(s,s.stateNode.containerInfo),_=s.pendingProps,r===null?s.child=Ss(s,null,_,h):hr(r,s,_,h),s.child;case 11:return lg(r,s,s.type,s.pendingProps,h);case 7:return hr(r,s,s.pendingProps,h),s.child;case 8:return hr(r,s,s.pendingProps.children,h),s.child;case 12:return hr(r,s,s.pendingProps.children,h),s.child;case 10:return _=s.pendingProps,qs(s,s.type,_.value),hr(r,s,_.children,h),s.child;case 9:return A=s.type._context,_=s.pendingProps.children,Zs(s),A=zn(A),_=_(A),s.flags|=1,hr(r,s,_,h),s.child;case 14:return bf(r,s,s.type,s.pendingProps,h);case 15:return Fp(r,s,s.type,s.pendingProps,h);case 19:return Cf(r,s,h);case 31:return wf(r,s,h);case 22:return jp(r,s,h,s.pendingProps);case 24:return Zs(s),_=zn(Sn),r===null?(A=Jc(),A===null&&(A=rn,P=bs(),A.pooledCache=P,P.refCount++,P!==null&&(A.pooledCacheLanes|=h),A=P),s.memoizedState={parent:_,cache:A},rh(s),qs(s,Sn,A)):((r.lanes&h)!==0&&(sc(r,s),Ao(s,null,null,h),$s()),A=r.memoizedState,P=s.memoizedState,A.parent!==_?(A={parent:_,cache:_},s.memoizedState=A,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=A),qs(s,Sn,_)):(_=P.cache,qs(s,Sn,_),_!==A.cache&&Kc(s,[Sn],h,!0))),hr(r,s,s.pendingProps.children,h),s.child;case 29:throw s.pendingProps}throw Error(S(156,s.tag))}function Io(r){r.flags|=4}function sd(r,s,h,_,A){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(A&335544128)===A)if(r.stateNode.complete)r.flags|=8192;else if(im())r.flags|=8192;else throw Za=xt,Eo}else r.flags&=-16777217}function fg(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!Pd(s))if(im())r.flags|=8192;else throw Za=xt,Eo}function od(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?Mi():536870912,r.lanes|=s,bc|=s)}function ld(r,s){if(!ui)switch(r.tailMode){case"hidden":s=r.tail;for(var h=null;s!==null;)s.alternate!==null&&(h=s),s=s.sibling;h===null?r.tail=null:h.sibling=null;break;case"collapsed":h=r.tail;for(var _=null;h!==null;)h.alternate!==null&&(_=h),h=h.sibling;_===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:_.sibling=null}}function vn(r){var s=r.alternate!==null&&r.alternate.child===r.child,h=0,_=0;if(s)for(var A=r.child;A!==null;)h|=A.lanes|A.childLanes,_|=A.subtreeFlags&65011712,_|=A.flags&65011712,A.return=r,A=A.sibling;else for(A=r.child;A!==null;)h|=A.lanes|A.childLanes,_|=A.subtreeFlags,_|=A.flags,A.return=r,A=A.sibling;return r.subtreeFlags|=_,r.childLanes=h,s}function pg(r,s,h){var _=s.pendingProps;switch(eu(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vn(s),null;case 1:return vn(s),null;case 3:return h=s.stateNode,_=null,r!==null&&(_=r.memoizedState.cache),s.memoizedState.cache!==_&&(s.flags|=2048),xs(Sn),Hi(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(r===null||r.child===null)&&(gs(s)?Io(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,_s())),vn(s),null;case 26:var A=s.type,P=s.memoizedState;return r===null?(Io(s),P!==null?(vn(s),fg(s,P)):(vn(s),sd(s,A,null,_,h))):P?P!==r.memoizedState?(Io(s),vn(s),fg(s,P)):(vn(s),s.flags&=-16777217):(r=r.memoizedProps,r!==_&&Io(s),vn(s),sd(s,A,r,_,h)),null;case 27:if(so(s),h=Wt.current,A=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==_&&Io(s);else{if(!_){if(s.stateNode===null)throw Error(S(166));return vn(s),null}r=zt.current,gs(s)?Vr(s):(r=Hg(A,_,h),s.stateNode=r,Io(s))}return vn(s),null;case 5:if(so(s),A=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==_&&Io(s);else{if(!_){if(s.stateNode===null)throw Error(S(166));return vn(s),null}if(P=zt.current,gs(s))Vr(s);else{var U=Ed(Wt.current);switch(P){case 1:P=U.createElementNS("http://www.w3.org/2000/svg",A);break;case 2:P=U.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;default:switch(A){case"svg":P=U.createElementNS("http://www.w3.org/2000/svg",A);break;case"math":P=U.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;case"script":P=U.createElement("div"),P.innerHTML="<script><\/script>",P=P.removeChild(P.firstChild);break;case"select":P=typeof _.is=="string"?U.createElement("select",{is:_.is}):U.createElement("select"),_.multiple?P.multiple=!0:_.size&&(P.size=_.size);break;default:P=typeof _.is=="string"?U.createElement(A,{is:_.is}):U.createElement(A)}}P[qi]=s,P[pt]=_;e:for(U=s.child;U!==null;){if(U.tag===5||U.tag===6)P.appendChild(U.stateNode);else if(U.tag!==4&&U.tag!==27&&U.child!==null){U.child.return=U,U=U.child;continue}if(U===s)break e;for(;U.sibling===null;){if(U.return===null||U.return===s)break e;U=U.return}U.sibling.return=U.return,U=U.sibling}s.stateNode=P;e:switch(fr(P,A,_),A){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}_&&Io(s)}}return vn(s),sd(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,h),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==_&&Io(s);else{if(typeof _!="string"&&s.stateNode===null)throw Error(S(166));if(r=Wt.current,gs(s)){if(r=s.stateNode,h=s.memoizedProps,_=null,A=Qn,A!==null)switch(A.tag){case 27:case 5:_=A.memoizedProps}r[qi]=s,r=!!(r.nodeValue===h||_!==null&&_.suppressHydrationWarning===!0||pm(r.nodeValue,h)),r||Nr(s,!0)}else r=Ed(r).createTextNode(_),r[qi]=s,s.stateNode=r}return vn(s),null;case 31:if(h=s.memoizedState,r===null||r.memoizedState!==null){if(_=gs(s),h!==null){if(r===null){if(!_)throw Error(S(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(557));r[qi]=s}else ys(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;vn(s),r=!1}else h=_s(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=h),r=!0;if(!r)return s.flags&256?(ln(s),s):(ln(s),null);if((s.flags&128)!==0)throw Error(S(558))}return vn(s),null;case 13:if(_=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(A=gs(s),_!==null&&_.dehydrated!==null){if(r===null){if(!A)throw Error(S(318));if(A=s.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(S(317));A[qi]=s}else ys(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;vn(s),A=!1}else A=_s(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=A),A=!0;if(!A)return s.flags&256?(ln(s),s):(ln(s),null)}return ln(s),(s.flags&128)!==0?(s.lanes=h,s):(h=_!==null,r=r!==null&&r.memoizedState!==null,h&&(_=s.child,A=null,_.alternate!==null&&_.alternate.memoizedState!==null&&_.alternate.memoizedState.cachePool!==null&&(A=_.alternate.memoizedState.cachePool.pool),P=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(P=_.memoizedState.cachePool.pool),P!==A&&(_.flags|=2048)),h!==r&&h&&(s.child.flags|=8192),od(s,s.updateQueue),vn(s),null);case 4:return Hi(),r===null&&dm(s.stateNode.containerInfo),vn(s),null;case 10:return xs(s.type),vn(s),null;case 19:if(ot(gn),_=s.memoizedState,_===null)return vn(s),null;if(A=(s.flags&128)!==0,P=_.rendering,P===null)if(A)ld(_,!1);else{if(In!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(P=cc(r),P!==null){for(s.flags|=128,ld(_,!1),r=P.updateQueue,s.updateQueue=r,od(s,r),s.subtreeFlags=0,r=h,h=s.child;h!==null;)mf(h,r),h=h.sibling;return Mt(gn,gn.current&1|2),ui&&Ns(s,_.treeForkCount),s.child}r=r.sibling}_.tail!==null&&Wn()>yd&&(s.flags|=128,A=!0,ld(_,!1),s.lanes=4194304)}else{if(!A)if(r=cc(P),r!==null){if(s.flags|=128,A=!0,r=r.updateQueue,s.updateQueue=r,od(s,r),ld(_,!0),_.tail===null&&_.tailMode==="hidden"&&!P.alternate&&!ui)return vn(s),null}else 2*Wn()-_.renderingStartTime>yd&&h!==536870912&&(s.flags|=128,A=!0,ld(_,!1),s.lanes=4194304);_.isBackwards?(P.sibling=s.child,s.child=P):(r=_.last,r!==null?r.sibling=P:s.child=P,_.last=P)}return _.tail!==null?(r=_.tail,_.rendering=r,_.tail=r.sibling,_.renderingStartTime=Wn(),r.sibling=null,h=gn.current,Mt(gn,A?h&1|2:h&1),ui&&Ns(s,_.treeForkCount),r):(vn(s),null);case 22:case 23:return ln(s),ul(),_=s.memoizedState!==null,r!==null?r.memoizedState!==null!==_&&(s.flags|=8192):_&&(s.flags|=8192),_?(h&536870912)!==0&&(s.flags&128)===0&&(vn(s),s.subtreeFlags&6&&(s.flags|=8192)):vn(s),h=s.updateQueue,h!==null&&od(s,h.retryQueue),h=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(h=r.memoizedState.cachePool.pool),_=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(_=s.memoizedState.cachePool.pool),_!==h&&(s.flags|=2048),r!==null&&ot(Ga),null;case 24:return h=null,r!==null&&(h=r.memoizedState.cache),s.memoizedState.cache!==h&&(s.flags|=2048),xs(Sn),vn(s),null;case 25:return null;case 30:return null}throw Error(S(156,s.tag))}function Ly(r,s){switch(eu(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return xs(Sn),Hi(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return so(s),null;case 31:if(s.memoizedState!==null){if(ln(s),s.alternate===null)throw Error(S(340));ys()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(ln(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(S(340));ys()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return ot(gn),null;case 4:return Hi(),null;case 10:return xs(s.type),null;case 22:case 23:return ln(s),ul(),r!==null&&ot(Ga),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return xs(Sn),null;case 25:return null;default:return null}}function Df(r,s){switch(eu(s),s.tag){case 3:xs(Sn),Hi();break;case 26:case 27:case 5:so(s);break;case 4:Hi();break;case 31:s.memoizedState!==null&&ln(s);break;case 13:ln(s);break;case 19:ot(gn);break;case 10:xs(s.type);break;case 22:case 23:ln(s),ul(),r!==null&&ot(Ga);break;case 24:xs(Sn)}}function ch(r,s){try{var h=s.updateQueue,_=h!==null?h.lastEffect:null;if(_!==null){var A=_.next;h=A;do{if((h.tag&r)===r){_=void 0;var P=h.create,U=h.inst;_=P(),U.destroy=_}h=h.next}while(h!==A)}}catch(ee){Gi(s,s.return,ee)}}function gl(r,s,h){try{var _=s.updateQueue,A=_!==null?_.lastEffect:null;if(A!==null){var P=A.next;_=P;do{if((_.tag&r)===r){var U=_.inst,ee=U.destroy;if(ee!==void 0){U.destroy=void 0,A=s;var be=h,Ge=ee;try{Ge()}catch(it){Gi(A,be,it)}}}_=_.next}while(_!==P)}}catch(it){Gi(s,s.return,it)}}function mg(r){var s=r.updateQueue;if(s!==null){var h=r.stateNode;try{ah(s,h)}catch(_){Gi(r,r.return,_)}}}function gg(r,s,h){h.props=Po(r.type,r.memoizedProps),h.state=r.memoizedState;try{h.componentWillUnmount()}catch(_){Gi(r,s,_)}}function ud(r,s){try{var h=r.ref;if(h!==null){switch(r.tag){case 26:case 27:case 5:var _=r.stateNode;break;case 30:_=r.stateNode;break;default:_=r.stateNode}typeof h=="function"?r.refCleanup=h(_):h.current=_}}catch(A){Gi(r,s,A)}}function Qa(r,s){var h=r.ref,_=r.refCleanup;if(h!==null)if(typeof _=="function")try{_()}catch(A){Gi(r,s,A)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(A){Gi(r,s,A)}else h.current=null}function Pf(r){var s=r.type,h=r.memoizedProps,_=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":h.autoFocus&&_.focus();break e;case"img":h.src?_.src=h.src:h.srcSet&&(_.srcset=h.srcSet)}}catch(A){Gi(r,r.return,A)}}function zf(r,s,h){try{var _=r.stateNode;qg(_,r.type,h,s),_[pt]=s}catch(A){Gi(r,r.return,A)}}function cu(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&_u(r.type)||r.tag===4}function yc(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||cu(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&_u(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Zp(r,s,h){var _=r.tag;if(_===5||_===6)r=r.stateNode,s?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(r,s):(s=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,s.appendChild(r),h=h._reactRootContainer,h!=null||s.onclick!==null||(s.onclick=Va));else if(_!==4&&(_===27&&_u(r.type)&&(h=r.stateNode,s=null),r=r.child,r!==null))for(Zp(r,s,h),r=r.sibling;r!==null;)Zp(r,s,h),r=r.sibling}function Rf(r,s,h){var _=r.tag;if(_===5||_===6)r=r.stateNode,s?h.insertBefore(r,s):h.appendChild(r);else if(_!==4&&(_===27&&_u(r.type)&&(h=r.stateNode),r=r.child,r!==null))for(Rf(r,s,h),r=r.sibling;r!==null;)Rf(r,s,h),r=r.sibling}function yg(r){var s=r.stateNode,h=r.memoizedProps;try{for(var _=r.type,A=s.attributes;A.length;)s.removeAttributeNode(A[0]);fr(s,_,h),s[qi]=r,s[pt]=h}catch(P){Gi(r,r.return,P)}}var yl=!1,ir=!1,Hp=!1,_g=typeof WeakSet=="function"?WeakSet:Set,nr=null;function ky(r,s){if(r=r.containerInfo,Md=kd,r=Vc(r),$u(r)){if("selectionStart"in r)var h={start:r.selectionStart,end:r.selectionEnd};else e:{h=(h=r.ownerDocument)&&h.defaultView||window;var _=h.getSelection&&h.getSelection();if(_&&_.rangeCount!==0){h=_.anchorNode;var A=_.anchorOffset,P=_.focusNode;_=_.focusOffset;try{h.nodeType,P.nodeType}catch{h=null;break e}var U=0,ee=-1,be=-1,Ge=0,it=0,lt=r,qe=null;t:for(;;){for(var Xe;lt!==h||A!==0&&lt.nodeType!==3||(ee=U+A),lt!==P||_!==0&&lt.nodeType!==3||(be=U+_),lt.nodeType===3&&(U+=lt.nodeValue.length),(Xe=lt.firstChild)!==null;)qe=lt,lt=Xe;for(;;){if(lt===r)break t;if(qe===h&&++Ge===A&&(ee=U),qe===P&&++it===_&&(be=U),(Xe=lt.nextSibling)!==null)break;lt=qe,qe=lt.parentNode}lt=Xe}h=ee===-1||be===-1?null:{start:ee,end:be}}else h=null}h=h||{start:0,end:0}}else h=null;for(mm={focusedElem:r,selectionRange:h},kd=!1,nr=s;nr!==null;)if(s=nr,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,nr=r;else for(;nr!==null;){switch(s=nr,P=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(h=0;h<r.length;h++)A=r[h],A.ref.impl=A.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&P!==null){r=void 0,h=s,A=P.memoizedProps,P=P.memoizedState,_=h.stateNode;try{var Lt=Po(h.type,A);r=_.getSnapshotBeforeUpdate(Lt,P),_.__reactInternalSnapshotBeforeUpdate=r}catch(Ut){Gi(h,h.return,Ut)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,h=r.nodeType,h===9)io(r);else if(h===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":io(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(S(163))}if(r=s.sibling,r!==null){r.return=s.return,nr=r;break}nr=s.return}}function $p(r,s,h){var _=h.flags;switch(h.tag){case 0:case 11:case 15:za(r,h),_&4&&ch(5,h);break;case 1:if(za(r,h),_&4)if(r=h.stateNode,s===null)try{r.componentDidMount()}catch(U){Gi(h,h.return,U)}else{var A=Po(h.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(A,s,r.__reactInternalSnapshotBeforeUpdate)}catch(U){Gi(h,h.return,U)}}_&64&&mg(h),_&512&&ud(h,h.return);break;case 3:if(za(r,h),_&64&&(r=h.updateQueue,r!==null)){if(s=null,h.child!==null)switch(h.child.tag){case 27:case 5:s=h.child.stateNode;break;case 1:s=h.child.stateNode}try{ah(r,s)}catch(U){Gi(h,h.return,U)}}break;case 27:s===null&&_&4&&yg(h);case 26:case 5:za(r,h),s===null&&_&4&&Pf(h),_&512&&ud(h,h.return);break;case 12:za(r,h);break;case 31:za(r,h),_&4&&cd(r,h);break;case 13:za(r,h),_&4&&hd(r,h),_&64&&(r=h.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(h=rm.bind(null,h),ar(r,h))));break;case 22:if(_=h.memoizedState!==null||yl,!_){s=s!==null&&s.memoizedState!==null||ir,A=yl;var P=ir;yl=_,(ir=s)&&!P?_l(r,h,(h.subtreeFlags&8772)!==0):za(r,h),yl=A,ir=P}break;case 30:break;default:za(r,h)}}function hh(r){var s=r.alternate;s!==null&&(r.alternate=null,hh(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&Go(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var En=null,vi=!1;function Pa(r,s,h){for(h=h.child;h!==null;)Xp(r,s,h),h=h.sibling}function Xp(r,s,h){if(Te&&typeof Te.onCommitFiberUnmount=="function")try{Te.onCommitFiberUnmount(Pe,h)}catch{}switch(h.tag){case 26:ir||Qa(h,s),Pa(r,s,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:ir||Qa(h,s);var _=En,A=vi;_u(h.type)&&(En=h.stateNode,vi=!1),Pa(r,s,h),Sh(h.stateNode),En=_,vi=A;break;case 5:ir||Qa(h,s);case 6:if(_=En,A=vi,En=null,Pa(r,s,h),En=_,vi=A,En!==null)if(vi)try{(En.nodeType===9?En.body:En.nodeName==="HTML"?En.ownerDocument.body:En).removeChild(h.stateNode)}catch(P){Gi(h,s,P)}else try{En.removeChild(h.stateNode)}catch(P){Gi(h,s,P)}break;case 18:En!==null&&(vi?(r=En,Zg(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,h.stateNode),Su(r)):Zg(En,h.stateNode));break;case 4:_=En,A=vi,En=h.stateNode.containerInfo,vi=!0,Pa(r,s,h),En=_,vi=A;break;case 0:case 11:case 14:case 15:gl(2,h,s),ir||gl(4,h,s),Pa(r,s,h);break;case 1:ir||(Qa(h,s),_=h.stateNode,typeof _.componentWillUnmount=="function"&&gg(h,s,_)),Pa(r,s,h);break;case 21:Pa(r,s,h);break;case 22:ir=(_=ir)||h.memoizedState!==null,Pa(r,s,h),ir=_;break;default:Pa(r,s,h)}}function cd(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Su(r)}catch(h){Gi(s,s.return,h)}}}function hd(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Su(r)}catch(h){Gi(s,s.return,h)}}function dd(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new _g),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new _g),s;default:throw Error(S(435,r.tag))}}function fd(r,s){var h=dd(r);s.forEach(function(_){if(!h.has(_)){h.add(_);var A=Fy.bind(null,r,_);_.then(A,A)}})}function ca(r,s){var h=s.deletions;if(h!==null)for(var _=0;_<h.length;_++){var A=h[_],P=r,U=s,ee=U;e:for(;ee!==null;){switch(ee.tag){case 27:if(_u(ee.type)){En=ee.stateNode,vi=!1;break e}break;case 5:En=ee.stateNode,vi=!1;break e;case 3:case 4:En=ee.stateNode.containerInfo,vi=!0;break e}ee=ee.return}if(En===null)throw Error(S(160));Xp(P,U,A),En=null,vi=!1,P=A.alternate,P!==null&&(P.return=null),A.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)If(s,r),s=s.sibling}var ha=null;function If(r,s){var h=r.alternate,_=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:ca(s,r),dr(r),_&4&&(gl(3,r,r.return),ch(3,r),gl(5,r,r.return));break;case 1:ca(s,r),dr(r),_&512&&(ir||h===null||Qa(h,h.return)),_&64&&yl&&(r=r.updateQueue,r!==null&&(_=r.callbacks,_!==null&&(h=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=h===null?_:h.concat(_))));break;case 26:var A=ha;if(ca(s,r),dr(r),_&512&&(ir||h===null||Qa(h,h.return)),_&4){var P=h!==null?h.memoizedState:null;if(_=r.memoizedState,h===null)if(_===null)if(r.stateNode===null){e:{_=r.type,h=r.memoizedProps,A=A.ownerDocument||A;t:switch(_){case"title":P=A.getElementsByTagName("title")[0],(!P||P[Zt]||P[qi]||P.namespaceURI==="http://www.w3.org/2000/svg"||P.hasAttribute("itemprop"))&&(P=A.createElement(_),A.head.insertBefore(P,A.querySelector("head > title"))),fr(P,_,h),P[qi]=r,fn(P),_=P;break e;case"link":var U=Cm("link","href",A).get(_+(h.href||""));if(U){for(var ee=0;ee<U.length;ee++)if(P=U[ee],P.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&P.getAttribute("rel")===(h.rel==null?null:h.rel)&&P.getAttribute("title")===(h.title==null?null:h.title)&&P.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){U.splice(ee,1);break t}}P=A.createElement(_),fr(P,_,h),A.head.appendChild(P);break;case"meta":if(U=Cm("meta","content",A).get(_+(h.content||""))){for(ee=0;ee<U.length;ee++)if(P=U[ee],P.getAttribute("content")===(h.content==null?null:""+h.content)&&P.getAttribute("name")===(h.name==null?null:h.name)&&P.getAttribute("property")===(h.property==null?null:h.property)&&P.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&P.getAttribute("charset")===(h.charSet==null?null:h.charSet)){U.splice(ee,1);break t}}P=A.createElement(_),fr(P,_,h),A.head.appendChild(P);break;default:throw Error(S(468,_))}P[qi]=r,fn(P),_=P}r.stateNode=_}else Dd(A,r.type,r.stateNode);else r.stateNode=Am(A,_,r.memoizedProps);else P!==_?(P===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):P.count--,_===null?Dd(A,r.type,r.stateNode):Am(A,_,r.memoizedProps)):_===null&&r.stateNode!==null&&zf(r,r.memoizedProps,h.memoizedProps)}break;case 27:ca(s,r),dr(r),_&512&&(ir||h===null||Qa(h,h.return)),h!==null&&_&4&&zf(r,r.memoizedProps,h.memoizedProps);break;case 5:if(ca(s,r),dr(r),_&512&&(ir||h===null||Qa(h,h.return)),r.flags&32){A=r.stateNode;try{Fs(A,"")}catch(Lt){Gi(r,r.return,Lt)}}_&4&&r.stateNode!=null&&(A=r.memoizedProps,zf(r,A,h!==null?h.memoizedProps:A)),_&1024&&(Hp=!0);break;case 6:if(ca(s,r),dr(r),_&4){if(r.stateNode===null)throw Error(S(162));_=r.memoizedProps,h=r.stateNode;try{h.nodeValue=_}catch(Lt){Gi(r,r.return,Lt)}}break;case 3:if(op=null,A=ha,ha=rp(s.containerInfo),ca(s,r),ha=A,dr(r),_&4&&h!==null&&h.memoizedState.isDehydrated)try{Su(s.containerInfo)}catch(Lt){Gi(r,r.return,Lt)}Hp&&(Hp=!1,pd(r));break;case 4:_=ha,ha=rp(r.stateNode.containerInfo),ca(s,r),dr(r),ha=_;break;case 12:ca(s,r),dr(r);break;case 31:ca(s,r),dr(r),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,fd(r,_)));break;case 13:ca(s,r),dr(r),r.child.flags&8192&&r.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(Bf=Wn()),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,fd(r,_)));break;case 22:A=r.memoizedState!==null;var be=h!==null&&h.memoizedState!==null,Ge=yl,it=ir;if(yl=Ge||A,ir=it||be,ca(s,r),ir=it,yl=Ge,dr(r),_&8192)e:for(s=r.stateNode,s._visibility=A?s._visibility&-2:s._visibility|1,A&&(h===null||be||yl||ir||Js(r)),h=null,s=r;;){if(s.tag===5||s.tag===26){if(h===null){be=h=s;try{if(P=be.stateNode,A)U=P.style,typeof U.setProperty=="function"?U.setProperty("display","none","important"):U.display="none";else{ee=be.stateNode;var lt=be.memoizedProps.style,qe=lt!=null&&lt.hasOwnProperty("display")?lt.display:null;ee.style.display=qe==null||typeof qe=="boolean"?"":(""+qe).trim()}}catch(Lt){Gi(be,be.return,Lt)}}}else if(s.tag===6){if(h===null){be=s;try{be.stateNode.nodeValue=A?"":be.memoizedProps}catch(Lt){Gi(be,be.return,Lt)}}}else if(s.tag===18){if(h===null){be=s;try{var Xe=be.stateNode;A?ri(Xe,!0):ri(be.stateNode,!1)}catch(Lt){Gi(be,be.return,Lt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;h===s&&(h=null),s=s.return}h===s&&(h=null),s.sibling.return=s.return,s=s.sibling}_&4&&(_=r.updateQueue,_!==null&&(h=_.retryQueue,h!==null&&(_.retryQueue=null,fd(r,h))));break;case 19:ca(s,r),dr(r),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,fd(r,_)));break;case 30:break;case 21:break;default:ca(s,r),dr(r)}}function dr(r){var s=r.flags;if(s&2){try{for(var h,_=r.return;_!==null;){if(cu(_)){h=_;break}_=_.return}if(h==null)throw Error(S(160));switch(h.tag){case 27:var A=h.stateNode,P=yc(r);Rf(r,P,A);break;case 5:var U=h.stateNode;h.flags&32&&(Fs(U,""),h.flags&=-33);var ee=yc(r);Rf(r,ee,U);break;case 3:case 4:var be=h.stateNode.containerInfo,Ge=yc(r);Zp(r,Ge,be);break;default:throw Error(S(161))}}catch(it){Gi(r,r.return,it)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function pd(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;pd(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function za(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)$p(r,s.alternate,s),s=s.sibling}function Js(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:gl(4,s,s.return),Js(s);break;case 1:Qa(s,s.return);var h=s.stateNode;typeof h.componentWillUnmount=="function"&&gg(s,s.return,h),Js(s);break;case 27:Sh(s.stateNode);case 26:case 5:Qa(s,s.return),Js(s);break;case 22:s.memoizedState===null&&Js(s);break;case 30:Js(s);break;default:Js(s)}r=r.sibling}}function _l(r,s,h){for(h=h&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var _=s.alternate,A=r,P=s,U=P.flags;switch(P.tag){case 0:case 11:case 15:_l(A,P,h),ch(4,P);break;case 1:if(_l(A,P,h),_=P,A=_.stateNode,typeof A.componentDidMount=="function")try{A.componentDidMount()}catch(Ge){Gi(_,_.return,Ge)}if(_=P,A=_.updateQueue,A!==null){var ee=_.stateNode;try{var be=A.shared.hiddenCallbacks;if(be!==null)for(A.shared.hiddenCallbacks=null,A=0;A<be.length;A++)oc(be[A],ee)}catch(Ge){Gi(_,_.return,Ge)}}h&&U&64&&mg(P),ud(P,P.return);break;case 27:yg(P);case 26:case 5:_l(A,P,h),h&&_===null&&U&4&&Pf(P),ud(P,P.return);break;case 12:_l(A,P,h);break;case 31:_l(A,P,h),h&&U&4&&cd(A,P);break;case 13:_l(A,P,h),h&&U&4&&hd(A,P);break;case 22:P.memoizedState===null&&_l(A,P,h),ud(P,P.return);break;case 30:break;default:_l(A,P,h)}s=s.sibling}}function Lf(r,s){var h=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(h=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==h&&(r!=null&&r.refCount++,h!=null&&iu(h))}function vl(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&iu(r))}function eo(r,s,h,_){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Yp(r,s,h,_),s=s.sibling}function Yp(r,s,h,_){var A=s.flags;switch(s.tag){case 0:case 11:case 15:eo(r,s,h,_),A&2048&&ch(9,s);break;case 1:eo(r,s,h,_);break;case 3:eo(r,s,h,_),A&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&iu(r)));break;case 12:if(A&2048){eo(r,s,h,_),r=s.stateNode;try{var P=s.memoizedProps,U=P.id,ee=P.onPostCommit;typeof ee=="function"&&ee(U,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(be){Gi(s,s.return,be)}}else eo(r,s,h,_);break;case 31:eo(r,s,h,_);break;case 13:eo(r,s,h,_);break;case 23:break;case 22:P=s.stateNode,U=s.alternate,s.memoizedState!==null?P._visibility&2?eo(r,s,h,_):_c(r,s):P._visibility&2?eo(r,s,h,_):(P._visibility|=2,Lo(r,s,h,_,(s.subtreeFlags&10256)!==0||!1)),A&2048&&Lf(U,s);break;case 24:eo(r,s,h,_),A&2048&&vl(s.alternate,s);break;default:eo(r,s,h,_)}}function Lo(r,s,h,_,A){for(A=A&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var P=r,U=s,ee=h,be=_,Ge=U.flags;switch(U.tag){case 0:case 11:case 15:Lo(P,U,ee,be,A),ch(8,U);break;case 23:break;case 22:var it=U.stateNode;U.memoizedState!==null?it._visibility&2?Lo(P,U,ee,be,A):_c(P,U):(it._visibility|=2,Lo(P,U,ee,be,A)),A&&Ge&2048&&Lf(U.alternate,U);break;case 24:Lo(P,U,ee,be,A),A&&Ge&2048&&vl(U.alternate,U);break;default:Lo(P,U,ee,be,A)}s=s.sibling}}function _c(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var h=r,_=s,A=_.flags;switch(_.tag){case 22:_c(h,_),A&2048&&Lf(_.alternate,_);break;case 24:_c(h,_),A&2048&&vl(_.alternate,_);break;default:_c(h,_)}s=s.sibling}}var dh=8192;function vc(r,s,h){if(r.subtreeFlags&dh)for(r=r.child;r!==null;)vg(r,s,h),r=r.sibling}function vg(r,s,h){switch(r.tag){case 26:vc(r,s,h),r.flags&dh&&r.memoizedState!==null&&Dm(h,ha,r.memoizedState,r.memoizedProps);break;case 5:vc(r,s,h);break;case 3:case 4:var _=ha;ha=rp(r.stateNode.containerInfo),vc(r,s,h),ha=_;break;case 22:r.memoizedState===null&&(_=r.alternate,_!==null&&_.memoizedState!==null?(_=dh,dh=16777216,vc(r,s,h),dh=_):vc(r,s,h));break;default:vc(r,s,h)}}function xg(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function md(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var h=0;h<s.length;h++){var _=s[h];nr=_,fh(_,r)}xg(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)bg(r),r=r.sibling}function bg(r){switch(r.tag){case 0:case 11:case 15:md(r),r.flags&2048&&gl(9,r,r.return);break;case 3:md(r);break;case 12:md(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,kf(r)):md(r);break;default:md(r)}}function kf(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var h=0;h<s.length;h++){var _=s[h];nr=_,fh(_,r)}xg(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:gl(8,s,s.return),kf(s);break;case 22:h=s.stateNode,h._visibility&2&&(h._visibility&=-3,kf(s));break;default:kf(s)}r=r.sibling}}function fh(r,s){for(;nr!==null;){var h=nr;switch(h.tag){case 0:case 11:case 15:gl(8,h,s);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var _=h.memoizedState.cachePool.pool;_!=null&&_.refCount++}break;case 24:iu(h.memoizedState.cache)}if(_=h.child,_!==null)_.return=h,nr=_;else e:for(h=r;nr!==null;){_=nr;var A=_.sibling,P=_.return;if(hh(_),_===h){nr=null;break e}if(A!==null){A.return=P,nr=A;break e}nr=P}}}var By={getCacheForType:function(r){var s=zn(Sn),h=s.data.get(r);return h===void 0&&(h=r(),s.data.set(r,h)),h},cacheSignal:function(){return zn(Sn).controller.signal}},wg=typeof WeakMap=="function"?WeakMap:Map,Ui=0,rn=null,pi=null,mi=0,$i=0,da=null,Ps=!1,hu=!1,Wp=!1,xl=0,In=0,bl=0,xc=0,Kp=0,Lr=0,bc=0,gd=null,Ra=null,Qp=!1,Bf=0,Tg=0,yd=1/0,ph=null,wl=null,rr=0,Tl=null,mh=null,zs=0,Jp=0,Of=null,Sg=null,_d=0,em=null;function Ia(){return(Ui&2)!==0&&mi!==0?mi&-mi:tt.T!==null?um():gr()}function Mg(){if(Lr===0)if((mi&536870912)===0||ui){var r=bi;bi<<=1,(bi&3932160)===0&&(bi=262144),Lr=r}else Lr=536870912;return r=Tt.current,r!==null&&(r.flags|=32),Lr}function La(r,s,h){(r===rn&&($i===2||$i===9)||r.cancelPendingCommit!==null)&&(yh(r,0),du(r,mi,Lr,!1)),Di(r,h),((Ui&2)===0||r!==rn)&&(r===rn&&((Ui&2)===0&&(xc|=h),In===4&&du(r,mi,Lr,!1)),to(r))}function $n(r,s,h){if((Ui&6)!==0)throw Error(S(327));var _=!h&&(s&127)===0&&(s&r.expiredLanes)===0||Cn(r,s),A=_?_h(r,s):Nf(r,s,!0),P=_;do{if(A===0){hu&&!_&&du(r,s,0,!1);break}else{if(h=r.current.alternate,P&&!Oy(h)){A=Nf(r,s,!1),P=!1;continue}if(A===2){if(P=s,r.errorRecoveryDisabledLanes&P)var U=0;else U=r.pendingLanes&-536870913,U=U!==0?U:U&536870912?536870912:0;if(U!==0){s=U;e:{var ee=r;A=gd;var be=ee.current.memoizedState.isDehydrated;if(be&&(yh(ee,U).flags|=256),U=Nf(ee,U,!1),U!==2){if(Wp&&!be){ee.errorRecoveryDisabledLanes|=P,xc|=P,A=4;break e}P=Ra,Ra=A,P!==null&&(Ra===null?Ra=P:Ra.push.apply(Ra,P))}A=U}if(P=!1,A!==2)continue}}if(A===1){yh(r,0),du(r,s,0,!0);break}e:{switch(_=r,P=A,P){case 0:case 1:throw Error(S(345));case 4:if((s&4194048)!==s)break;case 6:du(_,s,Lr,!Ps);break e;case 2:Ra=null;break;case 3:case 5:break;default:throw Error(S(329))}if((s&62914560)===s&&(A=Bf+300-Wn(),10<A)){if(du(_,s,Lr,!Ps),Si(_,0,!0)!==0)break e;zs=s,_.timeoutHandle=np(gh.bind(null,_,h,Ra,ph,Qp,s,Lr,xc,bc,Ps,P,"Throttled",-0,0),A);break e}gh(_,h,Ra,ph,Qp,s,Lr,xc,bc,Ps,P,null,-0,0)}}break}while(!0);to(r)}function gh(r,s,h,_,A,P,U,ee,be,Ge,it,lt,qe,Xe){if(r.timeoutHandle=-1,lt=s.subtreeFlags,lt&8192||(lt&16785408)===16785408){lt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Va},vg(s,P,lt);var Lt=(P&62914560)===P?Bf-Wn():(P&4194048)===P?Tg-Wn():0;if(Lt=Pm(lt,Lt),Lt!==null){zs=P,r.cancelPendingCommit=Lt(Pg.bind(null,r,s,P,h,_,A,U,ee,be,it,lt,null,qe,Xe)),du(r,P,U,!Ge);return}}Pg(r,s,P,h,_,A,U,ee,be)}function Oy(r){for(var s=r;;){var h=s.tag;if((h===0||h===11||h===15)&&s.flags&16384&&(h=s.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var _=0;_<h.length;_++){var A=h[_],P=A.getSnapshot;A=A.value;try{if(!Fr(P(),A))return!1}catch{return!1}}if(h=s.child,s.subtreeFlags&16384&&h!==null)h.return=s,s=h;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function du(r,s,h,_){s&=~Kp,s&=~xc,r.suspendedLanes|=s,r.pingedLanes&=~s,_&&(r.warmLanes|=s),_=r.expirationTimes;for(var A=s;0<A;){var P=31-Je(A),U=1<<P;_[P]=-1,A&=~U}h!==0&&Oi(r,h,s)}function vd(){return(Ui&6)===0?(Ja(0),!1):!0}function Ff(){if(pi!==null){if($i===0)var r=pi.return;else r=pi,vs=Ta=null,Ws(r),ws=null,ol=0,r=pi;for(;r!==null;)Df(r.alternate,r),r=r.return;pi=null}}function yh(r,s){var h=r.timeoutHandle;h!==-1&&(r.timeoutHandle=-1,ym(h)),h=r.cancelPendingCommit,h!==null&&(r.cancelPendingCommit=null,h()),zs=0,Ff(),rn=r,pi=h=ra(r.current,null),mi=s,$i=0,da=null,Ps=!1,hu=Cn(r,s),Wp=!1,bc=Lr=Kp=xc=bl=In=0,Ra=gd=null,Qp=!1,(s&8)!==0&&(s|=s&32);var _=r.entangledLanes;if(_!==0)for(r=r.entanglements,_&=s;0<_;){var A=31-Je(_),P=1<<A;s|=r[A],_&=~P}return xl=s,nl(),h}function tm(r,s){ii=null,tt.H=Ai,s===qa||s===Ur?(s=ru(),$i=3):s===Eo?(s=ru(),$i=4):$i=s===xf?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,da=s,pi===null&&(In=1,Ka(r,Ir(s,r.current)))}function im(){var r=Tt.current;return r===null?!0:(mi&4194048)===mi?Dt===null:(mi&62914560)===mi||(mi&536870912)!==0?r===Dt:!1}function wc(){var r=tt.H;return tt.H=Ai,r===null?Ai:r}function jf(){var r=tt.A;return tt.A=By,r}function xd(){In=4,Ps||(mi&4194048)!==mi&&Tt.current!==null||(hu=!0),(bl&134217727)===0&&(xc&134217727)===0||rn===null||du(rn,mi,Lr,!1)}function Nf(r,s,h){var _=Ui;Ui|=2;var A=wc(),P=jf();(rn!==r||mi!==s)&&(ph=null,yh(r,s)),s=!1;var U=In;e:do try{if($i!==0&&pi!==null){var ee=pi,be=da;switch($i){case 8:Ff(),U=6;break e;case 3:case 2:case 9:case 6:Tt.current===null&&(s=!0);var Ge=$i;if($i=0,da=null,vh(r,ee,be,Ge),h&&hu){U=0;break e}break;default:Ge=$i,$i=0,da=null,vh(r,ee,be,Ge)}}Vf(),U=In;break}catch(it){tm(r,it)}while(!0);return s&&r.shellSuspendCounter++,vs=Ta=null,Ui=_,tt.H=A,tt.A=P,pi===null&&(rn=null,mi=0,nl()),U}function Vf(){for(;pi!==null;)Ag(pi)}function _h(r,s){var h=Ui;Ui|=2;var _=wc(),A=jf();rn!==r||mi!==s?(ph=null,yd=Wn()+500,yh(r,s)):hu=Cn(r,s);e:do try{if($i!==0&&pi!==null){s=pi;var P=da;t:switch($i){case 1:$i=0,da=null,vh(r,s,P,1);break;case 2:case 9:if(nc(P)){$i=0,da=null,Cg(s);break}s=function(){$i!==2&&$i!==9||rn!==r||($i=7),to(r)},P.then(s,s);break e;case 3:$i=7;break e;case 4:$i=5;break e;case 7:nc(P)?($i=0,da=null,Cg(s)):($i=0,da=null,vh(r,s,P,7));break;case 5:var U=null;switch(pi.tag){case 26:U=pi.memoizedState;case 5:case 27:var ee=pi;if(U?Pd(U):ee.stateNode.complete){$i=0,da=null;var be=ee.sibling;if(be!==null)pi=be;else{var Ge=ee.return;Ge!==null?(pi=Ge,Uf(Ge)):pi=null}break t}}$i=0,da=null,vh(r,s,P,5);break;case 6:$i=0,da=null,vh(r,s,P,6);break;case 8:Ff(),In=6;break e;default:throw Error(S(462))}}Eg();break}catch(it){tm(r,it)}while(!0);return vs=Ta=null,tt.H=_,tt.A=A,Ui=h,pi!==null?0:(rn=null,mi=0,nl(),In)}function Eg(){for(;pi!==null&&!Fa();)Ag(pi)}function Ag(r){var s=Zr(r.alternate,r,xl);r.memoizedProps=r.pendingProps,s===null?Uf(r):pi=s}function Cg(r){var s=r,h=s.alternate;switch(s.tag){case 15:case 0:s=cg(h,s,s.pendingProps,s.type,void 0,mi);break;case 11:s=cg(h,s,s.pendingProps,s.type.render,s.ref,mi);break;case 5:Ws(s);default:Df(h,s),s=pi=mf(s,xl),s=Zr(h,s,xl)}r.memoizedProps=r.pendingProps,s===null?Uf(r):pi=s}function vh(r,s,h,_){vs=Ta=null,Ws(s),ws=null,ol=0;var A=s.return;try{if(vf(r,A,s,h,mi)){In=1,Ka(r,Ir(h,r.current)),pi=null;return}}catch(P){if(A!==null)throw pi=A,P;In=1,Ka(r,Ir(h,r.current)),pi=null;return}s.flags&32768?(ui||_===1?r=!0:hu||(mi&536870912)!==0?r=!1:(Ps=r=!0,(_===2||_===9||_===3||_===6)&&(_=Tt.current,_!==null&&_.tag===13&&(_.flags|=16384))),Dg(s,r)):Uf(s)}function Uf(r){var s=r;do{if((s.flags&32768)!==0){Dg(s,Ps);return}r=s.return;var h=pg(s.alternate,s,xl);if(h!==null){pi=h;return}if(s=s.sibling,s!==null){pi=s;return}pi=s=r}while(s!==null);In===0&&(In=5)}function Dg(r,s){do{var h=Ly(r.alternate,r);if(h!==null){h.flags&=32767,pi=h;return}if(h=r.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!s&&(r=r.sibling,r!==null)){pi=r;return}pi=r=h}while(r!==null);In=6,pi=null}function Pg(r,s,h,_,A,P,U,ee,be){r.cancelPendingCommit=null;do Gf();while(rr!==0);if((Ui&6)!==0)throw Error(S(327));if(s!==null){if(s===r.current)throw Error(S(177));if(P=s.lanes|s.childLanes,P|=il,dn(r,h,P,U,ee,be),r===rn&&(pi=rn=null,mi=0),mh=s,Tl=r,zs=h,Jp=P,Of=A,Sg=_,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,Bg(Y,function(){return kg(),null})):(r.callbackNode=null,r.callbackPriority=0),_=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||_){_=tt.T,tt.T=null,A=ht.p,ht.p=2,U=Ui,Ui|=4;try{ky(r,s,h)}finally{Ui=U,ht.p=A,tt.T=_}}rr=1,zg(),Rg(),Ig()}}function zg(){if(rr===1){rr=0;var r=Tl,s=mh,h=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||h){h=tt.T,tt.T=null;var _=ht.p;ht.p=2;var A=Ui;Ui|=4;try{If(s,r);var P=mm,U=Vc(r.containerInfo),ee=P.focusedElem,be=P.selectionRange;if(U!==ee&&ee&&ee.ownerDocument&&Nc(ee.ownerDocument.documentElement,ee)){if(be!==null&&$u(ee)){var Ge=be.start,it=be.end;if(it===void 0&&(it=Ge),"selectionStart"in ee)ee.selectionStart=Ge,ee.selectionEnd=Math.min(it,ee.value.length);else{var lt=ee.ownerDocument||document,qe=lt&&lt.defaultView||window;if(qe.getSelection){var Xe=qe.getSelection(),Lt=ee.textContent.length,Ut=Math.min(be.start,Lt),Xi=be.end===void 0?Ut:Math.min(be.end,Lt);!Xe.extend&&Ut>Xi&&(U=Xi,Xi=Ut,Ut=U);var ze=Hu(ee,Ut),Ee=Hu(ee,Xi);if(ze&&Ee&&(Xe.rangeCount!==1||Xe.anchorNode!==ze.node||Xe.anchorOffset!==ze.offset||Xe.focusNode!==Ee.node||Xe.focusOffset!==Ee.offset)){var Ve=lt.createRange();Ve.setStart(ze.node,ze.offset),Xe.removeAllRanges(),Ut>Xi?(Xe.addRange(Ve),Xe.extend(Ee.node,Ee.offset)):(Ve.setEnd(Ee.node,Ee.offset),Xe.addRange(Ve))}}}}for(lt=[],Xe=ee;Xe=Xe.parentNode;)Xe.nodeType===1&&lt.push({element:Xe,left:Xe.scrollLeft,top:Xe.scrollTop});for(typeof ee.focus=="function"&&ee.focus(),ee=0;ee<lt.length;ee++){var at=lt[ee];at.element.scrollLeft=at.left,at.element.scrollTop=at.top}}kd=!!Md,mm=Md=null}finally{Ui=A,ht.p=_,tt.T=h}}r.current=s,rr=2}}function Rg(){if(rr===2){rr=0;var r=Tl,s=mh,h=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||h){h=tt.T,tt.T=null;var _=ht.p;ht.p=2;var A=Ui;Ui|=4;try{$p(r,s.alternate,s)}finally{Ui=A,ht.p=_,tt.T=h}}rr=3}}function Ig(){if(rr===4||rr===3){rr=0,Bl();var r=Tl,s=mh,h=zs,_=Sg;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?rr=5:(rr=0,mh=Tl=null,Lg(r,r.pendingLanes));var A=r.pendingLanes;if(A===0&&(wl=null),ut(h),s=s.stateNode,Te&&typeof Te.onCommitFiberRoot=="function")try{Te.onCommitFiberRoot(Pe,s,void 0,(s.current.flags&128)===128)}catch{}if(_!==null){s=tt.T,A=ht.p,ht.p=2,tt.T=null;try{for(var P=r.onRecoverableError,U=0;U<_.length;U++){var ee=_[U];P(ee.value,{componentStack:ee.stack})}}finally{tt.T=s,ht.p=A}}(zs&3)!==0&&Gf(),to(r),A=r.pendingLanes,(h&261930)!==0&&(A&42)!==0?r===em?_d++:(_d=0,em=r):_d=0,Ja(0)}}function Lg(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,iu(s)))}function Gf(){return zg(),Rg(),Ig(),kg()}function kg(){if(rr!==5)return!1;var r=Tl,s=Jp;Jp=0;var h=ut(zs),_=tt.T,A=ht.p;try{ht.p=32>h?32:h,tt.T=null,h=Of,Of=null;var P=Tl,U=zs;if(rr=0,mh=Tl=null,zs=0,(Ui&6)!==0)throw Error(S(331));var ee=Ui;if(Ui|=4,bg(P.current),Yp(P,P.current,U,h),Ui=ee,Ja(0,!1),Te&&typeof Te.onPostCommitFiberRoot=="function")try{Te.onPostCommitFiberRoot(Pe,P)}catch{}return!0}finally{ht.p=A,tt.T=_,Lg(r,s)}}function nm(r,s,h){s=Ir(h,s),s=pc(r.stateNode,s,2),r=Hs(r,s,2),r!==null&&(Di(r,2),to(r))}function Gi(r,s,h){if(r.tag===3)nm(r,r,h);else for(;s!==null;){if(s.tag===3){nm(s,r,h);break}else if(s.tag===1){var _=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(wl===null||!wl.has(_))){r=Ir(h,r),h=mc(2),_=Hs(s,h,2),_!==null&&(gc(h,_,s,r),Di(_,2),to(_));break}}s=s.return}}function qf(r,s,h){var _=r.pingCache;if(_===null){_=r.pingCache=new wg;var A=new Set;_.set(s,A)}else A=_.get(s),A===void 0&&(A=new Set,_.set(s,A));A.has(h)||(Wp=!0,A.add(h),r=fu.bind(null,r,s,h),s.then(r,r))}function fu(r,s,h){var _=r.pingCache;_!==null&&_.delete(s),r.pingedLanes|=r.suspendedLanes&h,r.warmLanes&=~h,rn===r&&(mi&h)===h&&(In===4||In===3&&(mi&62914560)===mi&&300>Wn()-Bf?(Ui&2)===0&&yh(r,0):Kp|=h,bc===mi&&(bc=0)),to(r)}function bd(r,s){s===0&&(s=Mi()),r=wa(r,s),r!==null&&(Di(r,s),to(r))}function rm(r){var s=r.memoizedState,h=0;s!==null&&(h=s.retryLane),bd(r,h)}function Fy(r,s){var h=0;switch(r.tag){case 31:case 13:var _=r.stateNode,A=r.memoizedState;A!==null&&(h=A.retryLane);break;case 19:_=r.stateNode;break;case 22:_=r.stateNode._retryCache;break;default:throw Error(S(314))}_!==null&&_.delete(s),bd(r,h)}function Bg(r,s){return oo(r,s)}var Zf=null,xh=null,am=!1,Hf=!1,sm=!1,Sl=0;function to(r){r!==xh&&r.next===null&&(xh===null?Zf=xh=r:xh=xh.next=r),Hf=!0,am||(am=!0,lm())}function Ja(r,s){if(!sm&&Hf){sm=!0;do for(var h=!1,_=Zf;_!==null;){if(r!==0){var A=_.pendingLanes;if(A===0)var P=0;else{var U=_.suspendedLanes,ee=_.pingedLanes;P=(1<<31-Je(42|r)+1)-1,P&=A&~(U&~ee),P=P&201326741?P&201326741|1:P?P|2:0}P!==0&&(h=!0,wd(_,P))}else P=mi,P=Si(_,_===rn?P:0,_.cancelPendingCommit!==null||_.timeoutHandle!==-1),(P&3)===0||Cn(_,P)||(h=!0,wd(_,P));_=_.next}while(h);sm=!1}}function pu(){om()}function om(){Hf=am=!1;var r=0;Sl!==0&&ip()&&(r=Sl);for(var s=Wn(),h=null,_=Zf;_!==null;){var A=_.next,P=$f(_,s);P===0?(_.next=null,h===null?Zf=A:h.next=A,A===null&&(xh=h)):(h=_,(r!==0||(P&3)!==0)&&(Hf=!0)),_=A}rr!==0&&rr!==5||Ja(r),Sl!==0&&(Sl=0)}function $f(r,s){for(var h=r.suspendedLanes,_=r.pingedLanes,A=r.expirationTimes,P=r.pendingLanes&-62914561;0<P;){var U=31-Je(P),ee=1<<U,be=A[U];be===-1?((ee&h)===0||(ee&_)!==0)&&(A[U]=qt(ee,s)):be<=s&&(r.expiredLanes|=ee),P&=~ee}if(s=rn,h=mi,h=Si(r,r===s?h:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),_=r.callbackNode,h===0||r===s&&($i===2||$i===9)||r.cancelPendingCommit!==null)return _!==null&&_!==null&&rs(_),r.callbackNode=null,r.callbackPriority=0;if((h&3)===0||Cn(r,h)){if(s=h&-h,s===r.callbackPriority)return s;switch(_!==null&&rs(_),ut(h)){case 2:case 8:h=W;break;case 32:h=Y;break;case 268435456:h=_e;break;default:h=Y}return _=Og.bind(null,r),h=oo(h,_),r.callbackPriority=s,r.callbackNode=h,s}return _!==null&&_!==null&&rs(_),r.callbackPriority=2,r.callbackNode=null,2}function Og(r,s){if(rr!==0&&rr!==5)return r.callbackNode=null,r.callbackPriority=0,null;var h=r.callbackNode;if(Gf()&&r.callbackNode!==h)return null;var _=mi;return _=Si(r,r===rn?_:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),_===0?null:($n(r,_,s),$f(r,Wn()),r.callbackNode!=null&&r.callbackNode===h?Og.bind(null,r):null)}function wd(r,s){if(Gf())return null;$n(r,s,!0)}function lm(){vm(function(){(Ui&6)!==0?oo(Re,pu):om()})}function um(){if(Sl===0){var r=sl;r===0&&(r=Vt,Vt<<=1,(Vt&261888)===0&&(Vt=256)),Sl=r}return Sl}function Xf(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Qt(""+r)}function Yf(r,s){var h=s.ownerDocument.createElement("input");return h.name=s.name,h.value=s.value,r.id&&h.setAttribute("form",r.id),s.parentNode.insertBefore(h,s),r=new FormData(r),h.parentNode.removeChild(h),r}function bh(r,s,h,_,A){if(s==="submit"&&h&&h.stateNode===A){var P=Xf((A[pt]||null).action),U=_.submitter;U&&(s=(s=U[pt]||null)?Xf(s.formAction):U.getAttribute("formAction"),s!==null&&(P=s,U=null));var ee=new ku("action","action",null,_,A);r.push({event:ee,listeners:[{instance:null,listener:function(){if(_.defaultPrevented){if(Sl!==0){var be=U?Yf(A,U):new FormData(A);yn(h,{pending:!0,data:be,method:A.method,action:P},null,be)}}else typeof P=="function"&&(ee.preventDefault(),be=U?Yf(A,U):new FormData(A),yn(h,{pending:!0,data:be,method:A.method,action:P},P,be))},currentTarget:A}]})}}for(var Wf=0;Wf<Zc.length;Wf++){var Kf=Zc[Wf],cm=Kf.toLowerCase(),Fg=Kf[0].toUpperCase()+Kf.slice(1);ia(cm,"on"+Fg)}ia(Wu,"onAnimationEnd"),ia(Ku,"onAnimationIteration"),ia(qc,"onAnimationStart"),ia("dblclick","onDoubleClick"),ia("focusin","onFocus"),ia("focusout","onBlur"),ia(tl,"onTransitionRun"),ia(Qu,"onTransitionStart"),ia(Kl,"onTransitionCancel"),ia(ta,"onTransitionEnd"),Os("onMouseEnter",["mouseout","mouseover"]),Os("onMouseLeave",["mouseout","mouseover"]),Os("onPointerEnter",["pointerout","pointerover"]),Os("onPointerLeave",["pointerout","pointerover"]),hi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),hi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),hi("onBeforeInput",["compositionend","keypress","textInput","paste"]),hi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),hi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),hi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(mu));function Ng(r,s){s=(s&4)!==0;for(var h=0;h<r.length;h++){var _=r[h],A=_.event;_=_.listeners;e:{var P=void 0;if(s)for(var U=_.length-1;0<=U;U--){var ee=_[U],be=ee.instance,Ge=ee.currentTarget;if(ee=ee.listener,be!==P&&A.isPropagationStopped())break e;P=ee,A.currentTarget=Ge;try{P(A)}catch(it){fs(it)}A.currentTarget=null,P=be}else for(U=0;U<_.length;U++){if(ee=_[U],be=ee.instance,Ge=ee.currentTarget,ee=ee.listener,be!==P&&A.isPropagationStopped())break e;P=ee,A.currentTarget=Ge;try{P(A)}catch(it){fs(it)}A.currentTarget=null,P=be}}}}function gi(r,s){var h=s[Jt];h===void 0&&(h=s[Jt]=new Set);var _=r+"__bubble";h.has(_)||(Jf(s,r,2,!1),h.add(_))}function hm(r,s,h){var _=0;s&&(_|=4),Jf(h,r,_,s)}var Qf="_reactListening"+Math.random().toString(36).slice(2);function dm(r){if(!r[Qf]){r[Qf]=!0,Fl.forEach(function(h){h!=="selectionchange"&&(jg.has(h)||hm(h,!1,r),hm(h,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Qf]||(s[Qf]=!0,hm("selectionchange",!1,s))}}function Jf(r,s,h,_){switch(Mc(s)){case 2:var A=Bd;break;case 8:A=ey;break;default:A=Rm}h=A.bind(null,s,h,r),A=void 0,!Cr||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(A=!0),_?A!==void 0?r.addEventListener(s,h,{capture:!0,passive:A}):r.addEventListener(s,h,!0):A!==void 0?r.addEventListener(s,h,{passive:A}):r.addEventListener(s,h,!1)}function ko(r,s,h,_,A){var P=_;if((s&1)===0&&(s&2)===0&&_!==null)e:for(;;){if(_===null)return;var U=_.tag;if(U===3||U===4){var ee=_.stateNode.containerInfo;if(ee===A)break;if(U===4)for(U=_.return;U!==null;){var be=U.tag;if((be===3||be===4)&&U.stateNode.containerInfo===A)return;U=U.return}for(;ee!==null;){if(U=ss(ee),U===null)return;if(be=U.tag,be===5||be===6||be===26||be===27){_=P=U;continue e}ee=ee.parentNode}}_=_.return}Fi(function(){var Ge=P,it=Lu(h),lt=[];e:{var qe=Zh.get(r);if(qe!==void 0){var Xe=ku,Lt=r;switch(r){case"keypress":if(ea(h)===0)break e;case"keydown":case"keyup":Xe=mn;break;case"focusin":Lt="focus",Xe=po;break;case"focusout":Lt="blur",Xe=po;break;case"beforeblur":case"afterblur":Xe=po;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Xe=Wo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Xe=Bu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Xe=kp;break;case Wu:case Ku:case qc:Xe=nf;break;case ta:Xe=Bc;break;case"scroll":case"scrollend":Xe=Yo;break;case"wheel":Xe=Nh;break;case"copy":case"cut":case"paste":Xe=Fh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Xe=kc;break;case"toggle":case"beforetoggle":Xe=Zl}var Ut=(s&4)!==0,Xi=!Ut&&(r==="scroll"||r==="scrollend"),ze=Ut?qe!==null?qe+"Capture":null:qe;Ut=[];for(var Ee=Ge,Ve;Ee!==null;){var at=Ee;if(Ve=at.stateNode,at=at.tag,at!==5&&at!==26&&at!==27||Ve===null||ze===null||(at=_a(Ee,ze),at!=null&&Ut.push(wh(Ee,at,Ve))),Xi)break;Ee=Ee.return}0<Ut.length&&(qe=new Xe(qe,Lt,null,h,it),lt.push({event:qe,listeners:Ut}))}}if((s&7)===0){e:{if(qe=r==="mouseover"||r==="pointerover",Xe=r==="mouseout"||r==="pointerout",qe&&h!==Oh&&(Lt=h.relatedTarget||h.fromElement)&&(ss(Lt)||Lt[Ht]))break e;if((Xe||qe)&&(qe=it.window===it?it:(qe=it.ownerDocument)?qe.defaultView||qe.parentWindow:window,Xe?(Lt=h.relatedTarget||h.toElement,Xe=Ge,Lt=Lt?ss(Lt):null,Lt!==null&&(Xi=O(Lt),Ut=Lt.tag,Lt!==Xi||Ut!==5&&Ut!==27&&Ut!==6)&&(Lt=null)):(Xe=null,Lt=Ge),Xe!==Lt)){if(Ut=Wo,at="onMouseLeave",ze="onMouseEnter",Ee="mouse",(r==="pointerout"||r==="pointerover")&&(Ut=kc,at="onPointerLeave",ze="onPointerEnter",Ee="pointer"),Xi=Xe==null?qe:os(Xe),Ve=Lt==null?qe:os(Lt),qe=new Ut(at,Ee+"leave",Xe,h,it),qe.target=Xi,qe.relatedTarget=Ve,at=null,ss(it)===Ge&&(Ut=new Ut(ze,Ee+"enter",Lt,h,it),Ut.target=Ve,Ut.relatedTarget=Xi,at=Ut),Xi=at,Xe&&Lt)t:{for(Ut=Vg,ze=Xe,Ee=Lt,Ve=0,at=ze;at;at=Ut(at))Ve++;at=0;for(var Nt=Ee;Nt;Nt=Ut(Nt))at++;for(;0<Ve-at;)ze=Ut(ze),Ve--;for(;0<at-Ve;)Ee=Ut(Ee),at--;for(;Ve--;){if(ze===Ee||Ee!==null&&ze===Ee.alternate){Ut=ze;break t}ze=Ut(ze),Ee=Ut(Ee)}Ut=null}else Ut=null;Xe!==null&&fm(lt,qe,Xe,Ut,!1),Lt!==null&&Xi!==null&&fm(lt,Xi,Lt,Ut,!0)}}e:{if(qe=Ge?os(Ge):window,Xe=qe.nodeName&&qe.nodeName.toLowerCase(),Xe==="select"||Xe==="input"&&qe.type==="file")var Ii=yo;else if(Fc(qe))if(Vh)Ii=ff;else{Ii=df;var kt=Bp}else Xe=qe.nodeName,!Xe||Xe.toLowerCase()!=="input"||qe.type!=="checkbox"&&qe.type!=="radio"?Ge&&Ho(Ge.elementType)&&(Ii=yo):Ii=Zu;if(Ii&&(Ii=Ii(r,Ge))){jc(lt,Ii,h,it);break e}kt&&kt(r,qe,Ge),r==="focusout"&&Ge&&qe.type==="number"&&Ge.memoizedProps.value!=null&&Iu(qe,"number",qe.value)}switch(kt=Ge?os(Ge):window,r){case"focusin":(Fc(kt)||kt.contentEditable==="true")&&(ba=kt,Xu=Ge,Yu=null);break;case"focusout":Yu=Xu=ba=null;break;case"mousedown":Gc=!0;break;case"contextmenu":case"mouseup":case"dragend":Gc=!1,pf(lt,h,it);break;case"selectionchange":if(Uc)break;case"keydown":case"keyup":pf(lt,h,it)}var Ft;if(Tn)e:{switch(r){case"compositionstart":var fi="onCompositionStart";break e;case"compositionend":fi="onCompositionEnd";break e;case"compositionupdate":fi="onCompositionUpdate";break e}fi=void 0}else Ua?Vu(r,h)&&(fi="onCompositionEnd"):r==="keydown"&&h.keyCode===229&&(fi="onCompositionStart");fi&&(Yl&&h.locale!=="ko"&&(Ua||fi!=="onCompositionStart"?fi==="onCompositionEnd"&&Ua&&(Ft=ho()):(Jr=it,cs="value"in Jr?Jr.value:Jr.textContent,Ua=!0)),kt=Td(Ge,fi),0<kt.length&&(fi=new jh(fi,r,null,h,it),lt.push({event:fi,listeners:kt}),Ft?fi.data=Ft:(Ft=of(h),Ft!==null&&(fi.data=Ft)))),(Ft=Xl?Oc(r,h):lf(r,h))&&(fi=Td(Ge,"onBeforeInput"),0<fi.length&&(kt=new jh("onBeforeInput","beforeinput",null,h,it),lt.push({event:kt,listeners:fi}),kt.data=Ft)),bh(lt,r,Ge,h,it)}Ng(lt,s)})}function wh(r,s,h){return{instance:r,listener:s,currentTarget:h}}function Td(r,s){for(var h=s+"Capture",_=[];r!==null;){var A=r,P=A.stateNode;if(A=A.tag,A!==5&&A!==26&&A!==27||P===null||(A=_a(r,h),A!=null&&_.unshift(wh(r,A,P)),A=_a(r,s),A!=null&&_.push(wh(r,A,P))),r.tag===3)return _;r=r.return}return[]}function Vg(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function fm(r,s,h,_,A){for(var P=s._reactName,U=[];h!==null&&h!==_;){var ee=h,be=ee.alternate,Ge=ee.stateNode;if(ee=ee.tag,be!==null&&be===_)break;ee!==5&&ee!==26&&ee!==27||Ge===null||(be=Ge,A?(Ge=_a(h,P),Ge!=null&&U.unshift(wh(h,Ge,be))):A||(Ge=_a(h,P),Ge!=null&&U.push(wh(h,Ge,be)))),h=h.return}U.length!==0&&r.push({event:s,listeners:U})}var Ug=/\r\n?/g,Gg=/\u0000|\uFFFD/g;function Sd(r){return(typeof r=="string"?r:""+r).replace(Ug,`
`).replace(Gg,"")}function pm(r,s){return s=Sd(s),Sd(r)===s}function Ri(r,s,h,_,A,P){switch(h){case"children":typeof _=="string"?s==="body"||s==="textarea"&&_===""||Fs(r,_):(typeof _=="number"||typeof _=="bigint")&&s!=="body"&&Fs(r,""+_);break;case"className":us(r,"class",_);break;case"tabIndex":us(r,"tabindex",_);break;case"dir":case"role":case"viewBox":case"width":case"height":us(r,h,_);break;case"style":Lc(r,_,P);break;case"data":if(s!=="object"){us(r,"data",_);break}case"src":case"href":if(_===""&&(s!=="a"||h!=="href")){r.removeAttribute(h);break}if(_==null||typeof _=="function"||typeof _=="symbol"||typeof _=="boolean"){r.removeAttribute(h);break}_=Qt(""+_),r.setAttribute(h,_);break;case"action":case"formAction":if(typeof _=="function"){r.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof P=="function"&&(h==="formAction"?(s!=="input"&&Ri(r,s,"name",A.name,A,null),Ri(r,s,"formEncType",A.formEncType,A,null),Ri(r,s,"formMethod",A.formMethod,A,null),Ri(r,s,"formTarget",A.formTarget,A,null)):(Ri(r,s,"encType",A.encType,A,null),Ri(r,s,"method",A.method,A,null),Ri(r,s,"target",A.target,A,null)));if(_==null||typeof _=="symbol"||typeof _=="boolean"){r.removeAttribute(h);break}_=Qt(""+_),r.setAttribute(h,_);break;case"onClick":_!=null&&(r.onclick=Va);break;case"onScroll":_!=null&&gi("scroll",r);break;case"onScrollEnd":_!=null&&gi("scrollend",r);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(S(61));if(h=_.__html,h!=null){if(A.children!=null)throw Error(S(60));r.innerHTML=h}}break;case"multiple":r.multiple=_&&typeof _!="function"&&typeof _!="symbol";break;case"muted":r.muted=_&&typeof _!="function"&&typeof _!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(_==null||typeof _=="function"||typeof _=="boolean"||typeof _=="symbol"){r.removeAttribute("xlink:href");break}h=Qt(""+_),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":_!=null&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(h,""+_):r.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":_&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(h,""):r.removeAttribute(h);break;case"capture":case"download":_===!0?r.setAttribute(h,""):_!==!1&&_!=null&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(h,_):r.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":_!=null&&typeof _!="function"&&typeof _!="symbol"&&!isNaN(_)&&1<=_?r.setAttribute(h,_):r.removeAttribute(h);break;case"rowSpan":case"start":_==null||typeof _=="function"||typeof _=="symbol"||isNaN(_)?r.removeAttribute(h):r.setAttribute(h,_);break;case"popover":gi("beforetoggle",r),gi("toggle",r),Pu(r,"popover",_);break;case"xlinkActuate":ya(r,"http://www.w3.org/1999/xlink","xlink:actuate",_);break;case"xlinkArcrole":ya(r,"http://www.w3.org/1999/xlink","xlink:arcrole",_);break;case"xlinkRole":ya(r,"http://www.w3.org/1999/xlink","xlink:role",_);break;case"xlinkShow":ya(r,"http://www.w3.org/1999/xlink","xlink:show",_);break;case"xlinkTitle":ya(r,"http://www.w3.org/1999/xlink","xlink:title",_);break;case"xlinkType":ya(r,"http://www.w3.org/1999/xlink","xlink:type",_);break;case"xmlBase":ya(r,"http://www.w3.org/XML/1998/namespace","xml:base",_);break;case"xmlLang":ya(r,"http://www.w3.org/XML/1998/namespace","xml:lang",_);break;case"xmlSpace":ya(r,"http://www.w3.org/XML/1998/namespace","xml:space",_);break;case"is":Pu(r,"is",_);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=co.get(h)||h,Pu(r,h,_))}}function ep(r,s,h,_,A,P){switch(h){case"style":Lc(r,_,P);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(S(61));if(h=_.__html,h!=null){if(A.children!=null)throw Error(S(60));r.innerHTML=h}}break;case"children":typeof _=="string"?Fs(r,_):(typeof _=="number"||typeof _=="bigint")&&Fs(r,""+_);break;case"onScroll":_!=null&&gi("scroll",r);break;case"onScrollEnd":_!=null&&gi("scrollend",r);break;case"onClick":_!=null&&(r.onclick=Va);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!_r.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(A=h.endsWith("Capture"),s=h.slice(2,A?h.length-7:void 0),P=r[pt]||null,P=P!=null?P[h]:null,typeof P=="function"&&r.removeEventListener(s,P,A),typeof _=="function")){typeof P!="function"&&P!==null&&(h in r?r[h]=null:r.hasAttribute(h)&&r.removeAttribute(h)),r.addEventListener(s,_,A);break e}h in r?r[h]=_:_===!0?r.setAttribute(h,""):Pu(r,h,_)}}}function fr(r,s,h){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":gi("error",r),gi("load",r);var _=!1,A=!1,P;for(P in h)if(h.hasOwnProperty(P)){var U=h[P];if(U!=null)switch(P){case"src":_=!0;break;case"srcSet":A=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(S(137,s));default:Ri(r,s,P,U,h,null)}}A&&Ri(r,s,"srcSet",h.srcSet,h,null),_&&Ri(r,s,"src",h.src,h,null);return;case"input":gi("invalid",r);var ee=P=U=A=null,be=null,Ge=null;for(_ in h)if(h.hasOwnProperty(_)){var it=h[_];if(it!=null)switch(_){case"name":A=it;break;case"type":U=it;break;case"checked":be=it;break;case"defaultChecked":Ge=it;break;case"value":P=it;break;case"defaultValue":ee=it;break;case"children":case"dangerouslySetInnerHTML":if(it!=null)throw Error(S(137,s));break;default:Ri(r,s,_,it,h,null)}}Ic(r,P,ee,be,Ge,U,A,!1);return;case"select":gi("invalid",r),_=U=P=null;for(A in h)if(h.hasOwnProperty(A)&&(ee=h[A],ee!=null))switch(A){case"value":P=ee;break;case"defaultValue":U=ee;break;case"multiple":_=ee;default:Ri(r,s,A,ee,h,null)}s=P,h=U,r.multiple=!!_,s!=null?uo(r,!!_,s,!1):h!=null&&uo(r,!!_,h,!0);return;case"textarea":gi("invalid",r),P=A=_=null;for(U in h)if(h.hasOwnProperty(U)&&(ee=h[U],ee!=null))switch(U){case"value":_=ee;break;case"defaultValue":A=ee;break;case"children":P=ee;break;case"dangerouslySetInnerHTML":if(ee!=null)throw Error(S(91));break;default:Ri(r,s,U,ee,h,null)}Vl(r,_,A,P);return;case"option":for(be in h)h.hasOwnProperty(be)&&(_=h[be],_!=null)&&(be==="selected"?r.selected=_&&typeof _!="function"&&typeof _!="symbol":Ri(r,s,be,_,h,null));return;case"dialog":gi("beforetoggle",r),gi("toggle",r),gi("cancel",r),gi("close",r);break;case"iframe":case"object":gi("load",r);break;case"video":case"audio":for(_=0;_<mu.length;_++)gi(mu[_],r);break;case"image":gi("error",r),gi("load",r);break;case"details":gi("toggle",r);break;case"embed":case"source":case"link":gi("error",r),gi("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ge in h)if(h.hasOwnProperty(Ge)&&(_=h[Ge],_!=null))switch(Ge){case"children":case"dangerouslySetInnerHTML":throw Error(S(137,s));default:Ri(r,s,Ge,_,h,null)}return;default:if(Ho(s)){for(it in h)h.hasOwnProperty(it)&&(_=h[it],_!==void 0&&ep(r,s,it,_,h,void 0));return}}for(ee in h)h.hasOwnProperty(ee)&&(_=h[ee],_!=null&&Ri(r,s,ee,_,h,null))}function qg(r,s,h,_){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var A=null,P=null,U=null,ee=null,be=null,Ge=null,it=null;for(Xe in h){var lt=h[Xe];if(h.hasOwnProperty(Xe)&&lt!=null)switch(Xe){case"checked":break;case"value":break;case"defaultValue":be=lt;default:_.hasOwnProperty(Xe)||Ri(r,s,Xe,null,_,lt)}}for(var qe in _){var Xe=_[qe];if(lt=h[qe],_.hasOwnProperty(qe)&&(Xe!=null||lt!=null))switch(qe){case"type":P=Xe;break;case"name":A=Xe;break;case"checked":Ge=Xe;break;case"defaultChecked":it=Xe;break;case"value":U=Xe;break;case"defaultValue":ee=Xe;break;case"children":case"dangerouslySetInnerHTML":if(Xe!=null)throw Error(S(137,s));break;default:Xe!==lt&&Ri(r,s,qe,Xe,_,lt)}}Ru(r,U,ee,be,Ge,it,P,A);return;case"select":Xe=U=ee=qe=null;for(P in h)if(be=h[P],h.hasOwnProperty(P)&&be!=null)switch(P){case"value":break;case"multiple":Xe=be;default:_.hasOwnProperty(P)||Ri(r,s,P,null,_,be)}for(A in _)if(P=_[A],be=h[A],_.hasOwnProperty(A)&&(P!=null||be!=null))switch(A){case"value":qe=P;break;case"defaultValue":ee=P;break;case"multiple":U=P;default:P!==be&&Ri(r,s,A,P,_,be)}s=ee,h=U,_=Xe,qe!=null?uo(r,!!h,qe,!1):!!_!=!!h&&(s!=null?uo(r,!!h,s,!0):uo(r,!!h,h?[]:"",!1));return;case"textarea":Xe=qe=null;for(ee in h)if(A=h[ee],h.hasOwnProperty(ee)&&A!=null&&!_.hasOwnProperty(ee))switch(ee){case"value":break;case"children":break;default:Ri(r,s,ee,null,_,A)}for(U in _)if(A=_[U],P=h[U],_.hasOwnProperty(U)&&(A!=null||P!=null))switch(U){case"value":qe=A;break;case"defaultValue":Xe=A;break;case"children":break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(S(91));break;default:A!==P&&Ri(r,s,U,A,_,P)}ef(r,qe,Xe);return;case"option":for(var Lt in h)qe=h[Lt],h.hasOwnProperty(Lt)&&qe!=null&&!_.hasOwnProperty(Lt)&&(Lt==="selected"?r.selected=!1:Ri(r,s,Lt,null,_,qe));for(be in _)qe=_[be],Xe=h[be],_.hasOwnProperty(be)&&qe!==Xe&&(qe!=null||Xe!=null)&&(be==="selected"?r.selected=qe&&typeof qe!="function"&&typeof qe!="symbol":Ri(r,s,be,qe,_,Xe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ut in h)qe=h[Ut],h.hasOwnProperty(Ut)&&qe!=null&&!_.hasOwnProperty(Ut)&&Ri(r,s,Ut,null,_,qe);for(Ge in _)if(qe=_[Ge],Xe=h[Ge],_.hasOwnProperty(Ge)&&qe!==Xe&&(qe!=null||Xe!=null))switch(Ge){case"children":case"dangerouslySetInnerHTML":if(qe!=null)throw Error(S(137,s));break;default:Ri(r,s,Ge,qe,_,Xe)}return;default:if(Ho(s)){for(var Xi in h)qe=h[Xi],h.hasOwnProperty(Xi)&&qe!==void 0&&!_.hasOwnProperty(Xi)&&ep(r,s,Xi,void 0,_,qe);for(it in _)qe=_[it],Xe=h[it],!_.hasOwnProperty(it)||qe===Xe||qe===void 0&&Xe===void 0||ep(r,s,it,qe,_,Xe);return}}for(var ze in h)qe=h[ze],h.hasOwnProperty(ze)&&qe!=null&&!_.hasOwnProperty(ze)&&Ri(r,s,ze,null,_,qe);for(lt in _)qe=_[lt],Xe=h[lt],!_.hasOwnProperty(lt)||qe===Xe||qe==null&&Xe==null||Ri(r,s,lt,qe,_,Xe)}function ka(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Th(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,h=performance.getEntriesByType("resource"),_=0;_<h.length;_++){var A=h[_],P=A.transferSize,U=A.initiatorType,ee=A.duration;if(P&&ee&&ka(U)){for(U=0,ee=A.responseEnd,_+=1;_<h.length;_++){var be=h[_],Ge=be.startTime;if(Ge>ee)break;var it=be.transferSize,lt=be.initiatorType;it&&ka(lt)&&(be=be.responseEnd,U+=it*(be<ee?1:(ee-Ge)/(be-Ge)))}if(--_,s+=8*(P+U)/(A.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var Md=null,mm=null;function Ed(r){return r.nodeType===9?r:r.ownerDocument}function gu(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function gm(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function tp(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var yu=null;function ip(){var r=window.event;return r&&r.type==="popstate"?r===yu?!1:(yu=r,!0):(yu=null,!1)}var np=typeof setTimeout=="function"?setTimeout:void 0,ym=typeof clearTimeout=="function"?clearTimeout:void 0,_m=typeof Promise=="function"?Promise:void 0,vm=typeof queueMicrotask=="function"?queueMicrotask:typeof _m<"u"?function(r){return _m.resolve(null).then(r).catch(xm)}:np;function xm(r){setTimeout(function(){throw r})}function _u(r){return r==="head"}function Zg(r,s){var h=s,_=0;do{var A=h.nextSibling;if(r.removeChild(h),A&&A.nodeType===8)if(h=A.data,h==="/$"||h==="/&"){if(_===0){r.removeChild(A),Su(s);return}_--}else if(h==="$"||h==="$?"||h==="$~"||h==="$!"||h==="&")_++;else if(h==="html")Sh(r.ownerDocument.documentElement);else if(h==="head"){h=r.ownerDocument.head,Sh(h);for(var P=h.firstChild;P;){var U=P.nextSibling,ee=P.nodeName;P[Zt]||ee==="SCRIPT"||ee==="STYLE"||ee==="LINK"&&P.rel.toLowerCase()==="stylesheet"||h.removeChild(P),P=U}}else h==="body"&&Sh(r.ownerDocument.body);h=A}while(h);Su(s)}function ri(r,s){var h=r;r=0;do{var _=h.nextSibling;if(h.nodeType===1?s?(h._stashedDisplay=h.style.display,h.style.display="none"):(h.style.display=h._stashedDisplay||"",h.getAttribute("style")===""&&h.removeAttribute("style")):h.nodeType===3&&(s?(h._stashedText=h.nodeValue,h.nodeValue=""):h.nodeValue=h._stashedText||""),_&&_.nodeType===8)if(h=_.data,h==="/$"){if(r===0)break;r--}else h!=="$"&&h!=="$?"&&h!=="$~"&&h!=="$!"||r++;h=_}while(h)}function io(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var h=s;switch(s=s.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":io(h),Go(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}r.removeChild(h)}}function br(r,s,h,_){for(;r.nodeType===1;){var A=h;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!_&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(_){if(!r[Zt])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(P=r.getAttribute("rel"),P==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(P!==A.rel||r.getAttribute("href")!==(A.href==null||A.href===""?null:A.href)||r.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin)||r.getAttribute("title")!==(A.title==null?null:A.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(P=r.getAttribute("src"),(P!==(A.src==null?null:A.src)||r.getAttribute("type")!==(A.type==null?null:A.type)||r.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin))&&P&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var P=A.name==null?null:""+A.name;if(A.type==="hidden"&&r.getAttribute("name")===P)return r}else return r;if(r=es(r.nextSibling),r===null)break}return null}function no(r,s,h){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!h||(r=es(r.nextSibling),r===null))return null;return r}function vu(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=es(r.nextSibling),r===null))return null;return r}function Hr(r){return r.data==="$?"||r.data==="$~"}function jn(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function ar(r,s){var h=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||h.readyState!=="loading")s();else{var _=function(){s(),h.removeEventListener("DOMContentLoaded",_)};h.addEventListener("DOMContentLoaded",_),r._reactRetry=_}}function es(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var fa=null;function sr(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var h=r.data;if(h==="/$"||h==="/&"){if(s===0)return es(r.nextSibling);s--}else h!=="$"&&h!=="$!"&&h!=="$?"&&h!=="$~"&&h!=="&"||s++}r=r.nextSibling}return null}function Ad(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var h=r.data;if(h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"){if(s===0)return r;s--}else h!=="/$"&&h!=="/&"||s++}r=r.previousSibling}return null}function Hg(r,s,h){switch(s=Ed(h),r){case"html":if(r=s.documentElement,!r)throw Error(S(452));return r;case"head":if(r=s.head,!r)throw Error(S(453));return r;case"body":if(r=s.body,!r)throw Error(S(454));return r;default:throw Error(S(451))}}function Sh(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);Go(r)}var wr=new Map,Tc=new Set;function rp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Bo=ht.d;ht.d={f:$g,r:Xg,D:wm,C:$r,L:ro,m:Xr,X:ap,S:bu,M:Tm};function $g(){var r=Bo.f(),s=vd();return r||s}function Xg(r){var s=Bs(r);s!==null&&s.tag===5&&s.type==="form"?er(s):Bo.r(r)}var xu=typeof document>"u"?null:document;function bm(r,s,h){var _=xu;if(_&&typeof s=="string"&&s){var A=Ar(s);A='link[rel="'+r+'"][href="'+A+'"]',typeof h=="string"&&(A+='[crossorigin="'+h+'"]'),Tc.has(A)||(Tc.add(A),r={rel:r,crossOrigin:h,href:s},_.querySelector(A)===null&&(s=_.createElement("link"),fr(s,"link",r),fn(s),_.head.appendChild(s)))}}function wm(r){Bo.D(r),bm("dns-prefetch",r,null)}function $r(r,s){Bo.C(r,s),bm("preconnect",r,s)}function ro(r,s,h){Bo.L(r,s,h);var _=xu;if(_&&r&&s){var A='link[rel="preload"][as="'+Ar(s)+'"]';s==="image"&&h&&h.imageSrcSet?(A+='[imagesrcset="'+Ar(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(A+='[imagesizes="'+Ar(h.imageSizes)+'"]')):A+='[href="'+Ar(r)+'"]';var P=A;switch(s){case"style":P=Sc(r);break;case"script":P=Ml(r)}wr.has(P)||(r=te({rel:"preload",href:s==="image"&&h&&h.imageSrcSet?void 0:r,as:s},h),wr.set(P,r),_.querySelector(A)!==null||s==="style"&&_.querySelector(Mh(P))||s==="script"&&_.querySelector(Eh(P))||(s=_.createElement("link"),fr(s,"link",r),fn(s),_.head.appendChild(s)))}}function Xr(r,s){Bo.m(r,s);var h=xu;if(h&&r){var _=s&&typeof s.as=="string"?s.as:"script",A='link[rel="modulepreload"][as="'+Ar(_)+'"][href="'+Ar(r)+'"]',P=A;switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":P=Ml(r)}if(!wr.has(P)&&(r=te({rel:"modulepreload",href:r},s),wr.set(P,r),h.querySelector(A)===null)){switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(Eh(P)))return}_=h.createElement("link"),fr(_,"link",r),fn(_),h.head.appendChild(_)}}}function bu(r,s,h){Bo.S(r,s,h);var _=xu;if(_&&r){var A=ls(_).hoistableStyles,P=Sc(r);s=s||"default";var U=A.get(P);if(!U){var ee={loading:0,preload:null};if(U=_.querySelector(Mh(P)))ee.loading=5;else{r=te({rel:"stylesheet",href:r,"data-precedence":s},h),(h=wr.get(P))&&Cd(r,h);var be=U=_.createElement("link");fn(be),fr(be,"link",r),be._p=new Promise(function(Ge,it){be.onload=Ge,be.onerror=it}),be.addEventListener("load",function(){ee.loading|=1}),be.addEventListener("error",function(){ee.loading|=2}),ee.loading|=4,El(U,s,_)}U={type:"stylesheet",instance:U,count:1,state:ee},A.set(P,U)}}}function ap(r,s){Bo.X(r,s);var h=xu;if(h&&r){var _=ls(h).hoistableScripts,A=Ml(r),P=_.get(A);P||(P=h.querySelector(Eh(A)),P||(r=te({src:r,async:!0},s),(s=wr.get(A))&&sp(r,s),P=h.createElement("script"),fn(P),fr(P,"link",r),h.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},_.set(A,P))}}function Tm(r,s){Bo.M(r,s);var h=xu;if(h&&r){var _=ls(h).hoistableScripts,A=Ml(r),P=_.get(A);P||(P=h.querySelector(Eh(A)),P||(r=te({src:r,async:!0,type:"module"},s),(s=wr.get(A))&&sp(r,s),P=h.createElement("script"),fn(P),fr(P,"link",r),h.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},_.set(A,P))}}function Sm(r,s,h,_){var A=(A=Wt.current)?rp(A):null;if(!A)throw Error(S(446));switch(r){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(s=Sc(h.href),h=ls(A).hoistableStyles,_=h.get(s),_||(_={type:"style",instance:null,count:0,state:null},h.set(s,_)),_):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){r=Sc(h.href);var P=ls(A).hoistableStyles,U=P.get(r);if(U||(A=A.ownerDocument||A,U={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},P.set(r,U),(P=A.querySelector(Mh(r)))&&!P._p&&(U.instance=P,U.state.loading=5),wr.has(r)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},wr.set(r,h),P||Em(A,r,h,U.state))),s&&_===null)throw Error(S(528,""));return U}if(s&&_!==null)throw Error(S(529,""));return null;case"script":return s=h.async,h=h.src,typeof h=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Ml(h),h=ls(A).hoistableScripts,_=h.get(s),_||(_={type:"script",instance:null,count:0,state:null},h.set(s,_)),_):{type:"void",instance:null,count:0,state:null};default:throw Error(S(444,r))}}function Sc(r){return'href="'+Ar(r)+'"'}function Mh(r){return'link[rel="stylesheet"]['+r+"]"}function Mm(r){return te({},r,{"data-precedence":r.precedence,precedence:null})}function Em(r,s,h,_){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?_.loading=1:(s=r.createElement("link"),_.preload=s,s.addEventListener("load",function(){return _.loading|=1}),s.addEventListener("error",function(){return _.loading|=2}),fr(s,"link",h),fn(s),r.head.appendChild(s))}function Ml(r){return'[src="'+Ar(r)+'"]'}function Eh(r){return"script[async]"+r}function Am(r,s,h){if(s.count++,s.instance===null)switch(s.type){case"style":var _=r.querySelector('style[data-href~="'+Ar(h.href)+'"]');if(_)return s.instance=_,fn(_),_;var A=te({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return _=(r.ownerDocument||r).createElement("style"),fn(_),fr(_,"style",A),El(_,h.precedence,r),s.instance=_;case"stylesheet":A=Sc(h.href);var P=r.querySelector(Mh(A));if(P)return s.state.loading|=4,s.instance=P,fn(P),P;_=Mm(h),(A=wr.get(A))&&Cd(_,A),P=(r.ownerDocument||r).createElement("link"),fn(P);var U=P;return U._p=new Promise(function(ee,be){U.onload=ee,U.onerror=be}),fr(P,"link",_),s.state.loading|=4,El(P,h.precedence,r),s.instance=P;case"script":return P=Ml(h.src),(A=r.querySelector(Eh(P)))?(s.instance=A,fn(A),A):(_=h,(A=wr.get(P))&&(_=te({},h),sp(_,A)),r=r.ownerDocument||r,A=r.createElement("script"),fn(A),fr(A,"link",_),r.head.appendChild(A),s.instance=A);case"void":return null;default:throw Error(S(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(_=s.instance,s.state.loading|=4,El(_,h.precedence,r));return s.instance}function El(r,s,h){for(var _=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),A=_.length?_[_.length-1]:null,P=A,U=0;U<_.length;U++){var ee=_[U];if(ee.dataset.precedence===s)P=ee;else if(P!==A)break}P?P.parentNode.insertBefore(r,P.nextSibling):(s=h.nodeType===9?h.head:h,s.insertBefore(r,s.firstChild))}function Cd(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function sp(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var op=null;function Cm(r,s,h){if(op===null){var _=new Map,A=op=new Map;A.set(h,_)}else A=op,_=A.get(h),_||(_=new Map,A.set(h,_));if(_.has(r))return _;for(_.set(r,null),h=h.getElementsByTagName(r),A=0;A<h.length;A++){var P=h[A];if(!(P[Zt]||P[qi]||r==="link"&&P.getAttribute("rel")==="stylesheet")&&P.namespaceURI!=="http://www.w3.org/2000/svg"){var U=P.getAttribute(s)||"";U=r+U;var ee=_.get(U);ee?ee.push(P):_.set(U,[P])}}return _}function Dd(r,s,h){r=r.ownerDocument||r,r.head.insertBefore(h,s==="title"?r.querySelector("head > title"):null)}function lp(r,s,h){if(h===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(r=s.disabled,typeof s.precedence=="string"&&r==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Pd(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function Dm(r,s,h,_){if(h.type==="stylesheet"&&(typeof _.media!="string"||matchMedia(_.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var A=Sc(_.href),P=s.querySelector(Mh(A));if(P){s=P._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=Rd.bind(r),s.then(r,r)),h.state.loading|=4,h.instance=P,fn(P);return}P=s.ownerDocument||s,_=Mm(_),(A=wr.get(A))&&Cd(_,A),P=P.createElement("link"),fn(P);var U=P;U._p=new Promise(function(ee,be){U.onload=ee,U.onerror=be}),fr(P,"link",_),h.instance=P}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(h,s),(s=h.state.preload)&&(h.state.loading&3)===0&&(r.count++,h=Rd.bind(r),s.addEventListener("load",h),s.addEventListener("error",h))}}var zd=0;function Pm(r,s){return r.stylesheets&&r.count===0&&Ld(r,r.stylesheets),0<r.count||0<r.imgCount?function(h){var _=setTimeout(function(){if(r.stylesheets&&Ld(r,r.stylesheets),r.unsuspend){var P=r.unsuspend;r.unsuspend=null,P()}},6e4+s);0<r.imgBytes&&zd===0&&(zd=62500*Th());var A=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Ld(r,r.stylesheets),r.unsuspend)){var P=r.unsuspend;r.unsuspend=null,P()}},(r.imgBytes>zd?50:800)+s);return r.unsuspend=h,function(){r.unsuspend=null,clearTimeout(_),clearTimeout(A)}}:null}function Rd(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ld(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Id=null;function Ld(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Id=new Map,s.forEach(Yg,r),Id=null,Rd.call(r))}function Yg(r,s){if(!(s.state.loading&4)){var h=Id.get(r);if(h)var _=h.get(null);else{h=new Map,Id.set(r,h);for(var A=r.querySelectorAll("link[data-precedence],style[data-precedence]"),P=0;P<A.length;P++){var U=A[P];(U.nodeName==="LINK"||U.getAttribute("media")!=="not all")&&(h.set(U.dataset.precedence,U),_=U)}_&&h.set(null,_)}A=s.instance,U=A.getAttribute("data-precedence"),P=h.get(U)||_,P===_&&h.set(null,A),h.set(U,A),this.count++,_=Rd.bind(this),A.addEventListener("load",_),A.addEventListener("error",_),P?P.parentNode.insertBefore(A,P.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(A,r.firstChild)),s.state.loading|=4}}var Ah={$$typeof:$e,Provider:null,Consumer:null,_currentValue:Rt,_currentValue2:Rt,_threadCount:0};function jy(r,s,h,_,A,P,U,ee,be){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Un(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Un(0),this.hiddenUpdates=Un(null),this.identifierPrefix=_,this.onUncaughtError=A,this.onCaughtError=P,this.onRecoverableError=U,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=be,this.incompleteTransitions=new Map}function zm(r,s,h,_,A,P,U,ee,be,Ge,it,lt){return r=new jy(r,s,h,U,be,Ge,it,lt,ee),s=1,P===!0&&(s|=24),P=na(3,null,null,s),r.current=P,P.stateNode=r,s=bs(),s.refCount++,r.pooledCache=s,s.refCount++,P.memoizedState={element:_,isDehydrated:h,cache:s},rh(P),r}function Wg(r){return r?(r=Kt,r):Kt}function Kg(r,s,h,_,A,P){A=Wg(A),_.context===null?_.context=A:_.pendingContext=A,_=Es(s),_.payload={element:h},P=P===void 0?null:P,P!==null&&(_.callback=P),h=Hs(r,_,s),h!==null&&(La(h,r,s),Ma(h,r,s))}function up(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var h=r.retryLane;r.retryLane=h!==0&&h<s?h:s}}function cp(r,s){up(r,s),(r=r.alternate)&&up(r,s)}function Qg(r){if(r.tag===13||r.tag===31){var s=wa(r,67108864);s!==null&&La(s,r,67108864),cp(r,67108864)}}function Jg(r){if(r.tag===13||r.tag===31){var s=Ia();s=Uo(s);var h=wa(r,s);h!==null&&La(h,r,s),cp(r,s)}}var kd=!0;function Bd(r,s,h,_){var A=tt.T;tt.T=null;var P=ht.p;try{ht.p=2,Rm(r,s,h,_)}finally{ht.p=P,tt.T=A}}function ey(r,s,h,_){var A=tt.T;tt.T=null;var P=ht.p;try{ht.p=8,Rm(r,s,h,_)}finally{ht.p=P,tt.T=A}}function Rm(r,s,h,_){if(kd){var A=Od(_);if(A===null)ko(r,s,_,Ch,h),ty(r,_);else if(Vy(A,r,s,h,_))_.stopPropagation();else if(ty(r,_),s&4&&-1<Ny.indexOf(r)){for(;A!==null;){var P=Bs(A);if(P!==null)switch(P.tag){case 3:if(P=P.stateNode,P.current.memoizedState.isDehydrated){var U=Ie(P.pendingLanes);if(U!==0){var ee=P;for(ee.pendingLanes|=2,ee.entangledLanes|=2;U;){var be=1<<31-Je(U);ee.entanglements[1]|=be,U&=~be}to(P),(Ui&6)===0&&(yd=Wn()+500,Ja(0))}}break;case 31:case 13:ee=wa(P,2),ee!==null&&La(ee,P,2),vd(),cp(P,2)}if(P=Od(_),P===null&&ko(r,s,_,Ch,h),P===A)break;A=P}A!==null&&_.stopPropagation()}else ko(r,s,_,null,h)}}function Od(r){return r=Lu(r),hp(r)}var Ch=null;function hp(r){if(Ch=null,r=ss(r),r!==null){var s=O(r);if(s===null)r=null;else{var h=s.tag;if(h===13){if(r=M(s),r!==null)return r;r=null}else if(h===31){if(r=u(s),r!==null)return r;r=null}else if(h===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return Ch=r,null}function Mc(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Or()){case Re:return 2;case W:return 8;case Y:case ie:return 32;case _e:return 268435456;default:return 32}default:return 32}}var dp=!1,wu=null,Rs=null,Tu=null,Fd=new Map,Dh=new Map,Al=[],Ny="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ty(r,s){switch(r){case"focusin":case"focusout":wu=null;break;case"dragenter":case"dragleave":Rs=null;break;case"mouseover":case"mouseout":Tu=null;break;case"pointerover":case"pointerout":Fd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dh.delete(s.pointerId)}}function jd(r,s,h,_,A,P){return r===null||r.nativeEvent!==P?(r={blockedOn:s,domEventName:h,eventSystemFlags:_,nativeEvent:P,targetContainers:[A]},s!==null&&(s=Bs(s),s!==null&&Qg(s)),r):(r.eventSystemFlags|=_,s=r.targetContainers,A!==null&&s.indexOf(A)===-1&&s.push(A),r)}function Vy(r,s,h,_,A){switch(s){case"focusin":return wu=jd(wu,r,s,h,_,A),!0;case"dragenter":return Rs=jd(Rs,r,s,h,_,A),!0;case"mouseover":return Tu=jd(Tu,r,s,h,_,A),!0;case"pointerover":var P=A.pointerId;return Fd.set(P,jd(Fd.get(P)||null,r,s,h,_,A)),!0;case"gotpointercapture":return P=A.pointerId,Dh.set(P,jd(Dh.get(P)||null,r,s,h,_,A)),!0}return!1}function iy(r){var s=ss(r.target);if(s!==null){var h=O(s);if(h!==null){if(s=h.tag,s===13){if(s=M(h),s!==null){r.blockedOn=s,yr(r.priority,function(){Jg(h)});return}}else if(s===31){if(s=u(h),s!==null){r.blockedOn=s,yr(r.priority,function(){Jg(h)});return}}else if(s===3&&h.stateNode.current.memoizedState.isDehydrated){r.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Nd(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var h=Od(r.nativeEvent);if(h===null){h=r.nativeEvent;var _=new h.constructor(h.type,h);Oh=_,h.target.dispatchEvent(_),Oh=null}else return s=Bs(h),s!==null&&Qg(s),r.blockedOn=h,!1;s.shift()}return!0}function ny(r,s,h){Nd(r)&&h.delete(s)}function Vd(){dp=!1,wu!==null&&Nd(wu)&&(wu=null),Rs!==null&&Nd(Rs)&&(Rs=null),Tu!==null&&Nd(Tu)&&(Tu=null),Fd.forEach(ny),Dh.forEach(ny)}function fp(r,s){r.blockedOn===s&&(r.blockedOn=null,dp||(dp=!0,d.unstable_scheduleCallback(d.unstable_NormalPriority,Vd)))}var pp=null;function ry(r){pp!==r&&(pp=r,d.unstable_scheduleCallback(d.unstable_NormalPriority,function(){pp===r&&(pp=null);for(var s=0;s<r.length;s+=3){var h=r[s],_=r[s+1],A=r[s+2];if(typeof _!="function"){if(hp(_||h)===null)continue;break}var P=Bs(h);P!==null&&(r.splice(s,3),s-=3,yn(P,{pending:!0,data:A,method:h.method,action:_},_,A))}}))}function Su(r){function s(be){return fp(be,r)}wu!==null&&fp(wu,r),Rs!==null&&fp(Rs,r),Tu!==null&&fp(Tu,r),Fd.forEach(s),Dh.forEach(s);for(var h=0;h<Al.length;h++){var _=Al[h];_.blockedOn===r&&(_.blockedOn=null)}for(;0<Al.length&&(h=Al[0],h.blockedOn===null);)iy(h),h.blockedOn===null&&Al.shift();if(h=(r.ownerDocument||r).$$reactFormReplay,h!=null)for(_=0;_<h.length;_+=3){var A=h[_],P=h[_+1],U=A[pt]||null;if(typeof P=="function")U||ry(h);else if(U){var ee=null;if(P&&P.hasAttribute("formAction")){if(A=P,U=P[pt]||null)ee=U.formAction;else if(hp(A)!==null)continue}else ee=U.action;typeof ee=="function"?h[_+1]=ee:(h.splice(_,3),_-=3),ry(h)}}}function Im(){function r(P){P.canIntercept&&P.info==="react-transition"&&P.intercept({handler:function(){return new Promise(function(U){return A=U})},focusReset:"manual",scroll:"manual"})}function s(){A!==null&&(A(),A=null),_||setTimeout(h,20)}function h(){if(!_&&!navigation.transition){var P=navigation.currentEntry;P&&P.url!=null&&navigation.navigate(P.url,{state:P.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var _=!1,A=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(h,100),function(){_=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),A!==null&&(A(),A=null)}}}function Lm(r){this._internalRoot=r}mp.prototype.render=Lm.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(S(409));var h=s.current,_=Ia();Kg(h,_,r,s,null,null)},mp.prototype.unmount=Lm.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;Kg(r.current,2,null,r,null,null),vd(),s[Ht]=null}};function mp(r){this._internalRoot=r}mp.prototype.unstable_scheduleHydration=function(r){if(r){var s=gr();r={blockedOn:null,target:r,priority:s};for(var h=0;h<Al.length&&s!==0&&s<Al[h].priority;h++);Al.splice(h,0,r),h===0&&iy(r)}};var km=y.version;if(km!=="19.2.3")throw Error(S(527,km,"19.2.3"));ht.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(S(188)):(r=Object.keys(r).join(","),Error(S(268,r)));return r=Z(s),r=r!==null?X(r):null,r=r===null?null:r.stateNode,r};var ay={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:tt,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gp.isDisabled&&gp.supportsFiber)try{Pe=gp.inject(ay),Te=gp}catch{}}return Vm.createRoot=function(r,s){if(!R(r))throw Error(S(299));var h=!1,_="",A=lh,P=Ks,U=Qs;return s!=null&&(s.unstable_strictMode===!0&&(h=!0),s.identifierPrefix!==void 0&&(_=s.identifierPrefix),s.onUncaughtError!==void 0&&(A=s.onUncaughtError),s.onCaughtError!==void 0&&(P=s.onCaughtError),s.onRecoverableError!==void 0&&(U=s.onRecoverableError)),s=zm(r,1,!1,null,null,h,_,null,A,P,U,Im),r[Ht]=s.current,dm(r),new Lm(s)},Vm.hydrateRoot=function(r,s,h){if(!R(r))throw Error(S(299));var _=!1,A="",P=lh,U=Ks,ee=Qs,be=null;return h!=null&&(h.unstable_strictMode===!0&&(_=!0),h.identifierPrefix!==void 0&&(A=h.identifierPrefix),h.onUncaughtError!==void 0&&(P=h.onUncaughtError),h.onCaughtError!==void 0&&(U=h.onCaughtError),h.onRecoverableError!==void 0&&(ee=h.onRecoverableError),h.formState!==void 0&&(be=h.formState)),s=zm(r,1,!0,s,h??null,_,A,be,P,U,ee,Im),s.context=Wg(null),h=s.current,_=Ia(),_=Uo(_),A=Es(_),A.callback=null,Hs(h,A,_),h=_,s.current.lanes=h,Di(s,h),to(s),r[Ht]=s.current,dm(r),new mp(s)},Vm.version="19.2.3",Vm}var Q0;function ew(){if(Q0)return Jy.exports;Q0=1;function d(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(d)}catch(y){console.error(y)}}return d(),Jy.exports=J1(),Jy.exports}var tw=ew();var J0="popstate";function iw(d={}){function y(S,R){let{pathname:O,search:M,hash:u}=S.location;return b_("",{pathname:O,search:M,hash:u},R.state&&R.state.usr||null,R.state&&R.state.key||"default")}function T(S,R){return typeof R=="string"?R:Ym(R)}return rw(y,T,null,d)}function Yn(d,y){if(d===!1||d===null||typeof d>"u")throw new Error(y)}function Ll(d,y){if(!d){typeof console<"u"&&console.warn(y);try{throw new Error(y)}catch{}}}function nw(){return Math.random().toString(36).substring(2,10)}function ev(d,y){return{usr:d.state,key:d.key,idx:y}}function b_(d,y,T=null,S){return{pathname:typeof d=="string"?d:d.pathname,search:"",hash:"",...typeof y=="string"?Dp(y):y,state:T,key:y&&y.key||S||nw()}}function Ym({pathname:d="/",search:y="",hash:T=""}){return y&&y!=="?"&&(d+=y.charAt(0)==="?"?y:"?"+y),T&&T!=="#"&&(d+=T.charAt(0)==="#"?T:"#"+T),d}function Dp(d){let y={};if(d){let T=d.indexOf("#");T>=0&&(y.hash=d.substring(T),d=d.substring(0,T));let S=d.indexOf("?");S>=0&&(y.search=d.substring(S),d=d.substring(0,S)),d&&(y.pathname=d)}return y}function rw(d,y,T,S={}){let{window:R=document.defaultView,v5Compat:O=!1}=S,M=R.history,u="POP",j=null,Z=X();Z==null&&(Z=0,M.replaceState({...M.state,idx:Z},""));function X(){return(M.state||{idx:null}).idx}function te(){u="POP";let oe=X(),We=oe==null?null:oe-Z;Z=oe,j&&j({action:u,location:De.location,delta:We})}function de(oe,We){u="PUSH";let Ze=b_(De.location,oe,We);Z=X()+1;let $e=ev(Ze,Z),Ct=De.createHref(Ze);try{M.pushState($e,"",Ct)}catch(Ke){if(Ke instanceof DOMException&&Ke.name==="DataCloneError")throw Ke;R.location.assign(Ct)}O&&j&&j({action:u,location:De.location,delta:1})}function Ae(oe,We){u="REPLACE";let Ze=b_(De.location,oe,We);Z=X();let $e=ev(Ze,Z),Ct=De.createHref(Ze);M.replaceState($e,"",Ct),O&&j&&j({action:u,location:De.location,delta:0})}function Ce(oe){return aw(oe)}let De={get action(){return u},get location(){return d(R,M)},listen(oe){if(j)throw new Error("A history only accepts one active listener");return R.addEventListener(J0,te),j=oe,()=>{R.removeEventListener(J0,te),j=null}},createHref(oe){return y(R,oe)},createURL:Ce,encodeLocation(oe){let We=Ce(oe);return{pathname:We.pathname,search:We.search,hash:We.hash}},push:de,replace:Ae,go(oe){return M.go(oe)}};return De}function aw(d,y=!1){let T="http://localhost";typeof window<"u"&&(T=window.location.origin!=="null"?window.location.origin:window.location.href),Yn(T,"No window.location.(origin|href) available to create URL");let S=typeof d=="string"?d:Ym(d);return S=S.replace(/ $/,"%20"),!y&&S.startsWith("//")&&(S=T+S),new URL(S,T)}function Cx(d,y,T="/"){return sw(d,y,T,!1)}function sw(d,y,T,S){let R=typeof y=="string"?Dp(y):y,O=Dc(R.pathname||"/",T);if(O==null)return null;let M=Dx(d);ow(M);let u=null;for(let j=0;u==null&&j<M.length;++j){let Z=_w(O);u=gw(M[j],Z,S)}return u}function Dx(d,y=[],T=[],S="",R=!1){let O=(M,u,j=R,Z)=>{let X={relativePath:Z===void 0?M.path||"":Z,caseSensitive:M.caseSensitive===!0,childrenIndex:u,route:M};if(X.relativePath.startsWith("/")){if(!X.relativePath.startsWith(S)&&j)return;Yn(X.relativePath.startsWith(S),`Absolute route path "${X.relativePath}" nested under path "${S}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),X.relativePath=X.relativePath.slice(S.length)}let te=Cc([S,X.relativePath]),de=T.concat(X);M.children&&M.children.length>0&&(Yn(M.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${te}".`),Dx(M.children,y,de,te,j)),!(M.path==null&&!M.index)&&y.push({path:te,score:pw(te,M.index),routesMeta:de})};return d.forEach((M,u)=>{if(M.path===""||!M.path?.includes("?"))O(M,u);else for(let j of Px(M.path))O(M,u,!0,j)}),y}function Px(d){let y=d.split("/");if(y.length===0)return[];let[T,...S]=y,R=T.endsWith("?"),O=T.replace(/\?$/,"");if(S.length===0)return R?[O,""]:[O];let M=Px(S.join("/")),u=[];return u.push(...M.map(j=>j===""?O:[O,j].join("/"))),R&&u.push(...M),u.map(j=>d.startsWith("/")&&j===""?"/":j)}function ow(d){d.sort((y,T)=>y.score!==T.score?T.score-y.score:mw(y.routesMeta.map(S=>S.childrenIndex),T.routesMeta.map(S=>S.childrenIndex)))}var lw=/^:[\w-]+$/,uw=3,cw=2,hw=1,dw=10,fw=-2,tv=d=>d==="*";function pw(d,y){let T=d.split("/"),S=T.length;return T.some(tv)&&(S+=fw),y&&(S+=cw),T.filter(R=>!tv(R)).reduce((R,O)=>R+(lw.test(O)?uw:O===""?hw:dw),S)}function mw(d,y){return d.length===y.length&&d.slice(0,-1).every((S,R)=>S===y[R])?d[d.length-1]-y[y.length-1]:0}function gw(d,y,T=!1){let{routesMeta:S}=d,R={},O="/",M=[];for(let u=0;u<S.length;++u){let j=S[u],Z=u===S.length-1,X=O==="/"?y:y.slice(O.length)||"/",te=by({path:j.relativePath,caseSensitive:j.caseSensitive,end:Z},X),de=j.route;if(!te&&Z&&T&&!S[S.length-1].route.index&&(te=by({path:j.relativePath,caseSensitive:j.caseSensitive,end:!1},X)),!te)return null;Object.assign(R,te.params),M.push({params:R,pathname:Cc([O,te.pathname]),pathnameBase:ww(Cc([O,te.pathnameBase])),route:de}),te.pathnameBase!=="/"&&(O=Cc([O,te.pathnameBase]))}return M}function by(d,y){typeof d=="string"&&(d={path:d,caseSensitive:!1,end:!0});let[T,S]=yw(d.path,d.caseSensitive,d.end),R=y.match(T);if(!R)return null;let O=R[0],M=O.replace(/(.)\/+$/,"$1"),u=R.slice(1);return{params:S.reduce((Z,{paramName:X,isOptional:te},de)=>{if(X==="*"){let Ce=u[de]||"";M=O.slice(0,O.length-Ce.length).replace(/(.)\/+$/,"$1")}const Ae=u[de];return te&&!Ae?Z[X]=void 0:Z[X]=(Ae||"").replace(/%2F/g,"/"),Z},{}),pathname:O,pathnameBase:M,pattern:d}}function yw(d,y=!1,T=!0){Ll(d==="*"||!d.endsWith("*")||d.endsWith("/*"),`Route path "${d}" will be treated as if it were "${d.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${d.replace(/\*$/,"/*")}".`);let S=[],R="^"+d.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(M,u,j)=>(S.push({paramName:u,isOptional:j!=null}),j?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return d.endsWith("*")?(S.push({paramName:"*"}),R+=d==="*"||d==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):T?R+="\\/*$":d!==""&&d!=="/"&&(R+="(?:(?=\\/|$))"),[new RegExp(R,y?void 0:"i"),S]}function _w(d){try{return d.split("/").map(y=>decodeURIComponent(y).replace(/\//g,"%2F")).join("/")}catch(y){return Ll(!1,`The URL path "${d}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${y}).`),d}}function Dc(d,y){if(y==="/")return d;if(!d.toLowerCase().startsWith(y.toLowerCase()))return null;let T=y.endsWith("/")?y.length-1:y.length,S=d.charAt(T);return S&&S!=="/"?null:d.slice(T)||"/"}var zx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,vw=d=>zx.test(d);function xw(d,y="/"){let{pathname:T,search:S="",hash:R=""}=typeof d=="string"?Dp(d):d,O;if(T)if(vw(T))O=T;else{if(T.includes("//")){let M=T;T=T.replace(/\/\/+/g,"/"),Ll(!1,`Pathnames cannot have embedded double slashes - normalizing ${M} -> ${T}`)}T.startsWith("/")?O=iv(T.substring(1),"/"):O=iv(T,y)}else O=y;return{pathname:O,search:Tw(S),hash:Sw(R)}}function iv(d,y){let T=y.replace(/\/+$/,"").split("/");return d.split("/").forEach(R=>{R===".."?T.length>1&&T.pop():R!=="."&&T.push(R)}),T.length>1?T.join("/"):"/"}function n_(d,y,T,S){return`Cannot include a '${d}' character in a manually specified \`to.${y}\` field [${JSON.stringify(S)}].  Please separate it out to the \`to.${T}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function bw(d){return d.filter((y,T)=>T===0||y.route.path&&y.route.path.length>0)}function Rx(d){let y=bw(d);return y.map((T,S)=>S===y.length-1?T.pathname:T.pathnameBase)}function Ix(d,y,T,S=!1){let R;typeof d=="string"?R=Dp(d):(R={...d},Yn(!R.pathname||!R.pathname.includes("?"),n_("?","pathname","search",R)),Yn(!R.pathname||!R.pathname.includes("#"),n_("#","pathname","hash",R)),Yn(!R.search||!R.search.includes("#"),n_("#","search","hash",R)));let O=d===""||R.pathname==="",M=O?"/":R.pathname,u;if(M==null)u=T;else{let te=y.length-1;if(!S&&M.startsWith("..")){let de=M.split("/");for(;de[0]==="..";)de.shift(),te-=1;R.pathname=de.join("/")}u=te>=0?y[te]:"/"}let j=xw(R,u),Z=M&&M!=="/"&&M.endsWith("/"),X=(O||M===".")&&T.endsWith("/");return!j.pathname.endsWith("/")&&(Z||X)&&(j.pathname+="/"),j}var Cc=d=>d.join("/").replace(/\/\/+/g,"/"),ww=d=>d.replace(/\/+$/,"").replace(/^\/*/,"/"),Tw=d=>!d||d==="?"?"":d.startsWith("?")?d:"?"+d,Sw=d=>!d||d==="#"?"":d.startsWith("#")?d:"#"+d,Mw=class{constructor(d,y,T,S=!1){this.status=d,this.statusText=y||"",this.internal=S,T instanceof Error?(this.data=T.toString(),this.error=T):this.data=T}};function Ew(d){return d!=null&&typeof d.status=="number"&&typeof d.statusText=="string"&&typeof d.internal=="boolean"&&"data"in d}function Aw(d){return d.map(y=>y.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Lx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function kx(d,y){let T=d;if(typeof T!="string"||!zx.test(T))return{absoluteURL:void 0,isExternal:!1,to:T};let S=T,R=!1;if(Lx)try{let O=new URL(window.location.href),M=T.startsWith("//")?new URL(O.protocol+T):new URL(T),u=Dc(M.pathname,y);M.origin===O.origin&&u!=null?T=u+M.search+M.hash:R=!0}catch{Ll(!1,`<Link to="${T}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:S,isExternal:R,to:T}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Bx=["POST","PUT","PATCH","DELETE"];new Set(Bx);var Cw=["GET",...Bx];new Set(Cw);var Pp=we.createContext(null);Pp.displayName="DataRouter";var Cy=we.createContext(null);Cy.displayName="DataRouterState";var Dw=we.createContext(!1),Ox=we.createContext({isTransitioning:!1});Ox.displayName="ViewTransition";var Pw=we.createContext(new Map);Pw.displayName="Fetchers";var zw=we.createContext(null);zw.displayName="Await";var Vo=we.createContext(null);Vo.displayName="Navigation";var tg=we.createContext(null);tg.displayName="Location";var Du=we.createContext({outlet:null,matches:[],isDataRoute:!1});Du.displayName="Route";var H_=we.createContext(null);H_.displayName="RouteError";var Fx="REACT_ROUTER_ERROR",Rw="REDIRECT",Iw="ROUTE_ERROR_RESPONSE";function Lw(d){if(d.startsWith(`${Fx}:${Rw}:{`))try{let y=JSON.parse(d.slice(28));if(typeof y=="object"&&y&&typeof y.status=="number"&&typeof y.statusText=="string"&&typeof y.location=="string"&&typeof y.reloadDocument=="boolean"&&typeof y.replace=="boolean")return y}catch{}}function kw(d){if(d.startsWith(`${Fx}:${Iw}:{`))try{let y=JSON.parse(d.slice(40));if(typeof y=="object"&&y&&typeof y.status=="number"&&typeof y.statusText=="string")return new Mw(y.status,y.statusText,y.data)}catch{}}function Bw(d,{relative:y}={}){Yn(ig(),"useHref() may be used only in the context of a <Router> component.");let{basename:T,navigator:S}=we.useContext(Vo),{hash:R,pathname:O,search:M}=ng(d,{relative:y}),u=O;return T!=="/"&&(u=O==="/"?T:Cc([T,O])),S.createHref({pathname:u,search:M,hash:R})}function ig(){return we.useContext(tg)!=null}function Kd(){return Yn(ig(),"useLocation() may be used only in the context of a <Router> component."),we.useContext(tg).location}var jx="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Nx(d){we.useContext(Vo).static||we.useLayoutEffect(d)}function Ow(){let{isDataRoute:d}=we.useContext(Du);return d?Qw():Fw()}function Fw(){Yn(ig(),"useNavigate() may be used only in the context of a <Router> component.");let d=we.useContext(Pp),{basename:y,navigator:T}=we.useContext(Vo),{matches:S}=we.useContext(Du),{pathname:R}=Kd(),O=JSON.stringify(Rx(S)),M=we.useRef(!1);return Nx(()=>{M.current=!0}),we.useCallback((j,Z={})=>{if(Ll(M.current,jx),!M.current)return;if(typeof j=="number"){T.go(j);return}let X=Ix(j,JSON.parse(O),R,Z.relative==="path");d==null&&y!=="/"&&(X.pathname=X.pathname==="/"?y:Cc([y,X.pathname])),(Z.replace?T.replace:T.push)(X,Z.state,Z)},[y,T,O,R,d])}var jw=we.createContext(null);function Nw(d){let y=we.useContext(Du).outlet;return we.useMemo(()=>y&&we.createElement(jw.Provider,{value:d},y),[y,d])}function ng(d,{relative:y}={}){let{matches:T}=we.useContext(Du),{pathname:S}=Kd(),R=JSON.stringify(Rx(T));return we.useMemo(()=>Ix(d,JSON.parse(R),S,y==="path"),[d,R,S,y])}function Vw(d,y){return Vx(d,y)}function Vx(d,y,T,S,R){Yn(ig(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:O}=we.useContext(Vo),{matches:M}=we.useContext(Du),u=M[M.length-1],j=u?u.params:{},Z=u?u.pathname:"/",X=u?u.pathnameBase:"/",te=u&&u.route;{let Ze=te&&te.path||"";Gx(Z,!te||Ze.endsWith("*")||Ze.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${Z}" (under <Route path="${Ze}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Ze}"> to <Route path="${Ze==="/"?"*":`${Ze}/*`}">.`)}let de=Kd(),Ae;if(y){let Ze=typeof y=="string"?Dp(y):y;Yn(X==="/"||Ze.pathname?.startsWith(X),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${X}" but pathname "${Ze.pathname}" was given in the \`location\` prop.`),Ae=Ze}else Ae=de;let Ce=Ae.pathname||"/",De=Ce;if(X!=="/"){let Ze=X.replace(/^\//,"").split("/");De="/"+Ce.replace(/^\//,"").split("/").slice(Ze.length).join("/")}let oe=Cx(d,{pathname:De});Ll(te||oe!=null,`No routes matched location "${Ae.pathname}${Ae.search}${Ae.hash}" `),Ll(oe==null||oe[oe.length-1].route.element!==void 0||oe[oe.length-1].route.Component!==void 0||oe[oe.length-1].route.lazy!==void 0,`Matched leaf route at location "${Ae.pathname}${Ae.search}${Ae.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let We=Hw(oe&&oe.map(Ze=>Object.assign({},Ze,{params:Object.assign({},j,Ze.params),pathname:Cc([X,O.encodeLocation?O.encodeLocation(Ze.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Ze.pathname]),pathnameBase:Ze.pathnameBase==="/"?X:Cc([X,O.encodeLocation?O.encodeLocation(Ze.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Ze.pathnameBase])})),M,T,S,R);return y&&We?we.createElement(tg.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Ae},navigationType:"POP"}},We):We}function Uw(){let d=Kw(),y=Ew(d)?`${d.status} ${d.statusText}`:d instanceof Error?d.message:JSON.stringify(d),T=d instanceof Error?d.stack:null,S="rgba(200,200,200, 0.5)",R={padding:"0.5rem",backgroundColor:S},O={padding:"2px 4px",backgroundColor:S},M=null;return console.error("Error handled by React Router default ErrorBoundary:",d),M=we.createElement(we.Fragment,null,we.createElement("p",null," Hey developer "),we.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",we.createElement("code",{style:O},"ErrorBoundary")," or"," ",we.createElement("code",{style:O},"errorElement")," prop on your route.")),we.createElement(we.Fragment,null,we.createElement("h2",null,"Unexpected Application Error!"),we.createElement("h3",{style:{fontStyle:"italic"}},y),T?we.createElement("pre",{style:R},T):null,M)}var Gw=we.createElement(Uw,null),Ux=class extends we.Component{constructor(d){super(d),this.state={location:d.location,revalidation:d.revalidation,error:d.error}}static getDerivedStateFromError(d){return{error:d}}static getDerivedStateFromProps(d,y){return y.location!==d.location||y.revalidation!=="idle"&&d.revalidation==="idle"?{error:d.error,location:d.location,revalidation:d.revalidation}:{error:d.error!==void 0?d.error:y.error,location:y.location,revalidation:d.revalidation||y.revalidation}}componentDidCatch(d,y){this.props.onError?this.props.onError(d,y):console.error("React Router caught the following error during render",d)}render(){let d=this.state.error;if(this.context&&typeof d=="object"&&d&&"digest"in d&&typeof d.digest=="string"){const T=kw(d.digest);T&&(d=T)}let y=d!==void 0?we.createElement(Du.Provider,{value:this.props.routeContext},we.createElement(H_.Provider,{value:d,children:this.props.component})):this.props.children;return this.context?we.createElement(qw,{error:d},y):y}};Ux.contextType=Dw;var r_=new WeakMap;function qw({children:d,error:y}){let{basename:T}=we.useContext(Vo);if(typeof y=="object"&&y&&"digest"in y&&typeof y.digest=="string"){let S=Lw(y.digest);if(S){let R=r_.get(y);if(R)throw R;let O=kx(S.location,T);if(Lx&&!r_.get(y))if(O.isExternal||S.reloadDocument)window.location.href=O.absoluteURL||O.to;else{const M=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(O.to,{replace:S.replace}));throw r_.set(y,M),M}return we.createElement("meta",{httpEquiv:"refresh",content:`0;url=${O.absoluteURL||O.to}`})}}return d}function Zw({routeContext:d,match:y,children:T}){let S=we.useContext(Pp);return S&&S.static&&S.staticContext&&(y.route.errorElement||y.route.ErrorBoundary)&&(S.staticContext._deepestRenderedBoundaryId=y.route.id),we.createElement(Du.Provider,{value:d},T)}function Hw(d,y=[],T=null,S=null,R=null){if(d==null){if(!T)return null;if(T.errors)d=T.matches;else if(y.length===0&&!T.initialized&&T.matches.length>0)d=T.matches;else return null}let O=d,M=T?.errors;if(M!=null){let X=O.findIndex(te=>te.route.id&&M?.[te.route.id]!==void 0);Yn(X>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(M).join(",")}`),O=O.slice(0,Math.min(O.length,X+1))}let u=!1,j=-1;if(T)for(let X=0;X<O.length;X++){let te=O[X];if((te.route.HydrateFallback||te.route.hydrateFallbackElement)&&(j=X),te.route.id){let{loaderData:de,errors:Ae}=T,Ce=te.route.loader&&!de.hasOwnProperty(te.route.id)&&(!Ae||Ae[te.route.id]===void 0);if(te.route.lazy||Ce){u=!0,j>=0?O=O.slice(0,j+1):O=[O[0]];break}}}let Z=T&&S?(X,te)=>{S(X,{location:T.location,params:T.matches?.[0]?.params??{},unstable_pattern:Aw(T.matches),errorInfo:te})}:void 0;return O.reduceRight((X,te,de)=>{let Ae,Ce=!1,De=null,oe=null;T&&(Ae=M&&te.route.id?M[te.route.id]:void 0,De=te.route.errorElement||Gw,u&&(j<0&&de===0?(Gx("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Ce=!0,oe=null):j===de&&(Ce=!0,oe=te.route.hydrateFallbackElement||null)));let We=y.concat(O.slice(0,de+1)),Ze=()=>{let $e;return Ae?$e=De:Ce?$e=oe:te.route.Component?$e=we.createElement(te.route.Component,null):te.route.element?$e=te.route.element:$e=X,we.createElement(Zw,{match:te,routeContext:{outlet:X,matches:We,isDataRoute:T!=null},children:$e})};return T&&(te.route.ErrorBoundary||te.route.errorElement||de===0)?we.createElement(Ux,{location:T.location,revalidation:T.revalidation,component:De,error:Ae,children:Ze(),routeContext:{outlet:null,matches:We,isDataRoute:!0},onError:Z}):Ze()},null)}function $_(d){return`${d} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function $w(d){let y=we.useContext(Pp);return Yn(y,$_(d)),y}function Xw(d){let y=we.useContext(Cy);return Yn(y,$_(d)),y}function Yw(d){let y=we.useContext(Du);return Yn(y,$_(d)),y}function X_(d){let y=Yw(d),T=y.matches[y.matches.length-1];return Yn(T.route.id,`${d} can only be used on routes that contain a unique "id"`),T.route.id}function Ww(){return X_("useRouteId")}function Kw(){let d=we.useContext(H_),y=Xw("useRouteError"),T=X_("useRouteError");return d!==void 0?d:y.errors?.[T]}function Qw(){let{router:d}=$w("useNavigate"),y=X_("useNavigate"),T=we.useRef(!1);return Nx(()=>{T.current=!0}),we.useCallback(async(R,O={})=>{Ll(T.current,jx),T.current&&(typeof R=="number"?await d.navigate(R):await d.navigate(R,{fromRouteId:y,...O}))},[d,y])}var nv={};function Gx(d,y,T){!y&&!nv[d]&&(nv[d]=!0,Ll(!1,T))}we.memo(Jw);function Jw({routes:d,future:y,state:T,onError:S}){return Vx(d,void 0,T,S,y)}function e2(d){return Nw(d.context)}function Eu(d){Yn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function t2({basename:d="/",children:y=null,location:T,navigationType:S="POP",navigator:R,static:O=!1,unstable_useTransitions:M}){Yn(!ig(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=d.replace(/^\/*/,"/"),j=we.useMemo(()=>({basename:u,navigator:R,static:O,unstable_useTransitions:M,future:{}}),[u,R,O,M]);typeof T=="string"&&(T=Dp(T));let{pathname:Z="/",search:X="",hash:te="",state:de=null,key:Ae="default"}=T,Ce=we.useMemo(()=>{let De=Dc(Z,u);return De==null?null:{location:{pathname:De,search:X,hash:te,state:de,key:Ae},navigationType:S}},[u,Z,X,te,de,Ae,S]);return Ll(Ce!=null,`<Router basename="${u}"> is not able to match the URL "${Z}${X}${te}" because it does not start with the basename, so the <Router> won't render anything.`),Ce==null?null:we.createElement(Vo.Provider,{value:j},we.createElement(tg.Provider,{children:y,value:Ce}))}function i2({children:d,location:y}){return Vw(w_(d),y)}function w_(d,y=[]){let T=[];return we.Children.forEach(d,(S,R)=>{if(!we.isValidElement(S))return;let O=[...y,R];if(S.type===we.Fragment){T.push.apply(T,w_(S.props.children,O));return}Yn(S.type===Eu,`[${typeof S.type=="string"?S.type:S.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Yn(!S.props.index||!S.props.children,"An index route cannot have child routes.");let M={id:S.props.id||O.join("-"),caseSensitive:S.props.caseSensitive,element:S.props.element,Component:S.props.Component,index:S.props.index,path:S.props.path,middleware:S.props.middleware,loader:S.props.loader,action:S.props.action,hydrateFallbackElement:S.props.hydrateFallbackElement,HydrateFallback:S.props.HydrateFallback,errorElement:S.props.errorElement,ErrorBoundary:S.props.ErrorBoundary,hasErrorBoundary:S.props.hasErrorBoundary===!0||S.props.ErrorBoundary!=null||S.props.errorElement!=null,shouldRevalidate:S.props.shouldRevalidate,handle:S.props.handle,lazy:S.props.lazy};S.props.children&&(M.children=w_(S.props.children,O)),T.push(M)}),T}var py="get",my="application/x-www-form-urlencoded";function Dy(d){return typeof HTMLElement<"u"&&d instanceof HTMLElement}function n2(d){return Dy(d)&&d.tagName.toLowerCase()==="button"}function r2(d){return Dy(d)&&d.tagName.toLowerCase()==="form"}function a2(d){return Dy(d)&&d.tagName.toLowerCase()==="input"}function s2(d){return!!(d.metaKey||d.altKey||d.ctrlKey||d.shiftKey)}function o2(d,y){return d.button===0&&(!y||y==="_self")&&!s2(d)}var ly=null;function l2(){if(ly===null)try{new FormData(document.createElement("form"),0),ly=!1}catch{ly=!0}return ly}var u2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function a_(d){return d!=null&&!u2.has(d)?(Ll(!1,`"${d}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${my}"`),null):d}function c2(d,y){let T,S,R,O,M;if(r2(d)){let u=d.getAttribute("action");S=u?Dc(u,y):null,T=d.getAttribute("method")||py,R=a_(d.getAttribute("enctype"))||my,O=new FormData(d)}else if(n2(d)||a2(d)&&(d.type==="submit"||d.type==="image")){let u=d.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let j=d.getAttribute("formaction")||u.getAttribute("action");if(S=j?Dc(j,y):null,T=d.getAttribute("formmethod")||u.getAttribute("method")||py,R=a_(d.getAttribute("formenctype"))||a_(u.getAttribute("enctype"))||my,O=new FormData(u,d),!l2()){let{name:Z,type:X,value:te}=d;if(X==="image"){let de=Z?`${Z}.`:"";O.append(`${de}x`,"0"),O.append(`${de}y`,"0")}else Z&&O.append(Z,te)}}else{if(Dy(d))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');T=py,S=null,R=my,M=d}return O&&R==="text/plain"&&(M=O,O=void 0),{action:S,method:T.toLowerCase(),encType:R,formData:O,body:M}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Y_(d,y){if(d===!1||d===null||typeof d>"u")throw new Error(y)}function h2(d,y,T){let S=typeof d=="string"?new URL(d,typeof window>"u"?"server://singlefetch/":window.location.origin):d;return S.pathname==="/"?S.pathname=`_root.${T}`:y&&Dc(S.pathname,y)==="/"?S.pathname=`${y.replace(/\/$/,"")}/_root.${T}`:S.pathname=`${S.pathname.replace(/\/$/,"")}.${T}`,S}async function d2(d,y){if(d.id in y)return y[d.id];try{let T=await import(d.module);return y[d.id]=T,T}catch(T){return console.error(`Error loading route module \`${d.module}\`, reloading page...`),console.error(T),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function f2(d){return d==null?!1:d.href==null?d.rel==="preload"&&typeof d.imageSrcSet=="string"&&typeof d.imageSizes=="string":typeof d.rel=="string"&&typeof d.href=="string"}async function p2(d,y,T){let S=await Promise.all(d.map(async R=>{let O=y.routes[R.route.id];if(O){let M=await d2(O,T);return M.links?M.links():[]}return[]}));return _2(S.flat(1).filter(f2).filter(R=>R.rel==="stylesheet"||R.rel==="preload").map(R=>R.rel==="stylesheet"?{...R,rel:"prefetch",as:"style"}:{...R,rel:"prefetch"}))}function rv(d,y,T,S,R,O){let M=(j,Z)=>T[Z]?j.route.id!==T[Z].route.id:!0,u=(j,Z)=>T[Z].pathname!==j.pathname||T[Z].route.path?.endsWith("*")&&T[Z].params["*"]!==j.params["*"];return O==="assets"?y.filter((j,Z)=>M(j,Z)||u(j,Z)):O==="data"?y.filter((j,Z)=>{let X=S.routes[j.route.id];if(!X||!X.hasLoader)return!1;if(M(j,Z)||u(j,Z))return!0;if(j.route.shouldRevalidate){let te=j.route.shouldRevalidate({currentUrl:new URL(R.pathname+R.search+R.hash,window.origin),currentParams:T[0]?.params||{},nextUrl:new URL(d,window.origin),nextParams:j.params,defaultShouldRevalidate:!0});if(typeof te=="boolean")return te}return!0}):[]}function m2(d,y,{includeHydrateFallback:T}={}){return g2(d.map(S=>{let R=y.routes[S.route.id];if(!R)return[];let O=[R.module];return R.clientActionModule&&(O=O.concat(R.clientActionModule)),R.clientLoaderModule&&(O=O.concat(R.clientLoaderModule)),T&&R.hydrateFallbackModule&&(O=O.concat(R.hydrateFallbackModule)),R.imports&&(O=O.concat(R.imports)),O}).flat(1))}function g2(d){return[...new Set(d)]}function y2(d){let y={},T=Object.keys(d).sort();for(let S of T)y[S]=d[S];return y}function _2(d,y){let T=new Set;return new Set(y),d.reduce((S,R)=>{let O=JSON.stringify(y2(R));return T.has(O)||(T.add(O),S.push({key:O,link:R})),S},[])}function qx(){let d=we.useContext(Pp);return Y_(d,"You must render this element inside a <DataRouterContext.Provider> element"),d}function v2(){let d=we.useContext(Cy);return Y_(d,"You must render this element inside a <DataRouterStateContext.Provider> element"),d}var W_=we.createContext(void 0);W_.displayName="FrameworkContext";function Zx(){let d=we.useContext(W_);return Y_(d,"You must render this element inside a <HydratedRouter> element"),d}function x2(d,y){let T=we.useContext(W_),[S,R]=we.useState(!1),[O,M]=we.useState(!1),{onFocus:u,onBlur:j,onMouseEnter:Z,onMouseLeave:X,onTouchStart:te}=y,de=we.useRef(null);we.useEffect(()=>{if(d==="render"&&M(!0),d==="viewport"){let De=We=>{We.forEach(Ze=>{M(Ze.isIntersecting)})},oe=new IntersectionObserver(De,{threshold:.5});return de.current&&oe.observe(de.current),()=>{oe.disconnect()}}},[d]),we.useEffect(()=>{if(S){let De=setTimeout(()=>{M(!0)},100);return()=>{clearTimeout(De)}}},[S]);let Ae=()=>{R(!0)},Ce=()=>{R(!1),M(!1)};return T?d!=="intent"?[O,de,{}]:[O,de,{onFocus:Um(u,Ae),onBlur:Um(j,Ce),onMouseEnter:Um(Z,Ae),onMouseLeave:Um(X,Ce),onTouchStart:Um(te,Ae)}]:[!1,de,{}]}function Um(d,y){return T=>{d&&d(T),T.defaultPrevented||y(T)}}function b2({page:d,...y}){let{router:T}=qx(),S=we.useMemo(()=>Cx(T.routes,d,T.basename),[T.routes,d,T.basename]);return S?we.createElement(T2,{page:d,matches:S,...y}):null}function w2(d){let{manifest:y,routeModules:T}=Zx(),[S,R]=we.useState([]);return we.useEffect(()=>{let O=!1;return p2(d,y,T).then(M=>{O||R(M)}),()=>{O=!0}},[d,y,T]),S}function T2({page:d,matches:y,...T}){let S=Kd(),{manifest:R,routeModules:O}=Zx(),{basename:M}=qx(),{loaderData:u,matches:j}=v2(),Z=we.useMemo(()=>rv(d,y,j,R,S,"data"),[d,y,j,R,S]),X=we.useMemo(()=>rv(d,y,j,R,S,"assets"),[d,y,j,R,S]),te=we.useMemo(()=>{if(d===S.pathname+S.search+S.hash)return[];let Ce=new Set,De=!1;if(y.forEach(We=>{let Ze=R.routes[We.route.id];!Ze||!Ze.hasLoader||(!Z.some($e=>$e.route.id===We.route.id)&&We.route.id in u&&O[We.route.id]?.shouldRevalidate||Ze.hasClientLoader?De=!0:Ce.add(We.route.id))}),Ce.size===0)return[];let oe=h2(d,M,"data");return De&&Ce.size>0&&oe.searchParams.set("_routes",y.filter(We=>Ce.has(We.route.id)).map(We=>We.route.id).join(",")),[oe.pathname+oe.search]},[M,u,S,R,Z,y,d,O]),de=we.useMemo(()=>m2(X,R),[X,R]),Ae=w2(X);return we.createElement(we.Fragment,null,te.map(Ce=>we.createElement("link",{key:Ce,rel:"prefetch",as:"fetch",href:Ce,...T})),de.map(Ce=>we.createElement("link",{key:Ce,rel:"modulepreload",href:Ce,...T})),Ae.map(({key:Ce,link:De})=>we.createElement("link",{key:Ce,nonce:T.nonce,...De})))}function S2(...d){return y=>{d.forEach(T=>{typeof T=="function"?T(y):T!=null&&(T.current=y)})}}var M2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{M2&&(window.__reactRouterVersion="7.11.0")}catch{}function E2({basename:d,children:y,unstable_useTransitions:T,window:S}){let R=we.useRef();R.current==null&&(R.current=iw({window:S,v5Compat:!0}));let O=R.current,[M,u]=we.useState({action:O.action,location:O.location}),j=we.useCallback(Z=>{T===!1?u(Z):we.startTransition(()=>u(Z))},[T]);return we.useLayoutEffect(()=>O.listen(j),[O,j]),we.createElement(t2,{basename:d,children:y,location:M.location,navigationType:M.action,navigator:O,unstable_useTransitions:T})}var Hx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$x=we.forwardRef(function({onClick:y,discover:T="render",prefetch:S="none",relative:R,reloadDocument:O,replace:M,state:u,target:j,to:Z,preventScrollReset:X,viewTransition:te,unstable_defaultShouldRevalidate:de,...Ae},Ce){let{basename:De,unstable_useTransitions:oe}=we.useContext(Vo),We=typeof Z=="string"&&Hx.test(Z),Ze=kx(Z,De);Z=Ze.to;let $e=Bw(Z,{relative:R}),[Ct,Ke,vt]=x2(S,Ae),mt=D2(Z,{replace:M,state:u,target:j,preventScrollReset:X,relative:R,viewTransition:te,unstable_defaultShouldRevalidate:de,unstable_useTransitions:oe});function Et(ct){y&&y(ct),ct.defaultPrevented||mt(ct)}let Xt=we.createElement("a",{...Ae,...vt,href:Ze.absoluteURL||$e,onClick:Ze.isExternal||O?y:Et,ref:S2(Ce,Ke),target:j,"data-discover":!We&&T==="render"?"true":void 0});return Ct&&!We?we.createElement(we.Fragment,null,Xt,we.createElement(b2,{page:$e})):Xt});$x.displayName="Link";var K_=we.forwardRef(function({"aria-current":y="page",caseSensitive:T=!1,className:S="",end:R=!1,style:O,to:M,viewTransition:u,children:j,...Z},X){let te=ng(M,{relative:Z.relative}),de=Kd(),Ae=we.useContext(Cy),{navigator:Ce,basename:De}=we.useContext(Vo),oe=Ae!=null&&L2(te)&&u===!0,We=Ce.encodeLocation?Ce.encodeLocation(te).pathname:te.pathname,Ze=de.pathname,$e=Ae&&Ae.navigation&&Ae.navigation.location?Ae.navigation.location.pathname:null;T||(Ze=Ze.toLowerCase(),$e=$e?$e.toLowerCase():null,We=We.toLowerCase()),$e&&De&&($e=Dc($e,De)||$e);const Ct=We!=="/"&&We.endsWith("/")?We.length-1:We.length;let Ke=Ze===We||!R&&Ze.startsWith(We)&&Ze.charAt(Ct)==="/",vt=$e!=null&&($e===We||!R&&$e.startsWith(We)&&$e.charAt(We.length)==="/"),mt={isActive:Ke,isPending:vt,isTransitioning:oe},Et=Ke?y:void 0,Xt;typeof S=="function"?Xt=S(mt):Xt=[S,Ke?"active":null,vt?"pending":null,oe?"transitioning":null].filter(Boolean).join(" ");let ct=typeof O=="function"?O(mt):O;return we.createElement($x,{...Z,"aria-current":Et,className:Xt,ref:X,style:ct,to:M,viewTransition:u},typeof j=="function"?j(mt):j)});K_.displayName="NavLink";var A2=we.forwardRef(({discover:d="render",fetcherKey:y,navigate:T,reloadDocument:S,replace:R,state:O,method:M=py,action:u,onSubmit:j,relative:Z,preventScrollReset:X,viewTransition:te,unstable_defaultShouldRevalidate:de,...Ae},Ce)=>{let{unstable_useTransitions:De}=we.useContext(Vo),oe=R2(),We=I2(u,{relative:Z}),Ze=M.toLowerCase()==="get"?"get":"post",$e=typeof u=="string"&&Hx.test(u),Ct=Ke=>{if(j&&j(Ke),Ke.defaultPrevented)return;Ke.preventDefault();let vt=Ke.nativeEvent.submitter,mt=vt?.getAttribute("formmethod")||M,Et=()=>oe(vt||Ke.currentTarget,{fetcherKey:y,method:mt,navigate:T,replace:R,state:O,relative:Z,preventScrollReset:X,viewTransition:te,unstable_defaultShouldRevalidate:de});De&&T!==!1?we.startTransition(()=>Et()):Et()};return we.createElement("form",{ref:Ce,method:Ze,action:We,onSubmit:S?j:Ct,...Ae,"data-discover":!$e&&d==="render"?"true":void 0})});A2.displayName="Form";function C2(d){return`${d} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Xx(d){let y=we.useContext(Pp);return Yn(y,C2(d)),y}function D2(d,{target:y,replace:T,state:S,preventScrollReset:R,relative:O,viewTransition:M,unstable_defaultShouldRevalidate:u,unstable_useTransitions:j}={}){let Z=Ow(),X=Kd(),te=ng(d,{relative:O});return we.useCallback(de=>{if(o2(de,y)){de.preventDefault();let Ae=T!==void 0?T:Ym(X)===Ym(te),Ce=()=>Z(d,{replace:Ae,state:S,preventScrollReset:R,relative:O,viewTransition:M,unstable_defaultShouldRevalidate:u});j?we.startTransition(()=>Ce()):Ce()}},[X,Z,te,T,S,y,d,R,O,M,u,j])}var P2=0,z2=()=>`__${String(++P2)}__`;function R2(){let{router:d}=Xx("useSubmit"),{basename:y}=we.useContext(Vo),T=Ww(),S=d.fetch,R=d.navigate;return we.useCallback(async(O,M={})=>{let{action:u,method:j,encType:Z,formData:X,body:te}=c2(O,y);if(M.navigate===!1){let de=M.fetcherKey||z2();await S(de,T,M.action||u,{unstable_defaultShouldRevalidate:M.unstable_defaultShouldRevalidate,preventScrollReset:M.preventScrollReset,formData:X,body:te,formMethod:M.method||j,formEncType:M.encType||Z,flushSync:M.flushSync})}else await R(M.action||u,{unstable_defaultShouldRevalidate:M.unstable_defaultShouldRevalidate,preventScrollReset:M.preventScrollReset,formData:X,body:te,formMethod:M.method||j,formEncType:M.encType||Z,replace:M.replace,state:M.state,fromRouteId:T,flushSync:M.flushSync,viewTransition:M.viewTransition})},[S,R,y,T])}function I2(d,{relative:y}={}){let{basename:T}=we.useContext(Vo),S=we.useContext(Du);Yn(S,"useFormAction must be used inside a RouteContext");let[R]=S.matches.slice(-1),O={...ng(d||".",{relative:y})},M=Kd();if(d==null){O.search=M.search;let u=new URLSearchParams(O.search),j=u.getAll("index");if(j.some(X=>X==="")){u.delete("index"),j.filter(te=>te).forEach(te=>u.append("index",te));let X=u.toString();O.search=X?`?${X}`:""}}return(!d||d===".")&&R.route.index&&(O.search=O.search?O.search.replace(/^\?/,"?index&"):"?index"),T!=="/"&&(O.pathname=O.pathname==="/"?T:Cc([T,O.pathname])),Ym(O)}function L2(d,{relative:y}={}){let T=we.useContext(Ox);Yn(T!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:S}=Xx("useViewTransitionState"),R=ng(d,{relative:y});if(!T.isTransitioning)return!1;let O=Dc(T.currentLocation.pathname,S)||T.currentLocation.pathname,M=Dc(T.nextLocation.pathname,S)||T.nextLocation.pathname;return by(R.pathname,M)!=null||by(R.pathname,O)!=null}const k2=d=>d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),B2=d=>d.replace(/^([A-Z])|[\s-_]+(\w)/g,(y,T,S)=>S?S.toUpperCase():T.toLowerCase()),av=d=>{const y=B2(d);return y.charAt(0).toUpperCase()+y.slice(1)},Yx=(...d)=>d.filter((y,T,S)=>!!y&&y.trim()!==""&&S.indexOf(y)===T).join(" ").trim(),O2=d=>{for(const y in d)if(y.startsWith("aria-")||y==="role"||y==="title")return!0};var F2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const j2=we.forwardRef(({color:d="currentColor",size:y=24,strokeWidth:T=2,absoluteStrokeWidth:S,className:R="",children:O,iconNode:M,...u},j)=>we.createElement("svg",{ref:j,...F2,width:y,height:y,stroke:d,strokeWidth:S?Number(T)*24/Number(y):T,className:Yx("lucide",R),...!O&&!O2(u)&&{"aria-hidden":"true"},...u},[...M.map(([Z,X])=>we.createElement(Z,X)),...Array.isArray(O)?O:[O]]));const pr=(d,y)=>{const T=we.forwardRef(({className:S,...R},O)=>we.createElement(j2,{ref:O,iconNode:y,className:Yx(`lucide-${k2(av(d))}`,`lucide-${d}`,S),...R}));return T.displayName=av(d),T};const N2=[["path",{d:"M12 6.528V3a1 1 0 0 1 1-1h0",key:"11qiee"}],["path",{d:"M18.237 21A15 15 0 0 0 22 11a6 6 0 0 0-10-4.472A6 6 0 0 0 2 11a15.1 15.1 0 0 0 3.763 10 3 3 0 0 0 3.648.648 5.5 5.5 0 0 1 5.178 0A3 3 0 0 0 18.237 21",key:"110c12"}]],sv=pr("apple",N2);const V2=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ov=pr("calendar",V2);const U2=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],G2=pr("circle-check-big",U2);const q2=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Wx=pr("clock",q2);const Z2=[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}],["path",{d:"M15.947 12.65a4 4 0 0 0-5.925-4.128",key:"dpwdj0"}],["path",{d:"M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z",key:"s09mg5"}]],lv=pr("cloud-sun",Z2);const H2=[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]],$2=pr("droplet",H2);const X2=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Y2=pr("globe",X2);const W2=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],uv=pr("leaf",W2);const K2=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Q2=pr("lock",K2);const J2=[["path",{d:"M15 18h-5",key:"95g1m2"}],["path",{d:"M18 14h-8",key:"sponae"}],["path",{d:"M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-4 0v-9a2 2 0 0 1 2-2h2",key:"39pd36"}],["rect",{width:"8",height:"4",x:"10",y:"6",rx:"1",key:"aywv1n"}]],cv=pr("newspaper",J2);const eT=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],tT=pr("refresh-cw",eT);const iT=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],nT=pr("rocket",iT);const rT=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],hv=pr("save",rT);const aT=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],sT=pr("scroll-text",aT);const oT=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],lT=pr("settings",oT);const uT=[["path",{d:"M14 9.536V7a4 4 0 0 1 4-4h1.5a.5.5 0 0 1 .5.5V5a4 4 0 0 1-4 4 4 4 0 0 0-4 4c0 2 1 3 1 5a5 5 0 0 1-1 3",key:"139s4v"}],["path",{d:"M4 9a5 5 0 0 1 8 4 5 5 0 0 1-8-4",key:"1dlkgp"}],["path",{d:"M5 21h14",key:"11awu3"}]],cT=pr("sprout",uT);const hT=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],uy=pr("star",hT);const dT=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],fT=pr("thermometer",dT);const pT=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],mT=pr("wifi",pT);const gT=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],yT=pr("wind",gT);const _T=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],vT=pr("x",_T),xT=()=>he.jsxs("div",{className:"app-container",children:[he.jsx(K_,{to:"/settings",className:"settings-overlay-btn",children:he.jsx(lT,{size:24})}),he.jsx("main",{className:"main-content",children:he.jsx(e2,{})})]}),bT=()=>{const[d,y]=we.useState(null);if(we.useEffect(()=>{fetch("/api/weather/").then(M=>M.json()).then(M=>{M.ok&&y(M)}).catch(console.error)},[]),!d)return he.jsx("div",{className:"fs-loading",children:"Cargando tiempo..."});if(d.ok===!1)return he.jsx("div",{className:"fs-weather-container error",children:he.jsxs("div",{className:"fs-weather-main",children:[he.jsx(lv,{size:120,className:"fs-weather-icon text-red-400"}),he.jsxs("h1",{className:"fs-condition",children:["Error: ",d.reason]}),he.jsx("p",{style:{fontSize:"1.5rem",opacity:.7},children:d.error||d.summary||"Verifica tu API Key"})]})});const T=d.temperature?.value?Math.round(d.temperature.value):"--",S=d.summary||"Despejado",R=d.wind_speed?Math.round(d.wind_speed):0,O=d.humidity?Math.round(d.humidity):0;return he.jsx("div",{className:"fs-weather-container",children:he.jsxs("div",{className:"fs-weather-main column-mode",children:[he.jsx("div",{className:"current-weather-row",children:he.jsxs("div",{className:"fs-temp-group",children:[he.jsxs("span",{className:"fs-temp-val",children:[T,""]}),he.jsxs("div",{className:"fs-cond-group",children:[he.jsx("img",{src:S.toLowerCase().includes("lluvia")||S.toLowerCase().includes("llovizna")?"/assets/img/rain_3d.png":"/assets/img/sun_3d.png",className:"fs-weather-icon-3d",alt:"Weather Icon"}),he.jsx("h1",{className:"fs-condition",children:S})]})]})}),he.jsxs("div",{className:"fs-weather-grid compact",children:[he.jsxs("div",{className:"fs-weather-item",children:[he.jsx(yT,{size:32}),he.jsxs("span",{className:"fs-val",children:[R," ",he.jsx("span",{className:"fs-unit",children:"km/h"})]})]}),he.jsxs("div",{className:"fs-weather-item",children:[he.jsx($2,{size:32}),he.jsxs("span",{className:"fs-val",children:[O," ",he.jsx("span",{className:"fs-unit",children:"%"})]})]}),he.jsxs("div",{className:"fs-weather-item",children:[he.jsx(fT,{size:32}),he.jsxs("span",{className:"fs-val",children:[Math.round(d.feels_like?.value||T),""]})]})]}),d.days&&d.days.length>0&&he.jsx("div",{className:"fs-forecast-row",children:d.days.slice(1,6).map((M,u)=>he.jsxs("div",{className:"fs-forecast-day",children:[he.jsx("span",{className:"day-name",children:M.dayName.slice(0,3)}),he.jsx("div",{className:"day-icon",children:he.jsx(lv,{size:24})}),he.jsxs("div",{className:"day-temps",children:[he.jsxs("span",{className:"max",children:[Math.round(M.temperature.max),""]}),he.jsxs("span",{className:"min",children:[Math.round(M.temperature.min),""]})]})]},u))})]})})},wT=d=>{const y={manzana:"apple",remolacha:"beet",brocoli:"broccoli",zanahoria:"carrot",uva:"grapes",lechuga:"lettuce",pera:"pear",fresa:"fresa",freson:"freson",limon:"limon",naranja:"naranja",platano:"platano",tomate:"tomate",acelga:"chard",ajo:"ajo",berenjena:"berenjena",calabaza:"calabaza",cebolla:"cebolla",cereza:"cherry",chirimoya:"chirimoya",escarola:"escarola",sandia:"sandia",rabanito:"rabanito",kiwi:"fruit_3d",mandarina:"naranja",caqui:"fruit_3d",granada:"fruit_3d",alcachofa:"sprout_3d",apio:"sprout_3d",cardo:"sprout_3d",col:"lettuce",coliflor:"broccoli",endibia:"lettuce",espinaca:"chard",guisante:"sprout_3d",haba:"sprout_3d",nabo:"carrot",puerro:"ajo",judia:"sprout_3d"};let T=d.toLowerCase().trim();return T=T.replace(//g,"a").replace(//g,"e").replace(//g,"i").replace(//g,"o").replace(//g,"u").replace(//g,"n").replace(//g,"u"),T=T.replace(/\(.*\)/g,"").trim(),T=T.replace(/ /g,"-"),y[T]?y[T]:T.includes("manzana")?"apple":T.includes("pera")?"pear":T.includes("naranja")?"naranja":T.includes("limon")?"limon":T.includes("uva")?"grapes":T.includes("col")?"broccoli":T},TT=()=>{const[d,y]=we.useState(null),[T,S]=we.useState("fruits");if(we.useEffect(()=>{fetch("/api/farming/current").then(j=>j.json()).then(j=>y(j)).catch(j=>console.error(j))},[]),we.useEffect(()=>{const j=setInterval(()=>{S(Z=>Z==="fruits"?"vegetables":Z==="vegetables"?"sowing":"fruits")},12e3);return()=>clearInterval(j)},[]),!d)return he.jsx("div",{className:"fs-loading",children:"Cargando datos de cultivo..."});let R=[],O="",M=sv,u="";return T==="fruits"?(R=d.fruits,O="Frutas de Temporada",M=sv,u="linear-gradient(135deg, #fceeb5 0%, #ffc09f 100%)"):T==="vegetables"?(R=d.vegetables,O="Verduras del Mes",M=uv,u="linear-gradient(135deg, #dcfce7 0%, #86efac 100%)"):(R=d.sowing,O="Calendario de Siembra",M=cT,u="linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%)"),he.jsxs("div",{className:"fs-farming-container",style:{background:u},children:[he.jsxs("div",{className:"fs-farming-header",children:[he.jsx(M,{size:64,color:"#1f2937",className:"main-category-icon"}),he.jsx("h1",{children:O})]}),he.jsx("div",{className:"fs-farming-grid",children:R.map(j=>{const Z=wT(j),te=Z.endsWith("_3d")?`/icons/harvest/${Z}.png`:`/icons/harvest/${Z}.svg`;return he.jsxs("div",{className:"fs-farming-item",children:[he.jsxs("div",{className:"fs-farming-icon-wrapper",children:[he.jsx("img",{src:te,onError:de=>{const Ae=de.target,Ce=T==="fruits"?"/icons/harvest/fruit_3d.png":"/icons/harvest/sprout_3d.png";Ae.src!==window.location.origin+Ce?(Ae.src=Ce,Ae.classList.add("is-fallback")):(Ae.style.display="none",Ae.nextElementSibling?.classList.remove("hidden"))},alt:j}),he.jsx("div",{className:"fs-fallback-icon hidden",children:he.jsx(uv,{size:48})})]}),he.jsx("span",{className:"fs-farming-label",children:j})]},j)})})]})},ST=()=>{const[d]=we.useState(new Date),[y,T]=we.useState([]),[S,R]=we.useState([]),[O,M]=we.useState(null),[u,j]=we.useState(null),[Z,X]=we.useState("ASTRO"),[te,de]=we.useState(0),[Ae,Ce]=we.useState(0);we.useEffect(()=>{fetch("/api/saints").then(Ke=>Ke.json()).then(Ke=>{Array.isArray(Ke)&&T(Ke)}).catch(console.error),fetch("/api/ephemerides?type=all").then(Ke=>Ke.json()).then(Ke=>{Ke.items&&R(Ke.items.slice(0,15))}).catch(console.error),fetch("/api/ephemerides/apod").then(Ke=>Ke.json()).then(Ke=>{Ke.url&&Ke.media_type==="image"&&M(Ke)}).catch(console.error),fetch("/api/weather/").then(Ke=>Ke.json()).then(Ke=>{if(Ke.daily&&Ke.daily[0]){const vt=Ke.daily[0];j({sunrise:vt.sunrise,sunset:vt.sunset,moon_phase:vt.moon_phase})}}).catch(console.error)},[]),we.useEffect(()=>{const Ke=setInterval(()=>{X(vt=>vt==="ASTRO"?"EVENT":vt==="EVENT"?"SAINT":"ASTRO")},12e3);return()=>clearInterval(Ke)},[]),we.useEffect(()=>{const Ke=setInterval(()=>{Z==="EVENT"?de(vt=>(vt+1)%(S.length||1)):Z==="SAINT"&&Ce(vt=>(vt+1)%Math.min(y.length||1,3))},12e3);return()=>clearInterval(Ke)},[Z,S.length,y.length]);const De=S[te],oe=y[Ae],We=Ke=>Ke==="birth"?he.jsx(uy,{size:48,className:"text-green-400"}):Ke==="death"?he.jsx(uy,{size:48,className:"text-stone-400"}):he.jsx(ov,{size:48,className:"text-blue-400"}),Ze=Ke=>{const vt=["Luca","Andrea","Bautista","Borja","Saba"],mt=["Carmen","Paz","Luz","Merced","Dolores","Rosario","Virtudes","Nieves","Soledad","Pilar","Cruz","Fe","Caridad","Esperanza","Salud","Gracia","Asuncin","Concepcin","Ins","Beatriz","Raquel","Esther","Rut","Noem","Iris","Belen"],Et=Ke.split(" ")[0];return mt.includes(Et)||mt.some(Xt=>Ke.includes(Xt))?`Santa ${Ke}`:vt.includes(Et)?`San ${Ke}`:Et.endsWith("a")?`Santa ${Ke}`:`San ${Ke}`},$e=Ke=>Ke===0||Ke===1?"Luna Nueva":Ke>0&&Ke<.25?"Luna Creciente":Ke===.25?"Cuarto Creciente":Ke>.25&&Ke<.5?"Gibosa Creciente":Ke===.5?"Luna Llena":Ke>.5&&Ke<.75?"Gibosa Menguante":Ke===.75?"Cuarto Menguante":"Luna Menguante",Ct=Ke=>Ke?new Date(Ke*1e3).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"--:--";return he.jsxs("div",{className:"fs-ephemerides-container",style:{backgroundImage:O?`linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url(${O.url})`:"linear-gradient(to right, #1e1b4b, #312e81)"},children:[he.jsxs("div",{className:"fs-col-left",children:[he.jsxs("div",{className:"fs-date-block",children:[he.jsx(ov,{size:64,className:"text-yellow-400 mb-4"}),he.jsx("h1",{className:"fs-day-number",children:d.getDate()}),he.jsx("h2",{className:"fs-month-name",children:d.toLocaleDateString("es-ES",{month:"long"})}),he.jsx("h3",{className:"fs-weekday",children:d.toLocaleDateString("es-ES",{weekday:"long"})})]}),he.jsxs("div",{className:"fs-saints-list",children:[he.jsxs("div",{className:"fs-section-title",children:[he.jsx(uy,{size:24,className:"text-yellow-400"}),he.jsx("span",{children:"Santoral"})]}),he.jsx("ul",{children:y.slice(0,5).map((Ke,vt)=>he.jsx("li",{className:Z==="SAINT"&&vt===Ae?"active-saint-li":"",children:Ze(Ke.name)},vt))})]})]}),he.jsxs("div",{className:"fs-col-right",children:[Z==="ASTRO"&&u&&he.jsxs("div",{className:"fs-event-card fade-in bg-astro-card",children:[he.jsxs("div",{className:"fs-card-header",children:[he.jsx("img",{src:"/assets/img/moon_3d.png",style:{width:64,height:64},alt:"Moon"}),he.jsx("span",{className:"fs-card-title",children:"Astronoma"})]}),he.jsxs("div",{className:"fs-astro-content",children:[he.jsxs("div",{className:"astro-row",children:[he.jsxs("div",{className:"astro-item text-center",children:[he.jsx("h3",{className:"text-amber-300",children:"Salida del Sol"}),he.jsxs("div",{className:"astro-val-group",children:[he.jsx("img",{src:"/assets/img/sunrise_3d.png",style:{width:80,height:80},alt:"Sunrise"}),he.jsx("span",{className:"astro-time",children:Ct(u.sunrise)})]})]}),he.jsxs("div",{className:"astro-item text-center",children:[he.jsx("h3",{className:"text-amber-300",children:"Puesta del Sol"}),he.jsxs("div",{className:"astro-val-group",children:[he.jsx("img",{src:"/assets/img/sunset_3d.png",style:{width:80,height:80},alt:"Sunset"}),he.jsx("span",{className:"astro-time",children:Ct(u.sunset)})]})]})]}),he.jsx("div",{className:"astro-row mt-4",children:he.jsxs("div",{className:"astro-item text-center",children:[he.jsx("h3",{className:"text-purple-300",children:"Fase Lunar"}),he.jsxs("div",{className:"moon-phase-group",children:[he.jsx("img",{src:"/assets/img/moon_3d.png",style:{width:100,height:100},alt:"Moon Phase"}),he.jsx("span",{className:"moon-text",children:$e(u.moon_phase)})]})]})})]})]}),Z==="EVENT"&&De&&he.jsxs("div",{className:"fs-event-card fade-in",children:[he.jsxs("div",{className:"fs-card-header",children:[We(De.category),he.jsx("span",{className:"fs-card-year",children:De.year})]}),he.jsx("div",{className:"fs-scrollable-text-container",children:he.jsx("div",{className:"scroll-wrapper",children:he.jsx("p",{className:"fs-card-text",children:De.text})})}),De.thumbnail&&he.jsx("div",{className:"fs-card-image",children:he.jsx("img",{src:De.thumbnail,alt:"Event"})}),he.jsx("div",{className:"fs-card-label",children:"Tal da como hoy"})]}),(Z==="SAINT"&&oe||!De&&oe&&Z!=="ASTRO")&&he.jsxs("div",{className:"fs-event-card fade-in bg-saint-active-card",children:[he.jsxs("div",{className:"fs-card-header",children:[he.jsx(uy,{size:48,className:"text-yellow-400"}),he.jsx("span",{className:"fs-card-title",children:"Santoral"})]}),he.jsx("h2",{className:"fs-saint-title",children:Ze(oe.name)}),he.jsx("div",{className:"fs-scrollable-text-container saint-bio",children:he.jsx("div",{className:"scroll-wrapper",children:oe.bio||`Hoy celebramos la santidad de ${Ze(oe.name)}...`})}),oe.image?he.jsx("div",{className:"fs-card-image saint-img-wrapper",children:he.jsx("img",{src:oe.image,alt:oe.name})}):he.jsx("div",{className:"fs-card-image placeholder",children:he.jsx(sT,{size:64,className:"text-slate-600"})})]}),!De&&!oe&&!u&&he.jsx("div",{className:"fs-loading",children:"Cargando datos..."})]})]})},MT=()=>{const[d,y]=we.useState(null);return we.useEffect(()=>{fetch("/api/ephemerides/apod").then(T=>T.json()).then(T=>{T.url&&!T.error&&y(T)}).catch(console.error)},[]),d?d.media_type==="video"?he.jsxs("div",{className:"fs-apod-container video-mode",children:[he.jsx("iframe",{src:d.url,title:d.title,frameBorder:"0",allowFullScreen:!0,className:"fs-apod-video"}),he.jsx("div",{className:"fs-apod-overlay",children:he.jsx("h1",{children:d.title})})]}):he.jsx("div",{className:"fs-apod-container",style:{backgroundImage:`url(${d.url})`},children:he.jsxs("div",{className:"fs-apod-overlay",children:[he.jsxs("div",{className:"fs-apod-header",children:[he.jsx(nT,{size:32,className:"text-red-400"}),he.jsx("span",{children:"NASA: Foto del Da"})]}),he.jsx("h1",{children:d.title}),he.jsx("div",{className:"fs-apod-text-container",children:he.jsx("div",{className:"scroll-wrapper",children:d.explanation})})]})}):he.jsx("div",{className:"fs-apod-loading",children:"Buscando en las estrellas..."})},ET=()=>{const[d,y]=we.useState([]),[T,S]=we.useState(0);if(we.useEffect(()=>{fetch("/api/news").then(M=>M.json()).then(M=>{M.items&&Array.isArray(M.items)&&y(M.items)}).catch(console.error)},[]),we.useEffect(()=>{if(d.length===0)return;const M=setInterval(()=>{S(u=>(u+1)%d.length)},1e4);return()=>clearInterval(M)},[d.length]),d.length===0)return he.jsxs("div",{className:"fs-news-loading",children:[he.jsx(cv,{size:64,className:"animate-pulse mb-4"}),he.jsx("p",{children:"Cargando noticias..."})]});const R=d[T],O=R.image||"https://images.unsplash.com/photo-1504711434969-e33886168f5c?q=80&w=2070&auto=format&fit=crop";return he.jsxs("div",{className:"fs-news-container",style:{backgroundImage:`linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.9)), url(${O})`},children:[he.jsxs("div",{className:"fs-news-col-left",children:[he.jsxs("div",{className:"fs-news-header",children:[he.jsx(cv,{size:48,className:"text-blue-400"}),he.jsx("h1",{children:"Noticias"})]}),he.jsx("div",{className:"fs-news-list",children:d.slice(0,8).map((M,u)=>he.jsxs("div",{className:`fs-news-list-item ${u===T?"active":""}`,onClick:()=>S(u),children:[he.jsx("span",{className:"fs-news-source-badge",children:M.source}),he.jsx("p",{children:M.title})]},u))})]}),he.jsxs("div",{className:"fs-news-col-right",children:[he.jsxs("div",{className:"fs-news-card fade-in",children:[he.jsxs("div",{className:"fs-news-meta",children:[he.jsxs("span",{className:"fs-meta-pill",children:[he.jsx(Y2,{size:16})," ",R.source]}),R.published_at&&he.jsxs("span",{className:"fs-meta-pill",children:[he.jsx(Wx,{size:16})," ",R.published_at.slice(0,16)]})]}),he.jsx("h1",{className:"fs-news-title",children:R.title}),R.image&&he.jsx("div",{className:"fs-news-image",children:he.jsx("img",{src:R.image,alt:"News"})}),he.jsx("div",{className:"fs-news-summary",dangerouslySetInnerHTML:{__html:R.summary}})]},R.link),he.jsx("div",{className:"fs-news-progress",children:d.slice(0,8).map((M,u)=>he.jsx("div",{className:`fs-dot ${u===T?"active":""}`},u))})]})]})};var gy={exports:{}};var AT=gy.exports,dv;function CT(){return dv||(dv=1,(function(d,y){(function(T,S){d.exports=S()})(AT,(function(){var T={},S={};function R(M,u,j){if(S[M]=j,M==="index"){var Z="var sharedModule = {}; ("+S.shared+")(sharedModule); ("+S.worker+")(sharedModule);",X={};return S.shared(X),S.index(T,X),typeof window<"u"&&T.setWorkerUrl(window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"}))),T}}R("shared",["exports"],(function(M){function u(n,e,i,o){return new(i||(i=Promise))((function(c,p){function m(C){try{w(o.next(C))}catch(z){p(z)}}function x(C){try{w(o.throw(C))}catch(z){p(z)}}function w(C){var z;C.done?c(C.value):(z=C.value,z instanceof i?z:new i((function(L){L(z)}))).then(m,x)}w((o=o.apply(n,e||[])).next())}))}function j(n,e){this.x=n,this.y=e}function Z(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var X,te;typeof SuppressedError=="function"&&SuppressedError,j.prototype={clone(){return new j(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround(n,e){const i=Math.cos(n),o=Math.sin(n),c=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:j},j.convert=function(n){if(n instanceof j)return n;if(Array.isArray(n))return new j(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new j(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var de=(function(){if(te)return X;function n(e,i,o,c){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=c}return te=1,X=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,c=0;c<8;c++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<i)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=p/m}var x=0,w=1;for(o=e,c=0;c<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<i));c++)e>p?x=o:w=o,o=.5*(w-x)+x;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},X})(),Ae=Z(de);let Ce,De;function oe(){return Ce==null&&(Ce=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ce}function We(){if(De==null&&(De=!1,oe())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const c=4*o;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const i=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&i[o]!==o){De=!0;break}}}return De||!1}var Ze=1e-6,$e=typeof Float32Array<"u"?Float32Array:Array;function Ct(){var n=new $e(9);return $e!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Ke(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function vt(){var n=new $e(3);return $e!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function mt(n){var e=n[0],i=n[1],o=n[2];return Math.sqrt(e*e+i*i+o*o)}function Et(n,e,i){var o=new $e(3);return o[0]=n,o[1]=e,o[2]=i,o}function Xt(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function ct(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Yt(n,e,i){var o=e[0],c=e[1],p=e[2],m=i[0],x=i[1],w=i[2];return n[0]=c*w-p*x,n[1]=p*m-o*w,n[2]=o*x-c*m,n}var ki,wn=mt;function mr(n,e,i){var o=e[0],c=e[1],p=e[2],m=e[3];return n[0]=i[0]*o+i[4]*c+i[8]*p+i[12]*m,n[1]=i[1]*o+i[5]*c+i[9]*p+i[13]*m,n[2]=i[2]*o+i[6]*c+i[10]*p+i[14]*m,n[3]=i[3]*o+i[7]*c+i[11]*p+i[15]*m,n}function Bn(){var n=new $e(4);return $e!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function tt(n,e,i,o){var c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",p=Math.PI/360;e*=p,o*=p,i*=p;var m=Math.sin(e),x=Math.cos(e),w=Math.sin(i),C=Math.cos(i),z=Math.sin(o),L=Math.cos(o);switch(c){case"xyz":n[0]=m*C*L+x*w*z,n[1]=x*w*L-m*C*z,n[2]=x*C*z+m*w*L,n[3]=x*C*L-m*w*z;break;case"xzy":n[0]=m*C*L-x*w*z,n[1]=x*w*L-m*C*z,n[2]=x*C*z+m*w*L,n[3]=x*C*L+m*w*z;break;case"yxz":n[0]=m*C*L+x*w*z,n[1]=x*w*L-m*C*z,n[2]=x*C*z-m*w*L,n[3]=x*C*L+m*w*z;break;case"yzx":n[0]=m*C*L+x*w*z,n[1]=x*w*L+m*C*z,n[2]=x*C*z-m*w*L,n[3]=x*C*L-m*w*z;break;case"zxy":n[0]=m*C*L-x*w*z,n[1]=x*w*L+m*C*z,n[2]=x*C*z+m*w*L,n[3]=x*C*L-m*w*z;break;case"zyx":n[0]=m*C*L-x*w*z,n[1]=x*w*L+m*C*z,n[2]=x*C*z-m*w*L,n[3]=x*C*L+m*w*z;break;default:throw new Error("Unknown angle order "+c)}return n}function ht(){var n=new $e(2);return $e!=Float32Array&&(n[0]=0,n[1]=0),n}function Rt(n,e){var i=new $e(2);return i[0]=n,i[1]=e,i}vt(),ki=new $e(4),$e!=Float32Array&&(ki[0]=0,ki[1]=0,ki[2]=0,ki[3]=0),vt(),Et(1,0,0),Et(0,1,0),Bn(),Bn(),Ct(),ht();const It=8192;function si(n,e,i){return e*(It/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function Me(n,e){return(n%e+e)%e}function ot(n,e,i){return n*(1-i)+e*i}function Mt(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function zt(n,e,i,o){const c=new Ae(n,e,i,o);return p=>c.solve(p)}const Ot=zt(.25,.1,.25,1);function Wt(n,e,i){return Math.min(i,Math.max(e,n))}function li(n,e,i){const o=i-e,c=((n-e)%o+o)%o+e;return c===e?i:c}function Bi(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let Hi=1;function Er(n,e,i){const o={};for(const c in n)o[c]=e.call(this,n[c],c,n);return o}function so(n,e,i){const o={};for(const c in n)e.call(this,n[c],c,n)&&(o[c]=n[c]);return o}function Kr(n){return Array.isArray(n)?n.map(Kr):typeof n=="object"&&n?Er(n,Kr):n}const kl={};function sn(n){kl[n]||(typeof console<"u"&&console.warn(n),kl[n]=!0)}function Br(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function ga(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let hn=null;function Ls(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const ks="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function oo(n,e,i,o,c){return u(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(n,{timestamp:0});try{const m=p?.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const x=m.startsWith("BGR"),w=new Uint8ClampedArray(o*c*4);if(yield p.copyTo(w,(function(C,z,L,B,F){const G=4*Math.max(-z,0),q=(Math.max(0,L)-L)*B*4+G,$=4*B,Q=Math.max(0,z),ce=Math.max(0,L);return{rect:{x:Q,y:ce,width:Math.min(C.width,z+B)-Q,height:Math.min(C.height,L+F)-ce},layout:[{offset:q,stride:$}]}})(n,e,i,o,c)),x)for(let C=0;C<w.length;C+=4){const z=w[C];w[C]=w[C+2],w[C+2]=z}return w}finally{p.close()}}))}let rs,Fa;function Bl(n,e,i,o){return n.addEventListener(e,i,o),{unsubscribe:()=>{n.removeEventListener(e,i,o)}}}function Wn(n){return n*Math.PI/180}function Or(n){return n/Math.PI*180}const Re={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},W={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Y="AbortError";class ie extends Error{constructor(e=Y){super(e instanceof Error?e.message:e),this.name=Y,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function _e(n){return n.name===Y}const xe={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Be(n){return xe.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Pe="global-dispatcher";class Te extends Error{constructor(e,i,o,c){super(`AJAXError: ${i} (${e}): ${o}`),this.status=e,this.statusText=i,this.url=o,this.body=c}}const Oe=()=>ga(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Je=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=Be(n.url);if(o)return o(n,e);if(ga(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Pe},e)}if(!(/^file:/.test(i=n.url)||/^file:/.test(Oe())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,c){return u(this,void 0,void 0,(function*(){const p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Oe(),signal:c.signal});let m,x;o.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{m=yield fetch(p)}catch(C){throw _e(C)?C:new Te(0,C.message,o.url,new Blob)}if(!m.ok){const C=yield m.blob();throw new Te(m.status,m.statusText,o.url,C)}x=o.type==="arrayBuffer"||o.type==="image"?m.arrayBuffer():o.type==="json"?m.json():m.text();const w=yield x;return c.signal.throwIfAborted(),{data:w,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}}))})(n,e);if(ga(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Pe},e)}var i;return(function(o,c){return new Promise(((p,m)=>{var x;const w=new XMLHttpRequest;w.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(w.responseType="arraybuffer");for(const C in o.headers)w.setRequestHeader(C,o.headers[C]);o.type==="json"&&(w.responseType="text",!((x=o.headers)===null||x===void 0)&&x.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=o.credentials==="include",w.onerror=()=>{m(new Error(w.statusText))},w.onload=()=>{if(!c.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let C=w.response;if(o.type==="json")try{C=JSON.parse(w.response)}catch(z){return void m(z)}p({data:C,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const C=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});m(new Te(w.status,w.statusText,o.url,C))}},c.signal.addEventListener("abort",(()=>{w.abort(),m(new ie(c.signal.reason))})),w.send(o.body)}))})(n,e)};function et(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function wt(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Pt(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class Vt{constructor(e,i={}){Bi(this,i),this.type=e}}class bi extends Vt{constructor(e,i={}){super("error",Bi({error:e},i))}}class ci{on(e,i){return this._listeners=this._listeners||{},wt(e,i,this._listeners),{unsubscribe:()=>{this.off(e,i)}}}off(e,i){return Pt(e,i,this._listeners),Pt(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},wt(e,i,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,i){typeof e=="string"&&(e=new Vt(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const x of c)x.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const x of p)Pt(o,x,this._oneTimeListeners),x.call(this,e);const m=this._eventedParent;m&&(Bi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof bi&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Si=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Cn(n,e){const i={};for(const o in n)o!=="ref"&&(i[o]=n[o]);return Si.forEach((o=>{o in e&&(i[o]=e[o])})),i}function qt(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!qt(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!qt(n[i],e[i]))return!1;return!0}return n===e}function Mi(n,e){n.push(e)}function Un(n,e,i){Mi(i,{command:"addSource",args:[n,e[n]]})}function Di(n,e,i){Mi(e,{command:"removeSource",args:[n]}),i[n]=!0}function dn(n,e,i,o){Di(n,i,o),Un(n,e,i)}function Oi(n,e,i){let o;for(o in n[i])if(Object.prototype.hasOwnProperty.call(n[i],o)&&o!=="data"&&!qt(n[i][o],e[i][o]))return!1;for(o in e[i])if(Object.prototype.hasOwnProperty.call(e[i],o)&&o!=="data"&&!qt(n[i][o],e[i][o]))return!1;return!0}function Dn(n,e,i,o,c,p){n=n||{},e=e||{};for(const m in n)Object.prototype.hasOwnProperty.call(n,m)&&(qt(n[m],e[m])||i.push({command:p,args:[o,m,e[m],c]}));for(const m in e)Object.prototype.hasOwnProperty.call(e,m)&&!Object.prototype.hasOwnProperty.call(n,m)&&(qt(n[m],e[m])||i.push({command:p,args:[o,m,e[m],c]}))}function Ol(n){return n.id}function Uo(n,e){return n[e.id]=e,n}class ut{constructor(e,i,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function gr(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class yr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class ja{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,c]of i)this.bindings[o]=c}concat(e){return new ja(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const qi={kind:"null"},pt={kind:"number"},Ht={kind:"string"},Jt={kind:"boolean"},Qr={kind:"color"},Rc={kind:"projectionDefinition"},as={kind:"object"},Zt={kind:"value"},Go={kind:"collator"},ss={kind:"formatted"},Bs={kind:"padding"},os={kind:"colorArray"},ls={kind:"numberArray"},fn={kind:"resolvedImage"},Fl={kind:"variableAnchorOffsetCollection"};function _r(n,e){return{kind:"array",itemType:n,N:e}}function hi(n){if(n.kind==="array"){const e=hi(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Os=[qi,pt,Ht,Jt,Qr,Rc,ss,as,_r(Zt),Bs,ls,os,fn,Fl];function jl(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!jl(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Os)if(!jl(i,e))return null}}return`Expected ${hi(n)} but found ${hi(e)} instead.`}function Nl(n,e){return e.some((i=>i.kind===n.kind))}function lo(n,e){return e.some((i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n))}function Na(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const Pu=.96422,us=.82521,ya=4/29,yi=6/29,kh=3*yi*yi,Qd=yi*yi*yi,qo=Math.PI/180,Bh=180/Math.PI;function zu(n){return(n%=360)<0&&(n+=360),n}function Jd([n,e,i,o]){let c,p;const m=Ru((.2225045*(n=Ar(n))+.7168786*(e=Ar(e))+.0606169*(i=Ar(i)))/1);n===e&&e===i?c=p=m:(c=Ru((.4360747*n+.3850649*e+.1430804*i)/Pu),p=Ru((.0139322*n+.0971045*e+.7141733*i)/us));const x=116*m-16;return[x<0?0:x,500*(c-m),200*(m-p),o]}function Ar(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Ru(n){return n>Qd?Math.pow(n,1/3):n/kh+ya}function Ic([n,e,i,o]){let c=(n+16)/116,p=isNaN(e)?c:c+e/500,m=isNaN(i)?c:c-i/200;return c=1*uo(c),p=Pu*uo(p),m=us*uo(m),[Iu(3.1338561*p-1.6168667*c-.4906146*m),Iu(-.9787684*p+1.9161415*c+.033454*m),Iu(.0719453*p-.2289914*c+1.4052427*m),o]}function Iu(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function uo(n){return n>yi?n*n*n:kh*(n-ya)}const ef=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function Vl(n,e){return ef(n,e)?n[e]:void 0}function Fs(n){return parseInt(n.padEnd(2,n),16)/255}function tf(n,e){return Zo(e?n/100:n,0,1)}function Zo(n,e,i){return Math.min(Math.max(e,n),i)}function Lc(n){return!n.some(Number.isNaN)}const Ho={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function co(n,e,i){return n+i*(e-n)}function Ul(n,e,i){return n.map(((o,c)=>co(o,e[c],i)))}class Qt{constructor(e,i,o,c=1,p=!0){this.r=e,this.g=i,this.b=o,this.a=c,p||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,i,o,c]))}static parse(e){if(e instanceof Qt)return e;if(typeof e!="string")return;const i=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Vl(Ho,o);if(c){const[m,x,w]=c;return[m/255,x/255,w/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const m=o.length<6?1:2;let x=1;return[Fs(o.slice(x,x+=m)),Fs(o.slice(x,x+=m)),Fs(o.slice(x,x+=m)),Fs(o.slice(x,x+m)||"ff")]}if(o.startsWith("rgb")){const m=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[x,w,C,z,L,B,F,G,q,$,Q,ce]=m,J=[z||" ",F||" ",$].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const ne=[C,B,q].join(""),pe=ne==="%%%"?100:ne===""?255:0;if(pe){const ye=[Zo(+w/pe,0,1),Zo(+L/pe,0,1),Zo(+G/pe,0,1),Q?tf(+Q,ce):1];if(Lc(ye))return ye}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[m,x,w,C,z,L,B,F,G]=p,q=[w||" ",z||" ",B].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const $=[+x,Zo(+C,0,100),Zo(+L,0,100),F?tf(+F,G):1];if(Lc($))return(function([Q,ce,J,ne]){function pe(ye){const ke=(ye+Q/30)%12,Qe=ce*Math.min(J,1-J);return J-Qe*Math.max(-1,Math.min(ke-3,9-ke,1))}return Q=zu(Q),ce/=100,J/=100,[pe(0),pe(8),pe(4),ne]})($)}}})(e);return i?new Qt(...i,!1):void 0}get rgb(){const{r:e,g:i,b:o,a:c}=this,p=c||1/0;return this.overwriteGetter("rgb",[e/p,i/p,o/p,c])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[i,o,c,p]=Jd(e),m=Math.sqrt(o*o+c*c);return[Math.round(1e4*m)?zu(Math.atan2(c,o)*Bh):NaN,m,i,p]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Jd(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,o,c]=this.rgb;return`rgba(${[e,i,o].map((p=>Math.round(255*p))).join(",")},${c})`}static interpolate(e,i,o,c="rgb"){switch(c){case"rgb":{const[p,m,x,w]=Ul(e.rgb,i.rgb,o);return new Qt(p,m,x,w,!1)}case"hcl":{const[p,m,x,w]=e.hcl,[C,z,L,B]=i.hcl;let F,G;if(isNaN(p)||isNaN(C))isNaN(p)?isNaN(C)?F=NaN:(F=C,x!==1&&x!==0||(G=z)):(F=p,L!==1&&L!==0||(G=m));else{let J=C-p;C>p&&J>180?J-=360:C<p&&p-C>180&&(J+=360),F=p+o*J}const[q,$,Q,ce]=(function([J,ne,pe,ye]){return J=isNaN(J)?0:J*qo,Ic([pe,Math.cos(J)*ne,Math.sin(J)*ne,ye])})([F,G??co(m,z,o),co(x,L,o),co(w,B,o)]);return new Qt(q,$,Q,ce,!1)}case"lab":{const[p,m,x,w]=Ic(Ul(e.lab,i.lab,o));return new Qt(p,m,x,w,!1)}}}}Qt.black=new Qt(0,0,0,1),Qt.white=new Qt(1,1,1,1),Qt.transparent=new Qt(0,0,0,0),Qt.red=new Qt(1,0,0,1);class Va{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Oh=["bottom","center","top"];class Lu{constructor(e,i,o,c,p,m){this.text=e,this.image=i,this.scale=o,this.fontStack=c,this.textColor=p,this.verticalAlign=m}}class Gn{constructor(e){this.sections=e}static fromString(e){return new Gn([new Lu(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof Gn?e:Gn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Pn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Pn)return e;if(typeof e=="number")return new Pn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Pn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new Pn(Ul(e.values,i.values,o))}}class Qi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Qi)return e;if(typeof e=="number")return new Qi([e]);if(Array.isArray(e)){for(const i of e)if(typeof i!="number")return;return new Qi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new Qi(Ul(e.values,i.values,o))}}class jt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof jt)return e;if(typeof e=="string"){const o=Qt.parse(e);return o?new jt([o]):void 0}if(!Array.isArray(e))return;const i=[];for(const o of e){if(typeof o!="string")return;const c=Qt.parse(o);if(!c)return;i.push(c)}return new jt(i)}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o,c="rgb"){const p=[];if(e.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let m=0;m<e.values.length;m++)p.push(Qt.interpolate(e.values[m],i.values[m],o,c));return new jt(p)}}class Fi extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const _a=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class pn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof pn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let i=0;i<e.length;i+=2){const o=e[i],c=e[i+1];if(typeof o!="string"||!_a.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new pn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){const c=e.values,p=i.values;if(c.length!==p.length)throw new Fi(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${i.toString()}`);const m=[];for(let x=0;x<c.length;x+=2){if(c[x]!==p[x])throw new Fi(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${c[x]}, to[${x}]: ${p[x]}`);m.push(c[x]);const[w,C]=c[x+1],[z,L]=p[x+1];m.push([co(w,z,o),co(C,L,o)])}return new pn(m)}}class Cr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Cr({name:e,available:!1}):null}}class qn{constructor(e,i,o){this.from=e,this.to=i,this.transition=o}static interpolate(e,i,o){return new qn(e,i,o)}static parse(e){return e instanceof qn?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new qn(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new qn(e.from,e.to,e.transition):typeof e=="string"?new qn(e,e,1):void 0}}function Jr(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cs(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof qn||n instanceof Qt||n instanceof Va||n instanceof Gn||n instanceof Pn||n instanceof Qi||n instanceof jt||n instanceof pn||n instanceof Cr)return!0;if(Array.isArray(n)){for(const e of n)if(!cs(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!cs(n[e]))return!1;return!0}return!1}function Ji(n){if(n===null)return qi;if(typeof n=="string")return Ht;if(typeof n=="boolean")return Jt;if(typeof n=="number")return pt;if(n instanceof Qt)return Qr;if(n instanceof qn)return Rc;if(n instanceof Va)return Go;if(n instanceof Gn)return ss;if(n instanceof Pn)return Bs;if(n instanceof Qi)return ls;if(n instanceof jt)return os;if(n instanceof pn)return Fl;if(n instanceof Cr)return fn;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const c=Ji(o);if(i){if(i===c)continue;i=Zt;break}i=c}return _r(i||Zt,e)}return as}function ho(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Qt||n instanceof qn||n instanceof Gn||n instanceof Pn||n instanceof Qi||n instanceof jt||n instanceof pn||n instanceof Cr?n.toString():JSON.stringify(n)}class ea{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!cs(e[1]))return i.error("invalid value");const o=e[1];let c=Ji(o);const p=i.expectedType;return c.kind!=="array"||c.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(c=p),new ea(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const $o={string:Ht,number:pt,boolean:Jt,object:as};class Dr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,c=1;const p=e[0];if(p==="array"){let x,w;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in $o)||C==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=$o[C],c++}else x=Zt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],c++}o=_r(x,w)}else{if(!$o[p])throw new Error(`Types doesn't contain name = ${p}`);o=$o[p]}const m=[];for(;c<e.length;c++){const x=i.parse(e[c],c,Zt);if(!x)return null;m.push(x)}return new Dr(o,m)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!jl(this.type,Ji(o)))return o;if(i===this.args.length-1)throw new Fi(`Expected value to be of type ${hi(this.type)}, but found ${hi(Ji(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const On={"to-boolean":Jt,"to-color":Qr,"to-number":pt,"to-string":Ht};class Pr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(!On[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const c=On[o],p=[];for(let m=1;m<e.length;m++){const x=i.parse(e[m],m,Zt);if(!x)return null;p.push(x)}return new Pr(c,p)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,o;for(const c of this.args){if(i=c.evaluate(e),o=null,i instanceof Qt)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Jr(i[0],i[1],i[2],i[3]),!o))return new Qt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Fi(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(e);const c=Pn.parse(i);if(c)return c}throw new Fi(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(e);const c=Qi.parse(i);if(c)return c}throw new Fi(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(e);const c=jt.parse(i);if(c)return c}throw new Fi(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(e);const c=pn.parse(i);if(c)return c}throw new Fi(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new Fi(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return Gn.fromString(ho(this.args[0].evaluate(e)));case"resolvedImage":return Cr.fromString(ho(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return ho(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const ku=["Unknown","Point","LineString","Polygon"];class Xo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ku[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache.get(e);return i||(i=Qt.parse(e),this._parseColorCache.set(e,i)),i}}class Yo{constructor(e,i,o=[],c,p=new ja,m=[]){this.registry=e,this.path=o,this.key=o.map((x=>`[${x}]`)).join(""),this.scope=p,this.errors=m,this.expectedType=c,this._isConstant=i}parse(e,i,o,c,p={}){return i?this.concat(i,o,c)._parse(e,p):this._parse(e,p)}_parse(e,i){function o(c,p,m){return m==="assert"?new Dr(p,[c]):m==="coerce"?new Pr(p,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[c];if(p){let m=p.parse(e,this);if(!m)return null;if(this.expectedType){const x=this.expectedType,w=m.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||w.kind!=="value"){if(x.kind==="projectionDefinition"&&["string","array"].includes(w.kind)||["color","formatted","resolvedImage"].includes(x.kind)&&["value","string"].includes(w.kind)||["padding","numberArray"].includes(x.kind)&&["value","number","array"].includes(w.kind)||x.kind==="colorArray"&&["value","string","array"].includes(w.kind)||x.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(w.kind))m=o(m,x,i.typeAnnotation||"coerce");else if(this.checkSubtype(x,w))return null}else m=o(m,x,i.typeAnnotation||"assert")}if(!(m instanceof ea)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const x=new Xo;try{m=new ea(m.type,m.evaluate(x))}catch(w){return this.error(w.message),null}}return m}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const c=typeof e=="number"?this.path.concat(e):this.path,p=o?this.scope.concat(o):this.scope;return new Yo(this.registry,this._isConstant,c,i||null,p,this.errors)}error(e,...i){const o=`${this.key}${i.map((c=>`[${c}]`)).join("")}`;this.errors.push(new yr(o,e))}checkSubtype(e,i){const o=jl(e,i);return o&&this.error(o),o}}class Pi{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let p=1;p<e.length-1;p+=2){const m=e[p];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=i.parse(e[p+1],p+1);if(!x)return null;o.push([m,x])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return c?new Pi(o,c):null}outputDefined(){return this.result.outputDefined()}}class fo{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new fo(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class ni{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,pt),c=i.parse(e[2],2,_r(i.expectedType||Zt));return o&&c?new ni(c.type.itemType,o,c):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Fi(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Fi(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Fi(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class $t{constructor(e,i){this.type=Jt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Zt),c=i.parse(e[2],2,Zt);return o&&c?Nl(o.type,[Jt,Ht,pt,qi,Zt])?new $t(o,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${hi(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!lo(i,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${hi(Ji(i))} instead.`);if(!lo(o,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${hi(Ji(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Wo{constructor(e,i,o){this.type=pt,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Zt),c=i.parse(e[2],2,Zt);if(!o||!c)return null;if(!Nl(o.type,[Jt,Ht,pt,qi,Zt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${hi(o.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,pt);return p?new Wo(o,c,p):null}return new Wo(o,c)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!lo(i,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${hi(Ji(i))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(e)),lo(o,["string"])){const p=o.indexOf(i,c);return p===-1?-1:[...o.slice(0,p)].length}if(lo(o,["array"]))return o.indexOf(i,c);throw new Fi(`Expected second argument to be of type array or string, but found ${hi(Ji(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class di{constructor(e,i,o,c,p,m){this.inputType=e,this.type=i,this.input=o,this.cases=c,this.outputs=p,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const p={},m=[];for(let C=2;C<e.length-1;C+=2){let z=e[C];const L=e[C+1];Array.isArray(z)||(z=[z]);const B=i.concat(C);if(z.length===0)return B.error("Expected at least one branch label.");for(const G of z){if(typeof G!="number"&&typeof G!="string")return B.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return B.error("Numeric branch labels must be integer values.");if(o){if(B.checkSubtype(o,Ji(G)))return null}else o=Ji(G);if(p[String(G)]!==void 0)return B.error("Branch labels must be unique.");p[String(G)]=m.length}const F=i.parse(L,C,c);if(!F)return null;c=c||F.type,m.push(F)}const x=i.parse(e[1],1,Zt);if(!x)return null;const w=i.parse(e[e.length-1],e.length-1,c);return w?x.type.kind!=="value"&&i.concat(1).checkSubtype(o,x.type)?null:new di(o,c,x,p,m,w):null}evaluate(e){const i=this.input.evaluate(e);return(Ji(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Bu{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const c=[];for(let m=1;m<e.length-1;m+=2){const x=i.parse(e[m],m,Jt);if(!x)return null;const w=i.parse(e[m+1],m+1,o);if(!w)return null;c.push([x,w]),o=o||w.type}const p=i.parse(e[e.length-1],e.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new Bu(o,c,p)}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class va{constructor(e,i,o,c){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Zt),c=i.parse(e[2],2,pt);if(!o||!c)return null;if(!Nl(o.type,[_r(Zt),Ht,Zt]))return i.error(`Expected first argument to be of type array or string, but found ${hi(o.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,pt);return p?new va(o.type,o,c,p):null}return new va(o.type,o,c)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let c;if(this.endIndex&&(c=this.endIndex.evaluate(e)),lo(i,["string"]))return[...i].slice(o,c).join("");if(lo(i,["array"]))return i.slice(o,c);throw new Fi(`Expected first argument to be of type array or string, but found ${hi(Ji(i))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function po(n,e){const i=n.length-1;let o,c,p=0,m=i,x=0;for(;p<=m;)if(x=Math.floor((p+m)/2),o=n[x],c=n[x+1],o<=e){if(x===i||e<c)return x;p=x+1}else{if(!(o>e))throw new Fi("Input is not a number.");m=x-1}return 0}class mo{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,p]of o)this.labels.push(c),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,pt);if(!o)return null;const c=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let m=1;m<e.length;m+=2){const x=m===1?-1/0:e[m],w=e[m+1],C=m,z=m+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(c.length&&c[c.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const L=i.parse(w,z,p);if(!L)return null;p=p||L.type,c.push([x,L])}return new mo(p,o,c)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const p=i.length;return c>=i[p-1]?o[p-1].evaluate(e):o[po(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function nf(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ou,Fh,Lp=(function(){if(Fh)return Ou;function n(e,i,o,c){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=c}return Fh=1,Ou=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,c=0;c<8;c++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<i)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=p/m}var x=0,w=1;for(o=e,c=0;c<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<i));c++)e>p?x=o:w=o,o=.5*(w-x)+x;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Ou})(),jh=nf(Lp);class zr{constructor(e,i,o,c,p){this.type=e,this.operator=i,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[m,x]of p)this.labels.push(m),this.outputs.push(x)}static interpolationFactor(e,i,o,c){let p=0;if(e.name==="exponential")p=hs(i,e.base,o,c);else if(e.name==="linear")p=hs(i,1,o,c);else if(e.name==="cubic-bezier"){const m=e.controlPoints;p=new jh(m[0],m[1],m[2],m[3]).solve(hs(i,1,o,c))}return p}static parse(e,i){let[o,c,p,...m]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const C=c[1];if(typeof C!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:C}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const C=c.slice(1);if(C.length!==4||C.some((z=>typeof z!="number"||z<0||z>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,pt),!p)return null;const x=[];let w=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==os?i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType):w=Qr;for(let C=0;C<m.length;C+=2){const z=m[C],L=m[C+1],B=C+3,F=C+4;if(typeof z!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(x.length&&x[x.length-1][0]>=z)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const G=i.parse(L,F,w);if(!G)return null;w=w||G.type,x.push([z,G])}return Na(w,pt)||Na(w,Rc)||Na(w,Qr)||Na(w,Bs)||Na(w,ls)||Na(w,os)||Na(w,Fl)||Na(w,_r(pt))?new zr(w,o,c,p,x):i.error(`Type ${hi(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const p=i.length;if(c>=i[p-1])return o[p-1].evaluate(e);const m=po(i,c),x=zr.interpolationFactor(this.interpolation,c,i[m],i[m+1]),w=o[m].evaluate(e),C=o[m+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return co(w,C,x);case"color":return Qt.interpolate(w,C,x);case"padding":return Pn.interpolate(w,C,x);case"colorArray":return jt.interpolate(w,C,x);case"numberArray":return Qi.interpolate(w,C,x);case"variableAnchorOffsetCollection":return pn.interpolate(w,C,x);case"array":return Ul(w,C,x);case"projectionDefinition":return qn.interpolate(w,C,x)}case"interpolate-hcl":switch(this.type.kind){case"color":return Qt.interpolate(w,C,x,"hcl");case"colorArray":return jt.interpolate(w,C,x,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Qt.interpolate(w,C,x,"lab");case"colorArray":return jt.interpolate(w,C,x,"lab")}}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function hs(n,e,i,o){const c=o-i,p=n-i;return c===0?0:e===1?p/c:(Math.pow(e,p)-1)/(Math.pow(e,c)-1)}const en={color:Qt.interpolate,number:co,padding:Pn.interpolate,numberArray:Qi.interpolate,colorArray:jt.interpolate,variableAnchorOffsetCollection:pn.interpolate,array:Ul};class Ko{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=null;const c=i.expectedType;c&&c.kind!=="value"&&(o=c);const p=[];for(const x of e.slice(1)){const w=i.parse(x,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,p.push(w)}if(!o)throw new Error("No output type");const m=c&&p.some((x=>jl(c,x.type)));return new Ko(m?Zt:o,p)}evaluate(e){let i,o=null,c=0;for(const p of this.args)if(c++,o=p.evaluate(e),o&&o instanceof Cr&&!o.available&&(i||(i=o.name),o=null,c===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Fu(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ju(n,e,i,o){return o.compare(e,i)===0}function mn(n,e,i){const o=n!=="=="&&n!=="!=";return class Kx{constructor(p,m,x){this.type=Jt,this.lhs=p,this.rhs=m,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const x=p[0];let w=m.parse(p[1],1,Zt);if(!w)return null;if(!Fu(x,w.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${hi(w.type)}'.`);let C=m.parse(p[2],2,Zt);if(!C)return null;if(!Fu(x,C.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${hi(C.type)}'.`);if(w.type.kind!==C.type.kind&&w.type.kind!=="value"&&C.type.kind!=="value")return m.error(`Cannot compare types '${hi(w.type)}' and '${hi(C.type)}'.`);o&&(w.type.kind==="value"&&C.type.kind!=="value"?w=new Dr(C.type,[w]):w.type.kind!=="value"&&C.type.kind==="value"&&(C=new Dr(w.type,[C])));let z=null;if(p.length===4){if(w.type.kind!=="string"&&C.type.kind!=="string"&&w.type.kind!=="value"&&C.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(z=m.parse(p[3],3,Go),!z)return null}return new Kx(w,C,z)}evaluate(p){const m=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const w=Ji(m),C=Ji(x);if(w.kind!==C.kind||w.kind!=="string"&&w.kind!=="number")throw new Fi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${C.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=Ji(m),C=Ji(x);if(w.kind!=="string"||C.kind!=="string")return e(p,m,x)}return this.collator?i(p,m,x,this.collator.evaluate(p)):e(p,m,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const rf=mn("==",(function(n,e,i){return e===i}),ju),kc=mn("!=",(function(n,e,i){return e!==i}),(function(n,e,i,o){return!ju(0,e,i,o)})),af=mn("<",(function(n,e,i){return e<i}),(function(n,e,i,o){return o.compare(e,i)<0})),kp=mn(">",(function(n,e,i){return e>i}),(function(n,e,i,o){return o.compare(e,i)>0})),Gl=mn("<=",(function(n,e,i){return e<=i}),(function(n,e,i,o){return o.compare(e,i)<=0})),Bc=mn(">=",(function(n,e,i){return e>=i}),(function(n,e,i,o){return o.compare(e,i)>=0}));class ql{constructor(e,i,o){this.type=Go,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const c=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Jt);if(!c)return null;const p=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Jt);if(!p)return null;let m=null;return o.locale&&(m=i.parse(o.locale,1,Ht),!m)?null:new ql(c,p,m)}evaluate(e){return new Va(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Nh{constructor(e,i,o,c,p){this.type=Ht,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,pt);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let p=null;if(c.locale&&(p=i.parse(c.locale,1,Ht),!p))return null;let m=null;if(c.currency&&(m=i.parse(c.currency,1,Ht),!m))return null;let x=null;if(c["min-fraction-digits"]&&(x=i.parse(c["min-fraction-digits"],1,pt),!x))return null;let w=null;return c["max-fraction-digits"]&&(w=i.parse(c["max-fraction-digits"],1,pt),!w)?null:new Nh(o,p,m,x,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Nu{constructor(e){this.type=ss,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const c=[];let p=!1;for(let m=1;m<=e.length-1;++m){const x=e[m];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let w=null;if(x["font-scale"]&&(w=i.parse(x["font-scale"],1,pt),!w))return null;let C=null;if(x["text-font"]&&(C=i.parse(x["text-font"],1,_r(Ht)),!C))return null;let z=null;if(x["text-color"]&&(z=i.parse(x["text-color"],1,Qr),!z))return null;let L=null;if(x["vertical-align"]){if(typeof x["vertical-align"]=="string"&&!Oh.includes(x["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${x["vertical-align"]}' instead.`);if(L=i.parse(x["vertical-align"],1,Ht),!L)return null}const B=c[c.length-1];B.scale=w,B.font=C,B.textColor=z,B.verticalAlign=L}else{const w=i.parse(e[m],1,Zt);if(!w)return null;const C=w.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,c.push({content:w,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Nu(c)}evaluate(e){return new Gn(this.sections.map((i=>{const o=i.content.evaluate(e);return Ji(o)===fn?new Lu("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(e):null):new Lu(ho(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null,i.verticalAlign?i.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor),i.verticalAlign&&e(i.verticalAlign)}outputDefined(){return!1}}class Zl{constructor(e){this.type=fn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Ht);return o?new Zl(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=Cr.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Hl{constructor(e){this.type=pt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${hi(o.type)} instead.`):new Hl(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Fi(`Expected value to be of type string or array, but found ${hi(Ji(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Tn=8192;function $l(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*Tn),Math.round(o*c*Tn)]}function Xl(n,e){const i=Math.pow(2,e.z);return[(c=(n[0]/Tn+e.x)/i,360*c-180),(o=(n[1]/Tn+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function Yl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function go(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function sf(n,e,i){const o=n[0]-e[0],c=n[1]-e[1],p=n[0]-i[0],m=n[1]-i[1];return o*m-p*c==0&&o*p<=0&&c*m<=0}function Vu(n,e,i,o){return(c=[o[0]-i[0],o[1]-i[1]])[0]*(p=[e[0]-n[0],e[1]-n[1]])[1]-c[1]*p[0]!=0&&!(!Fc(n,e,i,o)||!Fc(i,o,n,e));var c,p}function of(n,e,i){for(const o of i)for(let c=0;c<o.length-1;++c)if(Vu(n,e,o[c],o[c+1]))return!0;return!1}function Ua(n,e,i=!1){let o=!1;for(const x of e)for(let w=0;w<x.length-1;w++){if(sf(n,x[w],x[w+1]))return i;(p=x[w])[1]>(c=n)[1]!=(m=x[w+1])[1]>c[1]&&c[0]<(m[0]-p[0])*(c[1]-p[1])/(m[1]-p[1])+p[0]&&(o=!o)}var c,p,m;return o}function Oc(n,e){for(const i of e)if(Ua(n,i))return!0;return!1}function lf(n,e){for(const i of n)if(!Ua(i,e))return!1;for(let i=0;i<n.length-1;++i)if(of(n[i],n[i+1],e))return!1;return!0}function uf(n,e){for(const i of e)if(lf(n,i))return!0;return!1}function Fc(n,e,i,o){const c=o[0]-i[0],p=o[1]-i[1],m=(n[0]-i[0])*p-c*(n[1]-i[1]),x=(e[0]-i[0])*p-c*(e[1]-i[1]);return m>0&&x<0||m<0&&x>0}function jc(n,e,i){const o=[];for(let c=0;c<n.length;c++){const p=[];for(let m=0;m<n[c].length;m++){const x=$l(n[c][m],i);Yl(e,x),p.push(x)}o.push(p)}return o}function Qo(n,e,i){const o=[];for(let c=0;c<n.length;c++){const p=jc(n[c],e,i);o.push(p)}return o}function Wl(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const c=.5*o;let p=n[0]-i[0]>c?-o:i[0]-n[0]>c?o:0;p===0&&(p=n[0]-i[2]>c?-o:i[2]-n[0]>c?o:0),n[0]+=p}Yl(e,n)}function cf(n,e,i,o){const c=Math.pow(2,o.z)*Tn,p=[o.x*Tn,o.y*Tn],m=[];for(const x of n)for(const w of x){const C=[w.x+p[0],w.y+p[1]];Wl(C,e,i,c),m.push(C)}return m}function Uu(n,e,i,o){const c=Math.pow(2,o.z)*Tn,p=[o.x*Tn,o.y*Tn],m=[];for(const w of n){const C=[];for(const z of w){const L=[z.x+p[0],z.y+p[1]];Yl(e,L),C.push(L)}m.push(C)}if(e[2]-e[0]<=c/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of m)for(const C of w)Wl(C,e,i,c)}var x;return m}class yo{constructor(e,i){this.type=Jt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(cs(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const c=[];for(const p of o.features){const{type:m,coordinates:x}=p.geometry;m==="Polygon"&&c.push(x),m==="MultiPolygon"&&c.push(...x)}if(c.length)return new yo(o,{type:"MultiPolygon",coordinates:c})}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new yo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new yo(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(o.type==="Polygon"){const x=jc(o.coordinates,p,m),w=cf(i.geometry(),c,p,m);if(!go(c,p))return!1;for(const C of w)if(!Ua(C,x))return!1}if(o.type==="MultiPolygon"){const x=Qo(o.coordinates,p,m),w=cf(i.geometry(),c,p,m);if(!go(c,p))return!1;for(const C of w)if(!Oc(C,x))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(o.type==="Polygon"){const x=jc(o.coordinates,p,m),w=Uu(i.geometry(),c,p,m);if(!go(c,p))return!1;for(const C of w)if(!lf(C,x))return!1}if(o.type==="MultiPolygon"){const x=Qo(o.coordinates,p,m),w=Uu(i.geometry(),c,p,m);if(!go(c,p))return!1;for(const C of w)if(!uf(C,x))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Vh=class{constructor(n=[],e=(i,o)=>i<o?-1:i>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:i}=this,o=e[n];for(;n>0;){const c=n-1>>1,p=e[c];if(i(o,p)>=0)break;e[n]=p,n=c}e[n]=o}_down(n){const{data:e,compare:i}=this,o=this.length>>1,c=e[n];for(;n<o;){let p=1+(n<<1);const m=p+1;if(m<this.length&&i(e[m],e[p])<0&&(p=m),i(e[p],c)>=0)break;e[n]=e[p],n=p}e[n]=c}};function Gu(n,e,i=0,o=n.length-1,c=Uh){for(;o>i;){if(o-i>600){const w=o-i+1,C=e-i+1,z=Math.log(w),L=.5*Math.exp(2*z/3),B=.5*Math.sqrt(z*L*(w-L)/w)*(C-w/2<0?-1:1);Gu(n,e,Math.max(i,Math.floor(e-C*L/w+B)),Math.min(o,Math.floor(e+(w-C)*L/w+B)),c)}const p=n[e];let m=i,x=o;for(_o(n,i,e),c(n[o],p)>0&&_o(n,i,o);m<x;){for(_o(n,m,x),m++,x--;c(n[m],p)<0;)m++;for(;c(n[x],p)>0;)x--}c(n[i],p)===0?_o(n,i,x):(x++,_o(n,x,o)),x<=e&&(i=x+1),e<=x&&(o=x-1)}}function _o(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function Uh(n,e){return n<e?-1:n>e?1:0}function qu(n,e){if(n.length<=1)return[n];const i=[];let o,c;for(const p of n){const m=Bp(p);m!==0&&(p.area=Math.abs(m),c===void 0&&(c=m<0),c===m<0?(o&&i.push(o),o=[p]):o.push(p))}if(o&&i.push(o),e>1)for(let p=0;p<i.length;p++)i[p].length<=e||(Gu(i[p],e,1,i[p].length-1,hf),i[p]=i[p].slice(0,e));return i}function hf(n,e){return e.area-n.area}function Bp(n){let e=0;for(let i,o,c=0,p=n.length,m=p-1;c<p;m=c++)i=n[c],o=n[m],e+=(o.x-i.x)*(i.y+o.y);return e}const df=1/298.257223563,Zu=df*(2-df),ff=Math.PI/180;class Gh{constructor(e){const i=6378.137*ff*1e3,o=Math.cos(e*ff),c=1/(1-Zu*(1-o*o)),p=Math.sqrt(c);this.kx=i*p*o,this.ky=i*p*c*(1-Zu)}distance(e,i){const o=this.wrap(e[0]-i[0])*this.kx,c=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+c*c)}pointOnLine(e,i){let o,c,p,m,x=1/0;for(let w=0;w<e.length-1;w++){let C=e[w][0],z=e[w][1],L=this.wrap(e[w+1][0]-C)*this.kx,B=(e[w+1][1]-z)*this.ky,F=0;L===0&&B===0||(F=(this.wrap(i[0]-C)*this.kx*L+(i[1]-z)*this.ky*B)/(L*L+B*B),F>1?(C=e[w+1][0],z=e[w+1][1]):F>0&&(C+=L/this.kx*F,z+=B/this.ky*F)),L=this.wrap(i[0]-C)*this.kx,B=(i[1]-z)*this.ky;const G=L*L+B*B;G<x&&(x=G,o=C,c=z,p=w,m=F)}return{point:[o,c],index:p,t:Math.max(0,Math.min(1,m))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Fr(n,e){return e[0]-n[0]}function vo(n){return n[1]-n[0]+1}function xa(n,e){return n[1]>=n[0]&&n[1]<e}function Hu(n,e){if(n[0]>n[1])return[null,null];const i=vo(n);if(e){if(i===2)return[n,null];const c=Math.floor(i/2);return[[n[0],n[0]+c],[n[0]+c,n[1]]]}if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function Nc(n,e){if(!xa(e,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Yl(i,n[o]);return i}function Vc(n){const e=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const o of i)Yl(e,o);return e}function $u(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Uc(n,e,i){if(!$u(n)||!$u(e))return NaN;let o=0,c=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(c=n[1]-e[3]),n[3]<e[1]&&(c=e[1]-n[3]),i.distance([0,0],[o,c])}function ba(n,e,i){const o=i.pointOnLine(e,n);return i.distance(n,o.point)}function Xu(n,e,i,o,c){const p=Math.min(ba(n,[i,o],c),ba(e,[i,o],c)),m=Math.min(ba(i,[n,e],c),ba(o,[n,e],c));return Math.min(p,m)}function Yu(n,e,i,o,c){if(!xa(e,n.length)||!xa(o,i.length))return 1/0;let p=1/0;for(let m=e[0];m<e[1];++m){const x=n[m],w=n[m+1];for(let C=o[0];C<o[1];++C){const z=i[C],L=i[C+1];if(Vu(x,w,z,L))return 0;p=Math.min(p,Xu(x,w,z,L,c))}}return p}function Gc(n,e,i,o,c){if(!xa(e,n.length)||!xa(o,i.length))return NaN;let p=1/0;for(let m=e[0];m<=e[1];++m)for(let x=o[0];x<=o[1];++x)if(p=Math.min(p,c.distance(n[m],i[x])),p===0)return p;return p}function pf(n,e,i){if(Ua(n,e,!0))return 0;let o=1/0;for(const c of e){const p=c[0],m=c[c.length-1];if(p!==m&&(o=Math.min(o,ba(n,[m,p],i)),o===0))return o;const x=i.pointOnLine(c,n);if(o=Math.min(o,i.distance(n,x.point)),o===0)return o}return o}function Jo(n,e,i,o){if(!xa(e,n.length))return NaN;for(let p=e[0];p<=e[1];++p)if(Ua(n[p],i,!0))return 0;let c=1/0;for(let p=e[0];p<e[1];++p){const m=n[p],x=n[p+1];for(const w of i)for(let C=0,z=w.length,L=z-1;C<z;L=C++){const B=w[L],F=w[C];if(Vu(m,x,B,F))return 0;c=Math.min(c,Xu(m,x,B,F,o))}}return c}function el(n,e){for(const i of n)for(const o of i)if(Ua(o,e,!0))return!0;return!1}function qh(n,e,i,o=1/0){const c=Vc(n),p=Vc(e);if(o!==1/0&&Uc(c,p,i)>=o)return o;if(go(c,p)){if(el(n,e))return 0}else if(el(e,n))return 0;let m=1/0;for(const x of n)for(let w=0,C=x.length,z=C-1;w<C;z=w++){const L=x[z],B=x[w];for(const F of e)for(let G=0,q=F.length,$=q-1;G<q;$=G++){const Q=F[$],ce=F[G];if(Vu(L,B,Q,ce))return 0;m=Math.min(m,Xu(L,B,Q,ce,i))}}return m}function _i(n,e,i,o,c,p){if(!p)return;const m=Uc(Nc(o,p),c,i);m<e&&n.push([m,p,[0,0]])}function ds(n,e,i,o,c,p,m){if(!p||!m)return;const x=Uc(Nc(o,p),Nc(c,m),i);x<e&&n.push([x,p,m])}function Wu(n,e,i,o,c=1/0){let p=Math.min(o.distance(n[0],i[0][0]),c);if(p===0)return p;const m=new Vh([[0,[0,n.length-1],[0,0]]],Fr),x=Vc(i);for(;m.length>0;){const w=m.pop();if(w[0]>=p)continue;const C=w[1],z=e?50:100;if(vo(C)<=z){if(!xa(C,n.length))return NaN;if(e){const L=Jo(n,C,i,o);if(isNaN(L)||L===0)return L;p=Math.min(p,L)}else for(let L=C[0];L<=C[1];++L){const B=pf(n[L],i,o);if(p=Math.min(p,B),p===0)return 0}}else{const L=Hu(C,e);_i(m,p,o,n,x,L[0]),_i(m,p,o,n,x,L[1])}}return p}function Ku(n,e,i,o,c,p=1/0){let m=Math.min(p,c.distance(n[0],i[0]));if(m===0)return m;const x=new Vh([[0,[0,n.length-1],[0,i.length-1]]],Fr);for(;x.length>0;){const w=x.pop();if(w[0]>=m)continue;const C=w[1],z=w[2],L=e?50:100,B=o?50:100;if(vo(C)<=L&&vo(z)<=B){if(!xa(C,n.length)&&xa(z,i.length))return NaN;let F;if(e&&o)F=Yu(n,C,i,z,c),m=Math.min(m,F);else if(e&&!o){const G=n.slice(C[0],C[1]+1);for(let q=z[0];q<=z[1];++q)if(F=ba(i[q],G,c),m=Math.min(m,F),m===0)return m}else if(!e&&o){const G=i.slice(z[0],z[1]+1);for(let q=C[0];q<=C[1];++q)if(F=ba(n[q],G,c),m=Math.min(m,F),m===0)return m}else F=Gc(n,C,i,z,c),m=Math.min(m,F)}else{const F=Hu(C,e),G=Hu(z,o);ds(x,m,c,n,i,F[0],G[0]),ds(x,m,c,n,i,F[0],G[1]),ds(x,m,c,n,i,F[1],G[0]),ds(x,m,c,n,i,F[1],G[1])}}return m}function qc(n){return n.type==="MultiPolygon"?n.coordinates.map((e=>({type:"Polygon",coordinates:e}))):n.type==="MultiLineString"?n.coordinates.map((e=>({type:"LineString",coordinates:e}))):n.type==="MultiPoint"?n.coordinates.map((e=>({type:"Point",coordinates:e}))):[n]}class tl{constructor(e,i){this.type=pt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(cs(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new tl(o,o.features.map((c=>qc(c.geometry))).flat());if(o.type==="Feature")return new tl(o,qc(o.geometry));if("type"in o&&"coordinates"in o)return new tl(o,qc(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const c=i.geometry(),p=c.flat().map((w=>Xl([w.x,w.y],i.canonical)));if(c.length===0)return NaN;const m=new Gh(p[0][1]);let x=1/0;for(const w of o){switch(w.type){case"Point":x=Math.min(x,Ku(p,!1,[w.coordinates],!1,m,x));break;case"LineString":x=Math.min(x,Ku(p,!1,w.coordinates,!0,m,x));break;case"Polygon":x=Math.min(x,Wu(p,!1,w.coordinates,m,x))}if(x===0)return x}return x})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const c=i.geometry(),p=c.flat().map((w=>Xl([w.x,w.y],i.canonical)));if(c.length===0)return NaN;const m=new Gh(p[0][1]);let x=1/0;for(const w of o){switch(w.type){case"Point":x=Math.min(x,Ku(p,!0,[w.coordinates],!1,m,x));break;case"LineString":x=Math.min(x,Ku(p,!0,w.coordinates,!0,m,x));break;case"Polygon":x=Math.min(x,Wu(p,!0,w.coordinates,m,x))}if(x===0)return x}return x})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(i,o){const c=i.geometry();if(c.length===0||c[0].length===0)return NaN;const p=qu(c,0).map((w=>w.map((C=>C.map((z=>Xl([z.x,z.y],i.canonical))))))),m=new Gh(p[0][0][0][1]);let x=1/0;for(const w of o)for(const C of p){switch(w.type){case"Point":x=Math.min(x,Wu([w.coordinates],!1,C,m,x));break;case"LineString":x=Math.min(x,Wu(w.coordinates,!0,C,m,x));break;case"Polygon":x=Math.min(x,qh(C,w.coordinates,m,x))}if(x===0)return x}return x})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Qu{constructor(e){this.type=Zt,this.key=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Qu(o)}evaluate(e){var i;const o=(i=e.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?Vl(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Kl={"==":rf,"!=":kc,">":kp,"<":af,">=":Bc,"<=":Gl,array:Dr,at:ni,boolean:Dr,case:Bu,coalesce:Ko,collator:ql,format:Nu,image:Zl,in:$t,"index-of":Wo,interpolate:zr,"interpolate-hcl":zr,"interpolate-lab":zr,length:Hl,let:Pi,literal:ea,match:di,number:Dr,"number-format":Nh,object:Dr,slice:va,step:mo,string:Dr,"to-boolean":Pr,"to-color":Pr,"to-number":Pr,"to-string":Pr,var:fo,within:yo,distance:tl,"global-state":Qu};class ta{constructor(e,i,o,c){this.name=e,this.type=i,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const o=e[0],c=ta.definitions[o];if(!c)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,x=m.filter((([C])=>!Array.isArray(C)||C.length===e.length-1));let w=null;for(const[C,z]of x){w=new Yo(i.registry,Rr,i.path,null,i.scope);const L=[];let B=!1;for(let F=1;F<e.length;F++){const G=e[F],q=Array.isArray(C)?C[F-1]:C.type,$=w.parse(G,1+L.length,q);if(!$){B=!0;break}L.push($)}if(!B)if(Array.isArray(C)&&C.length!==L.length)w.error(`Expected ${C.length} arguments, but found ${L.length} instead.`);else{for(let F=0;F<L.length;F++){const G=Array.isArray(C)?C[F]:C.type,q=L[F];w.concat(F+1).checkSubtype(G,q.type)}if(w.errors.length===0)return new ta(o,p,z,L)}}if(x.length===1)i.errors.push(...w.errors);else{const C=(x.length?x:m).map((([L])=>{return B=L,Array.isArray(B)?`(${B.map(hi).join(", ")})`:`(${hi(B.type)}...)`;var B})).join(" | "),z=[];for(let L=1;L<e.length;L++){const B=i.parse(e[L],1+z.length);if(!B)return null;z.push(hi(B.type))}i.error(`Expected arguments of type ${C}, but found (${z.join(", ")}) instead.`)}return null}static register(e,i){ta.definitions=i;for(const o in i)e[o]=ta}}function Zh(n,[e,i,o,c]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const p=c?c.evaluate(n):1,m=Jr(e,i,o,p);if(m)throw new Fi(m);return new Qt(e/255,i/255,o/255,p,!1)}function Zc(n,e){return n in e}function ia(n,e){const i=e[n];return i===void 0?null:i}function fs(n){return{type:n}}function Rr(n){if(n instanceof fo)return Rr(n.boundExpression);if(n instanceof ta&&n.name==="error"||n instanceof ql||n instanceof yo||n instanceof tl||n instanceof Qu)return!1;const e=n instanceof Pr||n instanceof Dr;let i=!0;return n.eachChild((o=>{i=e?i&&Rr(o):i&&o instanceof ea})),!!i&&js(n)&&nl(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function js(n){if(n instanceof ta&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof yo||n instanceof tl)return!1;let e=!0;return n.eachChild((i=>{e&&!js(i)&&(e=!1)})),e}function il(n){if(n instanceof ta&&n.name==="feature-state")return!1;let e=!0;return n.eachChild((i=>{e&&!il(i)&&(e=!1)})),e}function nl(n,e){if(n instanceof ta&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild((o=>{i&&!nl(o,e)&&(i=!1)})),i}function Ju(n){return{result:"success",value:n}}function xo(n){return{result:"error",value:n}}function wa(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Hh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Ql(n){return!!n.expression&&n.expression.interpolated}function Kt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Hc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Ji(n)===as}function na(n){return n}function $c(n,e){const i=n.stops&&typeof n.stops[0][0]=="object",o=i||!(i||n.property!==void 0),c=n.type||(Ql(e)?"exponential":"interval"),p=(function(z){switch(z.type){case"color":return Qt.parse;case"padding":return Pn.parse;case"numberArray":return Qi.parse;case"colorArray":return jt.parse;default:return null}})(e);if(p&&((n=gr({},n)).stops&&(n.stops=n.stops.map((z=>[z[0],p(z[1])]))),n.default=p(n.default?n.default:e.default)),n.colorSpace&&(m=n.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var m;const x=(function(z){switch(z){case"exponential":return bo;case"interval":return Xc;case"categorical":return mf;case"identity":return $h;default:throw new Error(`Unknown function type "${z}"`)}})(c);let w,C;if(c==="categorical"){w=Object.create(null);for(const z of n.stops)w[z[0]]=z[1];C=typeof n.stops[0][0]}if(i){const z={},L=[];for(let G=0;G<n.stops.length;G++){const q=n.stops[G],$=q[0].zoom;z[$]===void 0&&(z[$]={zoom:$,type:n.type,property:n.property,default:n.default,stops:[]},L.push($)),z[$].stops.push([q[0].value,q[1]])}const B=[];for(const G of L)B.push([z[G].zoom,$c(z[G],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:zr.interpolationFactor.bind(void 0,F),zoomStops:B.map((G=>G[0])),evaluate:({zoom:G},q)=>bo({stops:B,base:n.base},e,G).evaluate(G,q)}}if(o){const z=c==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:zr.interpolationFactor.bind(void 0,z),zoomStops:n.stops.map((L=>L[0])),evaluate:({zoom:L})=>x(n,e,L,w,C)}}return{kind:"source",evaluate(z,L){const B=L&&L.properties?L.properties[n.property]:void 0;return B===void 0?ra(n.default,e.default):x(n,e,B,w,C)}}}function ra(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function mf(n,e,i,o,c){return ra(typeof i===c?o[i]:void 0,n.default,e.default)}function Xc(n,e,i){if(Kt(i)!=="number")return ra(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const c=po(n.stops.map((p=>p[0])),i);return n.stops[c][1]}function bo(n,e,i){const o=n.base!==void 0?n.base:1;if(Kt(i)!=="number")return ra(n.default,e.default);const c=n.stops.length;if(c===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[c-1][0])return n.stops[c-1][1];const p=po(n.stops.map((z=>z[0])),i),m=(function(z,L,B,F){const G=F-B,q=z-B;return G===0?0:L===1?q/G:(Math.pow(L,q)-1)/(Math.pow(L,G)-1)})(i,o,n.stops[p][0],n.stops[p+1][0]),x=n.stops[p][1],w=n.stops[p+1][1],C=en[e.type]||na;return typeof x.evaluate=="function"?{evaluate(...z){const L=x.evaluate.apply(void 0,z),B=w.evaluate.apply(void 0,z);if(L!==void 0&&B!==void 0)return C(L,B,m,n.colorSpace)}}:C(x,w,m,n.colorSpace)}function $h(n,e,i){switch(e.type){case"color":i=Qt.parse(i);break;case"formatted":i=Gn.fromString(i.toString());break;case"resolvedImage":i=Cr.fromString(i.toString());break;case"padding":i=Pn.parse(i);break;case"colorArray":i=jt.parse(i);break;case"numberArray":i=Qi.parse(i);break;default:Kt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return ra(i,n.default,e.default)}ta.register(Kl,{error:[{kind:"error"},[Ht],(n,[e])=>{throw new Fi(e.evaluate(n))}],typeof:[Ht,[Zt],(n,[e])=>hi(Ji(e.evaluate(n)))],"to-rgba":[_r(pt,4),[Qr],(n,[e])=>{const[i,o,c,p]=e.evaluate(n).rgb;return[255*i,255*o,255*c,p]}],rgb:[Qr,[pt,pt,pt],Zh],rgba:[Qr,[pt,pt,pt,pt],Zh],has:{type:Jt,overloads:[[[Ht],(n,[e])=>Zc(e.evaluate(n),n.properties())],[[Ht,as],(n,[e,i])=>Zc(e.evaluate(n),i.evaluate(n))]]},get:{type:Zt,overloads:[[[Ht],(n,[e])=>ia(e.evaluate(n),n.properties())],[[Ht,as],(n,[e,i])=>ia(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Zt,[Ht],(n,[e])=>ia(e.evaluate(n),n.featureState||{})],properties:[as,[],n=>n.properties()],"geometry-type":[Ht,[],n=>n.geometryType()],id:[Zt,[],n=>n.id()],zoom:[pt,[],n=>n.globals.zoom],"heatmap-density":[pt,[],n=>n.globals.heatmapDensity||0],elevation:[pt,[],n=>n.globals.elevation||0],"line-progress":[pt,[],n=>n.globals.lineProgress||0],accumulated:[Zt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[pt,fs(pt),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[pt,fs(pt),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:pt,overloads:[[[pt,pt],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[pt],(n,[e])=>-e.evaluate(n)]]},"/":[pt,[pt,pt],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[pt,[pt,pt],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[pt,[],()=>Math.LN2],pi:[pt,[],()=>Math.PI],e:[pt,[],()=>Math.E],"^":[pt,[pt,pt],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[pt,[pt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[pt,[pt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[pt,[pt],(n,[e])=>Math.log(e.evaluate(n))],log2:[pt,[pt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[pt,[pt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[pt,[pt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[pt,[pt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[pt,[pt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[pt,[pt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[pt,[pt],(n,[e])=>Math.atan(e.evaluate(n))],min:[pt,fs(pt),(n,e)=>Math.min(...e.map((i=>i.evaluate(n))))],max:[pt,fs(pt),(n,e)=>Math.max(...e.map((i=>i.evaluate(n))))],abs:[pt,[pt],(n,[e])=>Math.abs(e.evaluate(n))],round:[pt,[pt],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[pt,[pt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[pt,[pt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Jt,[Ht,Zt],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Jt,[Zt],(n,[e])=>n.id()===e.value],"filter-type-==":[Jt,[Ht],(n,[e])=>n.geometryType()===e.value],"filter-<":[Jt,[Ht,Zt],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Jt,[Zt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Jt,[Ht,Zt],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o>c}],"filter-id->":[Jt,[Zt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Jt,[Ht,Zt],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Jt,[Zt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Jt,[Ht,Zt],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Jt,[Zt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Jt,[Zt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Jt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Jt,[_r(Ht)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Jt,[_r(Zt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Jt,[Ht,_r(Zt)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Jt,[Ht,_r(Zt)],(n,[e,i])=>(function(o,c,p,m){for(;p<=m;){const x=p+m>>1;if(c[x]===o)return!0;c[x]>o?m=x-1:p=x+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[fs(Jt),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[fs(Jt),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Jt,[Jt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Jt,[Ht],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Ht,[Ht],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Ht,[Ht],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Ht,fs(Zt),(n,e)=>e.map((i=>ho(i.evaluate(n)))).join("")],"resolved-locale":[Ht,[Go],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Yc{constructor(e,i,o){this.expression=e,this._warningHistory={},this._evaluator=new Xo,this._defaultValue=i?(function(c){if(c.type==="color"&&Hc(c.default))return new Qt(0,0,0,0);switch(c.type){case"color":return Qt.parse(c.default)||null;case"padding":return Pn.parse(c.default)||null;case"numberArray":return Qi.parse(c.default)||null;case"colorArray":return jt.parse(c.default)||null;case"variableAnchorOffsetCollection":return pn.parse(c.default)||null;case"projectionDefinition":return qn.parse(c.default)||null;default:return c.default===void 0?null:c.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,i,o,c,p,m){return this._globalState&&(e=Kn(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,c,p,m){this._globalState&&(e=Kn(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map((w=>JSON.stringify(w))).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function wo(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Kl}function Jl(n,e,i){const o=new Yo(Kl,Rr,[],e?(function(p){const m={color:Qr,string:Ht,number:pt,enum:Ht,boolean:Jt,formatted:ss,padding:Bs,numberArray:ls,colorArray:os,projectionDefinition:Rc,resolvedImage:fn,variableAnchorOffsetCollection:Fl};return p.type==="array"?_r(m[p.value]||Zt,p.length):m[p.type]})(e):void 0),c=o.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Ju(new Yc(c,e,i)):xo(o.errors)}class Ir{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!il(i.expression),this.globalStateRefs=Zn(i.expression),this._globalState=o}evaluateWithoutErrorHandling(e,i,o,c,p,m){return this._globalState&&(e=Kn(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,p,m)}evaluate(e,i,o,c,p,m){return this._globalState&&(e=Kn(e,this._globalState)),this._styleExpression.evaluate(e,i,o,c,p,m)}}class To{constructor(e,i,o,c,p){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!il(i.expression),this.globalStateRefs=Zn(i.expression),this.interpolationType=c,this._globalState=p}evaluateWithoutErrorHandling(e,i,o,c,p,m){return this._globalState&&(e=Kn(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,p,m)}evaluate(e,i,o,c,p,m){return this._globalState&&(e=Kn(e,this._globalState)),this._styleExpression.evaluate(e,i,o,c,p,m)}interpolationFactor(e,i,o){return this.interpolationType?zr.interpolationFactor(this.interpolationType,e,i,o):0}}function So(n,e,i){const o=Jl(n,e,i);if(o.result==="error")return o;const c=o.value.expression,p=js(c);if(!p&&!wa(e))return xo([new yr("","data expressions not supported")]);const m=nl(c,["zoom"]);if(!m&&!Hh(e))return xo([new yr("","zoom expressions not supported")]);const x=Mo(c);return x||m?x instanceof yr?xo([x]):x instanceof zr&&!Ql(e)?xo([new yr("",'"interpolate" expressions cannot be used with this property')]):Ju(x?new To(p?"camera":"composite",o.value,x.labels,x instanceof zr?x.interpolation:void 0,i):new Ir(p?"constant":"source",o.value,i)):xo([new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rl{constructor(e,i){this._parameters=e,this._specification=i,gr(this,$c(this._parameters,this._specification))}static deserialize(e){return new rl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Mo(n){let e=null;if(n instanceof Pi)e=Mo(n.result);else if(n instanceof Ko){for(const i of n.args)if(e=Mo(i),e)break}else(n instanceof mo||n instanceof zr)&&n.input instanceof ta&&n.input.name==="zoom"&&(e=n);return e instanceof yr||n.eachChild((i=>{const o=Mo(i);o instanceof yr?e=o:!e&&o?e=new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new yr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Zn(n,e=new Set){return n instanceof Qu&&e.add(n.key),n.eachChild((i=>{Zn(i,e)})),e}function Kn(n,e){const{zoom:i,heatmapDensity:o,elevation:c,lineProgress:p,isSupportedScript:m,accumulated:x}=n??{};return{zoom:i,heatmapDensity:o,elevation:c,lineProgress:p,isSupportedScript:m,accumulated:x,globalState:e}}function ps(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!ps(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const ms={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function jr(n,e){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ps(n)||(n=al(n));const i=Jl(n,ms,e);if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,c,p)=>i.value.evaluate(o,c,{},p),needGeometry:Xh(n),getGlobalStateRefs:()=>Zn(i.value.expression)}}function Ns(n,e){return n<e?-1:n>e?1:0}function Xh(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Xh(n[e]))return!0;return!1}function al(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?eu(n[1],n[2],"=="):e==="!="?ji(eu(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?eu(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(al))):e==="all"?["all"].concat(n.slice(1).map(al)):e==="none"?["all"].concat(n.slice(1).map(al).map(ji)):e==="in"?Yh(n[1],n.slice(2)):e==="!in"?ji(Yh(n[1],n.slice(2))):e==="has"?Qn(n[1]):e!=="!has"||ji(Qn(n[1]));var i}function eu(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Yh(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",n,["literal",e.sort(Ns)]]:["filter-in-small",n,["literal",e]]}}function Qn(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ji(n){return["!",n]}function ui(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let c="[";for(const p of n)c+=`${ui(p)},`;return`${c}]`}const i=Object.keys(n).sort();let o="{";for(let c=0;c<i.length;c++)o+=`${JSON.stringify(i[c])}:${ui(n[i[c]])},`;return`${o}}`}function Vs(n){let e="";for(const i of Si)e+=`/${ui(n[i])}`;return e}function aa(n){const e=n.value;return e?[new ut(n.key,e,"constants have been deprecated as of v8")]:[]}function on(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Nr(n){if(Array.isArray(n))return n.map(Nr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Nr(n[i]);return e}return on(n)}function Vr(n){const e=n.key,i=n.value,o=n.valueSpec||{},c=n.objectElementValidators||{},p=n.style,m=n.styleSpec,x=n.validateSpec;let w=[];const C=Kt(i);if(C!=="object")return[new ut(e,i,`object expected, ${C} found`)];for(const z in i){const L=z.split(".")[0],B=Vl(o,L)||o["*"];let F;if(Vl(c,L))F=c[L];else if(Vl(o,L)){if(i[z]===void 0)continue;F=x}else if(c["*"])F=c["*"];else{if(!o["*"]){w.push(new ut(e,i[z],`unknown property "${z}"`));continue}F=x}w=w.concat(F({key:(e&&`${e}.`)+z,value:i[z],valueSpec:B,style:p,styleSpec:m,object:i,objectKey:z,validateSpec:x},i))}for(const z in o)c[z]||o[z].required&&o[z].default===void 0&&i[z]===void 0&&w.push(new ut(e,i,`missing required property "${z}"`));return w}function ec(n){const e=n.value,i=n.valueSpec,o=n.style,c=n.styleSpec,p=n.key,m=n.arrayElementValidator||n.validateSpec;if(Kt(e)!=="array")return[new ut(p,e,`array expected, ${Kt(e)} found`)];if(i.length&&e.length!==i.length)return[new ut(p,e,`array length ${i.length} expected, length ${e.length} found`)];let x={type:i.value,values:i.values};c.$version<7&&(x.function=i.function),Kt(i.value)==="object"&&(x=i.value);let w=[];for(let C=0;C<e.length;C++)w=w.concat(m({array:e,arrayIndex:C,value:e[C],valueSpec:x,validateSpec:n.validateSpec,style:o,styleSpec:c,key:`${p}[${C}]`}));return w}function gs(n){const e=n.key,i=n.value,o=n.valueSpec;let c=Kt(i);return c==="number"&&i!=i&&(c="NaN"),c!=="number"?[new ut(e,i,`number expected, ${c} found`)]:"minimum"in o&&i<o.minimum?[new ut(e,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new ut(e,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function ys(n){const e=n.valueSpec,i=on(n.value.type);let o,c,p,m={};const x=i!=="categorical"&&n.value.property===void 0,w=!x,C=Kt(n.value.stops)==="array"&&Kt(n.value.stops[0])==="array"&&Kt(n.value.stops[0][0])==="object",z=Vr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(F){if(i==="identity")return[new ut(F.key,F.value,'identity function may not have a "stops" property')];let G=[];const q=F.value;return G=G.concat(ec({key:F.key,value:q,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:L})),Kt(q)==="array"&&q.length===0&&G.push(new ut(F.key,q,"array must have at least one stop")),G},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return i==="identity"&&x&&z.push(new ut(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||z.push(new ut(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!Ql(n.valueSpec)&&z.push(new ut(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(w&&!wa(n.valueSpec)?z.push(new ut(n.key,n.value,"property functions not supported")):x&&!Hh(n.valueSpec)&&z.push(new ut(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!C||n.value.property!==void 0||z.push(new ut(n.key,n.value,'"property" property is required')),z;function L(F){let G=[];const q=F.value,$=F.key;if(Kt(q)!=="array")return[new ut($,q,`array expected, ${Kt(q)} found`)];if(q.length!==2)return[new ut($,q,`array length 2 expected, length ${q.length} found`)];if(C){if(Kt(q[0])!=="object")return[new ut($,q,`object expected, ${Kt(q[0])} found`)];if(q[0].zoom===void 0)return[new ut($,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new ut($,q,"object stop key must have value")];if(p&&p>on(q[0].zoom))return[new ut($,q[0].zoom,"stop zoom values must appear in ascending order")];on(q[0].zoom)!==p&&(p=on(q[0].zoom),c=void 0,m={}),G=G.concat(Vr({key:`${$}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:gs,value:B}}))}else G=G.concat(B({key:`${$}[0]`,value:q[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},q));return wo(Nr(q[1]))?G.concat([new ut(`${$}[1]`,q[1],"expressions are not allowed in function stops.")]):G.concat(F.validateSpec({key:`${$}[1]`,value:q[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function B(F,G){const q=Kt(F.value),$=on(F.value),Q=F.value!==null?F.value:G;if(o){if(q!==o)return[new ut(F.key,Q,`${q} stop domain type must match previous stop domain type ${o}`)]}else o=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new ut(F.key,Q,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&i!=="categorical"){let ce=`number expected, ${q} found`;return wa(e)&&i===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ut(F.key,Q,ce)]}return i!=="categorical"||q!=="number"||isFinite($)&&Math.floor($)===$?i!=="categorical"&&q==="number"&&c!==void 0&&$<c?[new ut(F.key,Q,"stop domain values must appear in ascending order")]:(c=$,i==="categorical"&&$ in m?[new ut(F.key,Q,"stop domain values must be unique")]:(m[$]=!0,[])):[new ut(F.key,Q,`integer expected, found ${$}`)]}}function _s(n){const e=(n.expressionContext==="property"?So:Jl)(Nr(n.value),n.valueSpec);if(e.result==="error")return e.value.map((o=>new ut(`${n.key}${o.key}`,n.value,o.message)));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new ut(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!il(i))return[new ut(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!il(i))return[new ut(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!nl(i,["zoom","feature-state"]))return[new ut(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!js(i))return[new ut(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Us(n){const e=n.key,i=n.value,o=Kt(i);return o!=="string"?[new ut(e,i,`color expected, ${o} found`)]:Qt.parse(String(i))?[]:[new ut(e,i,`color expected, "${i}" found`)]}function Gs(n){const e=n.key,i=n.value,o=n.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(on(i))===-1&&c.push(new ut(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(on(i))===-1&&c.push(new ut(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function Ta(n){return ps(Nr(n.value))?_s(gr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):vs(n)}function vs(n){const e=n.value,i=n.key;if(Kt(e)!=="array")return[new ut(i,e,`array expected, ${Kt(e)} found`)];const o=n.styleSpec;let c,p=[];if(e.length<1)return[new ut(i,e,"filter array must have at least 1 element")];switch(p=p.concat(Gs({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),on(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&on(e[1])==="$type"&&p.push(new ut(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new ut(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Kt(e[1]),c!=="string"&&p.push(new ut(`${i}[1]`,e[1],`string expected, ${c} found`)));for(let m=2;m<e.length;m++)c=Kt(e[m]),on(e[1])==="$type"?p=p.concat(Gs({key:`${i}[${m}]`,value:e[m],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&p.push(new ut(`${i}[${m}]`,e[m],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)p=p.concat(vs({key:`${i}[${m}]`,value:e[m],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":c=Kt(e[1]),e.length!==2?p.push(new ut(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&p.push(new ut(`${i}[1]`,e[1],`string expected, ${c} found`))}return p}function qs(n,e){const i=n.key,o=n.validateSpec,c=n.style,p=n.styleSpec,m=n.value,x=n.objectKey,w=p[`${e}_${n.layerType}`];if(!w)return[];const C=x.match(/^(.*)-transition$/);if(e==="paint"&&C&&w[C[1]]&&w[C[1]].transition)return o({key:i,value:m,valueSpec:p.transition,style:c,styleSpec:p});const z=n.valueSpec||w[x];if(!z)return[new ut(i,m,`unknown property "${x}"`)];let L;if(Kt(m)==="string"&&wa(z)&&!z.tokens&&(L=/^{([^}]+)}$/.exec(m)))return[new ut(i,m,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const B=[];return n.layerType==="symbol"&&x==="text-font"&&Hc(Nr(m))&&on(m.type)==="identity"&&B.push(new ut(i,m,'"text-font" does not support identity functions')),B.concat(o({key:n.key,value:m,valueSpec:z,style:c,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:x}))}function xs(n){return qs(n,"paint")}function Wc(n){return qs(n,"layout")}function Kc(n){let e=[];const i=n.value,o=n.key,c=n.style,p=n.styleSpec;if(Kt(i)!=="object")return[new ut(o,i,`object expected, ${Kt(i)} found`)];i.type||i.ref||e.push(new ut(o,i,'either "type" or "ref" is required'));let m=on(i.type);const x=on(i.ref);if(i.id){const w=on(i.id);for(let C=0;C<n.arrayIndex;C++){const z=c.layers[C];on(z.id)===w&&e.push(new ut(o,i.id,`duplicate layer id "${i.id}", previously used at line ${z.id.__line__}`))}}if("ref"in i){let w;["type","source","source-layer","filter","layout"].forEach((C=>{C in i&&e.push(new ut(o,i[C],`"${C}" is prohibited for ref layers`))})),c.layers.forEach((C=>{on(C.id)===x&&(w=C)})),w?w.ref?e.push(new ut(o,i.ref,"ref cannot reference another ref layer")):m=on(w.type):e.push(new ut(o,i.ref,`ref layer "${x}" not found`))}else if(m!=="background")if(i.source){const w=c.sources&&c.sources[i.source],C=w&&on(w.type);w?C==="vector"&&m==="raster"?e.push(new ut(o,i.source,`layer "${i.id}" requires a raster source`)):C!=="raster-dem"&&m==="hillshade"||C!=="raster-dem"&&m==="color-relief"?e.push(new ut(o,i.source,`layer "${i.id}" requires a raster-dem source`)):C==="raster"&&m!=="raster"?e.push(new ut(o,i.source,`layer "${i.id}" requires a vector source`)):C!=="vector"||i["source-layer"]?C==="raster-dem"&&m!=="hillshade"&&m!=="color-relief"?e.push(new ut(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):m!=="line"||!i.paint||!i.paint["line-gradient"]||C==="geojson"&&w.lineMetrics||e.push(new ut(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ut(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new ut(o,i.source,`source "${i.source}" not found`))}else e.push(new ut(o,i,'missing required property "source"'));return e=e.concat(Vr({key:o,value:i,valueSpec:p.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:i.type,valueSpec:p.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:Ta,layout:w=>Vr({layer:i,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":C=>Wc(gr({layerType:m},C))}}),paint:w=>Vr({layer:i,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":C=>xs(gr({layerType:m},C))}})}})),e}function sa(n){const e=n.value,i=n.key,o=Kt(e);return o!=="string"?[new ut(i,e,`string expected, ${o} found`)]:[]}const tu={promoteId:function({key:n,value:e}){if(Kt(e)==="string")return sa({key:n,value:e});{const i=[];for(const o in e)i.push(...sa({key:`${n}.${o}`,value:e[o]}));return i}}};function Zs(n){const e=n.value,i=n.key,o=n.styleSpec,c=n.style,p=n.validateSpec;if(!e.type)return[new ut(i,e,'"type" is required')];const m=on(e.type);let x;switch(m){case"vector":case"raster":return x=Vr({key:i,value:e,valueSpec:o[`source_${m.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:tu,validateSpec:p}),x;case"raster-dem":return x=(function(w){var C;const z=(C=w.sourceName)!==null&&C!==void 0?C:"",L=w.value,B=w.styleSpec,F=B.source_raster_dem,G=w.style;let q=[];const $=Kt(L);if(L===void 0)return q;if($!=="object")return q.push(new ut("source_raster_dem",L,`object expected, ${$} found`)),q;const Q=on(L.encoding)==="custom",ce=["redFactor","greenFactor","blueFactor","baseShift"],J=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const ne in L)!Q&&ce.includes(ne)?q.push(new ut(ne,L[ne],`In "${z}": "${ne}" is only valid when "encoding" is set to "custom". ${J} encoding found`)):F[ne]?q=q.concat(w.validateSpec({key:ne,value:L[ne],valueSpec:F[ne],validateSpec:w.validateSpec,style:G,styleSpec:B})):q.push(new ut(ne,L[ne],`unknown property "${ne}"`));return q})({sourceName:i,value:e,style:n.style,styleSpec:o,validateSpec:p}),x;case"geojson":if(x=Vr({key:i,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:p,objectElementValidators:tu}),e.cluster)for(const w in e.clusterProperties){const[C,z]=e.clusterProperties[w],L=typeof C=="string"?[C,["accumulated"],["get",w]]:C;x.push(..._s({key:`${i}.${w}.map`,value:z,expressionContext:"cluster-map"})),x.push(..._s({key:`${i}.${w}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return x;case"video":return Vr({key:i,value:e,valueSpec:o.source_video,style:c,validateSpec:p,styleSpec:o});case"image":return Vr({key:i,value:e,valueSpec:o.source_image,style:c,validateSpec:p,styleSpec:o});case"canvas":return[new ut(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gs({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function zn(n){const e=n.value,i=n.styleSpec,o=i.light,c=n.style;let p=[];const m=Kt(e);if(e===void 0)return p;if(m!=="object")return p=p.concat([new ut("light",e,`object expected, ${m} found`)]),p;for(const x in e){const w=x.match(/^(.*)-transition$/);p=p.concat(w&&o[w[1]]&&o[w[1]].transition?n.validateSpec({key:x,value:e[x],valueSpec:i.transition,validateSpec:n.validateSpec,style:c,styleSpec:i}):o[x]?n.validateSpec({key:x,value:e[x],valueSpec:o[x],validateSpec:n.validateSpec,style:c,styleSpec:i}):[new ut(x,e[x],`unknown property "${x}"`)])}return p}function tc(n){const e=n.value,i=n.styleSpec,o=i.sky,c=n.style,p=Kt(e);if(e===void 0)return[];if(p!=="object")return[new ut("sky",e,`object expected, ${p} found`)];let m=[];for(const x in e)m=m.concat(o[x]?n.validateSpec({key:x,value:e[x],valueSpec:o[x],style:c,styleSpec:i}):[new ut(x,e[x],`unknown property "${x}"`)]);return m}function Qc(n){const e=n.value,i=n.styleSpec,o=i.terrain,c=n.style;let p=[];const m=Kt(e);if(e===void 0)return p;if(m!=="object")return p=p.concat([new ut("terrain",e,`object expected, ${m} found`)]),p;for(const x in e)p=p.concat(o[x]?n.validateSpec({key:x,value:e[x],valueSpec:o[x],validateSpec:n.validateSpec,style:c,styleSpec:i}):[new ut(x,e[x],`unknown property "${x}"`)]);return p}function Wh(n){let e=[];const i=n.value,o=n.key;if(Array.isArray(i)){const c=[],p=[];for(const m in i)i[m].id&&c.includes(i[m].id)&&e.push(new ut(o,i,`all the sprites' ids must be unique, but ${i[m].id} is duplicated`)),c.push(i[m].id),i[m].url&&p.includes(i[m].url)&&e.push(new ut(o,i,`all the sprites' URLs must be unique, but ${i[m].url} is duplicated`)),p.push(i[m].url),e=e.concat(Vr({key:`${o}[${m}]`,value:i[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return sa({key:o,value:i})}function gf(n){return!!n&&n.constructor===Object}function Kh(n){return gf(n.value)?[]:[new ut(n.key,n.value,`object expected, ${Kt(n.value)} found`)]}const Sn={"*":()=>[],array:ec,boolean:function(n){const e=n.value,i=n.key,o=Kt(e);return o!=="boolean"?[new ut(i,e,`boolean expected, ${o} found`)]:[]},number:gs,color:Us,constants:aa,enum:Gs,filter:Ta,function:ys,layer:Kc,object:Vr,source:Zs,light:zn,sky:tc,terrain:Qc,projection:function(n){const e=n.value,i=n.styleSpec,o=i.projection,c=n.style,p=Kt(e);if(e===void 0)return[];if(p!=="object")return[new ut("projection",e,`object expected, ${p} found`)];let m=[];for(const x in e)m=m.concat(o[x]?n.validateSpec({key:x,value:e[x],valueSpec:o[x],style:c,styleSpec:i}):[new ut(x,e[x],`unknown property "${x}"`)]);return m},projectionDefinition:function(n){const e=n.key;let i=n.value;i=i instanceof String?i.valueOf():i;const o=Kt(i);return o!=="array"||(function(c){return Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"})(i)||(function(c){return!!["interpolate","step","literal"].includes(c[0])})(i)?["array","string"].includes(o)?[]:[new ut(e,i,`projection expected, invalid type "${o}" found`)]:[new ut(e,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:sa,formatted:function(n){return sa(n).length===0?[]:_s(n)},resolvedImage:function(n){return sa(n).length===0?[]:_s(n)},padding:function(n){const e=n.key,i=n.value;if(Kt(i)==="array"){if(i.length<1||i.length>4)return[new ut(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let c=[];for(let p=0;p<i.length;p++)c=c.concat(n.validateSpec({key:`${e}[${p}]`,value:i[p],validateSpec:n.validateSpec,valueSpec:o}));return c}return gs({key:e,value:i,valueSpec:{}})},numberArray:function(n){const e=n.key,i=n.value;if(Kt(i)==="array"){const o={type:"number"};if(i.length<1)return[new ut(e,i,"array length at least 1 expected, length 0 found")];let c=[];for(let p=0;p<i.length;p++)c=c.concat(n.validateSpec({key:`${e}[${p}]`,value:i[p],validateSpec:n.validateSpec,valueSpec:o}));return c}return gs({key:e,value:i,valueSpec:{}})},colorArray:function(n){const e=n.key,i=n.value;if(Kt(i)==="array"){if(i.length<1)return[new ut(e,i,"array length at least 1 expected, length 0 found")];let o=[];for(let c=0;c<i.length;c++)o=o.concat(Us({key:`${e}[${c}]`,value:i[c]}));return o}return Us({key:e,value:i})},variableAnchorOffsetCollection:function(n){const e=n.key,i=n.value,o=Kt(i),c=n.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new ut(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let m=0;m<i.length;m+=2)p=p.concat(Gs({key:`${e}[${m}]`,value:i[m],valueSpec:c.layout_symbol["text-anchor"]})),p=p.concat(ec({key:`${e}[${m+1}]`,value:i[m+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:c}));return p},sprite:Wh,state:Kh,fontFaces:function(n){const e=n.key,i=n.value,o=n.validateSpec,c=n.styleSpec,p=n.style;if(!gf(i))return[new ut(e,i,`object expected, ${Kt(i)} found`)];const m=[];for(const x in i){const w=i[x],C=Kt(w);if(C==="string")m.push(...sa({key:`${e}.${x}`,value:w}));else if(C==="array"){const z={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[L,B]of w.entries())m.push(...Vr({key:`${e}.${x}[${L}]`,value:B,valueSpec:z,styleSpec:c,style:p,validateSpec:o}))}else m.push(new ut(`${e}.${x}`,w,`string or array expected, ${C} found`))}return m}};function bs(n){const e=n.value,i=n.valueSpec,o=n.styleSpec;return n.validateSpec=bs,i.expression&&Hc(on(e))?ys(n):i.expression&&wo(Nr(e))?_s(n):i.type&&Sn[i.type]?Sn[i.type](n):Vr(gr({},n,{valueSpec:i.type?o[i.type]:i}))}function iu(n){const e=n.value,i=n.key,o=sa(n);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new ut(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new ut(i,e,'"glyphs" url must include a "{range}" token'))),o}function vr(n,e=Ie){let i=[];return i=i.concat(bs({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:bs,objectElementValidators:{glyphs:iu,"*":()=>[]}})),n.constants&&(i=i.concat(aa({key:"constants",value:n.constants}))),sl(i)}function oa(n){return function(e){return n(Object.assign({},e,{validateSpec:bs}))}}function sl(n){return[].concat(n).sort(((e,i)=>e.line-i.line))}function xr(n){return function(...e){return sl(n.apply(this,e))}}vr.source=xr(oa(Zs)),vr.sprite=xr(oa(Wh)),vr.glyphs=xr(oa(iu)),vr.light=xr(oa(zn)),vr.sky=xr(oa(tc)),vr.terrain=xr(oa(Qc)),vr.state=xr(oa(Kh)),vr.layer=xr(oa(Kc)),vr.filter=xr(oa(Ta)),vr.paintProperty=xr(oa(xs)),vr.layoutProperty=xr(oa(Wc));const Op={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class nu{constructor(e,i){this._globalState=i,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const i=Jl(e,Op,this._globalState);if(i.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=i.value,this._globalStateRefs=Zn(i.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const ic=Ie,Hn=vr,Ga=Hn.light,Jc=Hn.sky,eh=Hn.paintProperty,yf=Hn.layoutProperty;function qa(n,e){let i=!1;if(e&&e.length)for(const o of e)n.fire(new bi(new Error(o.message))),i=!0;return i}class Eo{constructor(e,i,o){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const m=new Int32Array(this.arrayBuffer);e=m[0],this.d=(i=m[1])+2*(o=m[2]);for(let w=0;w<this.d*this.d;w++){const C=m[3+w],z=m[3+w+1];c.push(C===z?null:m.subarray(C,z))}const x=m[3+c.length+1];this.keys=m.subarray(m[3+c.length],x),this.bboxes=m.subarray(x),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let m=0;m<this.d*this.d;m++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=o,this.scale=i/e,this.uid=0;const p=o/i*e;this.min=-p,this.max=e+p}insert(e,i,o,c,p){this._forEachCell(i,o,c,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,o,c,p,m){this.cells[p].push(m)}query(e,i,o,c,p){const m=this.min,x=this.max;if(e<=m&&i<=m&&x<=o&&x<=c&&!p)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(e,i,o,c,this._queryCell,w,{},p),w}}_queryCell(e,i,o,c,p,m,x,w){const C=this.cells[p];if(C!==null){const z=this.keys,L=this.bboxes;for(let B=0;B<C.length;B++){const F=C[B];if(x[F]===void 0){const G=4*F;(w?w(L[G+0],L[G+1],L[G+2],L[G+3]):e<=L[G+2]&&i<=L[G+3]&&o>=L[G+0]&&c>=L[G+1])?(x[F]=!0,m.push(z[F])):x[F]=!1}}}}_forEachCell(e,i,o,c,p,m,x,w){const C=this._convertToCellCoord(e),z=this._convertToCellCoord(i),L=this._convertToCellCoord(o),B=this._convertToCellCoord(c);for(let F=C;F<=L;F++)for(let G=z;G<=B;G++){const q=this.d*G+F;if((!w||w(this._convertFromCellCoord(F),this._convertFromCellCoord(G),this._convertFromCellCoord(F+1),this._convertFromCellCoord(G+1)))&&p.call(this,e,i,o,c,q,m,x,w))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let o=0;for(let m=0;m<this.cells.length;m++)o+=this.cells[m].length;const c=new Int32Array(i+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let p=i;for(let m=0;m<e.length;m++){const x=e[m];c[3+m]=p,c.set(x,p),p+=x.length}return c[3+e.length]=p,c.set(this.keys,p),p+=this.keys.length,c[3+e.length+1]=p,c.set(this.bboxes,p),p+=this.bboxes.length,c.buffer}static serialize(e,i){const o=e.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(e){return new Eo(e.buffer)}}const Ur={};function xt(n,e,i={}){if(Ur[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),Ur[n]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}xt("Object",Object),xt("Set",Set),xt("TransferableGridIndex",Eo),xt("Color",Qt),xt("Error",Error),xt("AJAXError",Te),xt("ResolvedImage",Cr),xt("StylePropertyFunction",rl),xt("StyleExpression",Yc,{omit:["_evaluator"]}),xt("ZoomDependentExpression",To),xt("ZoomConstantExpression",Ir),xt("CompoundExpression",ta,{omit:["_evaluate"]});for(const n in Kl)Kl[n]._classRegistryKey||xt(`Expression_${n}`,Kl[n]);function nc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function th(n){return n.$name||n.constructor._classRegistryKey}function Sa(n){return!(function(e){if(e===null||typeof e!="object")return!1;const i=th(e);return!(!i||i==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||nc(n)||Ls(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Za(n,e){if(Sa(n))return(nc(n)||Ls(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const p=[];for(const m of n)p.push(Za(m,e));return p}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const i=th(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Ur[i])throw new Error(`${i} is not registered.`);const{klass:o}=Ur[i],c=o.serialize?o.serialize(n,e):{};if(o.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in n){if(!n.hasOwnProperty(p)||Ur[i].omit.indexOf(p)>=0)continue;const m=n[p];c[p]=Ur[i].shallow.indexOf(p)>=0?m:Za(m,e)}n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(c.$name=i),c}function ru(n){if(Sa(n))return n;if(Array.isArray(n))return n.map(ru);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=th(n)||"Object";if(!Ur[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=Ur[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const c of Object.keys(n)){if(c==="$name")continue;const p=n[c];o[c]=Ur[e].shallow.indexOf(c)>=0?p:ru(p)}return o}class ih{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function ws(n){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function ol(n){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function rc(n){return/\s/u.test(String.fromCodePoint(n))}function Ts(n){for(const e of n)if(ol(e.codePointAt(0)))return!0;return!1}function nh(n){for(const e of n)if(!Qh(e.codePointAt(0)))return!1;return!0}function ac(n){const e=n.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(e.join("|"),"u")}const Ss=ac(["Arab","Dupl","Mong","Ougr","Syrc"]);function Qh(n){return!Ss.test(String.fromCodePoint(n))}function Ms(n){return!(ol(n)||(e=n,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const rh=ac(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function sc(n){return rh.test(String.fromCodePoint(n))}function Es(n,e){return!(!e&&sc(n)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(n)))}function Hs(n){for(const e of n)if(sc(e.codePointAt(0)))return!0;return!1}const Ma=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Ma.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return u(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const i=n.pluginURL,o=new Promise((p=>{this.loadScriptResolve=p}));e(i);const c=new Promise((p=>setTimeout((()=>p()),this.TIMEOUT)));if(yield Promise.race([o,c]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:i};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class Ei{constructor(e,i){this.isSupportedScript=Jh,this.zoom=e,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new ih,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ih,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function Jh(n){return(function(e,i){for(const o of e)if(!Es(o.codePointAt(0),i))return!1;return!0})(n,Ma.getRTLTextPluginStatus()==="loaded")}const $s="-transition";class Ao{constructor(e,i,o){this.property=e,this.value=i,this.expression=(function(c,p,m){if(Hc(c))return new rl(c,p);if(wo(c)){const x=So(c,p,m);if(x.result==="error")throw new Error(x.value.map((w=>`${w.key}: ${w.message}`)).join(", "));return x.value}{let x=c;return p.type==="color"&&typeof c=="string"?x=Qt.parse(c):p.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?p.type!=="numberArray"||typeof c!="number"&&!Array.isArray(c)?p.type!=="colorArray"||typeof c!="string"&&!Array.isArray(c)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(c)?x=pn.parse(c):p.type==="projectionDefinition"&&typeof c=="string"&&(x=qn.parse(c)):x=jt.parse(c):x=Qi.parse(c):x=Pn.parse(c),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>x}}})(i===void 0?e.specification.default:i,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class oc{constructor(e,i){this.property=e,this.value=new Ao(e,void 0,i)}transitioned(e,i){return new ll(this.property,this.value,i,Bi({},e.transition,this.transition),e.now)}untransitioned(){return new ll(this.property,this.value,null,{},0)}}class ah{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=i}getValue(e){return Kr(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new oc(this._values[e].property,this._globalState)),this._values[e].value=new Ao(this._values[e].property,i===null?void 0:Kr(i),this._globalState)}getTransition(e){return Kr(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new oc(this._values[e].property,this._globalState)),this._values[e].transition=Kr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const c=this.getTransition(i);c!==void 0&&(e[`${i}${$s}`]=c)}return e}transitioned(e,i){const o=new lc(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,i._values[c]);return o}untransitioned(){const e=new lc(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class ll{constructor(e,i,o,c,p){this.property=e,this.value=i,this.begin=p+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const c=e.now||0,p=this.value.possiblyEvaluate(e,i,o),m=this.prior;if(m){if(c>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(c<this.begin)return m.possiblyEvaluate(e,i,o);{const x=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,o),p,Mt(x))}}return p}}class lc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const c=new ul(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(e,i,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ed{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=i}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Kr(this._values[e].value)}setValue(e,i){this._values[e]=new Ao(this._values[e].property,i===null?void 0:Kr(i),this._globalState)}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const c=new ul(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(e,i,o);return c}}class la{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,c){return this.property.evaluate(this.value,this.parameters,e,i,o,c)}}class ul{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Tt{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,o){const c=en[this.specification.type];return c?c(e,i,o):e}}class Dt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,c){return new la(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,c)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new la(this,{kind:"constant",value:void 0},e.parameters);const c=en[this.specification.type];if(c){const p=c(e.value.value,i.value.value,o);return new la(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,i,o,c,p,m){return e.kind==="constant"?e.value:e.evaluate(i,o,c,p,m)}}class Ea extends Dt{possiblyEvaluate(e,i,o,c){if(e.value===void 0)return new la(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const p=e.expression.evaluate(i,null,{},o,c),m=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,x=this._calculate(m,m,m,i);return new la(this,{kind:"constant",value:x},i)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new la(this,{kind:"constant",value:p},i)}return new la(this,e.expression,i)}evaluate(e,i,o,c,p,m){if(e.kind==="source"){const x=e.evaluate(i,o,c,p,m);return this._calculate(x,x,x,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,c),e.evaluate({zoom:Math.floor(i.zoom)},o,c),e.evaluate({zoom:Math.floor(i.zoom)+1},o,c),i):e.value}_calculate(e,i,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class au{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(i,null,{},o,c);return this._calculate(p,p,p,i)}return this._calculate(e.expression.evaluate(new Ei(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Ei(Math.floor(i.zoom),i)),e.expression.evaluate(new Ei(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class uc{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,c){return!!e.expression.evaluate(i,null,{},o,c)}interpolate(){return!1}}class Mn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const c=this.defaultPropertyValues[i]=new Ao(o,void 0,void 0),p=this.defaultTransitionablePropertyValues[i]=new oc(o,void 0);this.defaultTransitioningPropertyValues[i]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=c.possiblyEvaluate({})}}}xt("DataDrivenProperty",Dt),xt("DataConstantProperty",Tt),xt("CrossFadedDataDrivenProperty",Ea),xt("CrossFadedProperty",au),xt("ColorRampProperty",uc);class ln extends ci{constructor(e,i,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(c,p){return new nu(c,p)})(this.visibility,o),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=jr(e.filter,o)),i.layout&&(this._unevaluatedLayout=new ed(i.layout,o)),i.paint)){this._transitionablePaint=new ah(i.paint,o);for(const c in e.paint)this.setPaintProperty(c,e.paint[c],{validate:!1});for(const c in e.layout)this.setLayoutProperty(c,e.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ul(i.paint)}}setFilter(e){this.filter=e,this._featureFilter=jr(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const i of this._visibilityExpression.getGlobalStateRefs())e.add(i);if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const c of o.getGlobalStateRefs())e.add(c)}for(const i of this._featureFilter.getGlobalStateRefs())e.add(i);return e}getPaintAffectingGlobalStateRefs(){var e;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const c=this._transitionablePaint._values[o].value;for(const p of c.getGlobalStateRefs()){const m=(e=i.get(p))!==null&&e!==void 0?e:[];m.push({name:o,value:c.value}),i.set(p,m)}}return i}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,i,o={}){if(i==null||!this._validate(yf,`layers.${this.id}.layout.${e}`,e,i,o))return e==="visibility"?(this.visibility=i,this._visibilityExpression.setValue(i),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,i)}getPaintProperty(e){return e.endsWith($s)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(eh,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(e.endsWith($s))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const c=this._transitionablePaint._values[e],p=c.property.specification["property-type"]==="cross-faded-data-driven",m=c.value.isDataDriven(),x=c.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value;return w.isDataDriven()||m||p||this._handleOverridablePaintPropertyUpdate(e,x,w)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e=this.minzoom,i=!1){return!!(this.minzoom&&e<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),so(e,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}_validate(e,i,o,c,p={}){return(!p||p.validate!==!1)&&qa(this,e.call(Hn,{key:i,layerType:this.type,objectKey:o,value:c,styleSpec:Ie,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof la&&wa(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let gn;var cc={get paint(){return gn=gn||new Mn({"raster-opacity":new Tt(Ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new Tt(Ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(Ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(Ie.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(Ie.paint_raster["raster-saturation"]),"raster-contrast":new Tt(Ie.paint_raster["raster-contrast"]),"raster-resampling":new Tt(Ie.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(Ie.paint_raster["raster-fade-duration"])})}};class Xs extends ln{constructor(e,i){super(e,cc,i)}}const ii={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wi{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ti{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function tn(n,e=1){let i=0,o=0;return{members:n.map((c=>{const p=ii[c.type].BYTES_PER_ELEMENT,m=i=Aa(i,Math.max(e,p)),x=c.components||1;return o=Math.max(o,p),i+=p*x,{name:c.name,type:c.type,components:x,offset:m}})),size:Aa(i,Math.max(o,e)),alignment:e}}function Aa(n,e){return Math.ceil(n/e)*e}class Ha extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=o,e}}Ha.prototype.bytesPerElement=4,xt("StructArrayLayout2i4",Ha);class cl extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=c,e}}cl.prototype.bytesPerElement=6,xt("StructArrayLayout3i6",cl);class hl extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,c)}emplace(e,i,o,c,p){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=o,this.int16[m+2]=c,this.int16[m+3]=p,e}}hl.prototype.bytesPerElement=8,xt("StructArrayLayout4i8",hl);class Ys extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,p,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,c,p,m)}emplace(e,i,o,c,p,m,x){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=c,this.int16[w+3]=p,this.int16[w+4]=m,this.int16[w+5]=x,e}}Ys.prototype.bytesPerElement=12,xt("StructArrayLayout2i4i12",Ys);class td extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,p,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,c,p,m)}emplace(e,i,o,c,p,m,x){const w=4*e,C=8*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.uint8[C+4]=c,this.uint8[C+5]=p,this.uint8[C+6]=m,this.uint8[C+7]=x,e}}td.prototype.bytesPerElement=8,xt("StructArrayLayout2i4ub8",td);class Yi extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=o,e}}Yi.prototype.bytesPerElement=8,xt("StructArrayLayout2f8",Yi);class $a extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,p,m,x,w,C,z){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,o,c,p,m,x,w,C,z)}emplace(e,i,o,c,p,m,x,w,C,z,L){const B=10*e;return this.uint16[B+0]=i,this.uint16[B+1]=o,this.uint16[B+2]=c,this.uint16[B+3]=p,this.uint16[B+4]=m,this.uint16[B+5]=x,this.uint16[B+6]=w,this.uint16[B+7]=C,this.uint16[B+8]=z,this.uint16[B+9]=L,e}}$a.prototype.bytesPerElement=20,xt("StructArrayLayout10ui20",$a);class su extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,p,m,x,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,c,p,m,x,w)}emplace(e,i,o,c,p,m,x,w,C){const z=8*e;return this.uint16[z+0]=i,this.uint16[z+1]=o,this.uint16[z+2]=c,this.uint16[z+3]=p,this.uint16[z+4]=m,this.uint16[z+5]=x,this.uint16[z+6]=w,this.uint16[z+7]=C,e}}su.prototype.bytesPerElement=16,xt("StructArrayLayout8ui16",su);class ou extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,p,m,x,w,C,z,L,B){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,o,c,p,m,x,w,C,z,L,B)}emplace(e,i,o,c,p,m,x,w,C,z,L,B,F){const G=12*e;return this.int16[G+0]=i,this.int16[G+1]=o,this.int16[G+2]=c,this.int16[G+3]=p,this.uint16[G+4]=m,this.uint16[G+5]=x,this.uint16[G+6]=w,this.uint16[G+7]=C,this.int16[G+8]=z,this.int16[G+9]=L,this.int16[G+10]=B,this.int16[G+11]=F,e}}ou.prototype.bytesPerElement=24,xt("StructArrayLayout4i4ui4i24",ou);class hc extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=c,e}}hc.prototype.bytesPerElement=12,xt("StructArrayLayout3f12",hc);class dc extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}dc.prototype.bytesPerElement=4,xt("StructArrayLayout1ul4",dc);class fc extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,p,m,x,w,C){const z=this.length;return this.resize(z+1),this.emplace(z,e,i,o,c,p,m,x,w,C)}emplace(e,i,o,c,p,m,x,w,C,z){const L=10*e,B=5*e;return this.int16[L+0]=i,this.int16[L+1]=o,this.int16[L+2]=c,this.int16[L+3]=p,this.int16[L+4]=m,this.int16[L+5]=x,this.uint32[B+3]=w,this.uint16[L+8]=C,this.uint16[L+9]=z,e}}fc.prototype.bytesPerElement=20,xt("StructArrayLayout6i1ul2ui20",fc);class Co extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,p,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,c,p,m)}emplace(e,i,o,c,p,m,x){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=c,this.int16[w+3]=p,this.int16[w+4]=m,this.int16[w+5]=x,e}}Co.prototype.bytesPerElement=12,xt("StructArrayLayout2i2i2i12",Co);class Ws extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,c,p)}emplace(e,i,o,c,p,m){const x=4*e,w=8*e;return this.float32[x+0]=i,this.float32[x+1]=o,this.float32[x+2]=c,this.int16[w+6]=p,this.int16[w+7]=m,e}}Ws.prototype.bytesPerElement=16,xt("StructArrayLayout2f1f2i16",Ws);class cr extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,p,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,c,p,m)}emplace(e,i,o,c,p,m,x){const w=16*e,C=4*e,z=8*e;return this.uint8[w+0]=i,this.uint8[w+1]=o,this.float32[C+1]=c,this.float32[C+2]=p,this.int16[z+6]=m,this.int16[z+7]=x,e}}cr.prototype.bytesPerElement=16,xt("StructArrayLayout2ub2f2i16",cr);class nn extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=o,this.uint16[p+2]=c,e}}nn.prototype.bytesPerElement=6,xt("StructArrayLayout3ui6",nn);class As extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,p,m,x,w,C,z,L,B,F,G,q,$,Q){const ce=this.length;return this.resize(ce+1),this.emplace(ce,e,i,o,c,p,m,x,w,C,z,L,B,F,G,q,$,Q)}emplace(e,i,o,c,p,m,x,w,C,z,L,B,F,G,q,$,Q,ce){const J=24*e,ne=12*e,pe=48*e;return this.int16[J+0]=i,this.int16[J+1]=o,this.uint16[J+2]=c,this.uint16[J+3]=p,this.uint32[ne+2]=m,this.uint32[ne+3]=x,this.uint32[ne+4]=w,this.uint16[J+10]=C,this.uint16[J+11]=z,this.uint16[J+12]=L,this.float32[ne+7]=B,this.float32[ne+8]=F,this.uint8[pe+36]=G,this.uint8[pe+37]=q,this.uint8[pe+38]=$,this.uint32[ne+10]=Q,this.int16[J+22]=ce,e}}As.prototype.bytesPerElement=48,xt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",As);class dl extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,p,m,x,w,C,z,L,B,F,G,q,$,Q,ce,J,ne,pe,ye,ke,Qe,He,rt,yt,st){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,e,i,o,c,p,m,x,w,C,z,L,B,F,G,q,$,Q,ce,J,ne,pe,ye,ke,Qe,He,rt,yt,st)}emplace(e,i,o,c,p,m,x,w,C,z,L,B,F,G,q,$,Q,ce,J,ne,pe,ye,ke,Qe,He,rt,yt,st,Ye){const Ue=32*e,St=16*e;return this.int16[Ue+0]=i,this.int16[Ue+1]=o,this.int16[Ue+2]=c,this.int16[Ue+3]=p,this.int16[Ue+4]=m,this.int16[Ue+5]=x,this.int16[Ue+6]=w,this.int16[Ue+7]=C,this.uint16[Ue+8]=z,this.uint16[Ue+9]=L,this.uint16[Ue+10]=B,this.uint16[Ue+11]=F,this.uint16[Ue+12]=G,this.uint16[Ue+13]=q,this.uint16[Ue+14]=$,this.uint16[Ue+15]=Q,this.uint16[Ue+16]=ce,this.uint16[Ue+17]=J,this.uint16[Ue+18]=ne,this.uint16[Ue+19]=pe,this.uint16[Ue+20]=ye,this.uint16[Ue+21]=ke,this.uint16[Ue+22]=Qe,this.uint32[St+12]=He,this.float32[St+13]=rt,this.float32[St+14]=yt,this.uint16[Ue+30]=st,this.uint16[Ue+31]=Ye,e}}dl.prototype.bytesPerElement=64,xt("StructArrayLayout8i15ui1ul2f2ui64",dl);class fl extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}fl.prototype.bytesPerElement=4,xt("StructArrayLayout1f4",fl);class lu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const p=3*e;return this.uint16[6*e+0]=i,this.float32[p+1]=o,this.float32[p+2]=c,e}}lu.prototype.bytesPerElement=12,xt("StructArrayLayout1ui2f12",lu);class Xa extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const p=4*e;return this.uint32[2*e+0]=i,this.uint16[p+2]=o,this.uint16[p+3]=c,e}}Xa.prototype.bytesPerElement=8,xt("StructArrayLayout1ul2ui8",Xa);class g extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=o,e}}g.prototype.bytesPerElement=4,xt("StructArrayLayout2ui4",g);class t extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}t.prototype.bytesPerElement=2,xt("StructArrayLayout1ui2",t);class a extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,c)}emplace(e,i,o,c,p){const m=4*e;return this.float32[m+0]=i,this.float32[m+1]=o,this.float32[m+2]=c,this.float32[m+3]=p,e}}a.prototype.bytesPerElement=16,xt("StructArrayLayout4f16",a);class l extends wi{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new j(this.anchorPointX,this.anchorPointY)}}l.prototype.size=20;class f extends fc{get(e){return new l(this,e)}}xt("CollisionBoxArray",f);class v extends wi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}v.prototype.size=48;class b extends As{get(e){return new v(this,e)}}xt("PlacedSymbolArray",b);class E extends wi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}E.prototype.size=64;class D extends dl{get(e){return new E(this,e)}}xt("SymbolInstanceArray",D);class I extends fl{getoffsetX(e){return this.float32[1*e+0]}}xt("GlyphOffsetArray",I);class k extends cl{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}xt("SymbolLineVertexArray",k);class V extends wi{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}V.prototype.size=12;class N extends lu{get(e){return new V(this,e)}}xt("TextAnchorOffsetArray",N);class H extends wi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}H.prototype.size=8;class K extends Xa{get(e){return new H(this,e)}}xt("FeatureIndexArray",K);class re extends Ha{}class se extends Ha{}class ae extends Ha{}class ue extends Ys{}class ge extends td{}class le extends Yi{}class me extends $a{}class ve extends su{}class fe extends ou{}class Se extends hc{}class Ne extends dc{}class Le extends Co{}class Fe extends cr{}class je extends nn{}class dt extends g{}const ft=tn([{name:"a_pos",components:2,type:"Int16"}],4),{members:nt}=ft;class gt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,i,o,c){const p=this.segments[this.segments.length-1];return e>gt.MAX_VERTEX_ARRAY_LENGTH&&sn(`Max vertices per segment is ${gt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${gt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+e>gt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==c?this.createNewSegment(i,o,c):p}createNewSegment(e,i,o){const c={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(c.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(c),c}getOrCreateLatestSegment(e,i,o){return this.prepareSegment(0,e,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,c){return new gt([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function Gt(n,e){return 256*(n=Wt(Math.floor(n),0,255))+Wt(Math.floor(e),0,255)}gt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xt("SegmentVector",gt);const Ti=tn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Zi=tn([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Ni,Wi,zi,un={exports:{}},Ki={exports:{}},Jn={exports:{}},yn=(function(){if(zi)return un.exports;zi=1;var n=(Ni||(Ni=1,Ki.exports=function(i,o){var c,p,m,x,w,C,z,L;for(p=i.length-(c=3&i.length),m=o,w=3432918353,C=461845907,L=0;L<p;)z=255&i.charCodeAt(L)|(255&i.charCodeAt(++L))<<8|(255&i.charCodeAt(++L))<<16|(255&i.charCodeAt(++L))<<24,++L,m=27492+(65535&(x=5*(65535&(m=(m^=z=(65535&(z=(z=(65535&z)*w+(((z>>>16)*w&65535)<<16)&4294967295)<<15|z>>>17))*C+(((z>>>16)*C&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(z=0,c){case 3:z^=(255&i.charCodeAt(L+2))<<16;case 2:z^=(255&i.charCodeAt(L+1))<<8;case 1:m^=z=(65535&(z=(z=(65535&(z^=255&i.charCodeAt(L)))*w+(((z>>>16)*w&65535)<<16)&4294967295)<<15|z>>>17))*C+(((z>>>16)*C&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Ki.exports),e=(Wi||(Wi=1,Jn.exports=function(i,o){for(var c,p=i.length,m=o^p,x=0;p>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:m^=(255&i.charCodeAt(x+2))<<16;case 2:m^=(255&i.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Jn.exports);return un.exports=n,un.exports.murmur3=n,un.exports.murmur2=e,un.exports})(),_n=Z(yn);class er{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,c){this.ids.push(Cs(e)),this.positions.push(i,o,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=Cs(e);let o=0,c=this.ids.length-1;for(;o<c;){const m=o+c>>1;this.ids[m]>=i?c=m:o=m+1}const p=[];for(;this.ids[o]===i;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(e,i){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Ds(o,c,0,o.length-1),i&&i.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const i=new er;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Cs(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:_n(String(n))}function Ds(n,e,i,o){for(;i<o;){const c=n[i+o>>1];let p=i-1,m=o+1;for(;;){do p++;while(n[p]<c);do m--;while(n[m]>c);if(p>=m)break;Ya(n,p,m),Ya(e,3*p,3*m),Ya(e,3*p+1,3*m+1),Ya(e,3*p+2,3*m+2)}m-i<o-m?(Ds(n,e,i,m),i=m+1):(Ds(n,e,m+1,o),o=m)}}function Ya(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}xt("FeaturePositionMap",er);class Gr{constructor(e,i){this.gl=e.gl,this.location=i}}class pl extends Gr{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class uu extends Gr{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Wa extends Gr{constructor(e,i){super(e,i),this.current=Qt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const qr=new Float32Array(16);function ua(n){return[Gt(255*n.r,255*n.g),Gt(255*n.b,255*n.a)]}class Ca{constructor(e,i,o){this.value=e,this.uniformNames=i.map((c=>`u_${c}`)),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new Wa(e,i):new pl(e,i)}}class Da{constructor(e,i){this.uniformNames=i.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,i){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(e,i,o,c){let p=null;c==="u_pattern_to"?p=this.patternTo:c==="u_pattern_from"?p=this.patternFrom:c==="u_dasharray_to"?p=this.dashTo:c==="u_dasharray_from"?p=this.dashFrom:c==="u_pixel_ratio_to"?p=this.pixelRatioTo:c==="u_pixel_ratio_from"&&(p=this.pixelRatioFrom),p!==null&&e.set(p)}getBinding(e,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new uu(e,i):new pl(e,i)}}class Ai{constructor(e,i,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new c}populatePaintArray(e,i,o){const c=this.paintVertexArray.length,p=this.expression.evaluate(new Ei(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(c,e,p)}updatePaintArray(e,i,o,c,p){const m=this.expression.evaluate(new Ei(0,p),o,c);this._setPaintValue(e,i,m)}_setPaintValue(e,i,o){if(this.type==="color"){const c=ua(o);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,c[0],c[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vi{constructor(e,i,o,c,p,m){this.expression=e,this.uniformNames=i.map((x=>`u_${x}_t`)),this.type=o,this.useIntegerZoom=c,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=i.map((x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new m}populatePaintArray(e,i,o){const c=this.expression.evaluate(new Ei(this.zoom,o),i,{},o.canonical,[],o.formattedSection),p=this.expression.evaluate(new Ei(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(m,e,c,p)}updatePaintArray(e,i,o,c,p){const m=this.expression.evaluate(new Ei(this.zoom,p),o,c),x=this.expression.evaluate(new Ei(this.zoom+1,p),o,c);this._setPaintValue(e,i,m,x)}_setPaintValue(e,i,o,c){if(this.type==="color"){const p=ua(o),m=ua(c);for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,p[0],p[1],m[0],m[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,c=Wt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,i,o){return new pl(e,i)}}class Rn{constructor(e,i,o,c,p,m){this.expression=e,this.type=i,this.useIntegerZoom=o,this.zoom=c,this.layerId=m,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,i,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,this.getPositionIds(i),o)}updatePaintArray(e,i,o,c,p){this._setPaintValues(e,i,this.getPositionIds(o),p)}_setPaintValues(e,i,o,c){const p=this.getPositions(c);if(!p||!o)return;const m=p[o.min],x=p[o.mid],w=p[o.max];if(m&&x&&w)for(let C=e;C<i;C++)this.emplace(this.zoomInPaintVertexArray,C,x,m),this.emplace(this.zoomOutPaintVertexArray,C,x,w)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Fn extends Rn{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Ti.members}emplace(e,i,o,c){e.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],c.tlbr[0],c.tlbr[1],c.tlbr[2],c.tlbr[3],o.pixelRatio,c.pixelRatio)}}class sh extends Rn{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Zi.members}emplace(e,i,o,c){e.emplace(i,0,o.y,o.height,o.width,0,c.y,c.height,c.width)}}class oh{constructor(e,i,o){this.binders={},this._buffers=[];const c=[];for(const p in e.paint._values){if(!o(p))continue;const m=e.paint.get(p);if(!(m instanceof la&&wa(m.property.specification)))continue;const x=_f(p,e.type),w=m.value,C=m.property.specification.type,z=m.property.useIntegerZoom,L=m.property.specification["property-type"],B=L==="cross-faded"||L==="cross-faded-data-driven";if(w.kind==="constant")this.binders[p]=B?new Da(w.value,x):new Ca(w.value,x,C),c.push(`/u_${p}`);else if(w.kind==="source"||B){const F=Po(p,C,"source");this.binders[p]=B?p==="line-dasharray"?new sh(w,C,z,i,F,e.id):new Fn(w,C,z,i,F,e.id):new Ai(w,x,C,F),c.push(`/a_${p}`)}else{const F=Po(p,C,"composite");this.binders[p]=new Vi(w,x,C,z,i,F),c.push(`/z_${p}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Ai||i instanceof Vi?i.maxValue:0}populatePaintArrays(e,i,o){for(const c in this.binders){const p=this.binders[c];(p instanceof Ai||p instanceof Vi||p instanceof Rn)&&p.populatePaintArray(e,i,o)}}setConstantPatternPositions(e,i){for(const o in this.binders){const c=this.binders[o];c instanceof Da&&c.setConstantPatternPositions(e,i)}}setConstantDashPositions(e,i){for(const o in this.binders){const c=this.binders[o];c instanceof Da&&c.setConstantDashPositions(e,i)}}updatePaintArrays(e,i,o,c,p){let m=!1;for(const x in e){const w=i.getPositions(x);for(const C of w){const z=o.feature(C.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof Ai||B instanceof Vi||B instanceof Rn)&&B.expression.isStateDependent===!0){const F=c.paint.get(L);B.expression=F.value,B.updatePaintArray(C.start,C.end,z,e[x],p),m=!0}}}}return m}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Ca||o instanceof Da)&&e.push(...o.uniformNames.map((c=>`#define HAS_UNIFORM_${c}`)))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Ai||o instanceof Vi)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name);else if(o instanceof Rn){const c=o.getVertexAttributes();for(const p of c)e.push(p.name)}}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Ca||o instanceof Da||o instanceof Vi)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Ca||p instanceof Da||p instanceof Vi){for(const m of p.uniformNames)if(i[m]){const x=p.getBinding(e,i[m],m);o.push({name:m,property:c,binding:x})}}}return o}setUniforms(e,i,o,c){for(const{name:p,property:m,binding:x}of i)this.binders[m].setUniform(x,c,o.get(m),p)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof Rn){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof Ai||o instanceof Vi)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Ai||o instanceof Vi||o instanceof Rn)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Ai||i instanceof Vi||i instanceof Rn)&&i.destroy()}}}class Do{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new oh(c,i,o);this.needsUpload=!1,this._featureMap=new er,this._bufferOffset=0}populatePaintArrays(e,i,o,c){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,i,c);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,c){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,i,p,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function _f(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function Po(n,e,i){const o={color:{source:Yi,composite:a},number:{source:fl,composite:Yi}},c=(function(p){return{"line-pattern":{source:me,composite:me},"fill-pattern":{source:me,composite:me},"fill-extrusion-pattern":{source:me,composite:me},"line-dasharray":{source:ve,composite:ve}}[p]})(n);return c&&c[i]||o[e][i]}xt("ConstantBinder",Ca),xt("CrossFadedConstantBinder",Da),xt("SourceExpressionBinder",Ai),xt("CrossFadedPatternBinder",Fn),xt("CrossFadedDasharrayBinder",sh),xt("CompositeExpressionBinder",Vi),xt("ProgramConfiguration",oh,{omit:["_buffers"]}),xt("ProgramConfigurationSet",Do);const lh=Math.pow(2,14)-1,Ks=-lh-1;function Qs(n){const e=It/n.extent,i=n.loadGeometry();for(let o=0;o<i.length;o++){const c=i[o];for(let p=0;p<c.length;p++){const m=c[p],x=Math.round(m.x*e),w=Math.round(m.y*e);m.x=Wt(x,Ks,lh),m.y=Wt(w,Ks,lh),(x<m.x||x>m.x+1||w<m.y||w>m.y+1)&&sn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Ka(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Qs(n):[]}}const uh=-32768;function pc(n,e,i,o,c){n.emplaceBack(uh+8*e+o,uh+8*i+c)}class mc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new se,this.indexArray=new je,this.segments=new gt,this.programConfigurations=new Do(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){const c=this.layers[0],p=[];let m=null,x=!1,w=c.type==="heatmap";if(c.type==="circle"){const z=c;m=z.layout.get("circle-sort-key"),x=!m.isConstant(),w=w||z.paint.get("circle-pitch-alignment")==="map"}const C=w?i.subdivisionGranularity.circle:1;for(const{feature:z,id:L,index:B,sourceLayerIndex:F}of e){const G=this.layers[0]._featureFilter.needGeometry,q=Ka(z,G);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),q,o))continue;const $=x?m.evaluate(q,{},o):void 0,Q={id:L,properties:z.properties,type:z.type,sourceLayerIndex:F,index:B,geometry:G?q.geometry:Qs(z),patterns:{},sortKey:$};p.push(Q)}x&&p.sort(((z,L)=>z.sortKey-L.sortKey));for(const z of p){const{geometry:L,index:B,sourceLayerIndex:F}=z,G=e[B].feature;this.addFeature(z,L,B,o,C),i.featureIndex.insert(G,L,B,F,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,c,p=1){let m;switch(p){case 1:m=[0,7];break;case 3:m=[0,2,5,7];break;case 5:m=[0,1,3,4,6,7];break;case 7:m=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const x=m.length;for(const w of i)for(const C of w){const z=C.x,L=C.y;if(z<0||z>=It||L<0||L>=It)continue;const B=this.segments.prepareSegment(x*x,this.layoutVertexArray,this.indexArray,e.sortKey),F=B.vertexLength;for(let G=0;G<x;G++)for(let q=0;q<x;q++)pc(this.layoutVertexArray,z,L,m[q],m[G]);for(let G=0;G<x-1;G++)for(let q=0;q<x-1;q++){const $=F+G*x+q,Q=F+(G+1)*x+q;this.indexArray.emplaceBack($,Q+1,$+1),this.indexArray.emplaceBack($,Q,Q+1)}B.vertexLength+=x*x,B.primitiveLength+=(x-1)*(x-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:c})}}function gc(n,e){for(let i=0;i<n.length;i++)if(zo(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(zo(n,e[i]))return!0;return!!hr(n,e)}function vf(n,e,i){return!!zo(n,e)||!!bf(e,n,i)}function xf(n,e){if(n.length===1)return jp(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let c=0;c<o.length;c++)if(zo(n,o[c]))return!0}for(let i=0;i<n.length;i++)if(jp(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(hr(n,e[i]))return!0;return!1}function tr(n,e,i){if(n.length>1){if(hr(n,e))return!0;for(let o=0;o<e.length;o++)if(bf(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(bf(n[o],e,i))return!0;return!1}function hr(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],c=n[i+1];for(let p=0;p<e.length-1;p++)if(lg(o,c,e[p],e[p+1]))return!0}return!1}function lg(n,e,i,o){return Br(n,i,o)!==Br(e,i,o)&&Br(n,e,i)!==Br(n,e,o)}function bf(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(Fp(n,e[c-1],e[c])<o)return!0;return!1}function Fp(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const c=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function jp(n,e){let i,o,c,p=!1;for(let m=0;m<n.length;m++){i=n[m];for(let x=0,w=i.length-1;x<i.length;w=x++)o=i[x],c=i[w],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(p=!p)}return p}function zo(n,e){let i=!1;for(let o=0,c=n.length-1;o<n.length;c=o++){const p=n[o],m=n[c];p.y>e.y!=m.y>e.y&&e.x<(m.x-p.x)*(e.y-p.y)/(m.y-p.y)+p.x&&(i=!i)}return i}function ug(n,e,i){const o=i[0],c=i[2];if(n.x<o.x&&e.x<o.x||n.x>c.x&&e.x>c.x||n.y<o.y&&e.y<o.y||n.y>c.y&&e.y>c.y)return!1;const p=Br(n,e,i[0]);return p!==Br(n,e,i[1])||p!==Br(n,e,i[2])||p!==Br(n,e,i[3])}function ml(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function id(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function wf(n,e,i,o,c){if(!e[0]&&!e[1])return n;const p=j.convert(e)._mult(c);i==="viewport"&&p._rotate(-o);const m=[];for(let x=0;x<n.length;x++)m.push(n[x].sub(p));return m}function Tf(n){const e=[];for(let i=0;i<n.length;i++){const o=n[i],c=e.at(-1);(i===0||c&&!o.equals(c))&&e.push(o)}return e}function Np({queryGeometry:n,size:e},i){return vf(n,i,e)}function cg({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:c},p){return vf(n,p,e*(i.projectTileCoordinates(p.x,p.y,o,c).signedDistanceFromCamera/i.cameraToCenterDistance))}function hg({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:c},p){const m=i.projectTileCoordinates(p.x,p.y,o,c).signedDistanceFromCamera,x=e*(i.cameraToCenterDistance/m);return vf(n,nd(p,i,o,c),x)}function dg({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:c},p){return vf(n,nd(p,i,o,c),e)}function Sf({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:c,pitchAlignment:p="map",pitchScale:m="map"},x){const w=p==="map"?m==="map"?Np:cg:m==="map"?hg:dg,C={queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:c};for(const z of x)for(const L of z)if(w(C,L))return!0;return!1}function nd(n,e,i,o){const c=e.projectTileCoordinates(n.x,n.y,i,o).point;return new j((.5*c.x+.5)*e.width,(.5*-c.y+.5)*e.height)}let Mf,Vp;xt("CircleBucket",mc,{omit:["layers"]});var Up={get paint(){return Vp=Vp||new Mn({"circle-radius":new Dt(Ie.paint_circle["circle-radius"]),"circle-color":new Dt(Ie.paint_circle["circle-color"]),"circle-blur":new Dt(Ie.paint_circle["circle-blur"]),"circle-opacity":new Dt(Ie.paint_circle["circle-opacity"]),"circle-translate":new Tt(Ie.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(Ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(Ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(Ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Dt(Ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Dt(Ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Dt(Ie.paint_circle["circle-stroke-opacity"])})},get layout(){return Mf=Mf||new Mn({"circle-sort-key":new Dt(Ie.layout_circle["circle-sort-key"])})}};class Ef extends ln{constructor(e,i){super(e,Up,i)}createBucket(e){return new mc(e)}queryRadius(e){const i=e;return ml("circle-radius",this,i)+ml("circle-stroke-width",this,i)+id(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:c,transform:p,pixelsToTileUnits:m,unwrappedTileID:x,getElevation:w}){const C=wf(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,m),z=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),L=this.paint.get("circle-pitch-scale"),B=this.paint.get("circle-pitch-alignment");let F,G;return B==="map"?(F=C,G=z*m):(F=(function(q,$,Q,ce){return q.map((J=>nd(J,$,Q,ce)))})(C,p,x,w),G=z),Sf({queryGeometry:F,size:G,transform:p,unwrappedTileID:x,getElevation:w,pitchAlignment:B,pitchScale:L},c)}}class Af extends mc{}let Gp;xt("HeatmapBucket",Af,{omit:["layers"]});var qp={get paint(){return Gp=Gp||new Mn({"heatmap-radius":new Dt(Ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Dt(Ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(Ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new uc(Ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(Ie.paint_heatmap["heatmap-opacity"])})}};function Cf(n,{width:e,height:i},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*i*o}`)}else c=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=c,n}function Ro(n,{width:e,height:i},o){if(e===n.width&&i===n.height)return;const c=Cf({},{width:e,height:i},o);rd(n,c,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,i)},o),n.width=e,n.height=i,n.data=c.data}function rd(n,e,i,o,c,p){if(c.width===0||c.height===0)return e;if(c.width>n.width||c.height>n.height||i.x>n.width-c.width||i.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const m=n.data,x=e.data;if(m===x)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<c.height;w++){const C=((i.y+w)*n.width+i.x)*p,z=((o.y+w)*e.width+o.x)*p;for(let L=0;L<c.width*p;L++)x[z+L]=m[C+L]}return e}class ad{constructor(e,i){Cf(this,e,1,i)}resize(e){Ro(this,e,1)}clone(){return new ad({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,p){rd(e,i,o,c,p,1)}}class Zr{constructor(e,i){Cf(this,e,4,i)}resize(e){Ro(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Zr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,p){rd(e,i,o,c,p,4)}setPixel(e,i,o){const c=4*(e*this.width+i);this.data[c+0]=Math.round(255*o.r/o.a),this.data[c+1]=Math.round(255*o.g/o.a),this.data[c+2]=Math.round(255*o.b/o.a),this.data[c+3]=Math.round(255*o.a)}}function Io(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,c=n.image||new Zr({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const p=(m,x,w)=>{e[n.evaluationKey]=w;const C=n.expression.evaluate(e);c.setPixel(m/4/i,x/4,C)};if(n.clips)for(let m=0,x=0;m<o;++m,x+=4*i)for(let w=0,C=0;w<i;w++,C+=4){const z=w/(i-1),{start:L,end:B}=n.clips[m];p(x,C,L*(1-z)+B*z)}else for(let m=0,x=0;m<i;m++,x+=4)p(0,x,m/(i-1));return c}xt("AlphaImage",ad),xt("RGBAImage",Zr);const sd="big-fb";class fg extends ln{createBucket(e){return new Af(e)}constructor(e,i){super(e,qp,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Io({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(sd)&&this.heatmapFbos.delete(sd)}queryRadius(e){return ml("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:c,transform:p,pixelsToTileUnits:m,unwrappedTileID:x,getElevation:w}){return Sf({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(i,o)*m,transform:p,unwrappedTileID:x,getElevation:w},c)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let od;var ld={get paint(){return od=od||new Mn({"hillshade-illumination-direction":new Tt(Ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Tt(Ie.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Tt(Ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(Ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(Ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(Ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(Ie.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Tt(Ie.paint_hillshade["hillshade-method"])})}};class vn extends ln{constructor(e,i){super(e,ld,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,c=this.paint.get("hillshade-shadow-color").values;const p=Math.max(e.length,i.length,o.length,c.length);e=e.concat(Array(p-e.length).fill(e.at(-1))),i=i.concat(Array(p-i.length).fill(i.at(-1))),o=o.concat(Array(p-o.length).fill(o.at(-1))),c=c.concat(Array(p-c.length).fill(c.at(-1)));const m=i.map(Wn);return{directionRadians:e.map(Wn),altitudeRadians:m,shadowColor:c,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let pg;var Ly={get paint(){return pg=pg||new Mn({"color-relief-opacity":new Tt(Ie["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new uc(Ie["paint_color-relief"]["color-relief-color"])})}};class Df{constructor(e,i,o,c){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,c)}update(e,i,o){const{width:c,height:p}=e,m=!(this.size&&this.size[0]===c&&this.size[1]===p||o),{context:x}=this,{gl:w}=x;if(this.useMipmap=!!(i&&i.useMipmap),w.bindTexture(w.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!i||i.premultiply!==!1)),m)this.size=[c,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Ls(e)?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,e):w.texImage2D(w.TEXTURE_2D,0,this.format,c,p,0,this.format,w.UNSIGNED_BYTE,e.data);else{const{x:C,y:z}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Ls(e)?w.texSubImage2D(w.TEXTURE_2D,0,C,z,w.RGBA,w.UNSIGNED_BYTE,e):w.texSubImage2D(w.TEXTURE_2D,0,C,z,c,p,w.RGBA,w.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&w.generateMipmap(w.TEXTURE_2D),x.pixelStoreUnpackFlipY.setDefault(),x.pixelStoreUnpack.setDefault(),x.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,i,o){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||e),this.filter=e),i!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ch{constructor(e,i,o,c=1,p=1,m=1,x=0){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void sn(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const w=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=p,this.blueFactor=m,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<w;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(w,C)]=this.data[this._idx(w-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,w)]=this.data[this._idx(C,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<w;C++)for(let z=0;z<w;z++){const L=this.get(C,z);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(e,i){const o=new Uint8Array(this.data.buffer),c=4*this._idx(e,i);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${i}, dim: ${this.dim}`);return(i+1)*this.stride+(e+1)}unpack(e,i,o){return e*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return gl(e,this.getUnpackVector())}getPixels(){return new Zr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,p=i*this.dim+this.dim,m=o*this.dim,x=o*this.dim+this.dim;switch(i){case-1:c=p-1;break;case 1:p=c+1}switch(o){case-1:m=x-1;break;case 1:x=m+1}const w=-i*this.dim,C=-o*this.dim;for(let z=m;z<x;z++)for(let L=c;L<p;L++)this.data[this._idx(L,z)]=e.data[this._idx(L+w,z+C)]}}function gl(n,e){const i=e[0],o=e[1],c=e[2],p=e[3],m=Math.min(i,o,c),x=Math.round((n+p)/m);return{r:Math.floor(x*m/i)%256,g:Math.floor(x*m/o)%256,b:Math.floor(x*m/c)%256}}xt("DEMData",ch);class mg extends ln{constructor(e,i){super(e,Ly,i)}_createColorRamp(e){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Ir&&o._styleExpression.expression instanceof zr){this.colorRampExpression=o;const m=o._styleExpression.expression;i.elevationStops=m.labels,i.colorStops=[];for(const x of i.elevationStops)i.colorStops.push(m.evaluate({globals:{elevation:x}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Qt.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=e)return i;const c={elevationStops:[],colorStops:[]},p=(i.elevationStops.length-1)/(e-1);for(let m=0;m<i.elevationStops.length-.5;m+=p)c.elevationStops.push(i.elevationStops[Math.round(m)]),c.colorStops.push(i.colorStops[Math.round(m)]);return sn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${i.elevationStops.length}`),c}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const c=this._createColorRamp(i),p=new Zr({width:c.colorStops.length,height:1}),m=new Zr({width:c.colorStops.length,height:1});for(let x=0;x<c.elevationStops.length;x++){const w=gl(c.elevationStops[x],o);m.setPixel(0,x,new Qt(w.r/255,w.g/255,w.b/255,1)),p.setPixel(0,x,c.colorStops[x])}return this.colorRampTextures={elevationTexture:new Df(e,m,e.gl.RGBA),colorTexture:new Df(e,p,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const gg=tn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ud}=gg;function Qa(n,e,i){const o=i.patternDependencies;let c=!1;for(const p of e){const m=p.paint.get(`${n}-pattern`);m.isConstant()||(c=!0);const x=m.constantOr(null);x&&(c=!0,o[x.to]=!0,o[x.from]=!0)}return c}function Pf(n,e,i,o,c){const{zoom:p}=o,m=c.patternDependencies;for(const x of e){const w=x.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let C=w.evaluate({zoom:p-1},i,{},c.availableImages),z=w.evaluate({zoom:p},i,{},c.availableImages),L=w.evaluate({zoom:p+1},i,{},c.availableImages);C=C&&C.name?C.name:C,z=z&&z.name?z.name:z,L=L&&L.name?L.name:L,m[C]=!0,m[z]=!0,m[L]=!0,i.patterns[x.id]={min:C,mid:z,max:L}}}return i}function zf(n,e,i,o,c){let p;if(c===(function(m,x,w,C){let z=0;for(let L=x,B=w-C;L<w;L+=C)z+=(m[B]-m[L])*(m[L+1]+m[B+1]),B=L;return z})(n,e,i,o)>0)for(let m=e;m<i;m+=o)p=ca(m/o|0,n[m],n[m+1],p);else for(let m=i-o;m>=e;m-=o)p=ca(m/o|0,n[m],n[m+1],p);return p&&Pa(p,p.next)&&(ha(p),p=p.next),p}function cu(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!Pa(o,o.next)&&vi(o.prev,o,o.next)!==0)o=o.next;else{if(ha(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function yc(n,e,i,o,c,p,m){if(!n)return;!m&&p&&(function(w,C,z,L){let B=w;do B.z===0&&(B.z=nr(B.x,B.y,C,z,L)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==w);B.prevZ.nextZ=null,B.prevZ=null,(function(F){let G,q=1;do{let $,Q=F;F=null;let ce=null;for(G=0;Q;){G++;let J=Q,ne=0;for(let ye=0;ye<q&&(ne++,J=J.nextZ,J);ye++);let pe=q;for(;ne>0||pe>0&&J;)ne!==0&&(pe===0||!J||Q.z<=J.z)?($=Q,Q=Q.nextZ,ne--):($=J,J=J.nextZ,pe--),ce?ce.nextZ=$:F=$,$.prevZ=ce,ce=$;Q=J}ce.nextZ=null,q*=2}while(G>1)})(B)})(n,o,c,p);let x=n;for(;n.prev!==n.next;){const w=n.prev,C=n.next;if(p?Rf(n,o,c,p):Zp(n))e.push(w.i,n.i,C.i),ha(n),n=C.next,x=C.next;else if((n=C)===x){m?m===1?yc(n=yg(cu(n),e),e,i,o,c,p,2):m===2&&yl(n,e,i,o,c,p):yc(cu(n),e,i,o,c,p,1);break}}}function Zp(n){const e=n.prev,i=n,o=n.next;if(vi(e,i,o)>=0)return!1;const c=e.x,p=i.x,m=o.x,x=e.y,w=i.y,C=o.y,z=Math.min(c,p,m),L=Math.min(x,w,C),B=Math.max(c,p,m),F=Math.max(x,w,C);let G=o.next;for(;G!==e;){if(G.x>=z&&G.x<=B&&G.y>=L&&G.y<=F&&hh(c,x,p,w,m,C,G.x,G.y)&&vi(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function Rf(n,e,i,o){const c=n.prev,p=n,m=n.next;if(vi(c,p,m)>=0)return!1;const x=c.x,w=p.x,C=m.x,z=c.y,L=p.y,B=m.y,F=Math.min(x,w,C),G=Math.min(z,L,B),q=Math.max(x,w,C),$=Math.max(z,L,B),Q=nr(F,G,e,i,o),ce=nr(q,$,e,i,o);let J=n.prevZ,ne=n.nextZ;for(;J&&J.z>=Q&&ne&&ne.z<=ce;){if(J.x>=F&&J.x<=q&&J.y>=G&&J.y<=$&&J!==c&&J!==m&&hh(x,z,w,L,C,B,J.x,J.y)&&vi(J.prev,J,J.next)>=0||(J=J.prevZ,ne.x>=F&&ne.x<=q&&ne.y>=G&&ne.y<=$&&ne!==c&&ne!==m&&hh(x,z,w,L,C,B,ne.x,ne.y)&&vi(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;J&&J.z>=Q;){if(J.x>=F&&J.x<=q&&J.y>=G&&J.y<=$&&J!==c&&J!==m&&hh(x,z,w,L,C,B,J.x,J.y)&&vi(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;ne&&ne.z<=ce;){if(ne.x>=F&&ne.x<=q&&ne.y>=G&&ne.y<=$&&ne!==c&&ne!==m&&hh(x,z,w,L,C,B,ne.x,ne.y)&&vi(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function yg(n,e){let i=n;do{const o=i.prev,c=i.next.next;!Pa(o,c)&&Xp(o,i,i.next,c)&&dd(o,c)&&dd(c,o)&&(e.push(o.i,i.i,c.i),ha(i),ha(i.next),i=n=c),i=i.next}while(i!==n);return cu(i)}function yl(n,e,i,o,c,p){let m=n;do{let x=m.next.next;for(;x!==m.prev;){if(m.i!==x.i&&En(m,x)){let w=fd(m,x);return m=cu(m,m.next),w=cu(w,w.next),yc(m,e,i,o,c,p,0),void yc(w,e,i,o,c,p,0)}x=x.next}m=m.next}while(m!==n)}function ir(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function Hp(n,e){const i=(function(c,p){let m=p;const x=c.x,w=c.y;let C,z=-1/0;if(Pa(c,m))return m;do{if(Pa(c,m.next))return m.next;if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){const q=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(q<=x&&q>z&&(z=q,C=m.x<m.next.x?m:m.next,q===x))return C}m=m.next}while(m!==p);if(!C)return null;const L=C,B=C.x,F=C.y;let G=1/0;m=C;do{if(x>=m.x&&m.x>=B&&x!==m.x&&$p(w<F?x:z,w,B,F,w<F?z:x,w,m.x,m.y)){const q=Math.abs(w-m.y)/(x-m.x);dd(m,c)&&(q<G||q===G&&(m.x>C.x||m.x===C.x&&_g(C,m)))&&(C=m,G=q)}m=m.next}while(m!==L);return C})(n,e);if(!i)return e;const o=fd(i,n);return cu(o,o.next),cu(i,i.next)}function _g(n,e){return vi(n.prev,n,e.prev)<0&&vi(e.next,n,n.next)<0}function nr(n,e,i,o,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ky(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function $p(n,e,i,o,c,p,m,x){return(c-m)*(e-x)>=(n-m)*(p-x)&&(n-m)*(o-x)>=(i-m)*(e-x)&&(i-m)*(p-x)>=(c-m)*(o-x)}function hh(n,e,i,o,c,p,m,x){return!(n===m&&e===x)&&$p(n,e,i,o,c,p,m,x)}function En(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,o){let c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==o.i&&c.next.i!==o.i&&Xp(c,c.next,i,o))return!0;c=c.next}while(c!==i);return!1})(n,e)&&(dd(n,e)&&dd(e,n)&&(function(i,o){let c=i,p=!1;const m=(i.x+o.x)/2,x=(i.y+o.y)/2;do c.y>x!=c.next.y>x&&c.next.y!==c.y&&m<(c.next.x-c.x)*(x-c.y)/(c.next.y-c.y)+c.x&&(p=!p),c=c.next;while(c!==i);return p})(n,e)&&(vi(n.prev,n,e.prev)||vi(n,e.prev,e))||Pa(n,e)&&vi(n.prev,n,n.next)>0&&vi(e.prev,e,e.next)>0)}function vi(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Pa(n,e){return n.x===e.x&&n.y===e.y}function Xp(n,e,i,o){const c=hd(vi(n,e,i)),p=hd(vi(n,e,o)),m=hd(vi(i,o,n)),x=hd(vi(i,o,e));return c!==p&&m!==x||!(c!==0||!cd(n,i,e))||!(p!==0||!cd(n,o,e))||!(m!==0||!cd(i,n,o))||!(x!==0||!cd(i,e,o))}function cd(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function hd(n){return n>0?1:n<0?-1:0}function dd(n,e){return vi(n.prev,n,n.next)<0?vi(n,e,n.next)>=0&&vi(n,n.prev,e)>=0:vi(n,e,n.prev)<0||vi(n,n.next,e)<0}function fd(n,e){const i=If(n.i,n.x,n.y),o=If(e.i,e.x,e.y),c=n.next,p=e.prev;return n.next=e,e.prev=n,i.next=c,c.prev=i,o.next=i,i.prev=o,p.next=o,o.prev=p,o}function ca(n,e,i,o){const c=If(n,e,i);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function ha(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function If(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class dr{constructor(e,i){if(i>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=i}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class pd{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}pd.noSubdivision=new pd({fill:new dr(0,0),line:new dr(0,0),tile:new dr(0,0),stencil:new dr(0,0),circle:1}),xt("SubdivisionGranularityExpression",dr),xt("SubdivisionGranularitySetting",pd);const za=-32768,Js=32767;class _l{constructor(e,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=It/e,this._canonical=i}_getKey(e,i){return(e+=32768)<<16|i+32768}_vertexToIndex(e,i){if(e<-32768||i<-32768||e>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),c=0|Math.round(i),p=this._getKey(o,c);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const m=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,m),this._vertexBuffer.push(o,c),m}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(c,p){const m=[];for(let x=0;x<p.length;x+=3){const w=p[x],C=p[x+1],z=p[x+2],L=c[2*w],B=c[2*w+1];(c[2*C]-L)*(c[2*z+1]-B)-(c[2*C+1]-B)*(c[2*z]-L)>0?(m.push(w),m.push(z),m.push(C)):(m.push(w),m.push(C),m.push(z))}return m})(this._vertexBuffer,e);const i=[],o=e.length;for(let c=0;c<o;c+=3){const p=[e[c+0],e[c+1],e[c+2]],m=[this._vertexBuffer[2*e[c+0]+0],this._vertexBuffer[2*e[c+0]+1],this._vertexBuffer[2*e[c+1]+0],this._vertexBuffer[2*e[c+1]+1],this._vertexBuffer[2*e[c+2]+0],this._vertexBuffer[2*e[c+2]+1]];let x=1/0,w=1/0,C=-1/0,z=-1/0;for(let q=0;q<3;q++){const $=m[2*q],Q=m[2*q+1];x=Math.min(x,$),C=Math.max(C,$),w=Math.min(w,Q),z=Math.max(z,Q)}if(x===C||w===z)continue;const L=Math.floor(x/this._granularityCellSize),B=Math.ceil(C/this._granularityCellSize),F=Math.floor(w/this._granularityCellSize),G=Math.ceil(z/this._granularityCellSize);if(L!==B||F!==G)for(let q=F;q<G;q++){const $=this._scanlineGenerateVertexRingForCellRow(q,m,p);eo(this._vertexBuffer,$,i)}else i.push(...p)}return i}_scanlineGenerateVertexRingForCellRow(e,i,o){const c=e*this._granularityCellSize,p=c+this._granularityCellSize,m=[];for(let x=0;x<3;x++){const w=i[2*x],C=i[2*x+1],z=i[2*(x+1)%6],L=i[(2*(x+1)+1)%6],B=i[2*(x+2)%6],F=i[(2*(x+2)+1)%6],G=z-w,q=L-C,$=G===0,Q=q===0,ce=(c-C)/q,J=(p-C)/q,ne=Math.min(ce,J),pe=Math.max(ce,J);if(!Q&&(ne>=1||pe<=0)||Q&&(C<c||C>p)){L>=c&&L<=p&&m.push(o[(x+1)%3]);continue}!Q&&ne>0&&m.push(this._vertexToIndex(w+G*ne,C+q*ne));const ye=w+G*Math.max(ne,0),ke=w+G*Math.min(pe,1);$||this._generateIntraEdgeVertices(m,w,C,z,L,ye,ke),!Q&&pe<1&&m.push(this._vertexToIndex(w+G*pe,C+q*pe)),(Q||L>=c&&L<=p)&&m.push(o[(x+1)%3]),!Q&&(L<=c||L>=p)&&this._generateInterEdgeVertices(m,w,C,z,L,B,F,ke,c,p)}return m}_generateIntraEdgeVertices(e,i,o,c,p,m,x){const w=c-i,C=p-o,z=C===0,L=z?Math.min(i,c):Math.min(m,x),B=z?Math.max(i,c):Math.max(m,x),F=Math.floor(L/this._granularityCellSize)+1,G=Math.ceil(B/this._granularityCellSize)-1;if(z?i<c:m<x)for(let q=F;q<=G;q++){const $=q*this._granularityCellSize;e.push(this._vertexToIndex($,o+C*($-i)/w))}else for(let q=G;q>=F;q--){const $=q*this._granularityCellSize;e.push(this._vertexToIndex($,o+C*($-i)/w))}}_generateInterEdgeVertices(e,i,o,c,p,m,x,w,C,z){const L=p-o,B=m-c,F=x-p,G=(C-p)/F,q=(z-p)/F,$=Math.min(G,q),Q=Math.max(G,q),ce=c+B*$;let J=Math.floor(Math.min(ce,w)/this._granularityCellSize)+1,ne=Math.ceil(Math.max(ce,w)/this._granularityCellSize)-1,pe=w<ce;const ye=F===0;if(ye&&(x===C||x===z))return;if(ye||$>=1||Q<=0){const Qe=o-x,He=m+(i-m)*Math.min((C-x)/Qe,(z-x)/Qe);J=Math.floor(Math.min(He,w)/this._granularityCellSize)+1,ne=Math.ceil(Math.max(He,w)/this._granularityCellSize)-1,pe=w<He}const ke=L>0?z:C;if(pe)for(let Qe=J;Qe<=ne;Qe++)e.push(this._vertexToIndex(Qe*this._granularityCellSize,ke));else for(let Qe=ne;Qe>=J;Qe--)e.push(this._vertexToIndex(Qe*this._granularityCellSize,ke))}_generateOutline(e){const i=[];for(const o of e){const c=vl(o,this._granularity,!0),p=this._pointArrayToIndices(c),m=[];for(let x=1;x<p.length;x++)m.push(p[x-1]),m.push(p[x]);i.push(m)}return i}_handlePoles(e){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(e,i,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let i=0;i<e.length;i+=2){const o=e[i+1];o===za&&(e[i+1]=-32767),o===Js&&(e[i+1]=32766)}}_generatePoleQuad(e,i,o,c,p,m){c>p!=(m===za)?(e.push(i),e.push(o),e.push(this._vertexToIndex(c,m)),e.push(o),e.push(this._vertexToIndex(p,m)),e.push(this._vertexToIndex(c,m))):(e.push(o),e.push(i),e.push(this._vertexToIndex(c,m)),e.push(this._vertexToIndex(p,m)),e.push(o),e.push(this._vertexToIndex(c,m)))}_fillPoles(e,i,o){const c=this._vertexBuffer,p=It,m=e.length;for(let x=2;x<m;x+=3){const w=e[x-2],C=e[x-1],z=e[x],L=c[2*w],B=c[2*w+1],F=c[2*C],G=c[2*C+1],q=c[2*z],$=c[2*z+1];i&&(B===0&&G===0&&this._generatePoleQuad(e,w,C,L,F,za),G===0&&$===0&&this._generatePoleQuad(e,C,z,F,q,za),$===0&&B===0&&this._generatePoleQuad(e,z,w,q,L,za)),o&&(B===p&&G===p&&this._generatePoleQuad(e,w,C,L,F,Js),G===p&&$===p&&this._generatePoleQuad(e,C,z,F,q,Js),$===p&&B===p&&this._generatePoleQuad(e,z,w,q,L,Js))}}_initializeVertices(e){for(let i=0;i<e.length;i+=2)this._vertexToIndex(e[i],e[i+1])}subdividePolygonInternal(e,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:c}=(function(x){const w=[],C=[];for(const z of x)if(z.length!==0){z!==x[0]&&w.push(C.length/2);for(let L=0;L<z.length;L++)C.push(z[L].x),C.push(z[L].y)}return{flattened:C,holeIndices:w}})(e);let p;this._initializeVertices(o);try{const x=(function(C,z,L=2){const B=z&&z.length,F=B?z[0]*L:C.length;let G=zf(C,0,F,L,!0);const q=[];if(!G||G.next===G.prev)return q;let $,Q,ce;if(B&&(G=(function(J,ne,pe,ye){const ke=[];for(let Qe=0,He=ne.length;Qe<He;Qe++){const rt=zf(J,ne[Qe]*ye,Qe<He-1?ne[Qe+1]*ye:J.length,ye,!1);rt===rt.next&&(rt.steiner=!0),ke.push(ky(rt))}ke.sort(ir);for(let Qe=0;Qe<ke.length;Qe++)pe=Hp(ke[Qe],pe);return pe})(C,z,G,L)),C.length>80*L){$=C[0],Q=C[1];let J=$,ne=Q;for(let pe=L;pe<F;pe+=L){const ye=C[pe],ke=C[pe+1];ye<$&&($=ye),ke<Q&&(Q=ke),ye>J&&(J=ye),ke>ne&&(ne=ke)}ce=Math.max(J-$,ne-Q),ce=ce!==0?32767/ce:0}return yc(G,q,L,$,Q,ce,0),q})(o,c),w=this._convertIndices(o,x);p=this._subdivideTrianglesScanline(w)}catch(x){console.error(x)}let m=[];return i&&(m=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:m}}_convertIndices(e,i){const o=[];for(let c=0;c<i.length;c++)o.push(this._vertexToIndex(e[2*i[c]],e[2*i[c]+1]));return o}_pointArrayToIndices(e){const i=[];for(let o=0;o<e.length;o++){const c=e[o];i.push(this._vertexToIndex(c.x,c.y))}return i}}function Lf(n,e,i,o=!0){return new _l(i,e).subdividePolygonInternal(n,o)}function vl(n,e,i=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],c=n[n.length-1],p=i&&(o.x!==c.x||o.y!==c.y);if(e<2)return p?[...n,n[0]]:[...n];const m=Math.floor(It/e),x=[];x.push(new j(n[0].x,n[0].y));const w=n.length,C=p?w:w-1;for(let z=0;z<C;z++){const L=n[z],B=z<w-1?n[z+1]:n[0],F=L.x,G=L.y,q=B.x,$=B.y,Q=F!==q,ce=G!==$;if(!Q&&!ce)continue;const J=q-F,ne=$-G,pe=Math.abs(J),ye=Math.abs(ne);let ke=F,Qe=G;for(;;){const rt=J>0?(Math.floor(ke/m)+1)*m:(Math.ceil(ke/m)-1)*m,yt=ne>0?(Math.floor(Qe/m)+1)*m:(Math.ceil(Qe/m)-1)*m,st=Math.abs(ke-rt),Ye=Math.abs(Qe-yt),Ue=Math.abs(ke-q),St=Math.abs(Qe-$),bt=Q?st/pe:Number.POSITIVE_INFINITY,At=ce?Ye/ye:Number.POSITIVE_INFINITY;if((Ue<=st||!Q)&&(St<=Ye||!ce))break;if(bt<At&&Q||!ce){ke=rt,Qe+=ne*bt;const _t=new j(ke,Math.round(Qe));x[x.length-1].x===_t.x&&x[x.length-1].y===_t.y||x.push(_t)}else{ke+=J*At,Qe=yt;const _t=new j(Math.round(ke),Qe);x[x.length-1].x===_t.x&&x[x.length-1].y===_t.y||x.push(_t)}}const He=new j(q,$);x[x.length-1].x===He.x&&x[x.length-1].y===He.y||x.push(He)}return x}function eo(n,e,i){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,c=n[2*e[0]];for(let w=1;w<e.length;w++){const C=n[2*e[w]];C<c&&(c=C,o=w)}const p=e.length;let m=o,x=(m+1)%p;for(;;){const w=m-1>=0?m-1:p-1,C=(x+1)%p,z=n[2*e[w]],L=n[2*e[C]],B=n[2*e[m]],F=n[2*e[m]+1],G=n[2*e[x]+1];let q=!1;if(z<L)q=!0;else if(z>L)q=!1;else{const $=G-F,Q=-(n[2*e[x]]-B),ce=F<G?1:-1;((z-B)*$+(n[2*e[w]+1]-F)*Q)*ce>((L-B)*$+(n[2*e[C]+1]-F)*Q)*ce&&(q=!0)}if(q){const $=e[w],Q=e[m],ce=e[x];$!==Q&&$!==ce&&Q!==ce&&i.push(ce,Q,$),m--,m<0&&(m=p-1)}else{const $=e[C],Q=e[m],ce=e[x];$!==Q&&$!==ce&&Q!==ce&&i.push(ce,Q,$),x++,x>=p&&(x=0)}if(w===C)break}}function Yp(n,e,i,o,c,p,m,x,w){const C=c.length/2,z=m&&x&&w;if(C<gt.MAX_VERTEX_ARRAY_LENGTH){const L=e.prepareSegment(C,i,o),B=L.vertexLength;for(let q=0;q<p.length;q+=3)o.emplaceBack(B+p[q],B+p[q+1],B+p[q+2]);let F,G;L.vertexLength+=C,L.primitiveLength+=p.length/3,z&&(G=m.prepareSegment(C,i,x),F=G.vertexLength,G.vertexLength+=C);for(let q=0;q<c.length;q+=2)n(c[q],c[q+1]);if(z)for(let q=0;q<w.length;q++){const $=w[q];for(let Q=1;Q<$.length;Q+=2)x.emplaceBack(F+$[Q-1],F+$[Q]);G.primitiveLength+=$.length/2}}else(function(L,B,F,G,q,$){const Q=[];for(let ye=0;ye<G.length/2;ye++)Q.push(-1);const ce={count:0};let J=0,ne=L.getOrCreateLatestSegment(B,F),pe=ne.vertexLength;for(let ye=2;ye<q.length;ye+=3){const ke=q[ye-2],Qe=q[ye-1],He=q[ye];let rt=Q[ke]<J,yt=Q[Qe]<J,st=Q[He]<J;ne.vertexLength+((rt?1:0)+(yt?1:0)+(st?1:0))>gt.MAX_VERTEX_ARRAY_LENGTH&&(ne=L.createNewSegment(B,F),J=ce.count,rt=!0,yt=!0,st=!0,pe=0);const Ye=Lo(Q,G,$,ce,ke,rt,ne),Ue=Lo(Q,G,$,ce,Qe,yt,ne),St=Lo(Q,G,$,ce,He,st,ne);F.emplaceBack(pe+Ye-J,pe+Ue-J,pe+St-J),ne.primitiveLength++}})(e,i,o,c,p,n),z&&(function(L,B,F,G,q,$){const Q=[];for(let ye=0;ye<G.length/2;ye++)Q.push(-1);const ce={count:0};let J=0,ne=L.getOrCreateLatestSegment(B,F),pe=ne.vertexLength;for(let ye=0;ye<q.length;ye++){const ke=q[ye];for(let Qe=1;Qe<q[ye].length;Qe+=2){const He=ke[Qe-1],rt=ke[Qe];let yt=Q[He]<J,st=Q[rt]<J;ne.vertexLength+((yt?1:0)+(st?1:0))>gt.MAX_VERTEX_ARRAY_LENGTH&&(ne=L.createNewSegment(B,F),J=ce.count,yt=!0,st=!0,pe=0);const Ye=Lo(Q,G,$,ce,He,yt,ne),Ue=Lo(Q,G,$,ce,rt,st,ne);F.emplaceBack(pe+Ye-J,pe+Ue-J),ne.primitiveLength++}}})(m,i,x,c,w,n),e.forceNewSegmentOnNextPrepare(),m?.forceNewSegmentOnNextPrepare()}function Lo(n,e,i,o,c,p,m){if(p){const x=o.count;return i(e[2*c],e[2*c+1]),n[c]=o.count,o.count++,m.vertexLength++,x}return n[c]}class _c{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ae,this.indexArray=new je,this.indexArray2=new dt,this.programConfigurations=new Do(e.layers,e.zoom),this.segments=new gt,this.segments2=new gt,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Qa("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),p=!c.isConstant(),m=[];for(const{feature:x,id:w,index:C,sourceLayerIndex:z}of e){const L=this.layers[0]._featureFilter.needGeometry,B=Ka(x,L);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),B,o))continue;const F=p?c.evaluate(B,{},o,i.availableImages):void 0,G={id:w,properties:x.properties,type:x.type,sourceLayerIndex:z,index:C,geometry:L?B.geometry:Qs(x),patterns:{},sortKey:F};m.push(G)}p&&m.sort(((x,w)=>x.sortKey-w.sortKey));for(const x of m){const{geometry:w,index:C,sourceLayerIndex:z}=x;if(this.hasDependencies){const L=Pf("fill",this.layers,x,{zoom:this.zoom},i);this.patternFeatures.push(L)}else this.addFeature(x,w,C,o,{},i.subdivisionGranularity);i.featureIndex.insert(e[C].feature,w,C,z,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,i,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ud),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,c,p,m){for(const x of qu(i,500)){const w=Lf(x,c,m.fill.getGranularityForZoomLevel(c.z)),C=this.layoutVertexArray;Yp(((z,L)=>{C.emplaceBack(z,L)}),this.segments,this.layoutVertexArray,this.indexArray,w.verticesFlattened,w.indicesTriangles,this.segments2,this.indexArray2,w.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:c})}}let dh,vc;xt("FillBucket",_c,{omit:["layers","patternFeatures"]});var vg={get paint(){return vc=vc||new Mn({"fill-antialias":new Tt(Ie.paint_fill["fill-antialias"]),"fill-opacity":new Dt(Ie.paint_fill["fill-opacity"]),"fill-color":new Dt(Ie.paint_fill["fill-color"]),"fill-outline-color":new Dt(Ie.paint_fill["fill-outline-color"]),"fill-translate":new Tt(Ie.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(Ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ea(Ie.paint_fill["fill-pattern"])})},get layout(){return dh=dh||new Mn({"fill-sort-key":new Dt(Ie.layout_fill["fill-sort-key"])})}};class xg extends ln{constructor(e,i){super(e,vg,i)}recalculate(e,i){super.recalculate(e,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new _c(e)}queryRadius(){return id(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:i,transform:o,pixelsToTileUnits:c}){return xf(wf(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,c),i)}isTileClipped(){return!0}}const md=tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bg=tn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:kf}=md;class fh{constructor(e,i,o,c,p){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=p,e.readFields(By,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,o=[];let c,p=1,m=0,x=0,w=0;for(;e.pos<i;){if(m<=0){const C=e.readVarint();p=7&C,m=C>>3}if(m--,p===1||p===2)x+=e.readSVarint(),w+=e.readSVarint(),p===1&&(c&&o.push(c),c=[]),c&&c.push(new j(x,w));else{if(p!==7)throw new Error(`unknown command ${p}`);c&&c.push(c[0].clone())}}return c&&o.push(c),o}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let o=1,c=0,p=0,m=0,x=1/0,w=-1/0,C=1/0,z=-1/0;for(;e.pos<i;){if(c<=0){const L=e.readVarint();o=7&L,c=L>>3}if(c--,o===1||o===2)p+=e.readSVarint(),m+=e.readSVarint(),p<x&&(x=p),p>w&&(w=p),m<C&&(C=m),m>z&&(z=m);else if(o!==7)throw new Error(`unknown command ${o}`)}return[x,C,w,z]}toGeoJSON(e,i,o){const c=this.extent*Math.pow(2,o),p=this.extent*e,m=this.extent*i,x=this.loadGeometry();function w(B){return[360*(B.x+p)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(B.y+m)/c)*Math.PI))-90]}function C(B){return B.map(w)}let z;if(this.type===1){const B=[];for(const G of x)B.push(G[0]);const F=C(B);z=B.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const B=x.map(C);z=B.length===1?{type:"LineString",coordinates:B[0]}:{type:"MultiLineString",coordinates:B}}else{if(this.type!==3)throw new Error("unknown feature type");{const B=wg(x),F=[];for(const G of B)F.push(G.map(C));z=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const L={type:"Feature",geometry:z,properties:this.properties};return this.id!=null&&(L.id=this.id),L}}function By(n,e,i){n===1?e.id=i.readVarint():n===2?(function(o,c){const p=o.readVarint()+o.pos;for(;o.pos<p;){const m=c._keys[o.readVarint()],x=c._values[o.readVarint()];c.properties[m]=x}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function wg(n){const e=n.length;if(e<=1)return[n];const i=[];let o,c;for(let p=0;p<e;p++){const m=Ui(n[p]);m!==0&&(c===void 0&&(c=m<0),c===m<0?(o&&i.push(o),o=[n[p]]):o&&o.push(n[p]))}return o&&i.push(o),i}function Ui(n){let e=0;for(let i,o,c=0,p=n.length,m=p-1;c<p;m=c++)i=n[c],o=n[m],e+=(o.x-i.x)*(i.y+o.y);return e}fh.types=["Unknown","Point","LineString","Polygon"];class rn{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(pi,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new fh(this._pbf,i,this.extent,this._keys,this._values)}}function pi(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(o){let c=null;const p=o.readVarint()+o.pos;for(;o.pos<p;){const m=o.readVarint()>>3;c=m===1?o.readString():m===2?o.readFloat():m===3?o.readDouble():m===4?o.readVarint64():m===5?o.readVarint():m===6?o.readSVarint():m===7?o.readBoolean():null}if(c==null)throw new Error("unknown feature value");return c})(i))}class mi{constructor(e,i){this.layers=e.readFields($i,{},i)}}function $i(n,e,i){if(n===3){const o=new rn(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}const da=Math.pow(2,13);function Ps(n,e,i,o,c,p,m,x){n.emplaceBack(e,i,2*Math.floor(o*da)+m,c*da*2,p*da*2,Math.round(x))}class hu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ue,this.centroidVertexArray=new re,this.indexArray=new je,this.programConfigurations=new Do(e.layers,e.zoom),this.segments=new gt,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.features=[],this.hasDependencies=Qa("fill-extrusion",this.layers,i);for(const{feature:c,id:p,index:m,sourceLayerIndex:x}of e){const w=this.layers[0]._featureFilter.needGeometry,C=Ka(c,w);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),C,o))continue;const z={id:p,sourceLayerIndex:x,index:m,geometry:w?C.geometry:Qs(c),properties:c.properties,type:c.type,patterns:{}};this.hasDependencies?this.features.push(Pf("fill-extrusion",this.layers,z,{zoom:this.zoom},i)):this.addFeature(z,z.geometry,m,o,{},i.subdivisionGranularity),i.featureIndex.insert(c,z.geometry,m,x,this.index,!0)}}addFeatures(e,i,o){for(const c of this.features){const{geometry:p}=c;this.addFeature(c,p,c.index,i,o,e.subdivisionGranularity)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kf),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,bg.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,o,c,p,m){for(const x of qu(i,500)){const w={x:0,y:0,sampleCount:0},C=this.layoutVertexArray.length;this.processPolygon(w,c,e,x,m);const z=this.layoutVertexArray.length-C,L=Math.floor(w.x/w.sampleCount),B=Math.floor(w.y/w.sampleCount);for(let F=0;F<z;F++)this.centroidVertexArray.emplaceBack(L,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:c})}processPolygon(e,i,o,c,p){if(c.length<1||In(c[0]))return;for(const L of c)L.length!==0&&Wp(e,L);const m={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},x=p.fill.getGranularityForZoomLevel(i.z),w=fh.types[o.type]==="Polygon";for(const L of c){if(L.length===0||In(L))continue;const B=vl(L,x,w);this._generateSideFaces(B,m)}if(!w)return;const C=Lf(c,i,x,!1),z=this.layoutVertexArray;Yp(((L,B)=>{Ps(z,L,B,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles)}_generateSideFaces(e,i){let o=0;for(let c=1;c<e.length;c++){const p=e[c],m=e[c-1];if(xl(p,m))continue;i.segment.vertexLength+4>gt.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const x=p.sub(m)._perp()._unit(),w=m.dist(p);o+w>32768&&(o=0),Ps(this.layoutVertexArray,p.x,p.y,x.x,x.y,0,0,o),Ps(this.layoutVertexArray,p.x,p.y,x.x,x.y,0,1,o),o+=w,Ps(this.layoutVertexArray,m.x,m.y,x.x,x.y,0,0,o),Ps(this.layoutVertexArray,m.x,m.y,x.x,x.y,0,1,o);const C=i.segment.vertexLength;this.indexArray.emplaceBack(C,C+2,C+1),this.indexArray.emplaceBack(C+1,C+2,C+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function Wp(n,e){for(let i=0;i<e.length;i++){const o=e[i];i===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function xl(n,e){return n.x===e.x&&(n.x<0||n.x>It)||n.y===e.y&&(n.y<0||n.y>It)}function In(n){return n.every((e=>e.x<0))||n.every((e=>e.x>It))||n.every((e=>e.y<0))||n.every((e=>e.y>It))}let bl;xt("FillExtrusionBucket",hu,{omit:["layers","features"]});var xc={get paint(){return bl=bl||new Mn({"fill-extrusion-opacity":new Tt(Ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Dt(Ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(Ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(Ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ea(Ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Dt(Ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Dt(Ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Tt(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Kp extends ln{constructor(e,i){super(e,xc,i)}createBucket(e){return new hu(e)}queryRadius(){return id(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:c,transform:p,pixelsToTileUnits:m,pixelPosMatrix:x}){const w=wf(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,m),C=this.paint.get("fill-extrusion-height").evaluate(i,o),z=this.paint.get("fill-extrusion-base").evaluate(i,o),L=(function(F,G){const q=[];for(const $ of F){const Q=[$.x,$.y,0,1];mr(Q,Q,G),q.push(new j(Q[0]/Q[3],Q[1]/Q[3]))}return q})(w,x),B=(function(F,G,q,$){const Q=[],ce=[],J=$[8]*G,ne=$[9]*G,pe=$[10]*G,ye=$[11]*G,ke=$[8]*q,Qe=$[9]*q,He=$[10]*q,rt=$[11]*q;for(const yt of F){const st=[],Ye=[];for(const Ue of yt){const St=Ue.x,bt=Ue.y,At=$[0]*St+$[4]*bt+$[12],_t=$[1]*St+$[5]*bt+$[13],Bt=$[2]*St+$[6]*bt+$[14],xi=$[3]*St+$[7]*bt+$[15],oi=Bt+pe,xn=xi+ye,Yr=At+ke,or=_t+Qe,bn=Bt+He,cn=xi+rt,Li=new j((At+J)/xn,(_t+ne)/xn);Li.z=oi/xn,st.push(Li);const Ln=new j(Yr/cn,or/cn);Ln.z=bn/cn,Ye.push(Ln)}Q.push(st),ce.push(Ye)}return[Q,ce]})(c,z,C,x);return(function(F,G,q){let $=1/0;xf(q,G)&&($=bc(q,G[0]));for(let Q=0;Q<G.length;Q++){const ce=G[Q],J=F[Q];for(let ne=0;ne<ce.length-1;ne++){const pe=ce[ne],ye=[pe,ce[ne+1],J[ne+1],J[ne],pe];gc(q,ye)&&($=Math.min($,bc(q,ye)))}}return $!==1/0&&$})(B[0],B[1],L)}}function Lr(n,e){return n.x*e.x+n.y*e.y}function bc(n,e){if(n.length===1){let i=0;const o=e[i++];let c;for(;!c||o.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const p=e[i],m=n[0],x=c.sub(o),w=p.sub(o),C=m.sub(o),z=Lr(x,x),L=Lr(x,w),B=Lr(w,w),F=Lr(C,x),G=Lr(C,w),q=z*B-L*L,$=(B*F-L*G)/q,Q=(z*G-L*F)/q,ce=o.z*(1-$-Q)+c.z*$+p.z*Q;if(isFinite(ce))return ce}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}const gd=tn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ra}=gd,Qp=tn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Bf}=Qp,Tg=Math.cos(Math.PI/180*37.5),yd=Math.pow(2,14)/.5;class ph{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new ge,this.layoutVertexArray2=new le,this.indexArray=new je,this.programConfigurations=new Do(e.layers,e.zoom),this.segments=new gt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Qa("line",this.layers,i)||this.hasLineDasharray(this.layers);const c=this.layers[0].layout.get("line-sort-key"),p=!c.isConstant(),m=[];for(const{feature:x,id:w,index:C,sourceLayerIndex:z}of e){const L=this.layers[0]._featureFilter.needGeometry,B=Ka(x,L);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),B,o))continue;const F=p?c.evaluate(B,{},o):void 0,G={id:w,properties:x.properties,type:x.type,sourceLayerIndex:z,index:C,geometry:L?B.geometry:Qs(x),patterns:{},dashes:{},sortKey:F};m.push(G)}p&&m.sort(((x,w)=>x.sortKey-w.sortKey));for(const x of m){const{geometry:w,index:C,sourceLayerIndex:z}=x;this.hasDependencies?(Qa("line",this.layers,i)?Pf("line",this.layers,x,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,x,this.zoom,i),this.patternFeatures.push(x)):this.addFeature(x,w,C,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(e[C].feature,w,C,z,this.index)}}update(e,i,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o,dashPositions:c})}addFeatures(e,i,o,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,o,c,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Bf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ra),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,c,p,m,x){const w=this.layers[0].layout,C=w.get("line-join").evaluate(e,{}),z=w.get("line-cap"),L=w.get("line-miter-limit"),B=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of i)this.addLine(F,e,C,z,L,B,c,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,dashPositions:m,canonical:c})}addLine(e,i,o,c,p,m,x,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=vl(e,x?w.line.getGranularityForZoomLevel(x.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<e.length-1;J++)this.totalDistance+=e[J].dist(e[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=fh.types[i.type]==="Polygon";let z=e.length;for(;z>=2&&e[z-1].equals(e[z-2]);)z--;let L=0;for(;L<z-1&&e[L].equals(e[L+1]);)L++;if(z<(C?3:2))return;o==="bevel"&&(p=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray);let G,q,$,Q,ce;this.e1=this.e2=-1,C&&(G=e[z-2],ce=e[L].sub(G)._unit()._perp());for(let J=L;J<z;J++){if($=J===z-1?C?e[L+1]:void 0:e[J+1],$&&e[J].equals($))continue;ce&&(Q=ce),G&&(q=G),G=e[J],ce=$?$.sub(G)._unit()._perp():Q,Q=Q||ce;let ne=Q.add(ce);ne.x===0&&ne.y===0||ne._unit();const pe=Q.x*ce.x+Q.y*ce.y,ye=ne.x*ce.x+ne.y*ce.y,ke=ye!==0?1/ye:1/0,Qe=2*Math.sqrt(2-2*ye),He=ye<Tg&&q&&$,rt=Q.x*ce.y-Q.y*ce.x>0;if(He&&J>L){const Ye=G.dist(q);if(Ye>2*B){const Ue=G.sub(G.sub(q)._mult(B/Ye)._round());this.updateDistance(q,Ue),this.addCurrentVertex(Ue,Q,0,0,F),q=Ue}}const yt=q&&$;let st=yt?o:C?"butt":c;if(yt&&st==="round"&&(ke<m?st="miter":ke<=2&&(st="fakeround")),st==="miter"&&ke>p&&(st="bevel"),st==="bevel"&&(ke>2&&(st="flipbevel"),ke<p&&(st="miter")),q&&this.updateDistance(q,G),st==="miter")ne._mult(ke),this.addCurrentVertex(G,ne,0,0,F);else if(st==="flipbevel"){if(ke>100)ne=ce.mult(-1);else{const Ye=ke*Q.add(ce).mag()/Q.sub(ce).mag();ne._perp()._mult(Ye*(rt?-1:1))}this.addCurrentVertex(G,ne,0,0,F),this.addCurrentVertex(G,ne.mult(-1),0,0,F)}else if(st==="bevel"||st==="fakeround"){const Ye=-Math.sqrt(ke*ke-1),Ue=rt?Ye:0,St=rt?0:Ye;if(q&&this.addCurrentVertex(G,Q,Ue,St,F),st==="fakeround"){const bt=Math.round(180*Qe/Math.PI/20);for(let At=1;At<bt;At++){let _t=At/bt;if(_t!==.5){const xi=_t-.5;_t+=_t*xi*(_t-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*xi*xi+(.848013+pe*(.215638*pe-1.06021)))}const Bt=ce.sub(Q)._mult(_t)._add(Q)._unit()._mult(rt?-1:1);this.addHalfVertex(G,Bt.x,Bt.y,!1,rt,0,F)}}$&&this.addCurrentVertex(G,ce,-Ue,-St,F)}else if(st==="butt")this.addCurrentVertex(G,ne,0,0,F);else if(st==="square"){const Ye=q?1:-1;this.addCurrentVertex(G,ne,Ye,Ye,F)}else st==="round"&&(q&&(this.addCurrentVertex(G,Q,0,0,F),this.addCurrentVertex(G,Q,1,1,F,!0)),$&&(this.addCurrentVertex(G,ce,-1,-1,F,!0),this.addCurrentVertex(G,ce,0,0,F)));if(He&&J<z-1){const Ye=G.dist($);if(Ye>2*B){const Ue=G.add($.sub(G)._mult(B/Ye)._round());this.updateDistance(G,Ue),this.addCurrentVertex(Ue,ce,0,0,F),G=Ue}}}}addCurrentVertex(e,i,o,c,p,m=!1){const x=i.y*c-i.x,w=-i.y-i.x*c;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,m,!1,o,p),this.addHalfVertex(e,x,w,m,!0,-c,p),this.distance>yd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,i,o,c,p,m))}addHalfVertex({x:e,y:i},o,c,p,m,x,w){const C=.5*(this.lineClips?this.scaledDistance*(yd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(x===0?0:x<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,z,this.e2),w.primitiveLength++),m?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}hasLineDasharray(e){for(const i of e){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,i,o,c){for(const p of e){const m=p.paint.get("line-dasharray");if(!m||m.value.kind==="constant")continue;const x=p.layout.get("line-cap")==="round",w={dasharray:m.value.evaluate({zoom:o-1},i,{}),round:x},C={dasharray:m.value.evaluate({zoom:o},i,{}),round:x},z={dasharray:m.value.evaluate({zoom:o+1},i,{}),round:x},L=`${w.dasharray.join(",")},${w.round}`,B=`${C.dasharray.join(",")},${C.round}`,F=`${z.dasharray.join(",")},${z.round}`;c.dashDependencies[L]=w,c.dashDependencies[B]=C,c.dashDependencies[F]=z,i.dashes[p.id]={min:L,mid:B,max:F}}}}let wl,rr;xt("LineBucket",ph,{omit:["layers","patternFeatures"]});var Tl={get paint(){return rr=rr||new Mn({"line-opacity":new Dt(Ie.paint_line["line-opacity"]),"line-color":new Dt(Ie.paint_line["line-color"]),"line-translate":new Tt(Ie.paint_line["line-translate"]),"line-translate-anchor":new Tt(Ie.paint_line["line-translate-anchor"]),"line-width":new Dt(Ie.paint_line["line-width"]),"line-gap-width":new Dt(Ie.paint_line["line-gap-width"]),"line-offset":new Dt(Ie.paint_line["line-offset"]),"line-blur":new Dt(Ie.paint_line["line-blur"]),"line-dasharray":new Ea(Ie.paint_line["line-dasharray"]),"line-pattern":new Ea(Ie.paint_line["line-pattern"]),"line-gradient":new uc(Ie.paint_line["line-gradient"])})},get layout(){return wl=wl||new Mn({"line-cap":new Tt(Ie.layout_line["line-cap"]),"line-join":new Dt(Ie.layout_line["line-join"]),"line-miter-limit":new Tt(Ie.layout_line["line-miter-limit"]),"line-round-limit":new Tt(Ie.layout_line["line-round-limit"]),"line-sort-key":new Dt(Ie.layout_line["line-sort-key"])})}};class mh extends Dt{possiblyEvaluate(e,i){return i=new Ei(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,c){return i=Bi({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,c)}}let zs;class Jp extends ln{constructor(e,i){super(e,Tl,i),this.gradientVersion=0,zs||(zs=new mh(Tl.paint.properties["line-width"].specification),zs.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof mo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=zs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new ph(e)}queryRadius(e){const i=e,o=Of(ml("line-width",this,i),ml("line-gap-width",this,i)),c=ml("line-offset",this,i);return o/2+Math.abs(c)+id(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:c,transform:p,pixelsToTileUnits:m}){const x=wf(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,m),w=m/2*Of(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),C=this.paint.get("line-offset").evaluate(i,o);return C&&(c=(function(z,L){const B=[];for(let F=0;F<z.length;F++){const G=Tf(z[F]),q=[];for(let $=0;$<G.length;$++){const Q=G[$],ce=G[$-1],J=G[$+1],ne=$===0?new j(0,0):Q.sub(ce)._unit()._perp(),pe=$===G.length-1?new j(0,0):J.sub(Q)._unit()._perp(),ye=ne._add(pe)._unit(),ke=ye.x*pe.x+ye.y*pe.y;ke!==0&&ye._mult(1/ke),q.push(ye._mult(L)._add(Q))}B.push(q)}return B})(c,C*m)),(function(z,L,B){for(let F=0;F<L.length;F++){const G=L[F];if(z.length>=3){for(let q=0;q<G.length;q++)if(zo(z,G[q]))return!0}if(tr(z,G,B))return!0}return!1})(x,c,w)}isTileClipped(){return!0}}function Of(n,e){return e>0?e+2*n:n}const Sg=tn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_d=tn([{name:"a_projected_pos",components:3,type:"Float32"}],4);tn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const em=tn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);tn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ia=tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Mg=tn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function La(n,e,i){return n.sections.forEach((o=>{o.text=(function(c,p,m){const x=p.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?c=c.toLocaleUpperCase():x==="lowercase"&&(c=c.toLocaleLowerCase()),Ma.applyArabicShaping&&(c=Ma.applyArabicShaping(c)),c})(o.text,e,i)})),n}tn([{name:"triangle",components:3,type:"Uint16"}]),tn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),tn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),tn([{type:"Float32",name:"offsetX"}]),tn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),tn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var $n=24;const gh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Oy={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},du={40:!0};function vd(n,e,i,o,c,p){if("fontStack"in e){const m=i[e.fontStack],x=m&&m[n];return x?x.metrics.advance*e.scale+c:0}{const m=o[e.imageName];return m?m.displaySize[0]*e.scale*$n/p+c:0}}function Ff(n,e,i,o){const c=Math.pow(n-e,2);return o?n<e?c/2:2*c:c+Math.abs(i)*i}function yh(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function tm(n,e,i,o,c,p){let m=null,x=Ff(e,i,c,p);for(const w of o){const C=Ff(e-w.x,i,c,p)+w.badness;C<=x&&(m=w,x=C)}return{index:n,x:e,priorBreak:m,badness:x}}function im(n){return n?im(n.priorBreak).concat(n.index):[]}class wc{constructor(e="",i=[],o=[]){this.text=e,this.sections=i,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,i){const o=new wc;for(let c=0;c<e.sections.length;c++){const p=e.sections[c];p.image?o.addImageSection(p):o.addTextSection(p,i)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let i="",o={premature:!0,value:void 0};const c=e[Symbol.iterator]();let p=c.next();const m=e[Symbol.iterator]();m.next();let x=m.next();for(;!p.done;)i+=!x.done&&Ms(x.value.codePointAt(0))&&!gh[x.value]||!o.premature&&Ms(o.value.codePointAt(0))&&!gh[o.value]||!gh[p.value]?p.value:gh[p.value],o={value:p.value,premature:!1},p=c.next(),x=m.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),i=e?e[0].length:0,o=this.text.match(/\S\s*$/),c=o?o[0].length-1:0;this.text=this.text.substring(i,this.text.length-c),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-c)}substring(e,i){const o=[...this.text].slice(e,i).join(""),c=this.sectionIndex.slice(e,i);return new wc(o,this.sections,c)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}getMaxImageSize(e){let i=0,o=0;for(let c=0;c<this.length();c++){const p=this.getSection(c);if("imageName"in p){const m=e[p.imageName];if(!m)continue;const x=m.displaySize;i=Math.max(i,x[0]),o=Math.max(o,x[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(e,i){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||i});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void sn("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):sn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,i,o,c,p){const m=[],x=this.determineAverageLineWidth(e,i,o,c,p),w=this.hasZeroWidthSpaces();let C=0,z=0;const L=this.text[Symbol.iterator]();let B=L.next();const F=this.text[Symbol.iterator]();F.next();let G=F.next();const q=this.text[Symbol.iterator]();q.next(),q.next();let $=q.next();for(;!B.done;){const Q=this.getSection(z),ce=B.value.codePointAt(0);if(rc(ce)||(C+=vd(ce,Q,o,c,e,p)),!G.done){const J=ws(ce),ne=G.value.codePointAt(0);(Oy[ce]||J||"imageName"in Q||!$.done&&du[ne])&&m.push(tm(z+1,C,x,m,yh(ce,ne,J&&w),!1))}z++,B=L.next(),G=F.next(),$=q.next()}return im(tm(this.length(),C,x,m,0,!0))}determineAverageLineWidth(e,i,o,c,p){let m=0,x=0;for(const w of this.text){const C=this.getSection(x);m+=vd(w.codePointAt(0),C,o,c,e,p),x++}return m/Math.max(1,Math.ceil(m/i))}}const jf=4294967296,xd=1/jf,Nf=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Vf{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,i,o=this.length){for(;this.pos<o;){const c=this.readVarint(),p=c>>3,m=this.pos;this.type=7&c,e(p,i,this),this.pos===m&&this.skip(c)}return i}readMessage(e,i){return this.readFields(e,i,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*jf;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*jf;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const i=this.buf;let o,c;return c=i[this.pos++],o=127&c,c<128?o:(c=i[this.pos++],o|=(127&c)<<7,c<128?o:(c=i[this.pos++],o|=(127&c)<<14,c<128?o:(c=i[this.pos++],o|=(127&c)<<21,c<128?o:(c=i[this.pos],o|=(15&c)<<28,(function(p,m,x){const w=x.buf;let C,z;if(z=w[x.pos++],C=(112&z)>>4,z<128||(z=w[x.pos++],C|=(127&z)<<3,z<128)||(z=w[x.pos++],C|=(127&z)<<10,z<128)||(z=w[x.pos++],C|=(127&z)<<17,z<128)||(z=w[x.pos++],C|=(127&z)<<24,z<128)||(z=w[x.pos++],C|=(1&z)<<31,z<128))return _h(p,C,m);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=12&&Nf?Nf.decode(this.buf.subarray(i,e)):(function(o,c,p){let m="",x=c;for(;x<p;){const w=o[x];let C,z,L,B=null,F=w>239?4:w>223?3:w>191?2:1;if(x+F>p)break;F===1?w<128&&(B=w):F===2?(C=o[x+1],(192&C)==128&&(B=(31&w)<<6|63&C,B<=127&&(B=null))):F===3?(C=o[x+1],z=o[x+2],(192&C)==128&&(192&z)==128&&(B=(15&w)<<12|(63&C)<<6|63&z,(B<=2047||B>=55296&&B<=57343)&&(B=null))):F===4&&(C=o[x+1],z=o[x+2],L=o[x+3],(192&C)==128&&(192&z)==128&&(192&L)==128&&(B=(15&w)<<18|(63&C)<<12|(63&z)<<6|63&L,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,F=1):B>65535&&(B-=65536,m+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),m+=String.fromCharCode(B),x+=F}return m})(this.buf,i,e)}readBytes(){const e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i}readPackedVarint(e=[],i){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(i));return e}readPackedSVarint(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const i=7&e;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(e,i){this.writeVarint(e<<3|i)}realloc(e){let i=this.length||16;for(;i<this.pos+e;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*xd),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*xd),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(i,o){let c,p;if(i>=0?(c=i%4294967296|0,p=i/4294967296|0):(c=~(-i%4294967296),p=~(-i/4294967296),4294967295^c?c=c+1|0:(c=0,p=p+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(m,x,w){w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,w.buf[w.pos]=127&(m>>>=7)})(c,0,o),(function(m,x){const w=(7&m)<<4;x.buf[x.pos++]|=w|((m>>>=3)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m)))))})(p,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const i=this.pos;this.pos=(function(c,p,m){for(let x,w,C=0;C<p.length;C++){if(x=p.charCodeAt(C),x>55295&&x<57344){if(!w){x>56319||C+1===p.length?(c[m++]=239,c[m++]=191,c[m++]=189):w=x;continue}if(x<56320){c[m++]=239,c[m++]=191,c[m++]=189,w=x;continue}x=w-55296<<10|x-56320|65536,w=null}else w&&(c[m++]=239,c[m++]=191,c[m++]=189,w=null);x<128?c[m++]=x:(x<2048?c[m++]=x>>6|192:(x<65536?c[m++]=x>>12|224:(c[m++]=x>>18|240,c[m++]=x>>12&63|128),c[m++]=x>>6&63|128),c[m++]=63&x|128)}return m})(this.buf,e,this.pos);const o=this.pos-i;o>=128&&Eg(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const i=e.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,i){this.pos++;const o=this.pos;e(i,this);const c=this.pos-o;c>=128&&Eg(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c}writeMessage(e,i,o){this.writeTag(e,2),this.writeRawMessage(i,o)}writePackedVarint(e,i){i.length&&this.writeMessage(e,Ag,i)}writePackedSVarint(e,i){i.length&&this.writeMessage(e,Cg,i)}writePackedBoolean(e,i){i.length&&this.writeMessage(e,Dg,i)}writePackedFloat(e,i){i.length&&this.writeMessage(e,vh,i)}writePackedDouble(e,i){i.length&&this.writeMessage(e,Uf,i)}writePackedFixed32(e,i){i.length&&this.writeMessage(e,Pg,i)}writePackedSFixed32(e,i){i.length&&this.writeMessage(e,zg,i)}writePackedFixed64(e,i){i.length&&this.writeMessage(e,Rg,i)}writePackedSFixed64(e,i){i.length&&this.writeMessage(e,Ig,i)}writeBytesField(e,i){this.writeTag(e,2),this.writeBytes(i)}writeFixed32Field(e,i){this.writeTag(e,5),this.writeFixed32(i)}writeSFixed32Field(e,i){this.writeTag(e,5),this.writeSFixed32(i)}writeFixed64Field(e,i){this.writeTag(e,1),this.writeFixed64(i)}writeSFixed64Field(e,i){this.writeTag(e,1),this.writeSFixed64(i)}writeVarintField(e,i){this.writeTag(e,0),this.writeVarint(i)}writeSVarintField(e,i){this.writeTag(e,0),this.writeSVarint(i)}writeStringField(e,i){this.writeTag(e,2),this.writeString(i)}writeFloatField(e,i){this.writeTag(e,5),this.writeFloat(i)}writeDoubleField(e,i){this.writeTag(e,1),this.writeDouble(i)}writeBooleanField(e,i){this.writeVarintField(e,+i)}}function _h(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function Eg(n,e,i){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(let c=i.pos-1;c>=n;c--)i.buf[c+o]=i.buf[c]}function Ag(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function Cg(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function vh(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function Uf(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function Dg(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function Pg(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function zg(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function Rg(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function Ig(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}function Lg(n,e,i){n===1&&i.readMessage(Gf,e)}function Gf(n,e,i){if(n===3){const{id:o,bitmap:c,width:p,height:m,left:x,top:w,advance:C}=i.readMessage(kg,{});e.push({id:o,bitmap:new ad({width:p+6,height:m+6},c),metrics:{width:p,height:m,left:x,top:w,advance:C}})}}function kg(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}function nm(n){let e=0,i=0;for(const m of n)e+=m.w*m.h,i=Math.max(i,m.w);n.sort(((m,x)=>x.h-m.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,p=0;for(const m of n)for(let x=o.length-1;x>=0;x--){const w=o[x];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,p=Math.max(p,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===w.w&&m.h===w.h){const C=o.pop();C&&x<o.length&&(o[x]=C)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(o.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:c,h:p,fill:e/(c*p)||0}}class Gi{constructor(e,{pixelRatio:i,version:o,stretchX:c,stretchY:p,content:m,textFitWidth:x,textFitHeight:w}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=c,this.stretchY=p,this.content=m,this.version=o,this.textFitWidth=x,this.textFitHeight=w}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class qf{constructor(e,i){const o={},c={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,o,p),this.addImages(i,c,p);const{w:m,h:x}=nm(p),w=new Zr({width:m||1,height:x||1});for(const C in e){const z=e[C],L=o[C].paddedRect;Zr.copy(z.data,w,{x:0,y:0},{x:L.x+1,y:L.y+1},z.data)}for(const C in i){const z=i[C],L=c[C].paddedRect,B=L.x+1,F=L.y+1,G=z.data.width,q=z.data.height;Zr.copy(z.data,w,{x:0,y:0},{x:B,y:F},z.data),Zr.copy(z.data,w,{x:0,y:q-1},{x:B,y:F-1},{width:G,height:1}),Zr.copy(z.data,w,{x:0,y:0},{x:B,y:F+q},{width:G,height:1}),Zr.copy(z.data,w,{x:G-1,y:0},{x:B-1,y:F},{width:1,height:q}),Zr.copy(z.data,w,{x:0,y:0},{x:B+G,y:F},{width:1,height:q})}this.image=w,this.iconPositions=o,this.patternPositions=c}addImages(e,i,o){for(const c in e){const p=e[c],m={x:0,y:0,w:p.data.width+2,h:p.data.height+2};o.push(m),i[c]=new Gi(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,p]=e.tl;o.update(i.data,void 0,{x:c,y:p})}}var fu;function bd(n,e,i,o,c,p,m,x,w,C,z,L,B,F,G){const q=wc.fromFeature(n,c);let $;L===M.az.vertical&&q.verticalizePunctuation();let Q=q.determineLineBreaks(C,p,e,o,F);const{processBidirectionalText:ce,processStyledBidirectionalText:J}=Ma;if(ce&&q.sections.length===1){$=[],Q=Q.map((ke=>q.toCodeUnitIndex(ke)));const ye=ce(q.toString(),Q);for(const ke of ye){const Qe=[...ke].map((()=>0));$.push(new wc(ke,q.sections,Qe))}}else if(J){$=[],Q=Q.map((He=>q.toCodeUnitIndex(He)));let ye=0;const ke=[];for(const He of q.text)ke.push(...Array(He.length).fill(q.sectionIndex[ye])),ye++;const Qe=J(q.text,ke,Q);for(const He of Qe){const rt=[];let yt="";for(const st of He[0])rt.push(He[1][yt.length]),yt+=st;$.push(new wc(He[0],q.sections,rt))}}else $=(function(ye,ke){const Qe=[];let He=0;for(const rt of ke)Qe.push(ye.substring(He,rt)),He=rt;return He<ye.length()&&Qe.push(ye.substring(He,ye.length())),Qe})(q,Q);const ne=[],pe={positionedLines:ne,text:q.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:L,iconsInText:!1,verticalizable:!1};return(function(ye,ke,Qe,He,rt,yt,st,Ye,Ue,St,bt,At){let _t=0,Bt=0,xi=0,oi=0;const xn=Ye==="right"?1:Ye==="left"?0:.5,Yr=$n/At;let or=0;for(const Li of rt){Li.trim();const Ln=Li.getMaxScale(),Nn={positionedGlyphs:[],lineOffset:0};ye.positionedLines[or]=Nn;const an=Nn.positionedGlyphs;let ts=0;if(!Li.length()){Bt+=yt,++or;continue}const Wr=Fy(He,Li,Yr);let is=0;for(const Tr of Li.text){const An=Li.getSection(is),lr=Tr.codePointAt(0),kn=Zf(Ue,bt,lr),Sr={glyph:lr,imageName:null,x:_t,y:Bt+-17,vertical:kn,scale:1,fontStack:"",sectionIndex:Li.getSectionIndex(is),metrics:null,rect:null};let Ec;if("fontStack"in An){if(Ec=xh(An,lr,kn,Wr,ke,Qe),!Ec)continue;Sr.fontStack=An.fontStack}else{if(ye.iconsInText=!0,An.scale*=Yr,Ec=am(An,kn,Ln,Wr,He),!Ec)continue;ts=Math.max(ts,Ec.imageOffset),Sr.imageName=An.imageName}const{rect:Dl,metrics:jm,baselineOffset:Ph}=Ec;Sr.y+=Ph,Sr.scale=An.scale,Sr.metrics=jm,Sr.rect=Dl,an.push(Sr),kn?(ye.verticalizable=!0,_t+=("imageName"in An?jm.advance:$n)*An.scale+St):_t+=jm.advance*An.scale+St,is++}an.length!==0&&(xi=Math.max(_t-St,xi),Hf(an,0,an.length-1,xn)),_t=0,Nn.lineOffset=Math.max(ts,(Ln-1)*$n);const Oo=yt*Ln+ts;Bt+=Oo,oi=Math.max(Oo,oi),++or}const{horizontalAlign:bn,verticalAlign:cn}=rm(st);(function(Li,Ln,Nn,an,ts,Wr,is,Oo,Tr){const An=(Ln-Nn)*ts;let lr=0;lr=Wr!==is?-Oo*an- -17:-an*Tr*is+.5*is;for(const kn of Li)for(const Sr of kn.positionedGlyphs)Sr.x+=An,Sr.y+=lr})(ye.positionedLines,xn,bn,cn,xi,oi,yt,Bt,rt.length),ye.top+=-cn*Bt,ye.bottom=ye.top+Bt,ye.left+=-bn*xi,ye.right=ye.left+xi})(pe,e,i,o,$,m,x,w,L,C,B,G),!(function(ye){for(const ke of ye)if(ke.positionedGlyphs.length!==0)return!1;return!0})(ne)&&pe}function rm(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Fy(n,e,i){const o=e.getMaxScale()*$n,{maxImageWidth:c,maxImageHeight:p}=e.getMaxImageSize(n),m=Math.max(o,p*i);return{verticalLineContentWidth:Math.max(o,c*i),horizontalLineContentHeight:m}}function Bg(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function Zf(n,e,i){return!(n===M.az.horizontal||!e&&!ol(i)||e&&(rc(i)||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function xh(n,e,i,o,c,p){const m=p[n.fontStack],x=(function(C,z,L,B){if(C&&C.rect)return C;const F=z[L.fontStack],G=F&&F[B];return G?{rect:null,metrics:G.metrics}:null})(m&&m[e],c,n,e);if(x===null)return null;let w;if(i)w=o.verticalLineContentWidth-n.scale*$n;else{const C=Bg(n.verticalAlign);w=(o.horizontalLineContentHeight-n.scale*$n)*C}return{rect:x.rect,metrics:x.metrics,baselineOffset:w}}function am(n,e,i,o,c){const p=c[n.imageName];if(!p)return null;const m=p.paddedRect,x=p.displaySize,w={width:x[0],height:x[1],left:1,top:-3,advance:e?x[1]:x[0]};let C;if(e)C=o.verticalLineContentWidth-x[1]*n.scale;else{const z=Bg(n.verticalAlign);C=(o.horizontalLineContentHeight-x[1]*n.scale)*z}return{rect:m,metrics:w,baselineOffset:C,imageOffset:(e?x[0]:x[1])*n.scale-$n*i}}function Hf(n,e,i,o){if(o===0)return;const c=n[i],p=(n[i].x+c.metrics.advance*c.scale)*o;for(let m=e;m<=i;m++)n[m].x-=p}function sm(n,e,i){const{horizontalAlign:o,verticalAlign:c}=rm(i),p=e[0]-n.displaySize[0]*o,m=e[1]-n.displaySize[1]*c;return{image:n,top:m,bottom:m+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function Sl(n){var e,i;let o=n.left,c=n.top,p=n.right-o,m=n.bottom-c;const x=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",w=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",C=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(w==="proportional"){if(x==="stretchOnly"&&p/m<C||x==="proportional"){const z=Math.ceil(m*C);o*=z/p,p=z}}else if(x==="proportional"&&w==="stretchOnly"&&C!==0&&p/m>C){const z=Math.ceil(p/C);c*=z/m,m=z}return{x1:o,y1:c,x2:o+p,y2:c+m}}function to(n,e,i,o,c,p){const m=n.image;let x;if(m.content){const $=m.content,Q=m.pixelRatio||1;x=[$[0]/Q,$[1]/Q,m.displaySize[0]-$[2]/Q,m.displaySize[1]-$[3]/Q]}const w=e.left*p,C=e.right*p;let z,L,B,F;i==="width"||i==="both"?(F=c[0]+w-o[3],L=c[0]+C+o[1]):(F=c[0]+(w+C-m.displaySize[0])/2,L=F+m.displaySize[0]);const G=e.top*p,q=e.bottom*p;return i==="height"||i==="both"?(z=c[1]+G-o[0],B=c[1]+q+o[2]):(z=c[1]+(G+q-m.displaySize[1])/2,B=z+m.displaySize[1]),{image:m,top:z,right:L,bottom:B,left:F,collisionPadding:x}}xt("ImagePosition",Gi),xt("ImageAtlas",qf),M.az=void 0,(fu=M.az||(M.az={}))[fu.none=0]="none",fu[fu.horizontal=1]="horizontal",fu[fu.vertical=2]="vertical",fu[fu.horizontalOnly=3]="horizontalOnly";const Ja=128,pu=32640;function om(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Ei(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=i;let p=0;for(;p<o.length&&o[p]<=n;)p++;p=Math.max(0,p-1);let m=p;for(;m<o.length&&o[m]<n+1;)m++;m=Math.min(o.length-1,m);const x=o[p],w=o[m];return i.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:c}:{kind:"camera",minZoom:x,maxZoom:w,minSize:i.evaluate(new Ei(x)),maxSize:i.evaluate(new Ei(w)),interpolationType:c}}}function $f(n,e,i){let o="never";const c=n.get(e);return c?o=c:n.get(i)&&(o="always"),o}const Og=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wd(n,e,i,o,c,p,m,x,w,C,z,L,B){const F=x?Math.min(pu,Math.round(x[0])):0,G=x?Math.min(pu,Math.round(x[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*c),p,m,(F<<1)+(w?1:0),G,16*C,16*z,256*L,256*B)}function lm(n,e,i){n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i)}function um(n){for(const e of n.sections)if(Hs(e.text))return!0;return!1}class Xf{constructor(e){this.layoutVertexArray=new fe,this.indexArray=new je,this.programConfigurations=e,this.segments=new gt,this.dynamicLayoutVertexArray=new Se,this.opacityVertexArray=new Ne,this.hasVisibleVertices=!1,this.placedSymbolArray=new b}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,_d.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Og,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}xt("SymbolBuffers",Xf);class Yf{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new gt,this.collisionVertexArray=new Fe}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,em.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}xt("CollisionBuffers",Yf);class bh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((m=>m.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=om(this.zoom,i["text-size"]),this.iconSizeData=om(this.zoom,i["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=$f(o,"text-overlap","text-allow-overlap")!=="never"||$f(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((m=>M.az[m]))),this.stateDependentLayerIds=this.layers.filter((m=>m.isStateDependent())).map((m=>m.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Xf(new Do(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Xf(new Do(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new I,this.lineVertexArray=new k,this.symbolInstances=new D,this.textAnchorOffsets=new N}calculateGlyphDependencies(e,i,o,c,p){for(const m of e)if(i[m.codePointAt(0)]=!0,(o||c)&&p){const x=gh[m];x&&(i[x.codePointAt(0)]=!0)}}populate(e,i,o){const c=this.layers[0],p=c.layout,m=p.get("text-font"),x=p.get("text-field"),w=p.get("icon-image"),C=(x.value.kind!=="constant"||x.value.value instanceof Gn&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),z=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!C&&!z)return;const B=i.iconDependencies,F=i.glyphDependencies,G=i.availableImages,q=new Ei(this.zoom);for(const{feature:$,id:Q,index:ce,sourceLayerIndex:J}of e){const ne=c._featureFilter.needGeometry,pe=Ka($,ne);if(!c._featureFilter.filter(q,pe,o))continue;let ye,ke;if(ne||(pe.geometry=Qs($)),C){const He=c.getValueAndResolveTokens("text-field",pe,o,G),rt=Gn.factory(He),yt=this.hasRTLText=this.hasRTLText||um(rt);(!yt||Ma.getRTLTextPluginStatus()==="unavailable"||yt&&Ma.isParsed())&&(ye=La(rt,c,pe))}if(z){const He=c.getValueAndResolveTokens("icon-image",pe,o,G);ke=He instanceof Cr?He:Cr.fromString(He)}if(!ye&&!ke)continue;const Qe=this.sortFeaturesByKey?L.evaluate(pe,{},o):void 0;if(this.features.push({id:Q,text:ye,icon:ke,index:ce,sourceLayerIndex:J,geometry:pe.geometry,properties:$.properties,type:fh.types[$.type],sortKey:Qe}),ke&&(B[ke.name]=!0),ye){const He=m.evaluate(pe,{},o).join(","),rt=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(M.az.vertical)>=0;for(const yt of ye.sections)if(yt.image)B[yt.image.name]=!0;else{const st=Ts(ye.toString()),Ye=yt.fontStack||He,Ue=F[Ye]=F[Ye]||{};this.calculateGlyphDependencies(yt.text,Ue,rt,this.allowVerticalPlacement,st)}}}p.get("symbol-placement")==="line"&&(this.features=(function($){const Q={},ce={},J=[];let ne=0;function pe(He){J.push($[He]),ne++}function ye(He,rt,yt){const st=ce[He];return delete ce[He],ce[rt]=st,J[st].geometry[0].pop(),J[st].geometry[0]=J[st].geometry[0].concat(yt[0]),st}function ke(He,rt,yt){const st=Q[rt];return delete Q[rt],Q[He]=st,J[st].geometry[0].shift(),J[st].geometry[0]=yt[0].concat(J[st].geometry[0]),st}function Qe(He,rt,yt){const st=yt?rt[0][rt[0].length-1]:rt[0][0];return`${He}:${st.x}:${st.y}`}for(let He=0;He<$.length;He++){const rt=$[He],yt=rt.geometry,st=rt.text?rt.text.toString():null;if(!st){pe(He);continue}const Ye=Qe(st,yt),Ue=Qe(st,yt,!0);if(Ye in ce&&Ue in Q&&ce[Ye]!==Q[Ue]){const St=ke(Ye,Ue,yt),bt=ye(Ye,Ue,J[St].geometry);delete Q[Ye],delete ce[Ue],ce[Qe(st,J[bt].geometry,!0)]=bt,J[St].geometry=null}else Ye in ce?ye(Ye,Ue,yt):Ue in Q?ke(Ye,Ue,yt):(pe(He),Q[Ye]=ne-1,ce[Ue]=ne-1)}return J.filter((He=>He.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort((($,Q)=>$.sortKey-Q.sortKey))}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(i[e.segment+1]),p=e.dist(i[e.segment]);const m={};for(let x=e.segment+1;x<i.length;x++)m[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:c},x<i.length-1&&(c+=i[x+1].dist(i[x]));for(let x=e.segment||0;x>=0;x--)m[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:p},x>0&&(p+=i[x-1].dist(i[x]));for(let x=0;x<i.length;x++){const w=m[x];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,c,p,m,x,w,C,z,L,B){const F=e.indexArray,G=e.layoutVertexArray,q=e.segments.prepareSegment(4*i.length,G,F,this.canOverlap?m.sortKey:void 0),$=this.glyphOffsetArray.length,Q=q.vertexLength,ce=this.allowVerticalPlacement&&x===M.az.vertical?Math.PI/2:0,J=m.text&&m.text.sections;for(let ne=0;ne<i.length;ne++){const{tl:pe,tr:ye,bl:ke,br:Qe,tex:He,pixelOffsetTL:rt,pixelOffsetBR:yt,minFontScaleX:st,minFontScaleY:Ye,glyphOffset:Ue,isSDF:St,sectionIndex:bt}=i[ne],At=q.vertexLength,_t=Ue[1];wd(G,w.x,w.y,pe.x,_t+pe.y,He.x,He.y,o,St,rt.x,rt.y,st,Ye),wd(G,w.x,w.y,ye.x,_t+ye.y,He.x+He.w,He.y,o,St,yt.x,rt.y,st,Ye),wd(G,w.x,w.y,ke.x,_t+ke.y,He.x,He.y+He.h,o,St,rt.x,yt.y,st,Ye),wd(G,w.x,w.y,Qe.x,_t+Qe.y,He.x+He.w,He.y+He.h,o,St,yt.x,yt.y,st,Ye),lm(e.dynamicLayoutVertexArray,w,ce),F.emplaceBack(At,At+2,At+1),F.emplaceBack(At+1,At+2,At+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ue[0]),ne!==i.length-1&&bt===i[ne+1].sectionIndex||e.programConfigurations.populatePaintArrays(G.length,m,m.index,{imagePositions:{},canonical:B,formattedSection:J&&J[bt]})}e.placedSymbolArray.emplaceBack(w.x,w.y,$,this.glyphOffsetArray.length-$,Q,C,z,w.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],x,0,!1,0,L)}_addCollisionDebugVertex(e,i,o,c,p,m){return i.emplaceBack(0,0),e.emplaceBack(o.x,o.y,c,p,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(e,i,o,c,p,m,x){const w=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),C=w.vertexLength,z=p.layoutVertexArray,L=p.collisionVertexArray,B=x.anchorX,F=x.anchorY;this._addCollisionDebugVertex(z,L,m,B,F,new j(e,i)),this._addCollisionDebugVertex(z,L,m,B,F,new j(o,i)),this._addCollisionDebugVertex(z,L,m,B,F,new j(o,c)),this._addCollisionDebugVertex(z,L,m,B,F,new j(e,c)),w.vertexLength+=4;const G=p.indexArray;G.emplaceBack(C,C+1),G.emplaceBack(C+1,C+2),G.emplaceBack(C+2,C+3),G.emplaceBack(C+3,C),w.primitiveLength+=4}addDebugCollisionBoxes(e,i,o,c){for(let p=e;p<i;p++){const m=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,c?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yf(Le,Ia.members,dt),this.iconCollisionBox=new Yf(Le,Ia.members,dt);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,o,c,p,m,x,w,C){const z={};for(let L=i;L<o;L++){const B=e.get(L);z.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},z.textFeatureIndex=B.featureIndex;break}for(let L=c;L<p;L++){const B=e.get(L);z.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},z.verticalTextFeatureIndex=B.featureIndex;break}for(let L=m;L<x;L++){const B=e.get(L);z.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},z.iconFeatureIndex=B.featureIndex;break}for(let L=w;L<C;L++){const B=e.get(L);z.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},z.verticalIconFeatureIndex=B.featureIndex;break}return z}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),c=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<c;p+=4)e.indexArray.emplaceBack(p,p+2,p+1),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),c=[],p=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);const w=this.symbolInstances.get(x);c.push(0|Math.round(i*w.anchorX+o*w.anchorY)),p.push(w.featureIndex)}return m.sort(((x,w)=>c[x]-c[w]||p[w]-p[x])),m}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((c,p,m)=>{c>=0&&m.indexOf(c)===p&&this.addIndicesForPlacedSymbol(this.text,c)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Wf,Kf;xt("SymbolBucket",bh,{omit:["layers","collisionBoxArray","features","compareText"]}),bh.MAX_GLYPHS=65535,bh.addDynamicAttributes=lm;var cm={get paint(){return Kf=Kf||new Mn({"icon-opacity":new Dt(Ie.paint_symbol["icon-opacity"]),"icon-color":new Dt(Ie.paint_symbol["icon-color"]),"icon-halo-color":new Dt(Ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new Dt(Ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Dt(Ie.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(Ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(Ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new Dt(Ie.paint_symbol["text-opacity"]),"text-color":new Dt(Ie.paint_symbol["text-color"],{runtimeType:Qr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Dt(Ie.paint_symbol["text-halo-color"]),"text-halo-width":new Dt(Ie.paint_symbol["text-halo-width"]),"text-halo-blur":new Dt(Ie.paint_symbol["text-halo-blur"]),"text-translate":new Tt(Ie.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(Ie.paint_symbol["text-translate-anchor"])})},get layout(){return Wf=Wf||new Mn({"symbol-placement":new Tt(Ie.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(Ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(Ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Dt(Ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(Ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Tt(Ie.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Tt(Ie.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Tt(Ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(Ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(Ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new Dt(Ie.layout_symbol["icon-size"]),"icon-text-fit":new Tt(Ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Tt(Ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new Dt(Ie.layout_symbol["icon-image"]),"icon-rotate":new Dt(Ie.layout_symbol["icon-rotate"]),"icon-padding":new Dt(Ie.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(Ie.layout_symbol["icon-keep-upright"]),"icon-offset":new Dt(Ie.layout_symbol["icon-offset"]),"icon-anchor":new Dt(Ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(Ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(Ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(Ie.layout_symbol["text-rotation-alignment"]),"text-field":new Dt(Ie.layout_symbol["text-field"]),"text-font":new Dt(Ie.layout_symbol["text-font"]),"text-size":new Dt(Ie.layout_symbol["text-size"]),"text-max-width":new Dt(Ie.layout_symbol["text-max-width"]),"text-line-height":new Tt(Ie.layout_symbol["text-line-height"]),"text-letter-spacing":new Dt(Ie.layout_symbol["text-letter-spacing"]),"text-justify":new Dt(Ie.layout_symbol["text-justify"]),"text-radial-offset":new Dt(Ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(Ie.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Dt(Ie.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Dt(Ie.layout_symbol["text-anchor"]),"text-max-angle":new Tt(Ie.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(Ie.layout_symbol["text-writing-mode"]),"text-rotate":new Dt(Ie.layout_symbol["text-rotate"]),"text-padding":new Tt(Ie.layout_symbol["text-padding"]),"text-keep-upright":new Tt(Ie.layout_symbol["text-keep-upright"]),"text-transform":new Dt(Ie.layout_symbol["text-transform"]),"text-offset":new Dt(Ie.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(Ie.layout_symbol["text-allow-overlap"]),"text-overlap":new Tt(Ie.layout_symbol["text-overlap"]),"text-ignore-placement":new Tt(Ie.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(Ie.layout_symbol["text-optional"])})}};class Fg{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:qi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xt("FormatSectionOverride",Fg,{omit:["defaultValue"]});class mu extends ln{constructor(e,i){super(e,cm,i)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const p of o)c.indexOf(p)<0&&c.push(p);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,c){const p=this.layout.get(e).evaluate(i,{},o,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||wo(m.value)||!p?p:(function(x,w){return w.replace(/{([^{}]+)}/g,((C,z)=>x&&z in x?String(x[z]):""))})(i.properties,p)}createBucket(e){return new bh(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of cm.paint.overridableProperties){if(!mu.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new Fg(i),c=new Yc(o,i.property.specification);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new Ir("source",c):new To("composite",c,i.value.zoomStops),this.paint._values[e]=new la(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&mu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),c=cm.paint.properties[i];let p=!1;const m=x=>{for(const w of x)if(c.overrides&&c.overrides.hasOverride(w))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Gn)m(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const x=C=>{p||(C instanceof ea&&Ji(C.value)===ss?m(C.value.sections):C instanceof Nu?m(C.sections):C.eachChild(x))},w=o.value;w._styleExpression&&x(w._styleExpression.expression)}return p}}let jg;var Ng={get paint(){return jg=jg||new Mn({"background-color":new Tt(Ie.paint_background["background-color"]),"background-pattern":new au(Ie.paint_background["background-pattern"]),"background-opacity":new Tt(Ie.paint_background["background-opacity"])})}};class gi extends ln{constructor(e,i){super(e,Ng,i)}}class hm extends ln{constructor(e,i){super(e,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Qf{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const dm={once:!0},Jf=63710088e-1;class ko{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ko(li(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,c=e.lat*i,p=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return Jf*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof ko)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ko(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ko(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const wh=2*Math.PI*Jf;function Td(n){return wh*Math.cos(n*Math.PI/180)}function Vg(n){return(180+n)/360}function fm(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Ug(n,e){return n/Td(e)}function Gg(n){return 360*n-180}function Sd(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function pm(n,e){return n*Td(Sd(e))}class Ri{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=ko.convert(e);return new Ri(Vg(o.lng),fm(o.lat),Ug(i,o.lat))}toLngLat(){return new ko(Gg(this.x),Sd(this.y))}toAltitude(){return pm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/wh*(e=Sd(this.y),1/Math.cos(e*Math.PI/180));var e}}function ep(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class fr{constructor(e,i,o){if(!(function(c,p,m){return!(c<0||c>25||m<0||m>=Math.pow(2,c)||p<0||p>=Math.pow(2,c))})(e,i,o))throw new Error(`x=${i}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=o,this.key=Th(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,o){const c=(function(m,x,w){var C=ep(256*m,256*(x=Math.pow(2,w)-x-1),w),z=ep(256*(m+1),256*(x+1),w);return C[0]+","+C[1]+","+z[0]+","+z[1]})(this.x,this.y,this.z),p=(function(m,x,w){let C,z="";for(let L=m;L>0;L--)C=1<<L-1,z+=(x&C?1:0)+(w&C?2:0);return z})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,p).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new j((e.x*i-this.x)*It,(e.y*i-this.y)*It)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qg{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Th(e,i.z,i.z,i.x,i.y)}}class ka{constructor(e,i,o,c,p){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=i,this.canonical=new fr(o,+c,+p),this.key=Th(i,e,o,c,p)}clone(){return new ka(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new ka(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ka(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Th(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):Th(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-e.canonical.z;return!(i<0)&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ka(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new ka(i,this.wrap,i,o,c),new ka(i,this.wrap,i,o+1,c),new ka(i,this.wrap,i,o,c+1),new ka(i,this.wrap,i,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ka(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ka(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Ri(e.x-this.wrap,e.y))}}function Th(n,e,i,o,c){(n*=2)<0&&(n=-1*n-1);const p=1<<i;return(p*p*n+p*c+o).toString(36)+i.toString(36)+e.toString(36)}function Md(n,e){return e?n.properties[e]:n.id}function mm(n,e){const i={id:n.id};if(e.removeAllProperties&&(delete n.removeProperties,delete n.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const c=n.addOrUpdateProperties.findIndex((p=>p.key===o));c>-1&&n.addOrUpdateProperties.splice(c,1)}return(n.removeAllProperties||e.removeAllProperties)&&(i.removeAllProperties=!0),(n.removeProperties||e.removeProperties)&&(i.removeProperties=[...n.removeProperties||[],...e.removeProperties||[]]),(n.addOrUpdateProperties||e.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...n.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(n.newGeometry||e.newGeometry)&&(i.newGeometry=e.newGeometry||n.newGeometry),i}function Ed(n){var e,i;if(!n)return{};const o={};return o.removeAll=n.removeAll,o.remove=new Set(n.remove||[]),o.add=new Map((e=n.add)===null||e===void 0?void 0:e.map((c=>[c.id,c]))),o.update=new Map((i=n.update)===null||i===void 0?void 0:i.map((c=>[c.id,c]))),o}xt("CanonicalTileID",fr),xt("OverscaledTileID",ka,{omit:["terrainRttPosMatrix32f"]});class gu{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const i=new gu;return i.extend(e(new j(this.minX,this.minY))),i.extend(e(new j(this.maxX,this.minY))),i.extend(e(new j(this.minX,this.maxY))),i.extend(e(new j(this.maxX,this.maxY))),i}static fromPoints(e){const i=new gu;for(const o of e)i.extend(o);return i}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class gm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class tp{constructor(e,i,o,c,p){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=c,this._z=i,this.properties=e.properties,this.id=p}projectPoint(e,i,o,c){return[360*(e.x+i)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/c)*Math.PI))-90]}projectLine(e,i,o,c){return e.map((p=>this.projectPoint(p,i,o,c)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,i=e.extent*Math.pow(2,this._z),o=e.extent*this._x,c=e.extent*this._y,p=e.loadGeometry();switch(e.type){case 1:{const m=[];for(const w of p)m.push(w[0]);const x=this.projectLine(m,o,c,i);this._geometry=m.length===1?{type:"Point",coordinates:x[0]}:{type:"MultiPoint",coordinates:x};break}case 2:{const m=p.map((x=>this.projectLine(x,o,c,i)));this._geometry=m.length===1?{type:"LineString",coordinates:m[0]}:{type:"MultiLineString",coordinates:m};break}case 3:{const m=wg(p),x=[];for(const w of m)x.push(w.map((C=>this.projectLine(C,o,c,i))));this._geometry=x.length===1?{type:"Polygon",coordinates:x[0]}:{type:"MultiPolygon",coordinates:x};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&i!=="_x"&&i!=="_y"&&i!=="_z"&&(e[i]=this[i]);return e}}class yu{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,i,o){this._name=e,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class ip extends yu{}class np extends ip{getValueFromBuffer(e){return this.dataBuffer[e]}}class ym extends ip{getValueFromBuffer(e){return this.dataBuffer[e]}}class _m extends yu{delta;constructor(e,i,o,c){super(e,i,c),this.delta=o}}class vm extends _m{constructor(e,i,o,c){super(e,Int32Array.of(i),o,c)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class xm extends yu{constructor(e,i,o){super(e,Int32Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class _u{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,i,o,c,p=4096){this._name=e,this._geometryVector=i,this._idVector=o,this._propertyVectors=c,this._extent=p}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const c=e?.next().value,p={};for(const m of this.propertyVectors){if(!m)continue;const x=m.name,w=m.getValue(i);w!==null&&(p[x]=w)}i++,yield{id:o,geometry:c,properties:p}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let c;this.idVector&&(c=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const p={coordinates:i[o],type:this.geometryVector.geometryType(o)},m={};for(const x of this.propertyVectors){if(!x)continue;const w=x.name,C=x.getValue(o);C!==null&&(m[w]=C)}e.push({id:c,geometry:p,properties:m})}return e}containsMaxSaveIntegerValues(e){return e instanceof np||e instanceof xm&&e instanceof vm||e instanceof ym}}class Zg{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var ri,io,br,no,vu,Hr,jn,ar,es,fa;function sr(n,e,i){const o=new Int32Array(i);let c=0,p=e.get();for(let m=0;m<o.length;m++){let x=n[p++],w=127&x;x<128||(x=n[p++],w|=(127&x)<<7,x<128||(x=n[p++],w|=(127&x)<<14,x<128||(x=n[p++],w|=(127&x)<<21,x<128||(x=n[p++],w|=(15&x)<<28)))),o[c++]=w}return e.set(p),o}function Ad(n,e,i){const o=new BigInt64Array(i);for(let c=0;c<o.length;c++)o[c]=rp(n,e);return o}function Hg(n,e){let i,o;return o=n[e.get()],e.increment(),i=127&o,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<7,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<14,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<21,o<128?i:(o=n[e.get()],i|=(15&o)<<28,(function(c,p,m){let x,w;if(w=p[m.get()],m.increment(),x=(112&w)>>4,w<128||(w=p[m.get()],m.increment(),x|=(127&w)<<3,w<128)||(w=p[m.get()],m.increment(),x|=(127&w)<<10,w<128)||(w=p[m.get()],m.increment(),x|=(127&w)<<17,w<128)||(w=p[m.get()],m.increment(),x|=(127&w)<<24,w<128)||(w=p[m.get()],m.increment(),x|=(1&w)<<31,w<128))return 4294967296*x+(c>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,n,e)))))}function Sh(n,e,i,o){throw new Error("FastPFor is not implemented yet.")}function wr(n){return n>>>1^-(1&n)}function Tc(n){return n>>1n^-(1n&n)}function rp(n,e){let i=0n,o=0,c=e.get();for(;c<n.length;){const p=n[c++];if(i|=BigInt(127&p)<<BigInt(o),!(128&p))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(c),i}function Bo(n,e,i){const o=new Int32Array(i);let c=0;for(let p=0;p<e;p++){const m=n[p];o.fill(n[p+e],c,c+m),c+=m}return o}function $g(n,e,i){const o=new BigInt64Array(i);let c=0;for(let p=0;p<e;p++){const m=Number(n[p]);o.fill(n[p+e],c,c+m),c+=m}return o}function Xg(n,e,i){const o=new Float64Array(i);let c=0;for(let p=0;p<e;p++){const m=n[p];o.fill(n[p+e],c,c+m),c+=m}return o}function xu(n){const e=n.length/4*4;let i=1;if(e>=4)for(let o=n[0];i<e-4;i+=4)o=n[i]+=o,o=n[i+1]+=o,o=n[i+2]+=o,o=n[i+3]+=o;for(;i!=n.length;)n[i]+=n[i-1],++i}function bm(n){n[0]=n[0]>>>1^-(1&n[0]),n[1]=n[1]>>>1^-(1&n[1]);const e=n.length/4*4;let i=2;if(e>=4)for(;i<e-4;i+=4){const o=n[i],c=n[i+1],p=n[i+2],m=n[i+3];n[i]=(o>>>1^-(1&o))+n[i-2],n[i+1]=(c>>>1^-(1&c))+n[i-1],n[i+2]=(p>>>1^-(1&p))+n[i],n[i+3]=(m>>>1^-(1&m))+n[i+1]}for(;i!=n.length;i+=2)n[i]=(n[i]>>>1^-(1&n[i]))+n[i-2],n[i+1]=(n[i+1]>>>1^-(1&n[i+1]))+n[i-1]}(function(n){n.NONE="NONE",n.DELTA="DELTA",n.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",n.RLE="RLE",n.MORTON="MORTON",n.PDE="PDE"})(ri||(ri={})),(function(n){n.NONE="NONE",n.FAST_PFOR="FAST_PFOR",n.VARINT="VARINT",n.ALP="ALP"})(io||(io={})),(function(n){n.PRESENT="PRESENT",n.DATA="DATA",n.OFFSET="OFFSET",n.LENGTH="LENGTH"})(br||(br={}));class wm{_dictionaryType;_offsetType;_lengthType;constructor(e,i,o){this._dictionaryType=e,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function $r(n,e){const i=(function(o,c){const p=o[c.get()],m=Object.values(br)[p>>4];let x=null;switch(m){case br.DATA:x=new wm(Object.values(no)[15&p]);break;case br.OFFSET:x=new wm(null,Object.values(vu)[15&p]);break;case br.LENGTH:x=new wm(null,null,Object.values(Hr)[15&p])}c.increment();const w=o[c.get()],C=Object.values(ri)[w>>5],z=Object.values(ri)[w>>2&7],L=Object.values(io)[3&w];c.increment();const B=sr(o,c,2),F=B[0];return{physicalStreamType:m,logicalStreamType:x,logicalLevelTechnique1:C,logicalLevelTechnique2:z,physicalLevelTechnique:L,numValues:F,byteLength:B[1],decompressedCount:F}})(n,e);return i.logicalLevelTechnique1===ri.MORTON?(function(o,c,p){const m=sr(c,p,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:m[0],coordinateShift:m[1]}})(i,n,e):ri.RLE!==i.logicalLevelTechnique1&&ri.RLE!==i.logicalLevelTechnique2||io.NONE===i.physicalLevelTechnique?i:(function(o,c,p){const m=sr(c,p,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:m[1],runs:m[0],numRleValues:m[1]}})(i,n,e)}(function(n){n.NONE="NONE",n.SINGLE="SINGLE",n.SHARED="SHARED",n.VERTEX="VERTEX",n.MORTON="MORTON",n.FSST="FSST"})(no||(no={})),(function(n){n.VERTEX="VERTEX",n.INDEX="INDEX",n.STRING="STRING",n.KEY="KEY"})(vu||(vu={})),(function(n){n.VAR_BINARY="VAR_BINARY",n.GEOMETRIES="GEOMETRIES",n.PARTS="PARTS",n.RINGS="RINGS",n.TRIANGLES="TRIANGLES",n.SYMBOL="SYMBOL",n.DICTIONARY="DICTIONARY"})(Hr||(Hr={})),(function(n){n[n.FLAT=0]="FLAT",n[n.CONST=1]="CONST",n[n.SEQUENCE=2]="SEQUENCE",n[n.DICTIONARY=3]="DICTIONARY",n[n.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(jn||(jn={}));class ro{values;_size;constructor(e,i){this.values=e,this._size=i}get(e){const i=Math.floor(e/8);return(this.values[i]>>e%8&1)==1}set(e,i){const o=Math.floor(e/8);this.values[o]=this.values[o]|(i?1:0)<<e%8}getInt(e){const i=Math.floor(e/8);return this.values[i]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Xr(n,e,i,o,c){return(function(p,m,x){switch(m.logicalLevelTechnique1){case ri.DELTA:return m.logicalLevelTechnique2===ri.RLE?(function(w,C,z){const L=new Int32Array(z);let B=0,F=0;for(let G=0;G<C;G++){const q=w[G],$=wr(w[G+C]);for(let Q=0;Q<q;Q++)F+=$,L[B++]=F}return L})(p,m.runs,m.numRleValues):((function(w){w[0]=w[0]>>>1^-(1&w[0]);const C=w.length/4*4;let z=1;if(C>=4)for(;z<C-4;z+=4){const L=w[z],B=w[z+1],F=w[z+2],G=w[z+3];w[z]=(L>>>1^-(1&L))+w[z-1],w[z+1]=(B>>>1^-(1&B))+w[z],w[z+2]=(F>>>1^-(1&F))+w[z+1],w[z+3]=(G>>>1^-(1&G))+w[z+2]}for(;z!=w.length;++z)w[z]=(w[z]>>>1^-(1&w[z]))+w[z-1]})(p),p);case ri.RLE:return(function(w,C,z){return z?(function(L,B,F){const G=new Int32Array(F);let q=0;for(let $=0;$<B;$++){const Q=L[$];let ce=L[$+B];ce=ce>>>1^-(1&ce),G.fill(ce,q,q+Q),q+=Q}return G})(w,C.runs,C.numRleValues):Bo(w,C.runs,C.numRleValues)})(p,m,x);case ri.MORTON:return xu(p),p;case ri.COMPONENTWISE_DELTA:return bm(p),p;case ri.NONE:return x&&(function(w){for(let C=0;C<w.length;C++){const z=w[C];w[C]=z>>>1^-(1&z)}})(p),p;default:throw new Error(`The specified Logical level technique is not supported: ${m.logicalLevelTechnique1}`)}})(ap(n,e,i),i,o)}function bu(n,e,i){return(function(o,c){if(c.logicalLevelTechnique1===ri.DELTA&&c.logicalLevelTechnique2===ri.NONE)return(function(m){const x=new Int32Array(m.length+1);x[0]=0,x[1]=wr(m[0]);let w=x[1],C=2;for(;C!=x.length;++C){const z=m[C-1];w+=z>>>1^-(1&z),x[C]=x[C-1]+w}return x})(o);if(c.logicalLevelTechnique1===ri.RLE&&c.logicalLevelTechnique2===ri.NONE)return(function(m,x,w){const C=new Int32Array(w+1);C[0]=0;let z=1,L=C[0];for(let B=0;B<x;B++){const F=m[B],G=m[B+x];for(let q=z;q<z+F;q++)C[q]=G+L,L=C[q];z+=F}return C})(o,c.runs,c.numRleValues);if(c.logicalLevelTechnique1===ri.NONE&&c.logicalLevelTechnique2===ri.NONE){(function(m){let x=0;for(let w=0;w<m.length;w++)m[w]+=x,x=m[w]})(o);const p=new Int32Array(c.numValues+1);return p[0]=0,p.set(o,1),p}if(c.logicalLevelTechnique1===ri.DELTA&&c.logicalLevelTechnique2===ri.RLE){const p=(function(m,x,w){const C=new Int32Array(w+1);C[0]=0;let z=1,L=C[0];for(let B=0;B<x;B++){const F=m[B];let G=m[B+x];G=G>>>1^-(1&G);for(let q=z;q<z+F;q++)C[q]=G+L,L=C[q];z+=F}return C})(o,c.runs,c.numRleValues);return xu(p),p}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(ap(n,e,i),i)}function ap(n,e,i){const o=i.physicalLevelTechnique;if(o===io.FAST_PFOR)return Sh();if(o===io.VARINT)return sr(n,e,i.numValues);if(o===io.NONE){const c=e.get();e.add(i.byteLength);const p=n.subarray(c,e.get());return new Int32Array(p)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Tm(n,e,i,o){const c=ap(n,e,i);if(c.length===1){const p=c[0];return o?wr(p):p}return o?(function(p){return wr(p[1])})(c):(function(p){return p[1]})(c)}function Sm(n,e,i){return(function(o){if(o.length==2){const c=wr(o[1]);return[c,c]}return[wr(o[2]),wr(o[3])]})(ap(n,e,i))}function Sc(n,e,i){return(function(o){if(o.length==2){const c=Tc(o[1]);return[c,c]}return[Tc(o[2]),Tc(o[3])]})(Ad(n,e,i.numValues))}function Mh(n,e,i,o){return(function(c,p,m){switch(p.logicalLevelTechnique1){case ri.DELTA:return p.logicalLevelTechnique2===ri.RLE?(function(x,w,C){const z=new BigInt64Array(C);let L=0,B=0n;for(let F=0;F<w;F++){const G=Number(x[F]),q=Tc(x[F+w]);for(let $=0;$<G;$++)B+=q,z[L++]=B}return z})(c,p.runs,p.numRleValues):((function(x){x[0]=x[0]>>1n^-(1n&x[0]);const w=x.length/4*4;let C=1;if(w>=4)for(;C<w-4;C+=4){const z=x[C],L=x[C+1],B=x[C+2],F=x[C+3];x[C]=(z>>1n^-(1n&z))+x[C-1],x[C+1]=(L>>1n^-(1n&L))+x[C],x[C+2]=(B>>1n^-(1n&B))+x[C+1],x[C+3]=(F>>1n^-(1n&F))+x[C+2]}for(;C!=x.length;++C)x[C]=(x[C]>>1n^-(1n&x[C]))+x[C-1]})(c),c);case ri.RLE:return(function(x,w,C){return C?(function(z,L,B){const F=new BigInt64Array(B);let G=0;for(let q=0;q<L;q++){const $=Number(z[q]);let Q=z[q+L];Q=Q>>1n^-(1n&Q),F.fill(Q,G,G+$),G+=$}return F})(x,w.runs,w.numRleValues):$g(x,w.runs,w.numRleValues)})(c,p,m);case ri.NONE:return m&&(function(x){for(let w=0;w<x.length;w++){const C=x[w];x[w]=C>>1n^-(1n&C)}})(c),c;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}})(Ad(n,e,i.numValues),i,o)}function Mm(n,e,i,o){const c=Ad(n,e,i.numValues);if(c.length===1){const p=c[0];return o?Tc(p):p}return o?(function(p){return Tc(p[1])})(c):(function(p){return p[1]})(c)}function Em(n,e,i,o,c){return(function(p,m,x,w){switch(m.logicalLevelTechnique1){case ri.DELTA:return m.logicalLevelTechnique2===ri.RLE&&(p=Bo(p,m.runs,m.numRleValues)),(function(C,z){const L=new Int32Array(C.size());let B=0;C.get(0)?(L[0]=C.get(0)?z[0]>>>1^-(1&z[0]):0,B=1):L[0]=0;let F=1;for(;F!=L.length;++F)L[F]=C.get(F)?L[F-1]+(z[B]>>>1^-(1&z[B++])):L[F-1];return L})(w,p);case ri.RLE:return(function(C,z,L,B){const F=z;return L?(function(G,q,$){const Q=new Int32Array(G.size());let ce=0;for(let J=0;J<$;J++){const ne=q[J];let pe=q[J+$];pe=pe>>>1^-(1&pe);for(let ye=ce;ye<ce+ne;ye++)G.get(ye)?Q[ye]=pe:(Q[ye]=0,ce++);ce+=ne}return Q})(B,C,F.runs):(function(G,q,$){const Q=new Int32Array(G.size());let ce=0;for(let J=0;J<$;J++){const ne=q[J],pe=q[J+$];for(let ye=ce;ye<ce+ne;ye++)G.get(ye)?Q[ye]=pe:(Q[ye]=0,ce++);ce+=ne}return Q})(B,C,F.runs)})(p,m,x,w);case ri.MORTON:return xu(p),p;case ri.COMPONENTWISE_DELTA:return bm(p),p;case ri.NONE:return p=x?(function(C,z){const L=new Int32Array(C.size());let B=0,F=0;for(;F!=L.length;++F)if(C.get(F)){const G=z[B++];L[F]=G>>>1^-(1&G)}else L[F]=0;return L})(w,p):(function(C,z){const L=new Int32Array(C.size());let B=0,F=0;for(;F!=L.length;++F)L[F]=C.get(F)?z[B++]:0;return L})(w,p),p;default:throw new Error("The specified Logical level technique is not supported")}})(i.physicalLevelTechnique===io.FAST_PFOR?Sh():sr(n,e,i.numValues),i,o,c)}function Ml(n,e,i,o){const c=n.logicalLevelTechnique1;if(c===ri.RLE)return n.runs===1?jn.CONST:jn.FLAT;const p=e instanceof ro?e.size():e;if(c===ri.DELTA&&n.logicalLevelTechnique2===ri.RLE){const m=n.runs,x=2;if(n.numRleValues!==p)return jn.FLAT;if(m===1)return jn.SEQUENCE;if(m===2){const w=o.get();let C;if(n.physicalLevelTechnique===io.VARINT)C=sr(i,o,4);else{const z=o.get();C=new Int32Array(i.buffer,i.byteOffset+z,4)}if(o.set(w),C[2]===x&&C[3]===x)return jn.SEQUENCE}}return n.numValues===1?jn.CONST:jn.FLAT}class Eh extends ip{getValueFromBuffer(e){return this.dataBuffer[e]}}class Am extends _m{constructor(e,i,o,c){super(e,BigInt64Array.of(i),o,c)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class El{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,i,o){this._geometryOffsets=e,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Cd(n,e,i){return{x:sp(n,e)-i,y:sp(n>>1,e)-i}}function sp(n,e){let i=0;for(let o=0;o<e;o++)i|=(n&1<<2*o)>>o;return i}(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON",n[n.MULTIPOINT=3]="MULTIPOINT",n[n.MULTILINESTRING=4]="MULTILINESTRING",n[n.MULTIPOLYGON=5]="MULTIPOLYGON"})(ar||(ar={})),(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON"})(es||(es={})),(function(n){n[n.MORTON=0]="MORTON",n[n.VEC_2=1]="VEC_2",n[n.VEC_3=2]="VEC_3"})(fa||(fa={}));class op{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((i=>[i]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,i){return[e].concat(i)}createMultiPolygon(e){return e.flat()}}function Cm(n){const e=new Array(n.numGeometries);let i=1,o=1,c=1,p=0;const m=new op;let x=0,w=0;const C=n.mortonSettings,z=n.topologyVector,L=z.geometryOffsets,B=z.partOffsets,F=z.ringOffsets,G=n.vertexOffsets,q=n.containsPolygonGeometry(),$=n.vertexBuffer;for(let Q=0;Q<n.numGeometries;Q++){const ce=n.geometryType(Q);if(ce===ar.POINT){if(G&&G.length!==0)if(n.vertexBufferType===fa.VEC_2){const J=2*G[w++],ne=new j($[J],$[J+1]);e[p++]=m.createPoint(ne)}else{const J=Cd($[G[w++]],C.numBits,C.coordinateShift),ne=new j(J.x,J.y);e[p++]=m.createPoint(ne)}else{const J=new j($[x++],$[x++]);e[p++]=m.createPoint(J)}L&&c++,B&&i++,F&&o++}else if(ce===ar.MULTIPOINT){const J=L[c]-L[c-1];c++;const ne=new Array(J);if(G&&G.length!==0){for(let pe=0;pe<J;pe++){const ye=2*G[w++];ne[pe]=new j($[ye],$[ye+1])}e[p++]=m.createMultiPoint(ne)}else{for(let pe=0;pe<J;pe++){const ye=$[x++],ke=$[x++];ne[pe]=new j(ye,ke)}e[p++]=m.createMultiPoint(ne)}}else if(ce===ar.LINESTRING){let J,ne=0;q?(ne=F[o]-F[o-1],o++):ne=B[i]-B[i-1],i++,G&&G.length!==0?(J=n.vertexBufferType===fa.VEC_2?zd($,G,w,ne,!1):Pm($,G,w,ne,!1,C),w+=ne):(J=Dm($,x,ne,!1),x+=2*ne),e[p++]=m.createLineString(J),L&&c++}else if(ce===ar.POLYGON){const J=B[i]-B[i-1];i++;const ne=new Array(J-1);let pe=F[o]-F[o-1];if(o++,G&&G.length!==0){const ye=n.vertexBufferType===fa.VEC_2?lp($,G,w,pe):Pd($,G,w,pe,0,C);w+=pe;for(let ke=0;ke<ne.length;ke++)pe=F[o]-F[o-1],o++,ne[ke]=n.vertexBufferType===fa.VEC_2?lp($,G,w,pe):Pd($,G,w,pe,0,C),w+=pe;e[p++]=m.createPolygon(ye,ne)}else{const ye=Dd($,x,pe);x+=2*pe;for(let ke=0;ke<ne.length;ke++)pe=F[o]-F[o-1],o++,ne[ke]=Dd($,x,pe),x+=2*pe;e[p++]=m.createPolygon(ye,ne)}L&&c++}else if(ce===ar.MULTILINESTRING){const J=L[c]-L[c-1];c++;const ne=new Array(J);if(G&&G.length!==0){for(let pe=0;pe<J;pe++){let ye=0;q?(ye=F[o]-F[o-1],o++):ye=B[i]-B[i-1],i++;const ke=n.vertexBufferType===fa.VEC_2?zd($,G,w,ye,!1):Pm($,G,w,ye,!1,C);ne[pe]=ke,w+=ye}e[p++]=m.createMultiLineString(ne)}else{for(let pe=0;pe<J;pe++){let ye=0;q?(ye=F[o]-F[o-1],o++):ye=B[i]-B[i-1],i++,ne[pe]=Dm($,x,ye,!1),x+=2*ye}e[p++]=m.createMultiLineString(ne)}}else{if(ce!==ar.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const J=L[c]-L[c-1];c++;const ne=new Array(J);let pe=0;if(G&&G.length!==0){for(let ye=0;ye<J;ye++){const ke=B[i]-B[i-1];i++;const Qe=new Array(ke-1);pe=F[o]-F[o-1],o++;const He=n.vertexBufferType===fa.VEC_2?lp($,G,w,pe):Pd($,G,w,pe,0,C);w+=pe;for(let rt=0;rt<Qe.length;rt++)pe=F[o]-F[o-1],o++,Qe[rt]=n.vertexBufferType===fa.VEC_2?lp($,G,w,pe):Pd($,G,w,pe,0,C),w+=pe;ne[ye]=m.createPolygon(He,Qe)}e[p++]=m.createMultiPolygon(ne)}else{for(let ye=0;ye<J;ye++){const ke=B[i]-B[i-1];i++;const Qe=new Array(ke-1);pe=F[o]-F[o-1],o++;const He=Dd($,x,pe);x+=2*pe;for(let rt=0;rt<Qe.length;rt++){const yt=F[o]-F[o-1];o++,Qe[rt]=Dd($,x,yt),x+=2*yt}ne[ye]=m.createPolygon(He,Qe)}e[p++]=m.createMultiPolygon(ne)}}}}return e}function Dd(n,e,i){return Dm(n,e,i,!0)}function lp(n,e,i,o){return zd(n,e,i,o,!0)}function Pd(n,e,i,o,c,p){return Pm(n,e,i,o,!0,p)}function Dm(n,e,i,o){const c=new Array(o?i+1:i);for(let p=0;p<2*i;p+=2)c[p/2]=new j(n[e+p],n[e+p+1]);return o&&(c[c.length-1]=c[0]),c}function zd(n,e,i,o,c){const p=new Array(c?o+1:o);for(let m=0;m<2*o;m+=2){const x=2*e[i+m/2];p[m/2]=new j(n[x],n[x+1])}return c&&(p[p.length-1]=p[0]),p}function Pm(n,e,i,o,c,p){const m=new Array(c?o+1:o);for(let x=0;x<o;x++){const w=Cd(n[e[i+x]],p.numBits,p.coordinateShift);m[x]=new j(w.x,w.y)}return c&&(m[m.length-1]=m[0]),m}class Rd{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,i,o,c,p){this._vertexBufferType=e,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=c,this._mortonSettings=p}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Cm(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:e[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(e){const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=Cd(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return Cm(this)}get mortonSettings(){return this._mortonSettings}}class Id extends Rd{_numGeometries;_geometryType;constructor(e,i,o,c,p,m,x){super(o,c,p,m,x),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===ar.POLYGON||this._geometryType===ar.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Ld extends Rd{_geometryTypes;constructor(e,i,o,c,p,m){super(e,o,c,p,m),this._geometryTypes=i}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===ar.POLYGON||this.geometryType(e)===ar.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Yg{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,i,o,c){this._triangleOffsets=e,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=c}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,c=i.ringOffsets,p=i.geometryOffsets;let m=0,x=1,w=1,C=1;for(let z=0;z<this.numGeometries;z++)switch(this.geometryType(z)){case ar.POLYGON:{const L=o[x]-o[x-1];x++;const B=[];for(let F=0;F<L;F++){const G=c[w]-c[w-1];w++;const q=[];for(let $=0;$<G;$++){const Q=this._vertexBuffer[m++],ce=this._vertexBuffer[m++];q.push(new j(Q,ce))}q.length>0&&q.push(q[0]),B.push(q)}e[z]=B,p&&C++}break;case ar.MULTIPOLYGON:{const L=p[C]-p[C-1];C++;const B=[];for(let F=0;F<L;F++){const G=o[x]-o[x-1];x++;for(let q=0;q<G;q++){const $=c[w]-c[w-1];w++;const Q=[];for(let ce=0;ce<$;ce++){const J=this._vertexBuffer[m++],ne=this._vertexBuffer[m++];Q.push(new j(J,ne))}Q.length>0&&Q.push(Q[0]),B.push(Q)}}e[z]=B}}return e}[Symbol.iterator](){return null}}function Ah(n,e,i,o,c,p){return new jy(n,e,i,o,c,p)}class jy extends Yg{_numGeometries;_geometryType;constructor(e,i,o,c,p,m){super(o,c,p,m),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function zm(n,e,i,o,c){return new Wg(n,e,i,o,c)}class Wg extends Yg{_geometryTypes;constructor(e,i,o,c,p){super(i,o,c,p),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Kg(n,e,i,o,c){const p=$r(n,i);let m=null,x=null,w=null,C=null,z=null,L=null,B=null,F=null;if(Ml(p,o,n,i)===jn.CONST){const q=Tm(n,i,p,!1);for(let $=0;$<e-1;$++){const Q=$r(n,i);switch(Q.physicalStreamType){case br.LENGTH:switch(Q.logicalStreamType.lengthType){case Hr.GEOMETRIES:m=bu(n,i,Q);break;case Hr.PARTS:x=bu(n,i,Q);break;case Hr.RINGS:w=bu(n,i,Q);break;case Hr.TRIANGLES:B=bu(n,i,Q)}break;case br.OFFSET:switch(Q.logicalStreamType.offsetType){case vu.VERTEX:C=Xr(n,i,Q,!1);break;case vu.INDEX:F=Xr(n,i,Q,!1)}break;case br.DATA:no.VERTEX===Q.logicalStreamType.dictionaryType?z=Xr(n,i,Q,!0):(L={numBits:Q.numBits,coordinateShift:Q.coordinateShift},z=Xr(n,i,Q,!1))}}return F!==null?m!=null||x!=null?Ah(o,q,B,F,z,new El(m,x,w)):Ah(o,q,B,F,z):L===null?(function($,Q,ce,J,ne){return new Id($,Q,fa.VEC_2,ce,J,ne)})(o,q,new El(m,x,w),C,z):(function($,Q,ce,J,ne,pe){return new Id($,Q,fa.MORTON,ce,J,ne,pe)})(o,q,new El(m,x,w),C,z,L)}const G=Xr(n,i,p,!1);for(let q=0;q<e-1;q++){const $=$r(n,i);switch($.physicalStreamType){case br.LENGTH:switch($.logicalStreamType.lengthType){case Hr.GEOMETRIES:m=Xr(n,i,$,!1);break;case Hr.PARTS:x=Xr(n,i,$,!1);break;case Hr.RINGS:w=Xr(n,i,$,!1);break;case Hr.TRIANGLES:B=bu(n,i,$)}break;case br.OFFSET:switch($.logicalStreamType.offsetType){case vu.VERTEX:C=Xr(n,i,$,!1);break;case vu.INDEX:F=Xr(n,i,$,!1)}break;case br.DATA:no.VERTEX===$.logicalStreamType.dictionaryType?z=Xr(n,i,$,!0):(L={numBits:$.numBits,coordinateShift:$.coordinateShift},z=Xr(n,i,$,!1))}}return F!==null&&x===null?zm(G,B,F,z):(m!==null?(m=up(G,m,2),x!==null&&w!==null?(x=cp(G,m,x,!1),w=(function(q,$,Q,ce){const J=new Int32Array(Q[Q.length-1]+1);let ne=0;J[0]=ne;let pe=1,ye=1,ke=0;for(let Qe=0;Qe<q.length;Qe++){const He=q[Qe],rt=$[Qe+1]-$[Qe];if(He!==0&&He!==3)for(let yt=0;yt<rt;yt++){const st=Q[pe]-Q[pe-1];pe++;for(let Ye=0;Ye<st;Ye++)ne=J[ye++]=ne+ce[ke++]}else for(let yt=0;yt<rt;yt++)J[ye++]=++ne,pe++}return J})(G,m,x,w)):x!==null&&(x=(function(q,$,Q){const ce=new Int32Array($[$.length-1]+1);let J=0;ce[0]=J;let ne=1,pe=0;for(let ye=0;ye<q.length;ye++){const ke=q[ye],Qe=$[ye+1]-$[ye];if(ke===4||ke===1)for(let He=0;He<Qe;He++)J=ce[ne++]=J+Q[pe++];else for(let He=0;He<Qe;He++)ce[ne++]=++J}return ce})(G,m,x))):x!==null&&w!==null?(x=up(G,x,1),w=cp(G,x,w,!0)):x!==null&&(x=up(G,x,0)),F!==null?zm(G,B,F,z,new El(m,x,w)):L===null?(function(q,$,Q,ce){return new Ld(fa.VEC_2,q,$,Q,ce)})(G,new El(m,x,w),C,z):(function(q,$,Q,ce,J){return new Ld(fa.MORTON,q,$,Q,ce,J)})(G,new El(m,x,w),C,z,L))}function up(n,e,i){const o=new Int32Array(n.length+1);let c=0;o[0]=c;let p=0;for(let m=0;m<n.length;m++)c=o[m+1]=c+(n[m]>i?e[p++]:1);return o}function cp(n,e,i,o){const c=new Int32Array(e[e.length-1]+1);let p=0;c[0]=p;let m=1,x=0;for(let w=0;w<n.length;w++){const C=n[w],z=e[w+1]-e[w];if(C===5||C===2||o&&(C===4||C===1))for(let L=0;L<z;L++)p=c[m++]=p+i[x++];else for(let L=0;L<z;L++)c[m++]=++p}return c}class Qg extends yu{dataVector;constructor(e,i,o){super(e,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(e){return this.dataVector.get(e)}}class Jg extends ip{getValueFromBuffer(e){return this.dataBuffer[e]}}class kd extends yu{constructor(e,i,o){super(e,BigInt64Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Bd(n,e,i){return ey(n,Math.ceil(e/8),i)}function ey(n,e,i){const o=new Uint8Array(e);let c=0;for(;c<e;){const p=n[i.increment()];if(p<=127){const m=p+3,x=n[i.increment()],w=c+m;o.fill(x,c,w),c=w}else{const m=256-p;for(let x=0;x<m;x++)o[c++]=n[i.increment()]}}return o}const Rm=new TextDecoder;function Od(n,e,i){return i-e>=12?Rm.decode(n.subarray(e,i)):(function(o,c,p){let m="",x=c;for(;x<p;){const w=o[x];let C,z,L,B=null,F=w>239?4:w>223?3:w>191?2:1;if(x+F>p)break;F===1?w<128&&(B=w):F===2?(C=o[x+1],(192&C)==128&&(B=(31&w)<<6|63&C,B<=127&&(B=null))):F===3?(C=o[x+1],z=o[x+2],(192&C)==128&&(192&z)==128&&(B=(15&w)<<12|(63&C)<<6|63&z,(B<=2047||B>=55296&&B<=57343)&&(B=null))):F===4&&(C=o[x+1],z=o[x+2],L=o[x+3],(192&C)==128&&(192&z)==128&&(192&L)==128&&(B=(15&w)<<18|(63&C)<<12|(63&z)<<6|63&L,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,F=1):B>65535&&(B-=65536,m+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),m+=String.fromCharCode(B),x+=F}return m})(n,e,i)}class Ch extends yu{offsetBuffer;constructor(e,i,o,c){super(e,o,c),this.offsetBuffer=i}}class hp extends Ch{textEncoder;constructor(e,i,o,c){super(e,i,o,c??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Od(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Mc extends Ch{indexBuffer;textEncoder;constructor(e,i,o,c,p){super(e,o,c,p??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const i=this.indexBuffer[e];return Od(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class dp extends Ch{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,i,o,c,p,m,x){super(e,o,c,x),this.indexBuffer=i,this.symbolOffsetBuffer=p,this.symbolTableBuffer=m,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,c,p){const m=[],x=new Array(c.length).fill(0);for(let w=1;w<c.length;w++)x[w]=x[w-1]+c[w-1];for(let w=0;w<p.length;w++)if(p[w]===255)m.push(p[++w]);else{const C=c[p[w]],z=x[p[w]];for(let L=0;L<C;L++)m.push(o[z+L])}return new Uint8Array(m)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[e];return Od(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(e){const i=new Uint32Array(e.length-1);let o=e[0];for(let c=1;c<e.length;c++){const p=e[c];i[c-1]=p-o,o=p}return i}}function wu(n,e,i,o,c,p){return i.type==="scalarType"?(function(m,x,w,C,z,L){let B=null,F=0;if(m===0)return null;if(L.nullable){const q=$r(x,w);F=q.numValues;const $=w.get(),Q=Bd(x,F,w);w.set($+q.byteLength),B=new ro(Q,q.numValues)}const G=B??C;switch(z.physicalType){case 4:case 3:return(function(q,$,Q,ce,J){const ne=$r(q,$),pe=Ml(ne,J,q,$),ye=ce.physicalType===3;if(pe===jn.FLAT){const ke=Rs(J)?Em(q,$,ne,ye,J):Xr(q,$,ne,ye);return new np(Q.name,ke,J)}if(pe===jn.SEQUENCE){const ke=Sm(q,$,ne);return new vm(Q.name,ke[0],ke[1],ne.numRleValues)}{const ke=Tm(q,$,ne,ye);return new xm(Q.name,ke,J)}})(x,w,L,z,G);case 9:return(function(q,$,Q,ce,J){let ne=null,pe=null,ye=null,ke=null,Qe=null,He=null,rt=null,yt=null;for(let st=0;st<ce;st++){const Ye=$r($,Q);if(Ye.byteLength!==0)switch(Ye.physicalStreamType){case br.PRESENT:{const Ue=Bd($,Ye.numValues,Q);He=new ro(Ue,Ye.numValues);break}case br.OFFSET:pe=J!=null||He!=null?Em($,Q,Ye,!1,J??He):Xr($,Q,Ye,!1);break;case br.LENGTH:{const Ue=bu($,Q,Ye);Hr.DICTIONARY===Ye.logicalStreamType.lengthType?ne=Ue:Hr.SYMBOL===Ye.logicalStreamType.lengthType?ke=Ue:rt=Ue;break}case br.DATA:{const Ue=$.subarray(Q.get(),Q.get()+Ye.byteLength);Q.add(Ye.byteLength);const St=Ye.logicalStreamType.dictionaryType;no.FSST===St?Qe=Ue:no.SINGLE===St||no.SHARED===St?ye=Ue:no.NONE===St&&(yt=Ue);break}}}return(function(st,Ye,Ue,St,bt,At,_t){return Ye?new dp(st,Ue,St,bt,At,Ye,_t):null})(q,Qe,pe,ne,ye,ke,J??He)??(function(st,Ye,Ue,St,bt){return Ye?bt?new Mc(st,Ue,St,Ye,bt):new Mc(st,Ue,St,Ye):null})(q,ye,pe,ne,J??He)??(function(st,Ye,Ue,St,bt){if(!Ye||!Ue)return null;if(St)return bt?new Mc(st,St,Ye,Ue,bt):new Mc(st,St,Ye,Ue);if(bt&&bt.size()!==Ye.length-1){const At=new Int32Array(bt.size());let _t=0;for(let Bt=0;Bt<bt.size();Bt++)At[Bt]=bt.get(Bt)?_t++:0;return new Mc(st,At,Ye,Ue,bt)}return bt?new hp(st,Ye,Ue,bt):new hp(st,Ye,Ue)})(q,rt,yt,pe,J??He)})(L.name,x,w,L.nullable?m-1:m,B);case 0:return(function(q,$,Q,ce,J){const ne=$r(q,$),pe=ne.numValues,ye=$.get(),ke=Rs(J)?(function(He,rt,yt,st){const Ye=ey(He,Math.ceil(rt/8),yt),Ue=new ro(Ye,rt),St=st.size(),bt=new ro(new Uint8Array(St),St);let At=0;for(let _t=0;_t<st.size();_t++){const Bt=!!st.get(_t)&&Ue.get(At++);bt.set(_t,Bt)}return bt.getBuffer()})(q,pe,$,J):Bd(q,pe,$);$.set(ye+ne.byteLength);const Qe=new ro(ke,pe);return new Qg(Q.name,Qe,J)})(x,w,L,0,G);case 6:case 5:return(function(q,$,Q,ce,J){const ne=$r(q,$),pe=Ml(ne,ce,q,$),ye=J.physicalType===5;if(pe===jn.FLAT){const ke=Rs(ce)?(function(Qe,He,rt,yt,st){return(function(Ye,Ue,St,bt){switch(Ue.logicalLevelTechnique1){case ri.DELTA:return Ue.logicalLevelTechnique2===ri.RLE&&(Ye=$g(Ye,Ue.runs,Ue.numRleValues)),(function(At,_t){const Bt=new BigInt64Array(At.size());let xi=0;At.get(0)?(Bt[0]=At.get(0)?_t[0]>>1n^-(1n&_t[0]):0n,xi=1):Bt[0]=0n;let oi=1;for(;oi!=Bt.length;++oi)Bt[oi]=At.get(oi)?Bt[oi-1]+(_t[xi]>>1n^-(1n&_t[xi++])):Bt[oi-1];return Bt})(bt,Ye);case ri.RLE:return(function(At,_t,Bt,xi){const oi=_t;return Bt?(function(xn,Yr,or){const bn=new BigInt64Array(xn.size());let cn=0;for(let Li=0;Li<or;Li++){const Ln=Number(Yr[Li]);let Nn=Yr[Li+or];Nn=Nn>>1n^-(1n&Nn);for(let an=cn;an<cn+Ln;an++)xn.get(an)?bn[an]=Nn:(bn[an]=0n,cn++);cn+=Ln}return bn})(xi,At,oi.runs):(function(xn,Yr,or){const bn=new BigInt64Array(xn.size());let cn=0;for(let Li=0;Li<or;Li++){const Ln=Number(Yr[Li]),Nn=Yr[Li+or];for(let an=cn;an<cn+Ln;an++)xn.get(an)?bn[an]=Nn:(bn[an]=0n,cn++);cn+=Ln}return bn})(xi,At,oi.runs)})(Ye,Ue,St,bt);case ri.NONE:return Ye=St?(function(At,_t){const Bt=new BigInt64Array(At.size());let xi=0,oi=0;for(;oi!=Bt.length;++oi)if(At.get(oi)){const xn=_t[xi++];Bt[oi]=xn>>1n^-(1n&xn)}else Bt[oi]=0n;return Bt})(bt,Ye):(function(At,_t){const Bt=new BigInt64Array(At.size());let xi=0,oi=0;for(;oi!=Bt.length;++oi)Bt[oi]=At.get(oi)?_t[xi++]:0n;return Bt})(bt,Ye),Ye;default:throw new Error("The specified Logical level technique is not supported")}})(Ad(Qe,He,rt.numValues),rt,yt,st)})(q,$,ne,ye,ce):Mh(q,$,ne,ye);return new Eh(Q.name,ke,ce)}if(pe===jn.SEQUENCE){const ke=Sc(q,$,ne);return new Am(Q.name,ke[0],ke[1],ne.numRleValues)}{const ke=Mm(q,$,ne,ye);return new kd(Q.name,ke,ce)}})(x,w,L,G,z);case 7:return(function(q,$,Q,ce){const J=$r(q,$),ne=Rs(ce)?(function(pe,ye,ke,Qe){const He=ye.get(),rt=He+Qe*Float32Array.BYTES_PER_ELEMENT,yt=new Uint8Array(pe.subarray(He,rt)).buffer,st=new Float32Array(yt);ye.set(rt);const Ye=ke.size(),Ue=new Float32Array(Ye);let St=0;for(let bt=0;bt<Ye;bt++)Ue[bt]=ke.get(bt)?st[St++]:0;return Ue})(q,$,ce,J.numValues):(function(pe,ye,ke){const Qe=ye.get(),He=Qe+ke*Float32Array.BYTES_PER_ELEMENT,rt=new Uint8Array(pe.subarray(Qe,He)).buffer,yt=new Float32Array(rt);return ye.set(He),yt})(q,$,J.numValues);return new Jg(Q.name,ne,ce)})(x,w,L,G);case 8:return(function(q,$,Q,ce){const J=$r(q,$),ne=Rs(ce)?(function(pe,ye,ke,Qe){const He=ye.get(),rt=He+Qe*Float64Array.BYTES_PER_ELEMENT,yt=new Uint8Array(pe.subarray(He,rt)).buffer,st=new Float64Array(yt);ye.set(rt);const Ye=ke.size(),Ue=new Float64Array(Ye);let St=0;for(let bt=0;bt<Ye;bt++)Ue[bt]=ke.get(bt)?st[St++]:0;return Ue})(q,$,ce,J.numValues):(function(pe,ye,ke){const Qe=ye.get(),He=Qe+ke*Float64Array.BYTES_PER_ELEMENT,rt=new Uint8Array(pe.subarray(Qe,He)).buffer,yt=new Float64Array(rt);return ye.set(He),yt})(q,$,J.numValues);return new ym(Q.name,ne,ce)})(x,w,L,G);default:throw new Error(`The specified data type for the field is currently not supported: ${z}`)}})(o,n,e,c,i.scalarType,i):o!=1?null:(function(m,x,w,C){let z=null,L=null,B=null,F=null,G=!1;for(;!G;){const ce=$r(m,x);switch(ce.physicalStreamType){case br.LENGTH:Hr.DICTIONARY===ce.logicalStreamType.lengthType?z=bu(m,x,ce):B=bu(m,x,ce);break;case br.DATA:no.SINGLE===ce.logicalStreamType.dictionaryType||no.SHARED===ce.logicalStreamType.dictionaryType?(L=m.subarray(x.get(),x.get()+ce.byteLength),G=!0):F=m.subarray(x.get(),x.get()+ce.byteLength),x.add(ce.byteLength)}}const q=w.complexType.children,$=[];let Q=0;for(const ce of q){const J=sr(m,x,1)[0];if(J==0)continue;const ne=`${w.name}${ce.name==="default"?"":":"+ce.name}`;if(J!==2||ce.type!=="scalarField"||ce.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const pe=$r(m,x),ye=Bd(m,pe.numValues,x),ke=$r(m,x),Qe=ke.decompressedCount!==C?Em(m,x,ke,!1,new ro(ye,pe.numValues)):Xr(m,x,ke,!1);$[Q++]=F?new dp(ne,Qe,z,L,B,F,new ro(ye,pe.numValues)):new Mc(ne,Qe,z,L,new ro(ye,pe.numValues))}return $})(n,e,i,c)}function Rs(n){return n instanceof ro}function Tu(n){if(n.name==="id")return!1;if(n.type==="scalarType"){const e=n.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(n.type==="complexType"){const e=n.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",n),!1}const Fd=new TextDecoder;function Dh(n,e){const i=sr(n,e,1)[0];if(i===0)return"";const o=e.get(),c=n.subarray(o,o+i);return e.add(i),Fd.decode(c)}function Al(n,e){const i=sr(n,e,1)[0]>>>0,o=!!(4&i),c=!!(2&i),p=sr(n,e,1)[0]>>>0,m={};if(1&i&&(m.nullable=!0),c){const x={};if(o?(x.type="logicalType",x.logicalType=p):(x.type="physicalType",x.physicalType=p),8&i){const w=sr(n,e,1)[0]>>>0;x.children=new Array(w);for(let C=0;C<w;C++)x.children[C]=Al(n,e)}m.type="complexField",m.complexField=x}else{const x={};o?(x.type="logicalType",x.logicalType=p):(x.type="physicalType",x.physicalType=p),m.type="scalarField",m.scalarField=x}return m}function Ny(n,e){const i=sr(n,e,1)[0]>>>0,o=(function(c){switch(c){case 0:case 1:case 2:case 3:{const p={};p.nullable=!!(1&c),p.columnScope=0;const m={};return m.physicalType=c>1?6:4,m.type="physicalType",p.scalarType=m,p.type="scalarType",p}case 4:{const p={nullable:!1,columnScope:0},m={type:"physicalType",physicalType:0};return p.type="complexType",p.complexType=m,p}case 30:{const p={nullable:!1,columnScope:0},m={type:"physicalType",physicalType:1};return p.type="complexType",p.complexType=m,p}default:return(function(p){let m=null;switch(p){case 10:case 11:m=0;break;case 12:case 13:m=1;break;case 14:case 15:m=2;break;case 16:case 17:m=3;break;case 18:case 19:m=4;break;case 20:case 21:m=5;break;case 22:case 23:m=6;break;case 24:case 25:m=7;break;case 26:case 27:m=8;break;case 28:case 29:m=9;break;default:return null}const x={};x.nullable=!!(1&p),x.columnScope=0;const w={type:"physicalType"};return w.physicalType=m,x.type="scalarType",x.scalarType=w,x})(c)}})(i);if(!o)throw new Error(`Unsupported column type code: ${i}`);if((function(c){return c>=10})(i)?o.name=Dh(n,e):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),(function(c){return c===30})(i)){const c=sr(n,e,1)[0]>>>0,p=o.complexType;p.children=new Array(c);for(let m=0;m<c;m++)p.children[m]=Al(n,e)}return o}function ty(n,e){const i={featureTables:[]},o={};o.name=Dh(n,e);const c=sr(n,e,1)[0]>>>0,p=sr(n,e,1)[0]>>>0;o.columns=new Array(p);for(let m=0;m<p;m++)o.columns[m]=Ny(n,e);return i.featureTables.push(o),[i,c]}function jd(n,e,i,o,c,p,m=!1){const x=e.scalarType.physicalType,w=Ml(c,p,n,i);if(x===4)switch(w){case jn.FLAT:{const C=Xr(n,i,c,!1);return new np(o,C,p)}case jn.SEQUENCE:{const C=Sm(n,i,c);return new vm(o,C[0],C[1],c.numRleValues)}case jn.CONST:{const C=Tm(n,i,c,!1);return new xm(o,C,p)}}else switch(w){case jn.FLAT:{if(m){const z=(function(L,B,F,G){const q=(function($,Q,ce){const J=new Float64Array(Q);for(let ne=0;ne<Q;ne++)J[ne]=Hg($,ce);return J})(L,F.numValues,B);return(function($,Q,ce){switch(Q.logicalLevelTechnique1){case ri.DELTA:return Q.logicalLevelTechnique2===ri.RLE&&($=Xg($,Q.runs,Q.numRleValues)),(function(J){J[0]=J[0]%2==1?(J[0]+1)/-2:J[0]/2;const ne=J.length/4*4;let pe=1;if(ne>=4)for(;pe<ne-4;pe+=4){const ye=J[pe],ke=J[pe+1],Qe=J[pe+2],He=J[pe+3];J[pe]=(ye%2==1?(ye+1)/-2:ye/2)+J[pe-1],J[pe+1]=(ke%2==1?(ke+1)/-2:ke/2)+J[pe],J[pe+2]=(Qe%2==1?(Qe+1)/-2:Qe/2)+J[pe+1],J[pe+3]=(He%2==1?(He+1)/-2:He/2)+J[pe+2]}for(;pe!=J.length;++pe)J[pe]=(J[pe]%2==1?(J[pe]+1)/-2:J[pe]/2)+J[pe-1]})($),$;case ri.RLE:return(function(J,ne,pe){return Xg(J,ne.runs,ne.numRleValues)})($,Q);case ri.NONE:return $;default:throw new Error(`The specified Logical level technique is not supported: ${Q.logicalLevelTechnique1}`)}})(q,F)})(n,i,c);return new ym(o,z,p)}const C=Mh(n,i,c,!1);return new Eh(o,C,p)}case jn.SEQUENCE:{const C=Sc(n,i,c);return new Am(o,C[0],C[1],c.numRleValues)}case jn.CONST:{const C=Mm(n,i,c,!1);return new kd(o,C,p)}}throw new Error("Vector type not supported for id column.")}class Vy{constructor(e,i){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case ar.POINT:case ar.MULTIPOINT:this.type=1;break;case ar.LINESTRING:case ar.MULTILINESTRING:this.type=2;break;case ar.POLYGON:case ar.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const c of i)o.push(new j(c.x,c.y));e.push(o)}return e}}class iy{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new Vy(this.features[e],this.extent)}}class Nd{constructor(e){this.layers={};const i=(function(o,c,p=!0){const m=new Zg(0),x=[];for(;m.get()<o.length;){const w=sr(o,m,1)[0]>>>0,C=m.get()+w;if(C>o.length)throw new Error(`Block overruns tile: ${C} > ${o.length}`);if(sr(o,m,1)[0]>>>0!=1){m.set(C);continue}const z=ty(o,m),L=z[1],B=z[0].featureTables[0];let F=null,G=null;const q=[];let $=0;for(const ce of B.columns){const J=ce.name;if(J==="id"){let ne=null;if(ce.nullable){const ye=$r(o,m),ke=m.get(),Qe=Bd(o,ye.numValues,m);m.set(ke+ye.byteLength),ne=new ro(Qe,ye.numValues)}const pe=$r(o,m);$=pe.decompressedCount,F=jd(o,ce,m,J,pe,ne??$,p)}else if(J==="geometry"){const ne=sr(o,m,1)[0];if($===0){const pe=m.get();$=$r(o,m).decompressedCount,m.set(pe)}G=Kg(o,ne,m,$)}else{const ne=Tu(ce)?sr(o,m,1)[0]:1;if(ne===0&&ce.type==="scalarType")continue;const pe=wu(o,m,ce,ne,$);if(pe)if(Array.isArray(pe))for(const ye of pe)q.push(ye);else q.push(pe)}}const Q=new _u(B.name,G,F,q,L);x.push(Q),m.set(C)}return x})(new Uint8Array(e));this.layers=i.reduce(((o,c)=>Object.assign(Object.assign({},o),{[c.name]:new iy(c)})),{})}}class ny{constructor(e,i){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=i,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],i=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of i){const c=[];for(const p of o)c.push(new j(p[0],p[1]));e.push(c)}return e}}const Vd="_geojsonTileLayer";function fp(n,e){e.writeVarintField(15,n.version||1),e.writeStringField(1,n.name||""),e.writeVarintField(5,n.extent||4096);const i={keys:[],values:[],keycache:{},valuecache:{}};for(let p=0;p<n.length;p++)i.feature=n.feature(p),e.writeMessage(2,pp,i);const o=i.keys;for(const p of o)e.writeStringField(3,p);const c=i.values;for(const p of c)e.writeMessage(4,mp,p)}function pp(n,e){if(!n.feature)return;const i=n.feature;i.id!==void 0&&e.writeVarintField(1,i.id),e.writeMessage(2,ry,n),e.writeVarintField(3,i.type),e.writeMessage(4,Lm,i)}function ry(n,e){for(const i in n.feature?.properties){let o=n.feature.properties[i],c=n.keycache[i];if(o==null)continue;c===void 0&&(n.keys.push(i),c=n.keys.length-1,n.keycache[i]=c),e.writeVarint(c),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const p=typeof o+":"+o;let m=n.valuecache[p];m===void 0&&(n.values.push(o),m=n.values.length-1,n.valuecache[p]=m),e.writeVarint(m)}}function Su(n,e){return(e<<3)+(7&n)}function Im(n){return n<<1^n>>31}function Lm(n,e){const i=n.loadGeometry(),o=n.type;let c=0,p=0;for(const m of i){let x=1;o===1&&(x=m.length),e.writeVarint(Su(1,x));const w=o===3?m.length-1:m.length;for(let C=0;C<w;C++){C===1&&o!==1&&e.writeVarint(Su(2,w-1));const z=m[C].x-c,L=m[C].y-p;e.writeVarint(Im(z)),e.writeVarint(Im(L)),c+=z,p+=L}n.type===3&&e.writeVarint(Su(7,1))}}function mp(n,e){const i=typeof n;i==="string"?e.writeStringField(1,n):i==="boolean"?e.writeBooleanField(7,n):i==="number"&&(n%1!=0?e.writeDoubleField(3,n):n<0?e.writeSVarintField(6,n):e.writeVarintField(5,n))}class km{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Eo(It,16,0),this.grid3D=new Eo(It,16,0),this.featureIndexArray=new K,this.promoteId=i}insert(e,i,o,c,p,m){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,p);const w=m?this.grid3D:this.grid;for(let C=0;C<i.length;C++){const z=i[C],L=[1/0,1/0,-1/0,-1/0];for(let B=0;B<z.length;B++){const F=z[B];L[0]=Math.min(L[0],F.x),L[1]=Math.min(L[1],F.y),L[2]=Math.max(L[2],F.x),L[3]=Math.max(L[3],F.y)}L[0]<It&&L[1]<It&&L[2]>=0&&L[3]>=0&&w.insert(x,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new mi(new Vf(this.rawTileData)).layers:new Nd(this.rawTileData).layers,this.sourceLayerCoder=new gm(this.vtLayers?Object.keys(this.vtLayers).sort():[Vd])),this.vtLayers}query(e,i,o,c){this.loadVTLayers();const p=e.params,m=It/e.tileSize/e.scale,x=jr(p.filter,p.globalState),w=e.queryGeometry,C=e.queryPadding*m,z=gu.fromPoints(w),L=this.grid.query(z.minX-C,z.minY-C,z.maxX+C,z.maxY+C),B=gu.fromPoints(e.cameraQueryGeometry).expandBy(C),F=this.grid3D.query(B.minX,B.minY,B.maxX,B.maxY,(($,Q,ce,J)=>(function(ne,pe,ye,ke,Qe){for(const rt of ne)if(pe<=rt.x&&ye<=rt.y&&ke>=rt.x&&Qe>=rt.y)return!0;const He=[new j(pe,ye),new j(pe,Qe),new j(ke,Qe),new j(ke,ye)];if(ne.length>2){for(const rt of He)if(zo(ne,rt))return!0}for(let rt=0;rt<ne.length-1;rt++)if(ug(ne[rt],ne[rt+1],He))return!0;return!1})(e.cameraQueryGeometry,$-C,Q-C,ce+C,J+C)));for(const $ of F)L.push($);L.sort(gp);const G={};let q;for(let $=0;$<L.length;$++){const Q=L[$];if(Q===q)continue;q=Q;const ce=this.featureIndexArray.get(Q);let J=null;this.loadMatchingFeature(G,ce.bucketIndex,ce.sourceLayerIndex,ce.featureIndex,x,p.layers,p.availableImages,i,o,c,((ne,pe,ye)=>(J||(J=Qs(ne)),pe.queryIntersectsFeature({queryGeometry:w,feature:ne,featureState:ye,geometry:J,zoom:this.z,transform:e.transform,pixelsToTileUnits:m,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return G}loadMatchingFeature(e,i,o,c,p,m,x,w,C,z,L){const B=this.bucketLayerIDs[i];if(m&&!B.some(($=>m.has($))))return;const F=this.sourceLayerCoder.decode(o),G=this.vtLayers[F].feature(c);if(p.needGeometry){const $=Ka(G,!0);if(!p.filter(new Ei(this.tileID.overscaledZ),$,this.tileID.canonical))return}else if(!p.filter(new Ei(this.tileID.overscaledZ),G))return;const q=this.getId(G,F);for(let $=0;$<B.length;$++){const Q=B[$];if(m&&!m.has(Q))continue;const ce=w[Q];if(!ce)continue;let J={};q&&z&&(J=z.getState(ce.sourceLayer||Vd,q));const ne=Bi({},C[Q]);ne.paint=ay(ne.paint,ce.paint,G,J,x),ne.layout=ay(ne.layout,ce.layout,G,J,x);const pe=!L||L(G,ce,J);if(!pe)continue;const ye=new tp(G,this.z,this.x,this.y,q);ye.layer=ne;let ke=e[Q];ke===void 0&&(ke=e[Q]=[]),ke.push({featureIndex:c,feature:ye,intersectionZ:pe})}}lookupSymbolFeatures(e,i,o,c,p,m,x,w){const C={};this.loadVTLayers();const z=jr(p.filterSpec,p.globalState);for(const L of e)this.loadMatchingFeature(C,o,c,L,z,m,x,w,i);return C}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){var o;let c=e.id;return this.promoteId&&(c=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof c=="boolean"&&(c=Number(c)),c===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(c=Number(e.properties.cluster_id))),c}}function ay(n,e,i,o,c){return Er(n,((p,m)=>{const x=e instanceof ul?e.get(m):null;return x&&x.evaluate?x.evaluate(i,o,c):x}))}function gp(n,e){return e-n}function r(n,e,i,o,c){const p=[];for(let m=0;m<n.length;m++){const x=n[m];let w;for(let C=0;C<x.length-1;C++){let z=x[C],L=x[C+1];z.x<e&&L.x<e||(z.x<e?z=new j(e,z.y+(e-z.x)/(L.x-z.x)*(L.y-z.y))._round():L.x<e&&(L=new j(e,z.y+(e-z.x)/(L.x-z.x)*(L.y-z.y))._round()),z.y<i&&L.y<i||(z.y<i?z=new j(z.x+(i-z.y)/(L.y-z.y)*(L.x-z.x),i)._round():L.y<i&&(L=new j(z.x+(i-z.y)/(L.y-z.y)*(L.x-z.x),i)._round()),z.x>=o&&L.x>=o||(z.x>=o?z=new j(o,z.y+(o-z.x)/(L.x-z.x)*(L.y-z.y))._round():L.x>=o&&(L=new j(o,z.y+(o-z.x)/(L.x-z.x)*(L.y-z.y))._round()),z.y>=c&&L.y>=c||(z.y>=c?z=new j(z.x+(c-z.y)/(L.y-z.y)*(L.x-z.x),c)._round():L.y>=c&&(L=new j(z.x+(c-z.y)/(L.y-z.y)*(L.x-z.x),c)._round()),w&&z.equals(w[w.length-1])||(w=[z],p.push(w)),w.push(L)))))}}return p}function s(n,e,i,o,c){switch(e){case 1:return(function(p,m,x,w){const C=[];for(const z of p)for(const L of z){const B=w===0?L.x:L.y;B>=m&&B<=x&&C.push([L])}return C})(n,i,o,c);case 2:return _(n,i,o,c,!1);case 3:return _(n,i,o,c,!0)}return[]}function h(n,e,i,o,c){const p=o===0?A:P;let m=[];const x=[];for(let z=0;z<n.length-1;z++){const L=n[z],B=n[z+1],F=o===0?L.x:L.y,G=o===0?B.x:B.y;let q=!1;F<e?G>e&&m.push(p(L,B,e)):F>i?G<i&&m.push(p(L,B,i)):m.push(L),G<e&&F>=e&&(m.push(p(L,B,e)),q=!0),G>i&&F<=i&&(m.push(p(L,B,i)),q=!0),!c&&q&&(x.push(m),m=[])}const w=n.length-1,C=o===0?n[w].x:n[w].y;return C>=e&&C<=i&&m.push(n[w]),c&&m.length>0&&!m[0].equals(m[m.length-1])&&m.push(new j(m[0].x,m[0].y)),m.length>0&&x.push(m),x}function _(n,e,i,o,c){const p=[];for(const m of n){const x=h(m,e,i,o,c);x.length>0&&p.push(...x)}return p}function A(n,e,i){return new j(i,n.y+(i-n.x)/(e.x-n.x)*(e.y-n.y))}function P(n,e,i){return new j(n.x+(i-n.y)/(e.y-n.y)*(e.x-n.x),i)}xt("FeatureIndex",km,{omit:["rawTileData","sourceLayerCoder"]});class U extends j{constructor(e,i,o,c){super(e,i),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new U(this.x,this.y,this.angle,this.segment)}}function ee(n,e,i,o,c){if(e.segment===void 0||i===0)return!0;let p=e,m=e.segment+1,x=0;for(;x>-i/2;){if(m--,m<0)return!1;x-=n[m].dist(p),p=n[m]}x+=n[m].dist(n[m+1]),m++;const w=[];let C=0;for(;x<i/2;){const z=n[m],L=n[m+1];if(!L)return!1;let B=n[m-1].angleTo(z)-z.angleTo(L);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:B}),C+=B;x-w[0].distance>o;)C-=w.shift().angleDelta;if(C>c)return!1;m++,x+=z.dist(L)}return!0}function be(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function Ge(n,e,i){return n?.6*e*i:0}function it(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function lt(n,e,i,o,c,p){const m=Ge(i,c,p),x=it(i,o)*p;let w=0;const C=be(n)/2;for(let z=0;z<n.length-1;z++){const L=n[z],B=n[z+1],F=L.dist(B);if(w+F>C){const G=(C-w)/F,q=en.number(L.x,B.x,G),$=en.number(L.y,B.y,G),Q=new U(q,$,B.angleTo(L),z);return Q._round(),!m||ee(n,Q,x,m,e)?Q:void 0}w+=F}}function qe(n,e,i,o,c,p,m,x,w){const C=Ge(o,p,m),z=it(o,c),L=z*m,B=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return e-L<e/4&&(e=L+e/4),Xe(n,B?e/2*x%e:(z/2+2*p)*m*x%e,e,C,i,L,B,!1,w)}function Xe(n,e,i,o,c,p,m,x,w){const C=p/2,z=be(n);let L=0,B=e-i,F=[];for(let G=0;G<n.length-1;G++){const q=n[G],$=n[G+1],Q=q.dist($),ce=$.angleTo(q);for(;B+i<L+Q;){B+=i;const J=(B-L)/Q,ne=en.number(q.x,$.x,J),pe=en.number(q.y,$.y,J);if(ne>=0&&ne<w&&pe>=0&&pe<w&&B-C>=0&&B+C<=z){const ye=new U(ne,pe,ce,G);ye._round(),o&&!ee(n,ye,p,o,c)||F.push(ye)}}L+=Q}return x||F.length||m||(F=Xe(n,L/2,i,o,c,p,m,!0,w)),F}function Lt(n,e,i,o){const c=[],p=n.image,m=p.pixelRatio,x=p.paddedRect.w-2,w=p.paddedRect.h-2;let C={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const z=p.stretchX||[[0,x]],L=p.stretchY||[[0,w]],B=(Ue,St)=>Ue+St[1]-St[0],F=z.reduce(B,0),G=L.reduce(B,0),q=x-F,$=w-G;let Q=0,ce=F,J=0,ne=G,pe=0,ye=q,ke=0,Qe=$;if(p.content&&o){const Ue=p.content,St=Ue[2]-Ue[0],bt=Ue[3]-Ue[1];(p.textFitWidth||p.textFitHeight)&&(C=Sl(n)),Q=Ut(z,0,Ue[0]),J=Ut(L,0,Ue[1]),ce=Ut(z,Ue[0],Ue[2]),ne=Ut(L,Ue[1],Ue[3]),pe=Ue[0]-Q,ke=Ue[1]-J,ye=St-ce,Qe=bt-ne}const He=C.x1,rt=C.y1,yt=C.x2-He,st=C.y2-rt,Ye=(Ue,St,bt,At)=>{const _t=ze(Ue.stretch-Q,ce,yt,He),Bt=Ee(Ue.fixed-pe,ye,Ue.stretch,F),xi=ze(St.stretch-J,ne,st,rt),oi=Ee(St.fixed-ke,Qe,St.stretch,G),xn=ze(bt.stretch-Q,ce,yt,He),Yr=Ee(bt.fixed-pe,ye,bt.stretch,F),or=ze(At.stretch-J,ne,st,rt),bn=Ee(At.fixed-ke,Qe,At.stretch,G),cn=new j(_t,xi),Li=new j(xn,xi),Ln=new j(xn,or),Nn=new j(_t,or),an=new j(Bt/m,oi/m),ts=new j(Yr/m,bn/m),Wr=e*Math.PI/180;if(Wr){const Tr=Math.sin(Wr),An=Math.cos(Wr),lr=[An,-Tr,Tr,An];cn._matMult(lr),Li._matMult(lr),Nn._matMult(lr),Ln._matMult(lr)}const is=Ue.stretch+Ue.fixed,Oo=St.stretch+St.fixed;return{tl:cn,tr:Li,bl:Nn,br:Ln,tex:{x:p.paddedRect.x+1+is,y:p.paddedRect.y+1+Oo,w:bt.stretch+bt.fixed-is,h:At.stretch+At.fixed-Oo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:an,pixelOffsetBR:ts,minFontScaleX:ye/m/yt,minFontScaleY:Qe/m/st,isSDF:i}};if(o&&(p.stretchX||p.stretchY)){const Ue=Xi(z,q,F),St=Xi(L,$,G);for(let bt=0;bt<Ue.length-1;bt++){const At=Ue[bt],_t=Ue[bt+1];for(let Bt=0;Bt<St.length-1;Bt++)c.push(Ye(At,St[Bt],_t,St[Bt+1]))}}else c.push(Ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return c}function Ut(n,e,i){let o=0;for(const c of n)o+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return o}function Xi(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[c,p]of n){const m=o[o.length-1];o.push({fixed:c-m.stretch,stretch:m.stretch}),o.push({fixed:c-m.stretch,stretch:m.stretch+(p-c)})}return o.push({fixed:e+1,stretch:i}),o}function ze(n,e,i,o){return n/e*i+o}function Ee(n,e,i,o){return n-e*i/o}xt("Anchor",U);class Ve{constructor(e,i,o,c,p,m,x,w,C,z){var L;if(this.boxStartIndex=e.length,C){let B=m.top,F=m.bottom;const G=m.collisionPadding;G&&(B-=G[1],F+=G[3]);let q=F-B;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const B=!((L=m.image)===null||L===void 0)&&L.content&&(m.image.textFitWidth||m.image.textFitHeight)?Sl(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};B.y1=B.y1*x-w[0],B.y2=B.y2*x+w[2],B.x1=B.x1*x-w[3],B.x2=B.x2*x+w[1];const F=m.collisionPadding;if(F&&(B.x1-=F[0]*x,B.y1-=F[1]*x,B.x2+=F[2]*x,B.y2+=F[3]*x),z){const G=new j(B.x1,B.y1),q=new j(B.x2,B.y1),$=new j(B.x1,B.y2),Q=new j(B.x2,B.y2),ce=z*Math.PI/180;G._rotate(ce),q._rotate(ce),$._rotate(ce),Q._rotate(ce),B.x1=Math.min(G.x,q.x,$.x,Q.x),B.x2=Math.max(G.x,q.x,$.x,Q.x),B.y1=Math.min(G.y,q.y,$.y,Q.y),B.y2=Math.max(G.y,q.y,$.y,Q.y)}e.emplaceBack(i.x,i.y,B.x1,B.y1,B.x2,B.y2,o,c,p)}this.boxEndIndex=e.length}}class at{constructor(e=[],i=(o,c)=>o<c?-1:o>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,c=i[e];for(;e>0;){const p=e-1>>1,m=i[p];if(o(c,m)>=0)break;i[e]=m,e=p}i[e]=c}_down(e){const{data:i,compare:o}=this,c=this.length>>1,p=i[e];for(;e<c;){let m=1+(e<<1);const x=m+1;if(x<this.length&&o(i[x],i[m])<0&&(m=x),o(i[m],p)>=0)break;i[e]=i[m],e=m}i[e]=p}}function Nt(n,e=1,i=!1){const o=gu.fromPoints(n[0]),c=Math.min(o.width(),o.height());let p=c/2;const m=new at([],Ii),{minX:x,minY:w,maxX:C,maxY:z}=o;if(c===0)return new j(x,w);for(let F=x;F<C;F+=c)for(let G=w;G<z;G+=c)m.push(new kt(F+p,G+p,p,n));let L=(function(F){let G=0,q=0,$=0;const Q=F[0];for(let ce=0,J=Q.length,ne=J-1;ce<J;ne=ce++){const pe=Q[ce],ye=Q[ne],ke=pe.x*ye.y-ye.x*pe.y;q+=(pe.x+ye.x)*ke,$+=(pe.y+ye.y)*ke,G+=3*ke}return new kt(q/G,$/G,0,F)})(n),B=m.length;for(;m.length;){const F=m.pop();(F.d>L.d||!L.d)&&(L=F,i&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,B)),F.max-L.d<=e||(p=F.h/2,m.push(new kt(F.p.x-p,F.p.y-p,p,n)),m.push(new kt(F.p.x+p,F.p.y-p,p,n)),m.push(new kt(F.p.x-p,F.p.y+p,p,n)),m.push(new kt(F.p.x+p,F.p.y+p,p,n)),B+=4)}return i&&(console.log(`num probes: ${B}`),console.log(`best distance: ${L.d}`)),L.p}function Ii(n,e){return e.max-n.max}function kt(n,e,i,o){this.p=new j(n,e),this.h=i,this.d=(function(c,p){let m=!1,x=1/0;for(let w=0;w<p.length;w++){const C=p[w];for(let z=0,L=C.length,B=L-1;z<L;B=z++){const F=C[z],G=C[B];F.y>c.y!=G.y>c.y&&c.x<(G.x-F.x)*(c.y-F.y)/(G.y-F.y)+F.x&&(m=!m),x=Math.min(x,Fp(c,F,G))}}return(m?1:-1)*Math.sqrt(x)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Ft;M.aP=void 0,(Ft=M.aP||(M.aP={}))[Ft.center=1]="center",Ft[Ft.left=2]="left",Ft[Ft.right=3]="right",Ft[Ft.top=4]="top",Ft[Ft.bottom=5]="bottom",Ft[Ft["top-left"]=6]="top-left",Ft[Ft["top-right"]=7]="top-right",Ft[Ft["bottom-left"]=8]="bottom-left",Ft[Ft["bottom-right"]=9]="bottom-right";const fi=Number.POSITIVE_INFINITY;function Ci(n,e){return e[1]!==fi?(function(i,o,c){let p=0,m=0;switch(o=Math.abs(o),c=Math.abs(c),i){case"top-right":case"top-left":case"top":m=c-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-c}switch(i){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,m]})(n,e[0],e[1]):(function(i,o){let c=0,p=0;o<0&&(o=0);const m=o/Math.SQRT2;switch(i){case"top-right":case"top-left":p=m-7;break;case"bottom-right":case"bottom-left":p=7-m;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(i){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=o;break;case"right":c=-o}return[c,p]})(n,e[0])}function Cl(n,e,i){var o;const c=n.layout,p=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},i);if(p){const x=p.values,w=[];for(let C=0;C<x.length;C+=2){const z=w[C]=x[C],L=x[C+1].map((B=>B*$n));z.startsWith("top")?L[1]-=7:z.startsWith("bottom")&&(L[1]+=7),w[C+1]=L}return new pn(w)}const m=c.get("text-variable-anchor");if(m){let x;x=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},i)*$n,fi]:c.get("text-offset").evaluate(e,{},i).map((C=>C*$n));const w=[];for(const C of m)w.push(C,Ci(C,x));return new pn(w)}return null}function Bm(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function z1(n,e,i,o,c,p,m,x,w,C,z,L){let B=p.textMaxSize.evaluate(e,{});B===void 0&&(B=m);const F=n.layers[0].layout,G=F.get("icon-offset").evaluate(e,{},z),q=R0(i.horizontal),$=m/24,Q=n.tilePixelRatio*$,ce=n.tilePixelRatio*B/24,J=n.tilePixelRatio*x,ne=n.tilePixelRatio*F.get("symbol-spacing"),pe=F.get("text-padding")*n.tilePixelRatio,ye=(function(bt,At,_t,Bt=1){const xi=bt.get("icon-padding").evaluate(At,{},_t),oi=xi&&xi.values;return[oi[0]*Bt,oi[1]*Bt,oi[2]*Bt,oi[3]*Bt]})(F,e,z,n.tilePixelRatio),ke=F.get("text-max-angle")/180*Math.PI,Qe=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",He=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",rt=F.get("symbol-placement"),yt=ne/2,st=F.get("icon-text-fit");let Ye;o&&st!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(Ye=to(o,i.vertical,st,F.get("icon-text-fit-padding"),G,$)),q&&(o=to(o,q,st,F.get("icon-text-fit-padding"),G,$)));const Ue=z?L.line.getGranularityForZoomLevel(z.z):1,St=(bt,At)=>{At.x<0||At.x>=It||At.y<0||At.y>=It||(function(_t,Bt,xi,oi,xn,Yr,or,bn,cn,Li,Ln,Nn,an,ts,Wr,is,Oo,Tr,An,lr,kn,Sr,Ec,Dl,jm){const Ph=_t.addToLineVertexArray(Bt,xi);let Ud,yp,_p,vp,B0=0,O0=0,F0=0,j0=0,Yy=-1,Wy=-1;const Ac={};let N0=_n("");if(_t.allowVerticalPlacement&&oi.vertical){const pa=bn.layout.get("text-rotate").evaluate(kn,{},Dl)+90;_p=new Ve(cn,Bt,Li,Ln,Nn,oi.vertical,an,ts,Wr,pa),or&&(vp=new Ve(cn,Bt,Li,Ln,Nn,or,Oo,Tr,Wr,pa))}if(xn){const pa=bn.layout.get("icon-rotate").evaluate(kn,{}),ao=bn.layout.get("icon-text-fit")!=="none",Gd=Lt(xn,pa,Ec,ao),zl=or?Lt(or,pa,Ec,ao):void 0;yp=new Ve(cn,Bt,Li,Ln,Nn,xn,Oo,Tr,!1,pa),B0=4*Gd.length;const qd=_t.iconSizeData;let Mu=null;qd.kind==="source"?(Mu=[Ja*bn.layout.get("icon-size").evaluate(kn,{})],Mu[0]>pu&&sn(`${_t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):qd.kind==="composite"&&(Mu=[Ja*Sr.compositeIconSizes[0].evaluate(kn,{},Dl),Ja*Sr.compositeIconSizes[1].evaluate(kn,{},Dl)],(Mu[0]>pu||Mu[1]>pu)&&sn(`${_t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),_t.addSymbols(_t.icon,Gd,Mu,lr,An,kn,M.az.none,Bt,Ph.lineStartIndex,Ph.lineLength,-1,Dl),Yy=_t.icon.placedSymbolArray.length-1,zl&&(O0=4*zl.length,_t.addSymbols(_t.icon,zl,Mu,lr,An,kn,M.az.vertical,Bt,Ph.lineStartIndex,Ph.lineLength,-1,Dl),Wy=_t.icon.placedSymbolArray.length-1)}const V0=Object.keys(oi.horizontal);for(const pa of V0){const ao=oi.horizontal[pa];if(!Ud){N0=_n(ao.text);const zl=bn.layout.get("text-rotate").evaluate(kn,{},Dl);Ud=new Ve(cn,Bt,Li,Ln,Nn,ao,an,ts,Wr,zl)}const Gd=ao.positionedLines.length===1;if(F0+=z0(_t,Bt,ao,Yr,bn,Wr,kn,is,Ph,oi.vertical?M.az.horizontal:M.az.horizontalOnly,Gd?V0:[pa],Ac,Yy,Sr,Dl),Gd)break}oi.vertical&&(j0+=z0(_t,Bt,oi.vertical,Yr,bn,Wr,kn,is,Ph,M.az.vertical,["vertical"],Ac,Wy,Sr,Dl));const L1=Ud?Ud.boxStartIndex:_t.collisionBoxArray.length,k1=Ud?Ud.boxEndIndex:_t.collisionBoxArray.length,B1=_p?_p.boxStartIndex:_t.collisionBoxArray.length,O1=_p?_p.boxEndIndex:_t.collisionBoxArray.length,F1=yp?yp.boxStartIndex:_t.collisionBoxArray.length,j1=yp?yp.boxEndIndex:_t.collisionBoxArray.length,N1=vp?vp.boxStartIndex:_t.collisionBoxArray.length,V1=vp?vp.boxEndIndex:_t.collisionBoxArray.length;let Pl=-1;const oy=(pa,ao)=>pa&&pa.circleDiameter?Math.max(pa.circleDiameter,ao):ao;Pl=oy(Ud,Pl),Pl=oy(_p,Pl),Pl=oy(yp,Pl),Pl=oy(vp,Pl);const U0=Pl>-1?1:0;U0&&(Pl*=jm/$n),_t.glyphOffsetArray.length>=bh.MAX_GLYPHS&&sn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),kn.sortKey!==void 0&&_t.addToSortKeyRanges(_t.symbolInstances.length,kn.sortKey);const U1=Cl(bn,kn,Dl),[G1,q1]=(function(pa,ao){const Gd=pa.length,zl=ao?.values;if(zl?.length>0)for(let qd=0;qd<zl.length;qd+=2){const Mu=zl[qd+1];pa.emplaceBack(M.aP[zl[qd]],Mu[0],Mu[1])}return[Gd,pa.length]})(_t.textAnchorOffsets,U1);_t.symbolInstances.emplaceBack(Bt.x,Bt.y,Ac.right>=0?Ac.right:-1,Ac.center>=0?Ac.center:-1,Ac.left>=0?Ac.left:-1,Ac.vertical||-1,Yy,Wy,N0,L1,k1,B1,O1,F1,j1,N1,V1,Li,F0,j0,B0,O0,U0,0,an,Pl,G1,q1)})(n,At,bt,i,o,c,Ye,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Q,[pe,pe,pe,pe],Qe,w,J,ye,He,G,e,p,C,z,m)};if(rt==="line")for(const bt of r(e.geometry,0,0,It,It)){const At=vl(bt,Ue),_t=qe(At,ne,ke,i.vertical||q,o,24,ce,n.overscaling,It);for(const Bt of _t)q&&R1(n,q.text,yt,Bt)||St(At,Bt)}else if(rt==="line-center"){for(const bt of e.geometry)if(bt.length>1){const At=vl(bt,Ue),_t=lt(At,ke,i.vertical||q,o,24,ce);_t&&St(At,_t)}}else if(e.type==="Polygon")for(const bt of qu(e.geometry,0)){const At=Nt(bt,16);St(vl(bt[0],Ue,!0),new U(At.x,At.y,0))}else if(e.type==="LineString")for(const bt of e.geometry){const At=vl(bt,Ue);St(At,new U(At[0].x,At[0].y,0))}else if(e.type==="Point")for(const bt of e.geometry)for(const At of bt)St([At],new U(At.x,At.y,0))}function z0(n,e,i,o,c,p,m,x,w,C,z,L,B,F,G){const q=(function(ce,J,ne,pe,ye,ke,Qe,He){const rt=pe.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,yt=[];for(const st of J.positionedLines)for(const Ye of st.positionedGlyphs){if(!Ye.rect)continue;const Ue=Ye.rect||{};let St=4,bt=!0,At=1,_t=0;const Bt=(ye||He)&&Ye.vertical,xi=Ye.metrics.advance*Ye.scale/2;if(He&&J.verticalizable&&(_t=st.lineOffset/2-(Ye.imageName?-($n-Ye.metrics.width*Ye.scale)/2:(Ye.scale-1)*$n)),Ye.imageName){const Tr=Qe[Ye.imageName];bt=Tr.sdf,At=Tr.pixelRatio,St=1/At}const oi=ye?[Ye.x+xi,Ye.y]:[0,0];let xn=ye?[0,0]:[Ye.x+xi+ne[0],Ye.y+ne[1]-_t],Yr=[0,0];Bt&&(Yr=xn,xn=[0,0]);const or=Ye.metrics.isDoubleResolution?2:1,bn=(Ye.metrics.left-St)*Ye.scale-xi+xn[0],cn=(-Ye.metrics.top-St)*Ye.scale+xn[1],Li=bn+Ue.w/or*Ye.scale/At,Ln=cn+Ue.h/or*Ye.scale/At,Nn=new j(bn,cn),an=new j(Li,cn),ts=new j(bn,Ln),Wr=new j(Li,Ln);if(Bt){const Tr=new j(-xi,xi- -17),An=-Math.PI/2,lr=12-xi,kn=new j(22-lr,-(Ye.imageName?lr:0)),Sr=new j(...Yr);Nn._rotateAround(An,Tr)._add(kn)._add(Sr),an._rotateAround(An,Tr)._add(kn)._add(Sr),ts._rotateAround(An,Tr)._add(kn)._add(Sr),Wr._rotateAround(An,Tr)._add(kn)._add(Sr)}if(rt){const Tr=Math.sin(rt),An=Math.cos(rt),lr=[An,-Tr,Tr,An];Nn._matMult(lr),an._matMult(lr),ts._matMult(lr),Wr._matMult(lr)}const is=new j(0,0),Oo=new j(0,0);yt.push({tl:Nn,tr:an,bl:ts,br:Wr,tex:Ue,writingMode:J.writingMode,glyphOffset:oi,sectionIndex:Ye.sectionIndex,isSDF:bt,pixelOffsetTL:is,pixelOffsetBR:Oo,minFontScaleX:0,minFontScaleY:0})}return yt})(0,i,x,c,p,m,o,n.allowVerticalPlacement),$=n.textSizeData;let Q=null;$.kind==="source"?(Q=[Ja*c.layout.get("text-size").evaluate(m,{})],Q[0]>pu&&sn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):$.kind==="composite"&&(Q=[Ja*F.compositeTextSizes[0].evaluate(m,{},G),Ja*F.compositeTextSizes[1].evaluate(m,{},G)],(Q[0]>pu||Q[1]>pu)&&sn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,q,Q,x,p,m,C,e,w.lineStartIndex,w.lineLength,B,G);for(const ce of z)L[ce]=n.text.placedSymbolArray.length-1;return 4*q.length}function R0(n){for(const e in n)return n[e];return null}function R1(n,e,i,o){const c=n.compareText;if(e in c){const p=c[e];for(let m=p.length-1;m>=0;m--)if(o.dist(p[m])<i)return!0}else c[e]=[];return c[e].push(o),!1}const I0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Uy{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const p=I0[15&o];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new Uy(x,m,p,e)}constructor(e,i=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=I0.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Gy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:x}=this,w=[0,p.length-1,0],C=[];for(;w.length;){const z=w.pop()||0,L=w.pop()||0,B=w.pop()||0;if(L-B<=x){for(let $=B;$<=L;$++){const Q=m[2*$],ce=m[2*$+1];Q>=e&&Q<=o&&ce>=i&&ce<=c&&C.push(p[$])}continue}const F=B+L>>1,G=m[2*F],q=m[2*F+1];G>=e&&G<=o&&q>=i&&q<=c&&C.push(p[F]),(z===0?e<=G:i<=q)&&(w.push(B),w.push(F-1),w.push(1-z)),(z===0?o>=G:c>=q)&&(w.push(F+1),w.push(L),w.push(1-z))}return C}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:p,nodeSize:m}=this,x=[0,c.length-1,0],w=[],C=o*o;for(;x.length;){const z=x.pop()||0,L=x.pop()||0,B=x.pop()||0;if(L-B<=m){for(let $=B;$<=L;$++)k0(p[2*$],p[2*$+1],e,i)<=C&&w.push(c[$]);continue}const F=B+L>>1,G=p[2*F],q=p[2*F+1];k0(G,q,e,i)<=C&&w.push(c[F]),(z===0?e-o<=G:i-o<=q)&&(x.push(B),x.push(F-1),x.push(1-z)),(z===0?e+o>=G:i+o>=q)&&(x.push(F+1),x.push(L),x.push(1-z))}return w}}function Gy(n,e,i,o,c,p){if(c-o<=i)return;const m=o+c>>1;L0(n,e,m,o,c,p),Gy(n,e,i,o,m-1,1-p),Gy(n,e,i,m+1,c,1-p)}function L0(n,e,i,o,c,p){for(;c>o;){if(c-o>600){const C=c-o+1,z=i-o+1,L=Math.log(C),B=.5*Math.exp(2*L/3),F=.5*Math.sqrt(L*B*(C-B)/C)*(z-C/2<0?-1:1);L0(n,e,i,Math.max(o,Math.floor(i-z*B/C+F)),Math.min(c,Math.floor(i+(C-z)*B/C+F)),p)}const m=e[2*i+p];let x=o,w=c;for(Om(n,e,o,i),e[2*c+p]>m&&Om(n,e,o,c);x<w;){for(Om(n,e,x,w),x++,w--;e[2*x+p]<m;)x++;for(;e[2*w+p]>m;)w--}e[2*o+p]===m?Om(n,e,o,w):(w++,Om(n,e,w,c)),w<=i&&(o=w+1),i<=w&&(c=w-1)}}function Om(n,e,i,o){qy(n,i,o),qy(e,2*i,2*o),qy(e,2*i+1,2*o+1)}function qy(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function k0(n,e,i,o){const c=n-i,p=e-o;return c*c+p*p}var Zy;M.cH=void 0,(Zy=M.cH||(M.cH={})).create="create",Zy.load="load",Zy.fullLoad="fullLoad";let sy=null,Fm=[];const Hy=1e3/60,$y="loadTime",Xy="fullLoadTime",I1={mark(n){performance.mark(n)},frame(n){const e=n;sy!=null&&Fm.push(e-sy),sy=e},clearMetrics(){sy=null,Fm=[],performance.clearMeasures($y),performance.clearMeasures(Xy);for(const n in M.cH)performance.clearMarks(M.cH[n])},getPerformanceMetrics(){performance.measure($y,M.cH.create,M.cH.load),performance.measure(Xy,M.cH.create,M.cH.fullLoad);const n=performance.getEntriesByName($y)[0].duration,e=performance.getEntriesByName(Xy)[0].duration,i=Fm.length,o=1/(Fm.reduce(((p,m)=>p+m),0)/i/1e3),c=Fm.filter((p=>p>Hy)).reduce(((p,m)=>p+(m-Hy)/Hy),0);return{loadTime:n,fullLoadTime:e,fps:o,percentDroppedFrames:c/(i+c)*100,totalFrames:i}}};M.$=oe,M.A=$e,M.B=qa,M.C=Hn,M.D=Tt,M.E=ci,M.F=function([n,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(i),y:n*Math.sin(e)*Math.sin(i),z:n*Math.cos(i)}},M.G=en,M.H=Ei,M.I=Gi,M.J=Jc,M.K=function(n){if(hn==null){const e=n.navigator?n.navigator.userAgent:null;hn=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return hn},M.L=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Qf((()=>this.process())),this.subscription=Bl(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=ga(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}unregisterMessageHandler(n){delete this.messageHandlers[n]}sendAsync(n,e){return new Promise(((i,o)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=e?Bl(e.signal,"abort",(()=>{p?.unsubscribe(),delete this.resolveRejects[c];const w={id:c,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)}),dm):null;this.resolveRejects[c]={resolve:w=>{p?.unsubscribe(),i(w)},reject:w=>{p?.unsubscribe(),o(w)}};const m=[],x=Object.assign(Object.assign({},n),{id:c,sourceMapId:this.mapId,origin:location.origin,data:Za(n.data,m)});this.target.postMessage(x,{transfer:m})}))}receive(n){const e=n.data,i=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(ga(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return u(this,void 0,void 0,(function*(){if(e.type==="<response>"){const c=this.resolveRejects[n];return delete this.resolveRejects[n],c?void(e.error?c.reject(ru(e.error)):c.resolve(ru(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=ru(e.data),o=new AbortController;this.abortControllers[n]=o;try{const c=yield this.messageHandlers[e.type](e.sourceMapId,i,o);this.completeTask(n,null,c)}catch(c){this.completeTask(n,c)}}))}completeTask(n,e,i){const o=[];delete this.abortControllers[n];const c={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Za(e):null,data:Za(i,o)};this.target.postMessage(c,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},M.M=Pe,M.N=function(){var n=new $e(16);return $e!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},M.O=function(n,e,i){var o,c,p,m,x,w,C,z,L,B,F,G,q=i[0],$=i[1],Q=i[2];return e===n?(n[12]=e[0]*q+e[4]*$+e[8]*Q+e[12],n[13]=e[1]*q+e[5]*$+e[9]*Q+e[13],n[14]=e[2]*q+e[6]*$+e[10]*Q+e[14],n[15]=e[3]*q+e[7]*$+e[11]*Q+e[15]):(c=e[1],p=e[2],m=e[3],x=e[4],w=e[5],C=e[6],z=e[7],L=e[8],B=e[9],F=e[10],G=e[11],n[0]=o=e[0],n[1]=c,n[2]=p,n[3]=m,n[4]=x,n[5]=w,n[6]=C,n[7]=z,n[8]=L,n[9]=B,n[10]=F,n[11]=G,n[12]=o*q+x*$+L*Q+e[12],n[13]=c*q+w*$+B*Q+e[13],n[14]=p*q+C*$+F*Q+e[14],n[15]=m*q+z*$+G*Q+e[15]),n},M.P=j,M.Q=function(n,e,i){var o=i[0],c=i[1],p=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*p,n[9]=e[9]*p,n[10]=e[10]*p,n[11]=e[11]*p,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},M.R=Zr,M.S=function(n,e,i){var o=e[0],c=e[1],p=e[2],m=e[3],x=e[4],w=e[5],C=e[6],z=e[7],L=e[8],B=e[9],F=e[10],G=e[11],q=e[12],$=e[13],Q=e[14],ce=e[15],J=i[0],ne=i[1],pe=i[2],ye=i[3];return n[0]=J*o+ne*x+pe*L+ye*q,n[1]=J*c+ne*w+pe*B+ye*$,n[2]=J*p+ne*C+pe*F+ye*Q,n[3]=J*m+ne*z+pe*G+ye*ce,n[4]=(J=i[4])*o+(ne=i[5])*x+(pe=i[6])*L+(ye=i[7])*q,n[5]=J*c+ne*w+pe*B+ye*$,n[6]=J*p+ne*C+pe*F+ye*Q,n[7]=J*m+ne*z+pe*G+ye*ce,n[8]=(J=i[8])*o+(ne=i[9])*x+(pe=i[10])*L+(ye=i[11])*q,n[9]=J*c+ne*w+pe*B+ye*$,n[10]=J*p+ne*C+pe*F+ye*Q,n[11]=J*m+ne*z+pe*G+ye*ce,n[12]=(J=i[12])*o+(ne=i[13])*x+(pe=i[14])*L+(ye=i[15])*q,n[13]=J*c+ne*w+pe*B+ye*$,n[14]=J*p+ne*C+pe*F+ye*Q,n[15]=J*m+ne*z+pe*G+ye*ce,n},M.T=Df,M.U=function(n,e){const i={};for(let o=0;o<e.length;o++){const c=e[o];c in n&&(i[c]=n[c])}return i},M.V=ko,M.W=li,M.X=fm,M.Y=Vg,M.Z=_e,M._=u,M.a=ie,M.a$=ct,M.a0=We,M.a1=oo,M.a2=ka,M.a3=Gg,M.a4=Sd,M.a5=It,M.a6=function(n,e,i){if(!n)return e||{};if(!e)return n||{};const o=Ed(n),c=Ed(e);(function(m,x){x.removeAll&&(m.add.clear(),m.update.clear(),m.remove.clear(),x.remove.clear());for(const w of x.remove)m.add.delete(w),m.update.delete(w);for(const[w,C]of x.update){const z=m.update.get(w);z&&(x.update.set(w,mm(z,C)),m.update.delete(w))}})(o,c);const p={};if((o.removeAll||c.removeAll)&&(p.removeAll=!0),p.remove=new Set([...o.remove,...c.remove]),p.add=new Map([...o.add,...c.add]),p.update=new Map([...o.update,...c.update]),p.remove.size&&p.add.size)for(const m of p.add.keys())p.remove.delete(m);return(function(m){const x={};return m.removeAll&&(x.removeAll=m.removeAll),m.remove&&(x.remove=Array.from(m.remove)),m.add&&(x.add=Array.from(m.add.values())),m.update&&(x.update=Array.from(m.update.values())),x})(p)},M.a7=function(n,e){const i=new Map;if(n==null||n.type==null)return i;if(n.type==="Feature"){const o=Md(n,e);return o==null?void 0:(i.set(o,n),i)}if(n.type==="FeatureCollection"){const o=new Set;for(const c of n.features){const p=Md(c,e);if(p==null||o.has(p))return;o.add(p),i.set(p,c)}return i}},M.a8=function(n,e,i){var o,c;const p=[];if(e.removeAll)n.clear();else if(e.remove)for(const m of e.remove){const x=n.get(m);x&&(p.push(x.geometry),n.delete(m))}if(e.add)for(const m of e.add){const x=Md(m,i);if(x==null)continue;const w=n.get(x);w&&p.push(w.geometry),p.push(m.geometry),n.set(x,m)}if(e.update)for(const m of e.update){const x=n.get(m.id);if(!x)continue;const w=!!m.newGeometry,C=m.removeAllProperties||((o=m.removeProperties)===null||o===void 0?void 0:o.length)>0||((c=m.addOrUpdateProperties)===null||c===void 0?void 0:c.length)>0;if(!w&&!C)continue;p.push(x.geometry);const z=Object.assign({},x);if(n.set(m.id,z),w&&(p.push(m.newGeometry),z.geometry=m.newGeometry),C){if(z.properties=m.removeAllProperties?{}:Object.assign({},z.properties||{}),m.removeProperties)for(const L of m.removeProperties)delete z.properties[L];if(m.addOrUpdateProperties)for(const{key:L,value:B}of m.addOrUpdateProperties)z.properties[L]=B}}return p},M.a9=Ri,M.aA=function(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:c}){return n.kind==="source"?o/Ja:n.kind==="composite"?en.number(o/Ja,c/Ja,i):e},M.aB=function(n,e){var i=e[0],o=e[1],c=e[2],p=e[3],m=e[4],x=e[5],w=e[6],C=e[7],z=e[8],L=e[9],B=e[10],F=e[11],G=e[12],q=e[13],$=e[14],Q=e[15],ce=i*x-o*m,J=i*w-c*m,ne=i*C-p*m,pe=o*w-c*x,ye=o*C-p*x,ke=c*C-p*w,Qe=z*q-L*G,He=z*$-B*G,rt=z*Q-F*G,yt=L*$-B*q,st=L*Q-F*q,Ye=B*Q-F*$,Ue=ce*Ye-J*st+ne*yt+pe*rt-ye*He+ke*Qe;return Ue?(n[0]=(x*Ye-w*st+C*yt)*(Ue=1/Ue),n[1]=(c*st-o*Ye-p*yt)*Ue,n[2]=(q*ke-$*ye+Q*pe)*Ue,n[3]=(B*ye-L*ke-F*pe)*Ue,n[4]=(w*rt-m*Ye-C*He)*Ue,n[5]=(i*Ye-c*rt+p*He)*Ue,n[6]=($*ne-G*ke-Q*J)*Ue,n[7]=(z*ke-B*ne+F*J)*Ue,n[8]=(m*st-x*rt+C*Qe)*Ue,n[9]=(o*rt-i*st-p*Qe)*Ue,n[10]=(G*ye-q*ne+Q*ce)*Ue,n[11]=(L*ne-z*ye-F*ce)*Ue,n[12]=(x*He-m*yt-w*Qe)*Ue,n[13]=(i*yt-o*He+c*Qe)*Ue,n[14]=(q*J-G*pe-$*ce)*Ue,n[15]=(z*pe-L*J+B*ce)*Ue,n):null},M.aC=ht,M.aD=function(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)},M.aE=function(n){return n[0]=0,n[1]=0,n},M.aF=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n},M.aG=lm,M.aH=mr,M.aI=function(n,e,i,o){const c=e.y-n.y,p=e.x-n.x,m=o.y-i.y,x=o.x-i.x,w=m*p-x*c;if(w===0)return null;const C=(x*(n.y-i.y)-m*(n.x-i.x))/w;return new j(n.x+C*p,n.y+C*c)},M.aJ=r,M.aK=gc,M.aL=function(n){let e=1/0,i=1/0,o=-1/0,c=-1/0;for(const p of n)e=Math.min(e,p.x),i=Math.min(i,p.y),o=Math.max(o,p.x),c=Math.max(c,p.y);return[e,i,o,c]},M.aM=$n,M.aN=si,M.aO=function(n,e,i,o,c=!1){if(!i[0]&&!i[1])return[0,0];const p=c?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(p){const m=Math.sin(p),x=Math.cos(p);i=[i[0]*x-i[1]*m,i[0]*m+i[1]*x]}return[c?i[0]:si(e,i[0],n.zoom),c?i[1]:si(e,i[1],n.zoom)]},M.aQ=$f,M.aR=Bm,M.aS=rm,M.aT=Uy,M.aU=tn,M.aV=pd,M.aW=re,M.aX=gt,M.aY=je,M.aZ=Or,M.a_=pm,M.aa=gu,M.ab=25,M.ac=fr,M.ad=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const o of n){const c=window.document.createElement("source");et(o)||(e.crossOrigin="Anonymous"),c.src=o,e.appendChild(c)}}))},M.ae=ut,M.af=function(){return Hi++},M.ag=f,M.ah=bh,M.ai=Vd,M.aj=jr,M.ak=Ka,M.al=tp,M.am=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,c,p)=>{const m=c||p;return e[o]=!m||m.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e},M.an=Wt,M.ao=85.051129,M.ap=Wn,M.aq=function(n){return Math.pow(2,n)},M.ar=Ke,M.as=Ug,M.at=function(n){return Math.log(n)/Math.LN2},M.au=function(n){var e=n[0],i=n[1];return e*e+i*i},M.av=function(n){if(!n.length)return new Set;const e=Math.max(...n.map((w=>w.canonical.z)));let i=1/0,o=-1/0,c=1/0,p=-1/0;const m=[];for(const w of n){const{x:C,y:z,z:L}=w.canonical,B=Math.pow(2,e-L),F=C*B,G=z*B;m.push({id:w,x:F,y:G}),F<i&&(i=F),F>o&&(o=F),G<c&&(c=G),G>p&&(p=G)}const x=new Set;for(const w of m)w.x!==i&&w.x!==o&&w.y!==c&&w.y!==p||x.add(w.id);return x},M.aw=function(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||o-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x},M.ax=class{constructor(n,e){this.max=n,this.onRemove=e,this.reset()}reset(){for(const n in this.data)for(const e of this.data[n])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(n,e,i){const o=n.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const c={value:e,timeout:void 0};if(i!==void 0&&(c.timeout=setTimeout((()=>{this.remove(n,c)}),i)),this.data[o].push(c),this.order.push(o),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const e=this.data[n].shift();return e.timeout&&clearTimeout(e.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),e.value}getByKey(n){const e=this.data[n];return e?e[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,e){if(!this.has(n))return this;const i=n.wrapped().key,o=e===void 0?0:this.data[i].indexOf(e),c=this.data[i][o];return this.data[i].splice(o,1),c.timeout&&clearTimeout(c.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(c.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(n){const e=[];for(const i in this.data)for(const o of this.data[i])n(o.value)||e.push(o);for(const i of e)this.remove(i.value.tileID,i)}},M.ay=function(n,e){let i=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:c,minZoom:p,maxZoom:m}=n,x=c?Wt(zr.interpolationFactor(c,e,p,m),0,1):0;n.kind==="camera"?o=en.number(n.minSize,n.maxSize,x):i=x}return{uSizeT:i,uSize:o}},M.b=Ls,M.b$=Wa,M.b0=Xt,M.b1=function(n){var e=new $e(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},M.b2=function(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n},M.b3=function(n,e){var i=e[0],o=e[1],c=e[2],p=i*i+o*o+c*c;return p>0&&(p=1/Math.sqrt(p)),n[0]=e[0]*p,n[1]=e[1]*p,n[2]=e[2]*p,n},M.b4=Yt,M.b5=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},M.b6=function(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n[3]=e[3]*i[3],n},M.b7=mt,M.b8=function(n,e,i){const o=e[0]*i[0]+e[1]*i[1]+e[2]*i[2];return o===0?null:(-(n[0]*i[0]+n[1]*i[1]+n[2]*i[2])-i[3])/o},M.b9=wn,M.bA=function(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n},M.bB=tt,M.bC=function(n,e,i){var o=i[0],c=i[1],p=i[2],m=i[3],x=e[0],w=e[1],C=e[2],z=c*C-p*w,L=p*x-o*C,B=o*w-c*x;return n[0]=x+m*(z+=z)+c*(B+=B)-p*(L+=L),n[1]=w+m*L+p*z-o*B,n[2]=C+m*B+o*L-c*z,n},M.bD=function(n,e,i){const o=(function(w){var C=w[3],z=w[4],L=w[5],B=w[6],F=w[7],G=w[8];return w[0]*(G*z-L*F)+w[1]*(-G*C+L*B)+w[2]*(F*C-z*B)})([n[0],n[1],n[2],e[0],e[1],e[2],i[0],i[1],i[2]]);if(o===0)return null;const c=Yt([],[e[0],e[1],e[2]],[i[0],i[1],i[2]]),p=Yt([],[i[0],i[1],i[2]],[n[0],n[1],n[2]]),m=Yt([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),x=ct([],c,-n[3]);return Xt(x,x,ct([],p,-e[3])),Xt(x,x,ct([],m,-i[3])),ct(x,x,1/o),x},M.bE=Jf,M.bF=function(){return new Float64Array(4)},M.bG=function(n,e,i,o){var c=[],p=[];return c[0]=e[0]-i[0],c[1]=e[1]-i[1],c[2]=e[2]-i[2],p[0]=c[0]*Math.cos(o)-c[1]*Math.sin(o),p[1]=c[0]*Math.sin(o)+c[1]*Math.cos(o),p[2]=c[2],n[0]=p[0]+i[0],n[1]=p[1]+i[1],n[2]=p[2]+i[2],n},M.bH=function(n,e,i,o){var c=[],p=[];return c[0]=e[0]-i[0],c[1]=e[1]-i[1],c[2]=e[2]-i[2],p[0]=c[0],p[1]=c[1]*Math.cos(o)-c[2]*Math.sin(o),p[2]=c[1]*Math.sin(o)+c[2]*Math.cos(o),n[0]=p[0]+i[0],n[1]=p[1]+i[1],n[2]=p[2]+i[2],n},M.bI=function(n,e,i,o){var c=[],p=[];return c[0]=e[0]-i[0],c[1]=e[1]-i[1],c[2]=e[2]-i[2],p[0]=c[2]*Math.sin(o)+c[0]*Math.cos(o),p[1]=c[1],p[2]=c[2]*Math.cos(o)-c[0]*Math.sin(o),n[0]=p[0]+i[0],n[1]=p[1]+i[1],n[2]=p[2]+i[2],n},M.bJ=function(n,e,i){var o=Math.sin(i),c=Math.cos(i),p=e[0],m=e[1],x=e[2],w=e[3],C=e[8],z=e[9],L=e[10],B=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*c-C*o,n[1]=m*c-z*o,n[2]=x*c-L*o,n[3]=w*c-B*o,n[8]=p*o+C*c,n[9]=m*o+z*c,n[10]=x*o+L*c,n[11]=w*o+B*c,n},M.bK=function(n,e){const i=Me(n,360),o=Me(e,360),c=o-i,p=o>i?c-360:c+360;return Math.abs(c)<Math.abs(p)?c:p},M.bL=function(n){return n[0]=0,n[1]=0,n[2]=0,n},M.bM=function(n,e,i,o){const c=Math.sqrt(n*n+e*e),p=Math.sqrt(i*i+o*o);n/=c,e/=c,i/=p,o/=p;const m=Math.acos(n*i+e*o);return-e*i+n*o>0?m:-m},M.bN=function(n,e){const i=Me(n,2*Math.PI),o=Me(e,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},M.bO=function(){const n={},e=Ie.$version;for(const i in Ie.$root){const o=Ie.$root[i];if(o.required){let c=null;c=i==="version"?e:o.type==="array"?[]:{},c!=null&&(n[i]=c)}}return n},M.bP=Oe,M.bQ=ih,M.bR=function n(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],i[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object"||Object.keys(e).length!==Object.keys(i).length)return!1;for(const o in e)if(!n(e[o],i[o]))return!1;return!0}return e===i},M.bS=function(n){n=n.slice();const e=Object.create(null);for(let i=0;i<n.length;i++)e[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=Cn(n[i],e[n[i].ref]));return n},M.bT=function(n,e){if(n.type==="custom")return new hm(n,e);switch(n.type){case"background":return new gi(n,e);case"circle":return new Ef(n,e);case"color-relief":return new mg(n,e);case"fill":return new xg(n,e);case"fill-extrusion":return new Kp(n,e);case"heatmap":return new fg(n,e);case"hillshade":return new vn(n,e);case"line":return new Jp(n,e);case"raster":return new Xs(n,e);case"symbol":return new mu(n,e)}},M.bU=n=>n.type==="raster",M.bV=Kr,M.bW=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let i=[];try{if(!qt(n.version,e.version))return[{command:"setStyle",args:[e]}];qt(n.center,e.center)||i.push({command:"setCenter",args:[e.center]}),qt(n.state,e.state)||i.push({command:"setGlobalState",args:[e.state]}),qt(n.centerAltitude,e.centerAltitude)||i.push({command:"setCenterAltitude",args:[e.centerAltitude]}),qt(n.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),qt(n.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),qt(n.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),qt(n.roll,e.roll)||i.push({command:"setRoll",args:[e.roll]}),qt(n.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),qt(n.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),qt(n.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),qt(n.light,e.light)||i.push({command:"setLight",args:[e.light]}),qt(n.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),qt(n.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),qt(n.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const o={},c=[];(function(m,x,w,C){let z;for(z in x=x||{},m=m||{})Object.prototype.hasOwnProperty.call(m,z)&&(Object.prototype.hasOwnProperty.call(x,z)||Di(z,w,C));for(z in x)Object.prototype.hasOwnProperty.call(x,z)&&(Object.prototype.hasOwnProperty.call(m,z)?qt(m[z],x[z])||(m[z].type==="geojson"&&x[z].type==="geojson"&&Oi(m,x,z)?Mi(w,{command:"setGeoJSONSourceData",args:[z,x[z].data]}):dn(z,x,w,C)):Un(z,x,w))})(n.sources,e.sources,c,o);const p=[];n.layers&&n.layers.forEach((m=>{"source"in m&&o[m.source]?i.push({command:"removeLayer",args:[m.id]}):p.push(m)})),i=i.concat(c),(function(m,x,w){x=x||[];const C=(m=m||[]).map(Ol),z=x.map(Ol),L=m.reduce(Uo,{}),B=x.reduce(Uo,{}),F=C.slice(),G=Object.create(null);let q,$,Q,ce,J;for(let ne=0,pe=0;ne<C.length;ne++)q=C[ne],Object.prototype.hasOwnProperty.call(B,q)?pe++:(Mi(w,{command:"removeLayer",args:[q]}),F.splice(F.indexOf(q,pe),1));for(let ne=0,pe=0;ne<z.length;ne++)q=z[z.length-1-ne],F[F.length-1-ne]!==q&&(Object.prototype.hasOwnProperty.call(L,q)?(Mi(w,{command:"removeLayer",args:[q]}),F.splice(F.lastIndexOf(q,F.length-pe),1)):pe++,ce=F[F.length-ne],Mi(w,{command:"addLayer",args:[B[q],ce]}),F.splice(F.length-ne,0,q),G[q]=!0);for(let ne=0;ne<z.length;ne++)if(q=z[ne],$=L[q],Q=B[q],!G[q]&&!qt($,Q))if(qt($.source,Q.source)&&qt($["source-layer"],Q["source-layer"])&&qt($.type,Q.type)){for(J in Dn($.layout,Q.layout,w,q,null,"setLayoutProperty"),Dn($.paint,Q.paint,w,q,null,"setPaintProperty"),qt($.filter,Q.filter)||Mi(w,{command:"setFilter",args:[q,Q.filter]}),qt($.minzoom,Q.minzoom)&&qt($.maxzoom,Q.maxzoom)||Mi(w,{command:"setLayerZoomRange",args:[q,Q.minzoom,Q.maxzoom]}),$)Object.prototype.hasOwnProperty.call($,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?Dn($[J],Q[J],w,q,J.slice(6),"setPaintProperty"):qt($[J],Q[J])||Mi(w,{command:"setLayerProperty",args:[q,J,Q[J]]}));for(J in Q)Object.prototype.hasOwnProperty.call(Q,J)&&!Object.prototype.hasOwnProperty.call($,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?Dn($[J],Q[J],w,q,J.slice(6),"setPaintProperty"):qt($[J],Q[J])||Mi(w,{command:"setLayerProperty",args:[q,J,Q[J]]}))}else Mi(w,{command:"removeLayer",args:[q]}),ce=F[F.lastIndexOf(q)+1],Mi(w,{command:"addLayer",args:[Q,ce]})})(p,e.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[e]}]}return i},M.bX=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},M.bY=Er,M.bZ=so,M.b_=class extends Gr{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},M.ba=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n},M.bb=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},M.bc=qg,M.bd=Th,M.be=function(n,e,i,o,c){var p=1/Math.tan(e/2);if(n[0]=p/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0){var m=1/(o-c);n[10]=(c+o)*m,n[14]=2*c*o*m}else n[10]=-1,n[14]=-2*o;return n},M.bf=function(n){var e=new $e(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},M.bg=function(n,e,i){var o=Math.sin(i),c=Math.cos(i),p=e[0],m=e[1],x=e[2],w=e[3],C=e[4],z=e[5],L=e[6],B=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*c+C*o,n[1]=m*c+z*o,n[2]=x*c+L*o,n[3]=w*c+B*o,n[4]=C*c-p*o,n[5]=z*c-m*o,n[6]=L*c-x*o,n[7]=B*c-w*o,n},M.bh=function(n,e,i){var o=Math.sin(i),c=Math.cos(i),p=e[4],m=e[5],x=e[6],w=e[7],C=e[8],z=e[9],L=e[10],B=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=p*c+C*o,n[5]=m*c+z*o,n[6]=x*c+L*o,n[7]=w*c+B*o,n[8]=C*c-p*o,n[9]=z*c-m*o,n[10]=L*c-x*o,n[11]=B*c-w*o,n},M.bi=function(){const n=new Float32Array(16);return Ke(n),n},M.bj=function(){const n=new Float64Array(16);return Ke(n),n},M.bk=function(){return new Float64Array(16)},M.bl=function(n,e,i){const o=new Float64Array(4);return tt(o,n,e-90,i),o},M.bm=function(n,e,i,o){var c,p,m,x,w,C=e[0],z=e[1],L=e[2],B=e[3],F=i[0],G=i[1],q=i[2],$=i[3];return(p=C*F+z*G+L*q+B*$)<0&&(p=-p,F=-F,G=-G,q=-q,$=-$),1-p>Ze?(c=Math.acos(p),m=Math.sin(c),x=Math.sin((1-o)*c)/m,w=Math.sin(o*c)/m):(x=1-o,w=o),n[0]=x*C+w*F,n[1]=x*z+w*G,n[2]=x*L+w*q,n[3]=x*B+w*$,n},M.bn=function(n){const e=new Float64Array(9);(function(p,m){var x=m[0],w=m[1],C=m[2],z=m[3],L=x+x,B=w+w,F=C+C,G=x*L,q=w*L,$=w*B,Q=C*L,ce=C*B,J=C*F,ne=z*L,pe=z*B,ye=z*F;p[0]=1-$-J,p[3]=q-ye,p[6]=Q+pe,p[1]=q+ye,p[4]=1-G-J,p[7]=ce-ne,p[2]=Q-pe,p[5]=ce+ne,p[8]=1-G-$})(e,n);const i=Or(-Math.asin(Wt(e[2],-1,1)));let o,c;return Math.hypot(e[5],e[8])<.001?(o=0,c=-Or(Math.atan2(e[3],e[4]))):(o=Or(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),c=Or(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:i+90,bearing:c}},M.bo=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},M.bp=Qt,M.bq=pl,M.br=za,M.bs=Js,M.bt=dr,M.bu=ot,M.bv=Mt,M.bw=qn,M.bx=function(n,e,i,o,c){return ot(o,c,Wt((n-e)/(i-e),0,1))},M.by=Me,M.bz=function(){return new Float64Array(3)},M.c=xe,M.c$=function(n,e,i,o,c){return u(this,void 0,void 0,(function*(){if(We())try{return yield oo(n,e,i,o,c)}catch{}return(function(p,m,x,w,C){const z=p.width,L=p.height;rs&&Fa||(rs=new OffscreenCanvas(z,L),Fa=rs.getContext("2d",{willReadFrequently:!0})),rs.width=z,rs.height=L,Fa.drawImage(p,0,0,z,L);const B=Fa.getImageData(m,x,w,C);return Fa.clearRect(0,0,z,L),B.data})(n,e,i,o,c)}))},M.c0=class extends Gr{constructor(n,e){super(n,e),this.current=qr}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},M.c1=uu,M.c2=class extends Gr{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},M.c3=class extends Gr{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},M.c4=Ct,M.c5=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},M.c6=function(n,e,i){var o=e[0],c=e[1],p=e[2];return n[0]=o*i[0]+c*i[3]+p*i[6],n[1]=o*i[1]+c*i[4]+p*i[7],n[2]=o*i[2]+c*i[5]+p*i[8],n},M.c7=function(n,e,i,o,c,p,m){var x=1/(e-i),w=1/(o-c),C=1/(p-m);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*C,n[11]=0,n[12]=(e+i)*x,n[13]=(c+o)*w,n[14]=(m+p)*C,n[15]=1,n},M.c8=class extends Gr{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(4*n.length);for(let i=0;i<n.length;i++)e[4*i]=n[i].r,e[4*i+1]=n[i].g,e[4*i+2]=n[i].b,e[4*i+3]=n[i].a;this.gl.uniform4fv(this.location,e)}}},M.c9=class extends Gr{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},M.cA=function(n,e){return Re[e]&&"touches"in n},M.cB=function(n){return Re[n]||W[n]},M.cC=function(n,e,i){var o=e[0],c=e[1];return n[0]=i[0]*o+i[4]*c+i[12],n[1]=i[1]*o+i[5]*c+i[13],n},M.cD=function(n,e){const{x:i,y:o}=Ri.fromLngLat(e);return!(n<0||n>25||o<0||o>=1||i<0||i>=1)},M.cE=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},M.cF=class extends cl{},M.cG=I1,M.cI=Te,M.cJ=function(n,e){xe.REGISTERED_PROTOCOLS[n]=e},M.cK=function(n){delete xe.REGISTERED_PROTOCOLS[n]},M.cL=function(n,e){const i={};for(let c=0;c<n.length;c++){const p=e&&e[n[c].id]||Vs(n[c]);e&&(e[n[c].id]=p);let m=i[p];m||(m=i[p]=[]),m.push(n[c])}const o=[];for(const c in i)o.push(i[c]);return o},M.cM=xt,M.cN=gm,M.cO=km,M.cP=qf,M.cQ=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=It/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],i=e.layout,o=e._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new Ei(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Ei(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Ei(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:z}=n.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Ei(C),n.canonical),o["text-size"].possiblyEvaluate(new Ei(z),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:z}=n.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Ei(C),n.canonical),o["icon-size"].possiblyEvaluate(new Ei(z),n.canonical)]}const p=i.get("text-line-height")*$n,m=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",x=i.get("text-keep-upright"),w=i.get("text-size");for(const C of n.bucket.features){const z=i.get("text-font").evaluate(C,{},n.canonical).join(","),L=w.evaluate(C,{},n.canonical),B=c.layoutTextSize.evaluate(C,{},n.canonical),F=c.layoutIconSize.evaluate(C,{},n.canonical),G={horizontal:{},vertical:void 0},q=C.text;let $,Q=[0,0];if(q){const ne=q.toString(),pe=i.get("text-letter-spacing").evaluate(C,{},n.canonical)*$n,ye=nh(ne)?pe:0,ke=i.get("text-anchor").evaluate(C,{},n.canonical),Qe=Cl(e,C,n.canonical);if(!Qe){const st=i.get("text-radial-offset").evaluate(C,{},n.canonical);Q=st?Ci(ke,[st*$n,fi]):i.get("text-offset").evaluate(C,{},n.canonical).map((Ye=>Ye*$n))}let He=m?"center":i.get("text-justify").evaluate(C,{},n.canonical);const rt=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(C,{},n.canonical)*$n:1/0,yt=()=>{n.bucket.allowVerticalPlacement&&Ts(ne)&&(G.vertical=bd(q,n.glyphMap,n.glyphPositions,n.imagePositions,z,rt,p,ke,"left",ye,Q,M.az.vertical,!0,B,L))};if(!m&&Qe){const st=new Set;if(He==="auto")for(let Ue=0;Ue<Qe.values.length;Ue+=2)st.add(Bm(Qe.values[Ue]));else st.add(He);let Ye=!1;for(const Ue of st)if(!G.horizontal[Ue])if(Ye)G.horizontal[Ue]=G.horizontal[0];else{const St=bd(q,n.glyphMap,n.glyphPositions,n.imagePositions,z,rt,p,"center",Ue,ye,Q,M.az.horizontal,!1,B,L);St&&(G.horizontal[Ue]=St,Ye=St.positionedLines.length===1)}yt()}else{He==="auto"&&(He=Bm(ke));const st=bd(q,n.glyphMap,n.glyphPositions,n.imagePositions,z,rt,p,ke,He,ye,Q,M.az.horizontal,!1,B,L);st&&(G.horizontal[He]=st),yt(),Ts(ne)&&m&&x&&(G.vertical=bd(q,n.glyphMap,n.glyphPositions,n.imagePositions,z,rt,p,ke,He,ye,Q,M.az.vertical,!1,B,L))}}let ce=!1;if(C.icon&&C.icon.name){const ne=n.imageMap[C.icon.name];ne&&($=sm(n.imagePositions[C.icon.name],i.get("icon-offset").evaluate(C,{},n.canonical),i.get("icon-anchor").evaluate(C,{},n.canonical)),ce=!!ne.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=ce:n.bucket.sdfIcons!==ce&&sn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ne.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const J=R0(G.horizontal)||G.vertical;n.bucket.iconsInText=!!J&&J.iconsInText,(J||$)&&z1(n.bucket,C,G,$,n.imageMap,c,B,F,Q,ce,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},M.cR=_c,M.cS=hu,M.cT=ph,M.cU=function(n){const e=new Vf;return(function(i,o){for(const c in i.layers)o.writeMessage(3,fp,i.layers[c])})(n,e),e.finish()},M.cV=function(n,e,i,o,c,p){let m=s(n,e,i,c,0);return m=s(m,e,o,p,1),m},M.cW=class{constructor(n){this.maxEntries=n,this.map=new Map}get(n){const e=this.map.get(n);return e!==void 0&&(this.map.delete(n),this.map.set(n,e)),e}set(n,e){if(this.map.has(n))this.map.delete(n);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(n,e)}clear(){this.map.clear()}},M.cX=mi,M.cY=Vf,M.cZ=Nd,M.c_=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},M.ca=class extends Ws{},M.cb=Mg,M.cc=class extends nn{},M.cd=sd,M.ce=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},M.cf=Io,M.cg=function(n,e,i){var o=e[0],c=e[1],p=e[2],m=i[3]*o+i[7]*c+i[11]*p+i[15];return n[0]=(i[0]*o+i[4]*c+i[8]*p+i[12])/(m=m||1),n[1]=(i[1]*o+i[5]*c+i[9]*p+i[13])/m,n[2]=(i[2]*o+i[6]*c+i[10]*p+i[14])/m,n},M.ch=class extends hl{},M.ci=class extends t{},M.cj=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},M.ck=function(n,e){var i=n[0],o=n[1],c=n[2],p=n[3],m=n[4],x=n[5],w=n[6],C=n[7],z=n[8],L=n[9],B=n[10],F=n[11],G=n[12],q=n[13],$=n[14],Q=n[15],ce=e[0],J=e[1],ne=e[2],pe=e[3],ye=e[4],ke=e[5],Qe=e[6],He=e[7],rt=e[8],yt=e[9],st=e[10],Ye=e[11],Ue=e[12],St=e[13],bt=e[14],At=e[15];return Math.abs(i-ce)<=Ze*Math.max(1,Math.abs(i),Math.abs(ce))&&Math.abs(o-J)<=Ze*Math.max(1,Math.abs(o),Math.abs(J))&&Math.abs(c-ne)<=Ze*Math.max(1,Math.abs(c),Math.abs(ne))&&Math.abs(p-pe)<=Ze*Math.max(1,Math.abs(p),Math.abs(pe))&&Math.abs(m-ye)<=Ze*Math.max(1,Math.abs(m),Math.abs(ye))&&Math.abs(x-ke)<=Ze*Math.max(1,Math.abs(x),Math.abs(ke))&&Math.abs(w-Qe)<=Ze*Math.max(1,Math.abs(w),Math.abs(Qe))&&Math.abs(C-He)<=Ze*Math.max(1,Math.abs(C),Math.abs(He))&&Math.abs(z-rt)<=Ze*Math.max(1,Math.abs(z),Math.abs(rt))&&Math.abs(L-yt)<=Ze*Math.max(1,Math.abs(L),Math.abs(yt))&&Math.abs(B-st)<=Ze*Math.max(1,Math.abs(B),Math.abs(st))&&Math.abs(F-Ye)<=Ze*Math.max(1,Math.abs(F),Math.abs(Ye))&&Math.abs(G-Ue)<=Ze*Math.max(1,Math.abs(G),Math.abs(Ue))&&Math.abs(q-St)<=Ze*Math.max(1,Math.abs(q),Math.abs(St))&&Math.abs($-bt)<=Ze*Math.max(1,Math.abs($),Math.abs(bt))&&Math.abs(Q-At)<=Ze*Math.max(1,Math.abs(Q),Math.abs(At))},M.cl=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},M.cm=n=>n.type==="symbol",M.cn=n=>n.type==="circle",M.co=n=>n.type==="heatmap",M.cp=n=>n.type==="line",M.cq=n=>n.type==="fill",M.cr=n=>n.type==="fill-extrusion",M.cs=n=>n.type==="hillshade",M.ct=n=>n.type==="color-relief",M.cu=n=>n.type==="background",M.cv=n=>n.type==="custom",M.cw=zt,M.cx=function(n,e,i){const o=Rt(e.x-i.x,e.y-i.y),c=Rt(n.x-i.x,n.y-i.y),p=Math.atan2(o[0]*c[1]-o[1]*c[0],(function(m,x){return m[0]*x[0]+m[1]*x[1]})(o,c));return Or(p)},M.cy=Ot,M.cz=function(n,e){return W[e]&&(n instanceof MouseEvent||n instanceof WheelEvent)},M.d=et,M.d0=ch,M.d1=Z,M.d2=class{constructor(n,e){this.layers={[Vd]:this},this.name=Vd,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=n.length,this.features=n}feature(n){return new ny(this.features[n],this.extent)}},M.d3=Jl,M.d4=Ma,M.e=Bi,M.f=n=>u(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),M.g=Be,M.h=n=>new Promise(((e,i)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=ks}))},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(c):ks})),M.i=ga,M.j=(n,e)=>Je(Bi(n,{type:"json"}),e),M.k=bi,M.l=Vt,M.m=Je,M.n=(n,e)=>Je(Bi(n,{type:"arrayBuffer"}),e),M.o=function(n){return new Vf(n).readFields(Lg,[])},M.p=nm,M.q=function(n){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))},M.r=ad,M.s=Bl,M.t=Mn,M.u=Ie,M.v=ic,M.w=sn,M.x=ah,M.y=Ga,M.z=$s})),R("worker",["./shared"],(function(M){class u{constructor(W,Y){this.keyCache={},W&&this.replace(W,Y)}replace(W,Y){this._layerConfigs={},this._layers={},this.update(W,[],Y)}update(W,Y,ie){for(const xe of W){this._layerConfigs[xe.id]=xe;const Be=this._layers[xe.id]=M.bT(xe,ie);Be._featureFilter=M.aj(Be.filter,ie),this.keyCache[xe.id]&&delete this.keyCache[xe.id]}for(const xe of Y)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const _e=M.cL(Object.values(this._layerConfigs),this.keyCache);for(const xe of _e){const Be=xe.map((wt=>this._layers[wt.id])),Pe=Be[0];if(Pe.isHidden())continue;const Te=Pe.source||"";let Oe=this.familiesBySource[Te];Oe||(Oe=this.familiesBySource[Te]={});const Je=Pe.sourceLayer||M.ai;let et=Oe[Je];et||(et=Oe[Je]=[]),et.push(Be)}}}class j{constructor(W){const Y={},ie=[];for(const Pe in W){const Te=W[Pe],Oe=Y[Pe]={};for(const Je in Te){const et=Te[+Je];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const wt={x:0,y:0,w:et.bitmap.width+2,h:et.bitmap.height+2};ie.push(wt),Oe[Je]={rect:wt,metrics:et.metrics}}}const{w:_e,h:xe}=M.p(ie),Be=new M.r({width:_e||1,height:xe||1});for(const Pe in W){const Te=W[Pe];for(const Oe in Te){const Je=Te[+Oe];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const et=Y[Pe][Oe].rect;M.r.copy(Je.bitmap,Be,{x:0,y:0},{x:et.x+1,y:et.y+1},Je.bitmap)}}this.image=Be,this.positions=Y}}M.cM("GlyphAtlas",j);class Z{constructor(W){this.tileID=new M.a2(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,Y,ie,_e,xe){return M._(this,void 0,void 0,(function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new M.ag;const Be=new M.cN(Object.keys(W.layers).sort()),Pe=new M.cO(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];const Te={},Oe={featureIndex:Pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ie,subdivisionGranularity:xe},Je=Y.familiesBySource[this.source];for(const Oi in Je){const Dn=W.layers[Oi];if(!Dn)continue;Dn.version===1&&M.w(`Vector tile source "${this.source}" layer "${Oi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ol=Be.encode(Oi),Uo=[];for(let ut=0;ut<Dn.length;ut++){const gr=Dn.feature(ut),yr=Pe.getId(gr,Oi);Uo.push({feature:gr,id:yr,index:ut,sourceLayerIndex:Ol})}for(const ut of Je[Oi]){const gr=ut[0];gr.source!==this.source&&M.w(`layer.source = ${gr.source} does not equal this.source = ${this.source}`),gr.isHidden(this.zoom,!0)||(X(ut,this.zoom,ie),(Te[gr.id]=gr.createBucket({index:Pe.bucketLayerIDs.length,layers:ut,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ol,sourceID:this.source})).populate(Uo,Oe,this.tileID.canonical),Pe.bucketLayerIDs.push(ut.map((yr=>yr.id))))}}const et=M.bY(Oe.glyphDependencies,(Oi=>Object.keys(Oi).map(Number)));this.inFlightDependencies.forEach((Oi=>Oi?.abort())),this.inFlightDependencies=[];let wt=Promise.resolve({});if(Object.keys(et).length){const Oi=new AbortController;this.inFlightDependencies.push(Oi),wt=_e.sendAsync({type:"GG",data:{stacks:et,source:this.source,tileID:this.tileID,type:"glyphs"}},Oi)}const Pt=Object.keys(Oe.iconDependencies);let Vt=Promise.resolve({});if(Pt.length){const Oi=new AbortController;this.inFlightDependencies.push(Oi),Vt=_e.sendAsync({type:"GI",data:{icons:Pt,source:this.source,tileID:this.tileID,type:"icons"}},Oi)}const bi=Object.keys(Oe.patternDependencies);let ci=Promise.resolve({});if(bi.length){const Oi=new AbortController;this.inFlightDependencies.push(Oi),ci=_e.sendAsync({type:"GI",data:{icons:bi,source:this.source,tileID:this.tileID,type:"patterns"}},Oi)}const Ie=Oe.dashDependencies;let Si=Promise.resolve({});if(Object.keys(Ie).length){const Oi=new AbortController;this.inFlightDependencies.push(Oi),Si=_e.sendAsync({type:"GDA",data:{dashes:Ie}},Oi)}const[Cn,qt,Mi,Un]=yield Promise.all([wt,Vt,ci,Si]),Di=new j(Cn),dn=new M.cP(qt,Mi);for(const Oi in Te){const Dn=Te[Oi];Dn instanceof M.ah?(X(Dn.layers,this.zoom,ie),M.cQ({bucket:Dn,glyphMap:Cn,glyphPositions:Di.positions,imageMap:qt,imagePositions:dn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Oe.subdivisionGranularity})):Dn.hasDependencies&&(Dn instanceof M.cR||Dn instanceof M.cS||Dn instanceof M.cT)&&(X(Dn.layers,this.zoom,ie),Dn.addFeatures(Oe,this.tileID.canonical,dn.patternPositions,Un))}return this.status="done",{buckets:Object.values(Te).filter((Oi=>!Oi.isEmpty())),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Di.image,imageAtlas:dn,dashPositions:Un,glyphMap:this.returnDependencies?Cn:null,iconMap:this.returnDependencies?qt:null,glyphPositions:this.returnDependencies?Di.positions:null}}))}}function X(Re,W,Y){const ie=new M.H(W);for(const _e of Re)_e.recalculate(ie,Y)}class te{constructor(W,Y,ie,_e,xe){this.type=W,this.properties=ie||{},this.extent=xe,this.pointsArray=Y,this.id=_e}loadGeometry(){return this.pointsArray.map((W=>W.map((Y=>new M.P(Y.x,Y.y)))))}}class de{constructor(W,Y,ie){this.version=2,this._myFeatures=W,this.name=Y,this.length=W.length,this.extent=ie}feature(W){return this._myFeatures[W]}}class Ae{constructor(){this.layers={}}addLayer(W){this.layers[W.name]=W}}function Ce(Re){let W=M.cU(Re);return W.byteOffset===0&&W.byteLength===W.buffer.byteLength||(W=new Uint8Array(W)),{vectorTile:Re,rawData:W.buffer}}function De(Re,W,Y){const{extent:ie}=Re,_e=Math.pow(2,Y.z-W.z),xe=(Y.x-W.x*_e)*ie,Be=(Y.y-W.y*_e)*ie,Pe=[];for(let Te=0;Te<Re.length;Te++){const Oe=Re.feature(Te);let Je=Oe.loadGeometry();for(const wt of Je)for(const Pt of wt)Pt.x=Pt.x*_e-xe,Pt.y=Pt.y*_e-Be;const et=128;Je=M.cV(Je,Oe.type,-et,-et,ie+et,ie+et),Je.length!==0&&Pe.push(new te(Oe.type,Je,Oe.properties,Oe.id,ie))}return new de(Pe,Re.name,ie)}class oe{constructor(W,Y,ie){this.actor=W,this.layerIndex=Y,this.availableImages=ie,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new M.cW(1e3)}loadVectorTile(W,Y){return M._(this,void 0,void 0,(function*(){const ie=yield M.n(W.request,Y);try{return{vectorTile:W.encoding!=="mlt"?new M.cX(new M.cY(ie.data)):new M.cZ(ie.data),rawData:ie.data,cacheControl:ie.cacheControl,expires:ie.expires}}catch(_e){const xe=new Uint8Array(ie.data);let Be=`Unable to parse the tile at ${W.request.url}, `;throw Be+=xe[0]===31&&xe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${_e.message}`,new Error(Be)}}))}loadTile(W){return M._(this,void 0,void 0,(function*(){const{uid:Y,overzoomParameters:ie}=W;ie&&(W.request=ie.overzoomRequest);const _e=!!(W&&W.request&&W.request.collectResourceTiming)&&new M.c_(W.request),xe=new Z(W);this.loading[Y]=xe;const Be=new AbortController;xe.abort=Be;try{const Pe=yield this.loadVectorTile(W,Be);if(delete this.loading[Y],!Pe)return null;if(ie){const wt=this._getOverzoomTile(W,Pe.vectorTile);Pe.rawData=wt.rawData,Pe.vectorTile=wt.vectorTile}const Te=Pe.rawData,Oe={};Pe.expires&&(Oe.expires=Pe.expires),Pe.cacheControl&&(Oe.cacheControl=Pe.cacheControl);const Je={};if(_e){const wt=_e.finish();wt&&(Je.resourceTiming=JSON.parse(JSON.stringify(wt)))}xe.vectorTile=Pe.vectorTile;const et=xe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);this.loaded[Y]=xe,this.fetching[Y]={rawTileData:Te,cacheControl:Oe,resourceTiming:Je};try{const wt=yield et;return M.e({rawTileData:Te.slice(0),encoding:W.encoding},wt,Oe,Je)}finally{delete this.fetching[Y]}}catch(Pe){throw delete this.loading[Y],xe.status="done",this.loaded[Y]=xe,Pe}}))}_getOverzoomTile(W,Y){const{tileID:ie,source:_e,overzoomParameters:xe}=W,{maxZoomTileID:Be}=xe,Pe=`${Be.key}_${ie.key}`,Te=this.overzoomedTileResultCache.get(Pe);if(Te)return Te;const Oe=new Ae,Je=this.layerIndex.familiesBySource[_e];for(const wt in Je){const Pt=Y.layers[wt];if(!Pt)continue;const Vt=De(Pt,Be,ie.canonical);Vt.length>0&&Oe.addLayer(Vt)}const et=Ce(Oe);return this.overzoomedTileResultCache.set(Pe,et),et}reloadTile(W){return M._(this,void 0,void 0,(function*(){const Y=W.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ie=this.loaded[Y];if(ie.showCollisionBoxes=W.showCollisionBoxes,ie.status==="parsing"){const _e=yield ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);let xe;if(this.fetching[Y]){const{rawTileData:Be,cacheControl:Pe,resourceTiming:Te}=this.fetching[Y];delete this.fetching[Y],xe=M.e({rawTileData:Be.slice(0),encoding:W.encoding},_e,Pe,Te)}else xe=_e;return xe}if(ie.status==="done"&&ie.vectorTile)return ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity)}))}abortTile(W){return M._(this,void 0,void 0,(function*(){const Y=this.loading,ie=W.uid;Y&&Y[ie]&&Y[ie].abort&&(Y[ie].abort.abort(),delete Y[ie])}))}removeTile(W){return M._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]}))}}class We{constructor(){this.loaded={}}loadTile(W){return M._(this,void 0,void 0,(function*(){const{uid:Y,encoding:ie,rawImageData:_e,redFactor:xe,greenFactor:Be,blueFactor:Pe,baseShift:Te}=W,Oe=_e.width+2,Je=_e.height+2,et=M.b(_e)?new M.R({width:Oe,height:Je},yield M.c$(_e,-1,-1,Oe,Je)):_e,wt=new M.d0(Y,et,ie,xe,Be,Pe,Te);return this.loaded=this.loaded||{},this.loaded[Y]=wt,wt}))}removeTile(W){const Y=this.loaded,ie=W.uid;Y&&Y[ie]&&delete Y[ie]}}var Ze,$e,Ct=(function(){if($e)return Ze;function Re(Y,ie){if(Y.length!==0){W(Y[0],ie);for(var _e=1;_e<Y.length;_e++)W(Y[_e],!ie)}}function W(Y,ie){for(var _e=0,xe=0,Be=0,Pe=Y.length,Te=Pe-1;Be<Pe;Te=Be++){var Oe=(Y[Be][0]-Y[Te][0])*(Y[Te][1]+Y[Be][1]),Je=_e+Oe;xe+=Math.abs(_e)>=Math.abs(Oe)?_e-Je+Oe:Oe-Je+_e,_e=Je}_e+xe>=0!=!!ie&&Y.reverse()}return $e=1,Ze=function Y(ie,_e){var xe,Be=ie&&ie.type;if(Be==="FeatureCollection")for(xe=0;xe<ie.features.length;xe++)Y(ie.features[xe],_e);else if(Be==="GeometryCollection")for(xe=0;xe<ie.geometries.length;xe++)Y(ie.geometries[xe],_e);else if(Be==="Feature")Y(ie.geometry,_e);else if(Be==="Polygon")Re(ie.coordinates,_e);else if(Be==="MultiPolygon")for(xe=0;xe<ie.coordinates.length;xe++)Re(ie.coordinates[xe],_e);return ie}})(),Ke=M.d1(Ct);const vt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Re=>Re},mt=Math.fround||(Et=new Float32Array(1),Re=>(Et[0]=+Re,Et[0]));var Et;class Xt{constructor(W){this.options=Object.assign(Object.create(vt),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:Y,minZoom:ie,maxZoom:_e}=this.options;Y&&console.time("total time");const xe=`prepare ${W.length} points`;Y&&console.time(xe),this.points=W;const Be=[];for(let Te=0;Te<W.length;Te++){const Oe=W[Te];if(!Oe.geometry)continue;const[Je,et]=Oe.geometry.coordinates,wt=mt(ki(Je)),Pt=mt(wn(et));Be.push(wt,Pt,1/0,Te,-1,1),this.options.reduce&&Be.push(0)}let Pe=this.trees[_e+1]=this._createTree(Be);Y&&console.timeEnd(xe);for(let Te=_e;Te>=ie;Te--){const Oe=+Date.now();Pe=this.trees[Te]=this._createTree(this._cluster(Pe,Te)),Y&&console.log("z%d: %d clusters in %dms",Te,Pe.numItems,+Date.now()-Oe)}return Y&&console.timeEnd("total time"),this}getClusters(W,Y){let ie=((W[0]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,W[1]));let xe=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)ie=-180,xe=180;else if(ie>xe){const et=this.getClusters([ie,_e,180,Be],Y),wt=this.getClusters([-180,_e,xe,Be],Y);return et.concat(wt)}const Pe=this.trees[this._limitZoom(Y)],Te=Pe.range(ki(ie),wn(Be),ki(xe),wn(_e)),Oe=Pe.data,Je=[];for(const et of Te){const wt=this.stride*et;Je.push(Oe[wt+5]>1?ct(Oe,wt,this.clusterProps):this.points[Oe[wt+3]])}return Je}getChildren(W){const Y=this._getOriginId(W),ie=this._getOriginZoom(W),_e="No cluster with the specified id.",xe=this.trees[ie];if(!xe)throw new Error(_e);const Be=xe.data;if(Y*this.stride>=Be.length)throw new Error(_e);const Pe=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),Te=xe.within(Be[Y*this.stride],Be[Y*this.stride+1],Pe),Oe=[];for(const Je of Te){const et=Je*this.stride;Be[et+4]===W&&Oe.push(Be[et+5]>1?ct(Be,et,this.clusterProps):this.points[Be[et+3]])}if(Oe.length===0)throw new Error(_e);return Oe}getLeaves(W,Y,ie){const _e=[];return this._appendLeaves(_e,W,Y=Y||10,ie=ie||0,0),_e}getTile(W,Y,ie){const _e=this.trees[this._limitZoom(W)],xe=Math.pow(2,W),{extent:Be,radius:Pe}=this.options,Te=Pe/Be,Oe=(ie-Te)/xe,Je=(ie+1+Te)/xe,et={features:[]};return this._addTileFeatures(_e.range((Y-Te)/xe,Oe,(Y+1+Te)/xe,Je),_e.data,Y,ie,xe,et),Y===0&&this._addTileFeatures(_e.range(1-Te/xe,Oe,1,Je),_e.data,xe,ie,xe,et),Y===xe-1&&this._addTileFeatures(_e.range(0,Oe,Te/xe,Je),_e.data,-1,ie,xe,et),et.features.length?et:null}getClusterExpansionZoom(W){let Y=this._getOriginZoom(W)-1;for(;Y<=this.options.maxZoom;){const ie=this.getChildren(W);if(Y++,ie.length!==1)break;W=ie[0].properties.cluster_id}return Y}_appendLeaves(W,Y,ie,_e,xe){const Be=this.getChildren(Y);for(const Pe of Be){const Te=Pe.properties;if(Te&&Te.cluster?xe+Te.point_count<=_e?xe+=Te.point_count:xe=this._appendLeaves(W,Te.cluster_id,ie,_e,xe):xe<_e?xe++:W.push(Pe),W.length===ie)break}return xe}_createTree(W){const Y=new M.aT(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<W.length;ie+=this.stride)Y.add(W[ie],W[ie+1]);return Y.finish(),Y.data=W,Y}_addTileFeatures(W,Y,ie,_e,xe,Be){for(const Pe of W){const Te=Pe*this.stride,Oe=Y[Te+5]>1;let Je,et,wt;if(Oe)Je=Yt(Y,Te,this.clusterProps),et=Y[Te],wt=Y[Te+1];else{const bi=this.points[Y[Te+3]];Je=bi.properties;const[ci,Ie]=bi.geometry.coordinates;et=ki(ci),wt=wn(Ie)}const Pt={type:1,geometry:[[Math.round(this.options.extent*(et*xe-ie)),Math.round(this.options.extent*(wt*xe-_e))]],tags:Je};let Vt;Vt=Oe||this.options.generateId?Y[Te+3]:this.points[Y[Te+3]].id,Vt!==void 0&&(Pt.id=Vt),Be.features.push(Pt)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,Y){const{radius:ie,extent:_e,reduce:xe,minPoints:Be}=this.options,Pe=ie/(_e*Math.pow(2,Y)),Te=W.data,Oe=[],Je=this.stride;for(let et=0;et<Te.length;et+=Je){if(Te[et+2]<=Y)continue;Te[et+2]=Y;const wt=Te[et],Pt=Te[et+1],Vt=W.within(Te[et],Te[et+1],Pe),bi=Te[et+5];let ci=bi;for(const Ie of Vt){const Si=Ie*Je;Te[Si+2]>Y&&(ci+=Te[Si+5])}if(ci>bi&&ci>=Be){let Ie,Si=wt*bi,Cn=Pt*bi,qt=-1;const Mi=(et/Je<<5)+(Y+1)+this.points.length;for(const Un of Vt){const Di=Un*Je;if(Te[Di+2]<=Y)continue;Te[Di+2]=Y;const dn=Te[Di+5];Si+=Te[Di]*dn,Cn+=Te[Di+1]*dn,Te[Di+4]=Mi,xe&&(Ie||(Ie=this._map(Te,et,!0),qt=this.clusterProps.length,this.clusterProps.push(Ie)),xe(Ie,this._map(Te,Di)))}Te[et+4]=Mi,Oe.push(Si/ci,Cn/ci,1/0,Mi,-1,ci),xe&&Oe.push(qt)}else{for(let Ie=0;Ie<Je;Ie++)Oe.push(Te[et+Ie]);if(ci>1)for(const Ie of Vt){const Si=Ie*Je;if(!(Te[Si+2]<=Y)){Te[Si+2]=Y;for(let Cn=0;Cn<Je;Cn++)Oe.push(Te[Si+Cn])}}}}return Oe}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,Y,ie){if(W[Y+5]>1){const Be=this.clusterProps[W[Y+6]];return ie?Object.assign({},Be):Be}const _e=this.points[W[Y+3]].properties,xe=this.options.map(_e);return ie&&xe===_e?Object.assign({},xe):xe}}function ct(Re,W,Y){return{type:"Feature",id:Re[W+3],properties:Yt(Re,W,Y),geometry:{type:"Point",coordinates:[(ie=Re[W],360*(ie-.5)),mr(Re[W+1])]}};var ie}function Yt(Re,W,Y){const ie=Re[W+5],_e=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,xe=Re[W+6],Be=xe===-1?{}:Object.assign({},Y[xe]);return Object.assign(Be,{cluster:!0,cluster_id:Re[W+3],point_count:ie,point_count_abbreviated:_e})}function ki(Re){return Re/360+.5}function wn(Re){const W=Math.sin(Re*Math.PI/180),Y=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Y<0?0:Y>1?1:Y}function mr(Re){const W=(180-360*Re)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Bn(Re,W,Y,ie){let _e=ie;const xe=W+(Y-W>>1);let Be,Pe=Y-W;const Te=Re[W],Oe=Re[W+1],Je=Re[Y],et=Re[Y+1];for(let wt=W+3;wt<Y;wt+=3){const Pt=tt(Re[wt],Re[wt+1],Te,Oe,Je,et);if(Pt>_e)Be=wt,_e=Pt;else if(Pt===_e){const Vt=Math.abs(wt-xe);Vt<Pe&&(Be=wt,Pe=Vt)}}_e>ie&&(Be-W>3&&Bn(Re,W,Be,ie),Re[Be+2]=_e,Y-Be>3&&Bn(Re,Be,Y,ie))}function tt(Re,W,Y,ie,_e,xe){let Be=_e-Y,Pe=xe-ie;if(Be!==0||Pe!==0){const Te=((Re-Y)*Be+(W-ie)*Pe)/(Be*Be+Pe*Pe);Te>1?(Y=_e,ie=xe):Te>0&&(Y+=Be*Te,ie+=Pe*Te)}return Be=Re-Y,Pe=W-ie,Be*Be+Pe*Pe}function ht(Re,W,Y,ie){const _e={id:Re??null,type:W,geometry:Y,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")Rt(_e,Y);else if(W==="Polygon")Rt(_e,Y[0]);else if(W==="MultiLineString")for(const xe of Y)Rt(_e,xe);else if(W==="MultiPolygon")for(const xe of Y)Rt(_e,xe[0]);return _e}function Rt(Re,W){for(let Y=0;Y<W.length;Y+=3)Re.minX=Math.min(Re.minX,W[Y]),Re.minY=Math.min(Re.minY,W[Y+1]),Re.maxX=Math.max(Re.maxX,W[Y]),Re.maxY=Math.max(Re.maxY,W[Y+1])}function It(Re,W,Y,ie){if(!W.geometry)return;const _e=W.geometry.coordinates;if(_e&&_e.length===0)return;const xe=W.geometry.type,Be=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2);let Pe=[],Te=W.id;if(Y.promoteId?Te=W.properties[Y.promoteId]:Y.generateId&&(Te=ie||0),xe==="Point")si(_e,Pe);else if(xe==="MultiPoint")for(const Oe of _e)si(Oe,Pe);else if(xe==="LineString")Me(_e,Pe,Be,!1);else if(xe==="MultiLineString"){if(Y.lineMetrics){for(const Oe of _e)Pe=[],Me(Oe,Pe,Be,!1),Re.push(ht(Te,"LineString",Pe,W.properties));return}ot(_e,Pe,Be,!1)}else if(xe==="Polygon")ot(_e,Pe,Be,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const Oe of W.geometry.geometries)It(Re,{id:Te,geometry:Oe,properties:W.properties},Y,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Oe of _e){const Je=[];ot(Oe,Je,Be,!0),Pe.push(Je)}}Re.push(ht(Te,xe,Pe,W.properties))}function si(Re,W){W.push(Mt(Re[0]),zt(Re[1]),0)}function Me(Re,W,Y,ie){let _e,xe,Be=0;for(let Te=0;Te<Re.length;Te++){const Oe=Mt(Re[Te][0]),Je=zt(Re[Te][1]);W.push(Oe,Je,0),Te>0&&(Be+=ie?(_e*Je-Oe*xe)/2:Math.sqrt(Math.pow(Oe-_e,2)+Math.pow(Je-xe,2))),_e=Oe,xe=Je}const Pe=W.length-3;W[2]=1,Bn(W,0,Pe,Y),W[Pe+2]=1,W.size=Math.abs(Be),W.start=0,W.end=W.size}function ot(Re,W,Y,ie){for(let _e=0;_e<Re.length;_e++){const xe=[];Me(Re[_e],xe,Y,ie),W.push(xe)}}function Mt(Re){return Re/360+.5}function zt(Re){const W=Math.sin(Re*Math.PI/180),Y=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Y<0?0:Y>1?1:Y}function Ot(Re,W,Y,ie,_e,xe,Be,Pe){if(ie/=W,xe>=(Y/=W)&&Be<ie)return Re;if(Be<Y||xe>=ie)return null;const Te=[];for(const Oe of Re){const Je=Oe.geometry;let et=Oe.type;const wt=_e===0?Oe.minX:Oe.minY,Pt=_e===0?Oe.maxX:Oe.maxY;if(wt>=Y&&Pt<ie){Te.push(Oe);continue}if(Pt<Y||wt>=ie)continue;let Vt=[];if(et==="Point"||et==="MultiPoint")Wt(Je,Vt,Y,ie,_e);else if(et==="LineString")li(Je,Vt,Y,ie,_e,!1,Pe.lineMetrics);else if(et==="MultiLineString")Hi(Je,Vt,Y,ie,_e,!1);else if(et==="Polygon")Hi(Je,Vt,Y,ie,_e,!0);else if(et==="MultiPolygon")for(const bi of Je){const ci=[];Hi(bi,ci,Y,ie,_e,!0),ci.length&&Vt.push(ci)}if(Vt.length){if(Pe.lineMetrics&&et==="LineString"){for(const bi of Vt)Te.push(ht(Oe.id,et,bi,Oe.tags));continue}et!=="LineString"&&et!=="MultiLineString"||(Vt.length===1?(et="LineString",Vt=Vt[0]):et="MultiLineString"),et!=="Point"&&et!=="MultiPoint"||(et=Vt.length===3?"Point":"MultiPoint"),Te.push(ht(Oe.id,et,Vt,Oe.tags))}}return Te.length?Te:null}function Wt(Re,W,Y,ie,_e){for(let xe=0;xe<Re.length;xe+=3){const Be=Re[xe+_e];Be>=Y&&Be<=ie&&Er(W,Re[xe],Re[xe+1],Re[xe+2])}}function li(Re,W,Y,ie,_e,xe,Be){let Pe=Bi(Re);const Te=_e===0?so:Kr;let Oe,Je,et=Re.start;for(let ci=0;ci<Re.length-3;ci+=3){const Ie=Re[ci],Si=Re[ci+1],Cn=Re[ci+2],qt=Re[ci+3],Mi=Re[ci+4],Un=_e===0?Ie:Si,Di=_e===0?qt:Mi;let dn=!1;Be&&(Oe=Math.sqrt(Math.pow(Ie-qt,2)+Math.pow(Si-Mi,2))),Un<Y?Di>Y&&(Je=Te(Pe,Ie,Si,qt,Mi,Y),Be&&(Pe.start=et+Oe*Je)):Un>ie?Di<ie&&(Je=Te(Pe,Ie,Si,qt,Mi,ie),Be&&(Pe.start=et+Oe*Je)):Er(Pe,Ie,Si,Cn),Di<Y&&Un>=Y&&(Je=Te(Pe,Ie,Si,qt,Mi,Y),dn=!0),Di>ie&&Un<=ie&&(Je=Te(Pe,Ie,Si,qt,Mi,ie),dn=!0),!xe&&dn&&(Be&&(Pe.end=et+Oe*Je),W.push(Pe),Pe=Bi(Re)),Be&&(et+=Oe)}let wt=Re.length-3;const Pt=Re[wt],Vt=Re[wt+1],bi=_e===0?Pt:Vt;bi>=Y&&bi<=ie&&Er(Pe,Pt,Vt,Re[wt+2]),wt=Pe.length-3,xe&&wt>=3&&(Pe[wt]!==Pe[0]||Pe[wt+1]!==Pe[1])&&Er(Pe,Pe[0],Pe[1],Pe[2]),Pe.length&&W.push(Pe)}function Bi(Re){const W=[];return W.size=Re.size,W.start=Re.start,W.end=Re.end,W}function Hi(Re,W,Y,ie,_e,xe){for(const Be of Re)li(Be,W,Y,ie,_e,xe,!1)}function Er(Re,W,Y,ie){Re.push(W,Y,ie)}function so(Re,W,Y,ie,_e,xe){const Be=(xe-W)/(ie-W);return Er(Re,xe,Y+(_e-Y)*Be,1),Be}function Kr(Re,W,Y,ie,_e,xe){const Be=(xe-Y)/(_e-Y);return Er(Re,W+(ie-W)*Be,xe,1),Be}function kl(Re,W){const Y=[];for(let ie=0;ie<Re.length;ie++){const _e=Re[ie],xe=_e.type;let Be;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Be=sn(_e.geometry,W);else if(xe==="MultiLineString"||xe==="Polygon"){Be=[];for(const Pe of _e.geometry)Be.push(sn(Pe,W))}else if(xe==="MultiPolygon"){Be=[];for(const Pe of _e.geometry){const Te=[];for(const Oe of Pe)Te.push(sn(Oe,W));Be.push(Te)}}Y.push(ht(_e.id,xe,Be,_e.tags))}return Y}function sn(Re,W){const Y=[];Y.size=Re.size,Re.start!==void 0&&(Y.start=Re.start,Y.end=Re.end);for(let ie=0;ie<Re.length;ie+=3)Y.push(Re[ie]+W,Re[ie+1],Re[ie+2]);return Y}function Br(Re,W){if(Re.transformed)return Re;const Y=1<<Re.z,ie=Re.x,_e=Re.y;for(const xe of Re.features){const Be=xe.geometry,Pe=xe.type;if(xe.geometry=[],Pe===1)for(let Te=0;Te<Be.length;Te+=2)xe.geometry.push(ga(Be[Te],Be[Te+1],W,Y,ie,_e));else for(let Te=0;Te<Be.length;Te++){const Oe=[];for(let Je=0;Je<Be[Te].length;Je+=2)Oe.push(ga(Be[Te][Je],Be[Te][Je+1],W,Y,ie,_e));xe.geometry.push(Oe)}}return Re.transformed=!0,Re}function ga(Re,W,Y,ie,_e,xe){return[Math.round(Y*(Re*ie-_e)),Math.round(Y*(W*ie-xe))]}function hn(Re,W,Y,ie,_e){const xe=W===_e.maxZoom?0:_e.tolerance/((1<<W)*_e.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:Re.length,source:null,x:Y,y:ie,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Pe of Re)Ls(Be,Pe,xe,_e);return Be}function Ls(Re,W,Y,ie){const _e=W.geometry,xe=W.type,Be=[];if(Re.minX=Math.min(Re.minX,W.minX),Re.minY=Math.min(Re.minY,W.minY),Re.maxX=Math.max(Re.maxX,W.maxX),Re.maxY=Math.max(Re.maxY,W.maxY),xe==="Point"||xe==="MultiPoint")for(let Pe=0;Pe<_e.length;Pe+=3)Be.push(_e[Pe],_e[Pe+1]),Re.numPoints++,Re.numSimplified++;else if(xe==="LineString")ks(Be,_e,Re,Y,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let Pe=0;Pe<_e.length;Pe++)ks(Be,_e[Pe],Re,Y,xe==="Polygon",Pe===0);else if(xe==="MultiPolygon")for(let Pe=0;Pe<_e.length;Pe++){const Te=_e[Pe];for(let Oe=0;Oe<Te.length;Oe++)ks(Be,Te[Oe],Re,Y,!0,Oe===0)}if(Be.length){let Pe=W.tags||null;if(xe==="LineString"&&ie.lineMetrics){Pe={};for(const Oe in W.tags)Pe[Oe]=W.tags[Oe];Pe.mapbox_clip_start=_e.start/_e.size,Pe.mapbox_clip_end=_e.end/_e.size}const Te={geometry:Be,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:Pe};W.id!==null&&(Te.id=W.id),Re.features.push(Te)}}function ks(Re,W,Y,ie,_e,xe){const Be=ie*ie;if(ie>0&&W.size<(_e?Be:ie))return void(Y.numPoints+=W.length/3);const Pe=[];for(let Te=0;Te<W.length;Te+=3)(ie===0||W[Te+2]>Be)&&(Y.numSimplified++,Pe.push(W[Te],W[Te+1])),Y.numPoints++;_e&&(function(Te,Oe){let Je=0;for(let et=0,wt=Te.length,Pt=wt-2;et<wt;Pt=et,et+=2)Je+=(Te[et]-Te[Pt])*(Te[et+1]+Te[Pt+1]);if(Je>0===Oe)for(let et=0,wt=Te.length;et<wt/2;et+=2){const Pt=Te[et],Vt=Te[et+1];Te[et]=Te[wt-2-et],Te[et+1]=Te[wt-1-et],Te[wt-2-et]=Pt,Te[wt-1-et]=Vt}})(Pe,xe),Re.push(Pe)}const oo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class rs{constructor(W,Y){const ie=(Y=this.options=(function(xe,Be){for(const Pe in Be)xe[Pe]=Be[Pe];return xe})(Object.create(oo),Y)).debug;if(ie&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");let _e=(function(xe,Be){const Pe=[];if(xe.type==="FeatureCollection")for(let Te=0;Te<xe.features.length;Te++)It(Pe,xe.features[Te],Be,Te);else It(Pe,xe.type==="Feature"?xe:{geometry:xe},Be);return Pe})(W,Y);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),_e=(function(xe,Be){const Pe=Be.buffer/Be.extent;let Te=xe;const Oe=Ot(xe,1,-1-Pe,Pe,0,-1,2,Be),Je=Ot(xe,1,1-Pe,2+Pe,0,-1,2,Be);return(Oe||Je)&&(Te=Ot(xe,1,-Pe,1+Pe,0,-1,2,Be)||[],Oe&&(Te=kl(Oe,1).concat(Te)),Je&&(Te=Te.concat(kl(Je,-1)))),Te})(_e,Y),_e.length&&this.splitTile(_e,0,0,0),ie&&(_e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,Y,ie,_e,xe,Be,Pe){const Te=[W,Y,ie,_e],Oe=this.options,Je=Oe.debug;for(;Te.length;){_e=Te.pop(),ie=Te.pop(),Y=Te.pop(),W=Te.pop();const et=1<<Y,wt=Fa(Y,ie,_e);let Pt=this.tiles[wt];if(!Pt&&(Je>1&&console.time("creation"),Pt=this.tiles[wt]=hn(W,Y,ie,_e,Oe),this.tileCoords.push({z:Y,x:ie,y:_e}),Je)){Je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,ie,_e,Pt.numFeatures,Pt.numPoints,Pt.numSimplified),console.timeEnd("creation"));const dn=`z${Y}`;this.stats[dn]=(this.stats[dn]||0)+1,this.total++}if(Pt.source=W,xe==null){if(Y===Oe.indexMaxZoom||Pt.numPoints<=Oe.indexMaxPoints)continue}else{if(Y===Oe.maxZoom||Y===xe)continue;if(xe!=null){const dn=xe-Y;if(ie!==Be>>dn||_e!==Pe>>dn)continue}}if(Pt.source=null,W.length===0)continue;Je>1&&console.time("clipping");const Vt=.5*Oe.buffer/Oe.extent,bi=.5-Vt,ci=.5+Vt,Ie=1+Vt;let Si=null,Cn=null,qt=null,Mi=null,Un=Ot(W,et,ie-Vt,ie+ci,0,Pt.minX,Pt.maxX,Oe),Di=Ot(W,et,ie+bi,ie+Ie,0,Pt.minX,Pt.maxX,Oe);W=null,Un&&(Si=Ot(Un,et,_e-Vt,_e+ci,1,Pt.minY,Pt.maxY,Oe),Cn=Ot(Un,et,_e+bi,_e+Ie,1,Pt.minY,Pt.maxY,Oe),Un=null),Di&&(qt=Ot(Di,et,_e-Vt,_e+ci,1,Pt.minY,Pt.maxY,Oe),Mi=Ot(Di,et,_e+bi,_e+Ie,1,Pt.minY,Pt.maxY,Oe),Di=null),Je>1&&console.timeEnd("clipping"),Te.push(Si||[],Y+1,2*ie,2*_e),Te.push(Cn||[],Y+1,2*ie,2*_e+1),Te.push(qt||[],Y+1,2*ie+1,2*_e),Te.push(Mi||[],Y+1,2*ie+1,2*_e+1)}}getTile(W,Y,ie){W=+W,Y=+Y,ie=+ie;const _e=this.options,{extent:xe,debug:Be}=_e;if(W<0||W>24)return null;const Pe=1<<W,Te=Fa(W,Y=Y+Pe&Pe-1,ie);if(this.tiles[Te])return Br(this.tiles[Te],xe);Be>1&&console.log("drilling down to z%d-%d-%d",W,Y,ie);let Oe,Je=W,et=Y,wt=ie;for(;!Oe&&Je>0;)Je--,et>>=1,wt>>=1,Oe=this.tiles[Fa(Je,et,wt)];return Oe&&Oe.source?(Be>1&&(console.log("found parent tile z%d-%d-%d",Je,et,wt),console.time("drilling down")),this.splitTile(Oe.source,Je,et,wt,W,Y,ie),Be>1&&console.timeEnd("drilling down"),this.tiles[Te]?Br(this.tiles[Te],xe):null):null}}function Fa(Re,W,Y){return 32*((1<<Re)*Y+W)+Re}class Bl extends oe{constructor(W,Y,ie,_e=Wn){super(W,Y,ie),this._dataUpdateable=new Map,this._createGeoJSONIndex=_e}loadVectorTile(W,Y){return M._(this,void 0,void 0,(function*(){const ie=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const _e=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);return _e?Ce(new M.d2(_e.features,{version:2,extent:M.a5})):null}))}loadData(W){return M._(this,void 0,void 0,(function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();const ie=this._startPerformance(W);this._pendingRequest=new AbortController;try{(!this._pendingData||W.request||W.data||W.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest));const _e=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(_e,W),this.loaded={};const xe={};return W.request&&(xe.data=_e),this._finishPerformance(ie,W,xe),xe}catch(_e){if(delete this._pendingRequest,M.Z(_e))return{abandoned:!0};throw _e}}))}_startPerformance(W){var Y;if(!((Y=W?.request)===null||Y===void 0)&&Y.collectResourceTiming)return new M.c_(W.request)}_finishPerformance(W,Y,ie){if(!W)return;const _e=W.finish();_e&&(ie.resourceTiming={},ie.resourceTiming[Y.source]=JSON.parse(JSON.stringify(_e)))}getData(){return M._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(W){const Y=this.loaded;return Y&&Y[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,Y){return M._(this,void 0,void 0,(function*(){let ie;if(W.request?ie=yield this.loadGeoJSONFromUrl(W.request,W.promoteId,Y):W.data?ie=this._loadGeoJSONFromObject(W.data,W.promoteId):W.dataDiff&&(ie=this._loadGeoJSONFromDiff(W.dataDiff,W.promoteId,W.source)),delete this._pendingRequest,typeof ie!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);return Ke(ie,!0),W.filter&&(ie=this._filterGeoJSON(ie,W.filter)),ie}))}loadGeoJSONFromUrl(W,Y,ie){return M._(this,void 0,void 0,(function*(){const _e=yield M.j(W,ie);return this._dataUpdateable=M.a7(_e.data,Y),_e.data}))}_loadGeoJSONFromObject(W,Y){return this._dataUpdateable=M.a7(W,Y),W}_loadGeoJSONFromDiff(W,Y,ie){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ie}`);M.a8(this._dataUpdateable,W,Y);const _e=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(_e)}_filterGeoJSON(W,Y){const ie=M.d3(Y,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ie.result==="error")throw new Error(ie.value.map((xe=>`${xe.key}: ${xe.message}`)).join(", "));const _e=W.features.filter((xe=>ie.value.evaluate({zoom:0},xe)));return this._toFeatureCollection(_e)}_toFeatureCollection(W){return{type:"FeatureCollection",features:W}}removeSource(W){return M._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}function Wn(Re,W){return W.cluster?new Xt((function({superclusterOptions:Y,clusterProperties:ie}){if(!ie||!Y)return Y;const _e={},xe={},Be={accumulated:null,zoom:0},Pe={properties:null},Te=Object.keys(ie);for(const Oe of Te){const[Je,et]=ie[Oe],wt=M.d3(et),Pt=M.d3(typeof Je=="string"?[Je,["accumulated"],["get",Oe]]:Je);_e[Oe]=wt.value,xe[Oe]=Pt.value}return Y.map=Oe=>{Pe.properties=Oe;const Je={};for(const et of Te)Je[et]=_e[et].evaluate(Be,Pe);return Je},Y.reduce=(Oe,Je)=>{Pe.properties=Je;for(const et of Te)Be.accumulated=Oe[et],Oe[et]=xe[et].evaluate(Be,Pe)},Y})(W)).load(Re.features):(function(Y,ie){return new rs(Y,ie)})(Re,W.geojsonVtOptions)}class Or{constructor(W){this.self=W,this.actor=new M.L(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(Y,ie)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=ie},this.self.addProtocol=M.cJ,this.self.removeProtocol=M.cK,this.self.registerRTLTextPlugin=Y=>{M.d4.setMethods(Y)},this.actor.registerMessageHandler("LDT",((Y,ie)=>this._getDEMWorkerSource(Y,ie.source).loadTile(ie))),this.actor.registerMessageHandler("RDT",((Y,ie)=>M._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(Y,ie.source).removeTile(ie)})))),this.actor.registerMessageHandler("GCEZ",((Y,ie)=>M._(this,void 0,void 0,(function*(){return this._getWorkerSource(Y,ie.type,ie.source).getClusterExpansionZoom(ie)})))),this.actor.registerMessageHandler("GCC",((Y,ie)=>M._(this,void 0,void 0,(function*(){return this._getWorkerSource(Y,ie.type,ie.source).getClusterChildren(ie)})))),this.actor.registerMessageHandler("GCL",((Y,ie)=>M._(this,void 0,void 0,(function*(){return this._getWorkerSource(Y,ie.type,ie.source).getClusterLeaves(ie)})))),this.actor.registerMessageHandler("LD",((Y,ie)=>this._getWorkerSource(Y,ie.type,ie.source).loadData(ie))),this.actor.registerMessageHandler("GD",((Y,ie)=>this._getWorkerSource(Y,ie.type,ie.source).getData())),this.actor.registerMessageHandler("LT",((Y,ie)=>this._getWorkerSource(Y,ie.type,ie.source).loadTile(ie))),this.actor.registerMessageHandler("RT",((Y,ie)=>this._getWorkerSource(Y,ie.type,ie.source).reloadTile(ie))),this.actor.registerMessageHandler("AT",((Y,ie)=>this._getWorkerSource(Y,ie.type,ie.source).abortTile(ie))),this.actor.registerMessageHandler("RMT",((Y,ie)=>this._getWorkerSource(Y,ie.type,ie.source).removeTile(ie))),this.actor.registerMessageHandler("RS",((Y,ie)=>M._(this,void 0,void 0,(function*(){if(!this.workerSources[Y]||!this.workerSources[Y][ie.type]||!this.workerSources[Y][ie.type][ie.source])return;const _e=this.workerSources[Y][ie.type][ie.source];delete this.workerSources[Y][ie.type][ie.source],_e.removeSource!==void 0&&_e.removeSource(ie)})))),this.actor.registerMessageHandler("RM",(Y=>M._(this,void 0,void 0,(function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y],this.globalStates.delete(Y)})))),this.actor.registerMessageHandler("SR",((Y,ie)=>M._(this,void 0,void 0,(function*(){this.referrer=ie})))),this.actor.registerMessageHandler("SRPS",((Y,ie)=>this._syncRTLPluginState(Y,ie))),this.actor.registerMessageHandler("IS",((Y,ie)=>M._(this,void 0,void 0,(function*(){this.self.importScripts(ie)})))),this.actor.registerMessageHandler("SI",((Y,ie)=>this._setImages(Y,ie))),this.actor.registerMessageHandler("UL",((Y,ie)=>M._(this,void 0,void 0,(function*(){this._getLayerIndex(Y).update(ie.layers,ie.removedIds,this._getGlobalState(Y))})))),this.actor.registerMessageHandler("UGS",((Y,ie)=>M._(this,void 0,void 0,(function*(){const _e=this._getGlobalState(Y);for(const xe in ie)_e[xe]=ie[xe]})))),this.actor.registerMessageHandler("SL",((Y,ie)=>M._(this,void 0,void 0,(function*(){this._getLayerIndex(Y).replace(ie,this._getGlobalState(Y))}))))}_getGlobalState(W){let Y=this.globalStates.get(W);return Y||(Y={},this.globalStates.set(W,Y)),Y}_setImages(W,Y){return M._(this,void 0,void 0,(function*(){this.availableImages[W]=Y;for(const ie in this.workerSources[W]){const _e=this.workerSources[W][ie];for(const xe in _e)_e[xe].availableImages=Y}}))}_syncRTLPluginState(W,Y){return M._(this,void 0,void 0,(function*(){return yield M.d4.syncState(Y,this.self.importScripts)}))}_getAvailableImages(W){let Y=this.availableImages[W];return Y||(Y=[]),Y}_getLayerIndex(W){let Y=this.layerIndexes[W];return Y||(Y=this.layerIndexes[W]=new u),Y}_getWorkerSource(W,Y,ie){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][Y]||(this.workerSources[W][Y]={}),!this.workerSources[W][Y][ie]){const _e={sendAsync:(xe,Be)=>(xe.targetMapId=W,this.actor.sendAsync(xe,Be))};switch(Y){case"vector":this.workerSources[W][Y][ie]=new oe(_e,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][Y][ie]=new Bl(_e,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][Y][ie]=new this.externalWorkerSourceTypes[Y](_e,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][Y][ie]}_getDEMWorkerSource(W,Y){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][Y]||(this.demWorkerSources[W][Y]=new We),this.demWorkerSources[W][Y]}}return M.i(self)&&(self.worker=new Or(self)),Or})),R("index",["exports","./shared"],(function(M,u){var j="5.15.0";function Z(){var g=new u.A(4);return u.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let X,te,de;const Ae={frame(g,t,a){const l=requestAnimationFrame((v=>{f(),t(v)})),{unsubscribe:f}=u.s(g.signal,"abort",(()=>{f(),cancelAnimationFrame(l),a(new u.a(g.signal.reason))}),!1)},frameAsync(g){return new Promise(((t,a)=>{this.frame(g,t,a)}))},getImageData(g,t=0){return this.getImageCanvasContext(g).getImageData(-t,-t,g.width+2*t,g.height+2*t)},getImageCanvasContext(g){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=g.width,t.height=g.height,a.drawImage(g,0,0,g.width,g.height),a},resolveURL:g=>(X||(X=document.createElement("a")),X.href=g,X.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return de!==void 0?de:!!matchMedia&&(te==null&&(te=matchMedia("(prefers-reduced-motion: reduce)")),te.matches)},set prefersReducedMotion(g){de=g}},Ce=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(g){this._frozenAt=g}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function De(){return Ce.getCurrentTime()}class oe{static testProp(t){if(!oe.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in oe.docStyle)return t[a];return t[0]}static create(t,a,l){const f=window.document.createElement(t);return a!==void 0&&(f.className=a),l&&l.appendChild(f),f}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){oe.docStyle&&oe.selectProp&&(oe.userSelect=oe.docStyle[oe.selectProp],oe.docStyle[oe.selectProp]="none")}static enableDrag(){oe.docStyle&&oe.selectProp&&(oe.docStyle[oe.selectProp]=oe.userSelect)}static setTransform(t,a){t.style[oe.transformProp]=a}static addEventListener(t,a,l,f={}){t.addEventListener(a,l,"passive"in f?f:f.capture)}static removeEventListener(t,a,l,f={}){t.removeEventListener(a,l,"passive"in f?f:f.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",oe.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",oe.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",oe.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,l){const f=a.boundingClientRect;return new u.P((l.clientX-f.left)/a.x-t.clientLeft,(l.clientY-f.top)/a.y-t.clientTop)}static mousePos(t,a){const l=oe.getScale(t);return oe.getPoint(t,l,a)}static touchPos(t,a){const l=[],f=oe.getScale(t);for(let v=0;v<a.length;v++)l.push(oe.getPoint(t,f,a[v]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),l=a.querySelectorAll("script");for(const f of l)f.remove();return oe.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const l=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!l.includes("javascript:")&&!l.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const l of a)oe.removeAttributes(l),oe.clean(l)}static removeAttributes(t){for(const{name:a,value:l}of t.attributes)oe.isPossiblyDangerous(a,l)&&t.removeAttribute(a)}}oe.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,oe.selectProp=oe.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),oe.transformProp=oe.testProp(["transform","WebkitTransform"]);const We={supported:!1,testSupport:function(g){!Ct&&$e&&(Ke?vt(g):Ze=g)}};let Ze,$e,Ct=!1,Ke=!1;function vt(g){const t=g.createTexture();g.bindTexture(g.TEXTURE_2D,t);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,$e),g.isContextLost())return;We.supported=!0}catch{}g.deleteTexture(t),Ct=!0}var mt;typeof document<"u"&&($e=document.createElement("img"),$e.onload=()=>{Ze&&vt(Ze),Ze=null,Ke=!0},$e.onerror=()=>{Ct=!0,Ze=null},$e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(g){let t,a,l,f;g.resetRequestQueue=()=>{t=[],a=0,l=0,f={}},g.addThrottleControl=D=>{const I=l++;return f[I]=D,I},g.removeThrottleControl=D=>{delete f[D],b()},g.getImage=(D,I,k=!0)=>new Promise(((V,N)=>{We.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),u.e(D,{type:"image"}),t.push({abortController:I,requestParameters:D,supportImageRefresh:k,state:"queued",onError:H=>{N(H)},onSuccess:H=>{V(H)}}),b()}));const v=D=>u._(this,void 0,void 0,(function*(){D.state="running";const{requestParameters:I,supportImageRefresh:k,onError:V,onSuccess:N,abortController:H}=D,K=k===!1&&!u.i(self)&&!u.g(I.url)&&(!I.headers||Object.keys(I.headers).reduce(((ae,ue)=>ae&&ue==="accept"),!0));a++;const re=K?E(I,H):u.m(I,H);try{const ae=yield re;delete D.abortController,D.state="completed",ae.data instanceof HTMLImageElement||u.b(ae.data)?N(ae):ae.data&&N({data:yield(se=ae.data,typeof createImageBitmap=="function"?u.f(se):u.h(se)),cacheControl:ae.cacheControl,expires:ae.expires})}catch(ae){delete D.abortController,V(ae)}finally{a--,b()}var se})),b=()=>{const D=(()=>{for(const I of Object.keys(f))if(f[I]())return!0;return!1})()?u.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=a;I<D&&t.length>0;I++){const k=t.shift();k.abortController.signal.aborted?I--:v(k)}},E=(D,I)=>new Promise(((k,V)=>{const N=new Image,H=D.url,K=D.credentials;K&&K==="include"?N.crossOrigin="use-credentials":(K&&K==="same-origin"||!u.d(H))&&(N.crossOrigin="anonymous"),I.signal.addEventListener("abort",(()=>{N.src="",V(new u.a(I.signal.reason))})),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,k({data:N})},N.onerror=()=>{N.onerror=N.onload=null,I.signal.aborted||V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=H}))})(mt||(mt={})),mt.resetRequestQueue();class Et{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Xt(g){const t=[];if(typeof g=="string")t.push({id:"default",url:g});else if(g&&g.length>0){const a=[];for(const{id:l,url:f}of g){const v=`${l}${f}`;a.indexOf(v)===-1&&(a.push(v),t.push({id:l,url:f}))}}return t}function ct(g,t,a){try{const l=new URL(g);return l.pathname+=`${t}${a}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Yt(g){const{userImage:t}=g;return!!(t&&t.render&&t.render())&&(g.data.replace(new Uint8Array(t.data.buffer)),!0)}class ki extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:l}of this.requestors)l(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const l=a.spriteData;a.data=new u.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let l=!0;const f=a.data||a.spriteData;return this._validateStretch(a.stretchX,f&&f.width)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(a.stretchY,f&&f.height)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(a.content,a)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,a){if(!t)return!0;let l=0;for(const f of t){if(f[0]<l||f[1]<f[0]||a<f[1])return!1;l=f[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const l=a.spriteData,f=l&&l.width||a.data.width,v=l&&l.height||a.data.height;return!(t[0]<0||f<t[0]||t[1]<0||v<t[1]||t[2]<0||f<t[2]||t[3]<0||v<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,l=!0){const f=this.getImage(t);if(l&&(f.data.width!==a.data.width||f.data.height!==a.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=f.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,l)=>{let f=!0;if(!this.isLoaded())for(const v of t)this.images[v]||(f=!1);this.isLoaded()||f?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const l of t){let f=this.getImage(l);f||(this.fire(new u.l("styleimagemissing",{id:l})),f=this.getImage(l)),f?a[l]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,textFitWidth:f.textFitWidth,textFitHeight:f.textFitHeight,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:u.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],l=this.getImage(t);if(!l)return null;if(a&&a.position.version===l.version)return a.position;if(a)a.position.version=l.version;else{const f={w:l.data.width+2,h:l.data.height+2,x:0,y:0},v=new u.I(f,l);this.patterns[t]={bin:f,position:v}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const v in this.patterns)t.push(this.patterns[v].bin);const{w:a,h:l}=u.p(t),f=this.atlasImage;f.resize({width:a||1,height:l||1});for(const v in this.patterns){const{bin:b}=this.patterns[v],E=b.x+1,D=b.y+1,I=this.getImage(v).data,k=I.width,V=I.height;u.R.copy(I,f,{x:0,y:0},{x:E,y:D},{width:k,height:V}),u.R.copy(I,f,{x:0,y:V-1},{x:E,y:D-1},{width:k,height:1}),u.R.copy(I,f,{x:0,y:0},{x:E,y:D+V},{width:k,height:1}),u.R.copy(I,f,{x:k-1,y:0},{x:E-1,y:D},{width:1,height:V}),u.R.copy(I,f,{x:0,y:0},{x:E+k,y:D},{width:1,height:V})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const l=this.getImage(a);l||u.w(`Image with ID: "${a}" was not found`),Yt(l)&&this.updateImage(a,l)}}cloneImages(){const t={};for(const a in this.images){const l=this.images[a];t[a]=Object.assign(Object.assign({},l),{data:l.data?l.data.clone():null})}return t}}const wn=1e20;function mr(g,t,a,l,f,v,b,E,D){for(let I=t;I<t+l;I++)Bn(g,a*v+I,v,f,b,E,D);for(let I=a;I<a+f;I++)Bn(g,I*v+t,1,l,b,E,D)}function Bn(g,t,a,l,f,v,b){v[0]=0,b[0]=-wn,b[1]=wn,f[0]=g[t];for(let E=1,D=0,I=0;E<l;E++){f[E]=g[t+E*a];const k=E*E;do{const V=v[D];I=(f[E]-f[V]+k-V*V)/(E-V)/2}while(I<=b[D]&&--D>-1);D++,v[D]=E,b[D]=I,b[D+1]=wn}for(let E=0,D=0;E<l;E++){for(;b[D+1]<E;)D++;const I=v[D],k=E-I;g[t+E*a]=f[I]+k*k}}const tt=u.v.layout_symbol["text-font"].default.join(",");class ht{constructor(t,a,l){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=l}setURL(t){this.url=t}getGlyphs(t){return u._(this,void 0,void 0,(function*(){const a=[];for(const v in t)for(const b of t[v])a.push(this._getAndCacheGlyphsPromise(v,b));const l=yield Promise.all(a),f={};for(const{stack:v,id:b,glyph:E}of l)f[v]||(f[v]={}),f[v][b]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};return f}))}_getAndCacheGlyphsPromise(t,a){return u._(this,void 0,void 0,(function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let f=l.glyphs[a];return f!==void 0?{stack:t,id:a,glyph:f}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(f=l.glyphs[a]=this._drawGlyph(l,t,a),{stack:t,id:a,glyph:f}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return u._(this,void 0,void 0,(function*(){const l=this.entries[t],f=Math.floor(a/256);if(l.ranges[f])return{stack:t,id:a,glyph:null};if(!l.requests[f]){const v=ht.loadGlyphRange(t,f,this.url,this.requestManager);l.requests[f]=v}try{const v=yield l.requests[f];for(const b in v)l.glyphs[+b]=v[+b];return l.ranges[f]=!0,{stack:t,id:a,glyph:v[a]||null}}catch(v){const b=l.glyphs[a]=this._drawGlyph(l,t,a);return this._warnOnMissingGlyphRange(b,f,a,v),{stack:t,id:a,glyph:b}}}))}_warnOnMissingGlyphRange(t,a,l,f){const v=256*a,b=v+255,E=l.toString(16).padStart(4,"0").toUpperCase();u.w(`Unable to load glyph range ${a}, ${v}-${b}. Rendering codepoint U+${E} locally instead. ${f}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&u.q(t)}_drawGlyph(t,a,l){const f=a===tt&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(l),v=f?"ideographTinySDF":"tinySDF";t[v]||(t[v]=this._createTinySDF(f?this.localIdeographFontFamily:a));const b=t[v].draw(String.fromCodePoint(l));return{id:l,bitmap:new u.r({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const l=a.map((f=>/[-\w]+/.test(f)?f:`'${CSS.escape(f)}'`)).join(",");return new ht.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let l;for(const[f,v]of Object.entries(a))new RegExp(`\\b${f}\\b`,"i").test(t)&&(l=`${v}`);return l}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}ht.loadGlyphRange=function(g,t,a,l){return u._(this,void 0,void 0,(function*(){const f=256*t,v=f+255,b=l.transformRequest(a.replace("{fontstack}",g).replace("{range}",`${f}-${v}`),"Glyphs"),E=yield u.n(b,new AbortController);if(!E||!E.data)throw new Error(`Could not load glyph range. range: ${t}, ${f}-${v}`);const D={};for(const I of u.o(E.data))D[I.id]=I;return D}))},ht.TinySDF=class{constructor({fontSize:g=24,buffer:t=3,radius:a=8,cutoff:l=.25,fontFamily:f="sans-serif",fontWeight:v="normal",fontStyle:b="normal",lang:E=null}={}){this.buffer=t,this.cutoff=l,this.radius=a,this.lang=E;const D=this.size=g+4*t,I=this._createCanvas(D),k=this.ctx=I.getContext("2d",{willReadFrequently:!0});k.font=`${b} ${v} ${g}px ${f}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(g){const t=document.createElement("canvas");return t.width=t.height=g,t}draw(g){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:l,actualBoundingBoxLeft:f,actualBoundingBoxRight:v}=this.ctx.measureText(g),b=Math.ceil(a),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-f))),D=Math.min(this.size-this.buffer,b+Math.ceil(l)),I=E+2*this.buffer,k=D+2*this.buffer,V=Math.max(I*k,0),N=new Uint8ClampedArray(V),H={data:N,width:I,height:k,glyphWidth:E,glyphHeight:D,glyphTop:b,glyphLeft:0,glyphAdvance:t};if(E===0||D===0)return H;const{ctx:K,buffer:re,gridInner:se,gridOuter:ae}=this;this.lang&&(K.lang=this.lang),K.clearRect(re,re,E,D),K.fillText(g,re,re+b);const ue=K.getImageData(re,re,E,D);ae.fill(wn,0,V),se.fill(0,0,V);for(let ge=0;ge<D;ge++)for(let le=0;le<E;le++){const me=ue.data[4*(ge*E+le)+3]/255;if(me===0)continue;const ve=(ge+re)*I+le+re;if(me===1)ae[ve]=0,se[ve]=wn;else{const fe=.5-me;ae[ve]=fe>0?fe*fe:0,se[ve]=fe<0?fe*fe:0}}mr(ae,0,0,I,k,I,this.f,this.v,this.z),mr(se,re,re,E,D,I,this.f,this.v,this.z);for(let ge=0;ge<V;ge++){const le=Math.sqrt(ae[ge])-Math.sqrt(se[ge]);N[ge]=Math.round(255-255*(le/this.radius+this.cutoff))}return H}};class Rt{constructor(){this.specification=u.u.light.position}possiblyEvaluate(t,a){return u.F(t.expression.evaluate(a))}interpolate(t,a,l){return{x:u.G.number(t.x,a.x,l),y:u.G.number(t.y,a.y,l),z:u.G.number(t.z,a.z,l)}}}let It;class si extends u.E{constructor(t){super(),It=It||new u.t({anchor:new u.D(u.u.light.anchor),position:new Rt,color:new u.D(u.u.light.color),intensity:new u.D(u.u.light.intensity)}),this._transitionable=new u.x(It,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(u.y,t,a))for(const l in t){const f=t[l];l.endsWith(u.z)?this._transitionable.setTransition(l.slice(0,-u.z.length),f):this._transitionable.setValue(l,f)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,l){return(!l||l.validate!==!1)&&u.B(this,t.call(u.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.u}))}}const Me=new u.t({"sky-color":new u.D(u.u.sky["sky-color"]),"horizon-color":new u.D(u.u.sky["horizon-color"]),"fog-color":new u.D(u.u.sky["fog-color"]),"fog-ground-blend":new u.D(u.u.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.u.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.u.sky["atmosphere-blend"])});class ot extends u.E{constructor(t){super(),this._transitionable=new u.x(Me,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.H(0))}setSky(t,a={}){if(!this._validate(u.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in t){const f=t[l];l.endsWith(u.z)?this._transitionable.setTransition(l.slice(0,-u.z.length),f):this._transitionable.setValue(l,f)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,l={}){return l?.validate!==!1&&u.B(this,t.call(u.C,u.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class Mt{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const l=t.join(",")+String(a);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,a)),this.dashEntry[l]}getDashRanges(t,a,l){const f=[];let v=t.length%2==1?-t[t.length-1]*l:0,b=t[0]*l,E=!0;f.push({left:v,right:b,isDash:E,zeroLength:t[0]===0});let D=t[0];for(let I=1;I<t.length;I++){E=!E;const k=t[I];v=D*l,D+=k,b=D*l,f.push({left:v,right:b,isDash:E,zeroLength:k===0})}return f}addRoundDash(t,a,l){const f=a/2;for(let v=-l;v<=l;v++){const b=this.width*(this.nextRow+l+v);let E=0,D=t[E];for(let I=0;I<this.width;I++){I/D.right>1&&(D=t[++E]);const k=Math.abs(I-D.left),V=Math.abs(I-D.right),N=Math.min(k,V);let H;const K=v/l*(f+1);if(D.isDash){const re=f-Math.abs(K);H=Math.sqrt(N*N+re*re)}else H=f-Math.sqrt(N*N+K*K);this.data[b+I]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(t){for(let E=t.length-1;E>=0;--E){const D=t[E],I=t[E+1];D.zeroLength?t.splice(E,1):I&&I.isDash===D.isDash&&(I.left=D.left,t.splice(E,1))}const a=t[0],l=t[t.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const f=this.width*this.nextRow;let v=0,b=t[v];for(let E=0;E<this.width;E++){E/b.right>1&&(b=t[++v]);const D=Math.abs(E-b.left),I=Math.abs(E-b.right),k=Math.min(D,I);this.data[f+E]=Math.max(0,Math.min(255,(b.isDash?k:-k)+128))}}addDash(t,a){const l=a?7:0,f=2*l+1;if(this.nextRow+f>this.height)return u.w("LineAtlas out of space"),null;let v=0;for(let E=0;E<t.length;E++)v+=t[E];if(v!==0){const E=this.width/v,D=this.getDashRanges(t,this.width,E);a?this.addRoundDash(D,E,l):this.addRegularDash(D)}const b={y:this.nextRow+l,height:2*l,width:v};return this.nextRow+=f,this.dirty=!0,b}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const zt="maplibre_preloaded_worker_pool";class Ot{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ot.workerCount;)this.workers.push(new Worker(u.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[zt]}numActive(){return Object.keys(this.active).length}}const Wt=Math.floor(Ae.hardwareConcurrency/2);let li,Bi;function Hi(){return li||(li=new Ot),li}Ot.workerCount=u.K(globalThis)?Math.max(Math.min(Wt,3),1):1;class Er{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const l=this.workerPool.acquire(a);for(let f=0;f<l.length;f++){const v=new u.L(l[f],a);v.name=`Worker ${f}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const l=[];for(const f of this.actors)l.push(f.sendAsync({type:t,data:a}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const l of this.actors)l.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function so(){return Bi||(Bi=new Er(Hi(),u.M),Bi.registerMessageHandler("GR",((g,t,a)=>u.m(t,a)))),Bi}function Kr(g,t){const a=u.N();return u.O(a,a,[1,1,0]),u.Q(a,a,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?u.S(a,a,g.calculatePosMatrix(t.toUnwrapped())):a}function kl(g,t,a,l,f,v,b){var E;const D=(function(N,H,K){if(N)for(const re of N){const se=H[re];if(se&&se.source===K&&se.type==="fill-extrusion")return!0}else for(const re in H){const se=H[re];if(se.source===K&&se.type==="fill-extrusion")return!0}return!1})((E=f?.layers)!==null&&E!==void 0?E:null,t,g.id),I=v.maxPitchScaleFactor(),k=g.tilesIn(l,I,D);k.sort(sn);const V=[];for(const N of k)V.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(t,a,g.getState(),N.queryGeometry,N.cameraQueryGeometry,N.scale,f,v,I,Kr(v,N.tileID),b?(H,K)=>b(N.tileID,H,K):void 0)});return(function(N,H){for(const K in N)for(const re of N[K])Br(re,H);return N})((function(N){const H={},K={};for(const re of N){const se=re.queryResults,ae=re.wrappedTileID,ue=K[ae]=K[ae]||{};for(const ge in se){const le=se[ge],me=ue[ge]=ue[ge]||{},ve=H[ge]=H[ge]||[];for(const fe of le)me[fe.featureIndex]||(me[fe.featureIndex]=!0,ve.push(fe))}}return H})(V),g)}function sn(g,t){const a=g.tileID,l=t.tileID;return a.overscaledZ-l.overscaledZ||a.canonical.y-l.canonical.y||a.wrap-l.wrap||a.canonical.x-l.canonical.x}function Br(g,t){const a=g.feature,l=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=l}function ga(g,t,a){return u._(this,void 0,void 0,(function*(){let l=g;if(g.url?l=(yield u.j(t.transformRequest(g.url,"Source"),a)).data:yield Ae.frameAsync(a),!l)return null;const f=u.U(u.e(l,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(f.vectorLayerIds=l.vector_layers.map((v=>v.id))),f}))}class hn{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof u.V?new u.V(t.lng,t.lat):u.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof u.V?new u.V(t.lng,t.lat):u.V.convert(t),this}extend(t){const a=this._sw,l=this._ne;let f,v;if(t instanceof u.V)f=t,v=t;else{if(!(t instanceof hn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(hn.convert(t)):this.extend(u.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(u.V.convert(t)):this;if(f=t._sw,v=t._ne,!f||!v)return this}return a||l?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),l.lng=Math.max(v.lng,l.lng),l.lat=Math.max(v.lat,l.lat)):(this._sw=new u.V(f.lng,f.lat),this._ne=new u.V(v.lng,v.lat)),this}getCenter(){return new u.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.V(this.getWest(),this.getNorth())}getSouthEast(){return new u.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:l}=u.V.convert(t);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&f}intersects(t){if(!((t=hn.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=Math.abs(this.getEast()-this.getWest()),l=Math.abs(t.getEast()-t.getWest());if(a>=360||l>=360)return!0;const f=u.W(this.getWest(),-180,180),v=u.W(this.getEast(),-180,180),b=u.W(t.getWest(),-180,180),E=u.W(t.getEast(),-180,180),D=f>=v,I=b>=E;return!(!D||!I)||(D?E>=f||b<=v:I?v>=b||f<=E:b<=v&&E>=f)}static convert(t){return t instanceof hn?t:t&&new hn(t)}static fromLngLat(t,a=0){const l=360*a/40075017,f=l/Math.cos(Math.PI/180*t.lat);return new hn(new u.V(t.lng-f,t.lat-l),new u.V(t.lng+f,t.lat+l))}adjustAntiMeridian(){const t=new u.V(this._sw.lng,this._sw.lat),a=new u.V(this._ne.lng,this._ne.lat);return new hn(t,t.lng>a.lng?new u.V(a.lng+360,a.lat):a)}}class Ls{constructor(t,a,l){this.bounds=hn.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),l=Math.floor(u.Y(this.bounds.getWest())*a),f=Math.floor(u.X(this.bounds.getNorth())*a),v=Math.ceil(u.Y(this.bounds.getEast())*a),b=Math.ceil(u.X(this.bounds.getSouth())*a);return t.x>=l&&t.x<v&&t.y>=f&&t.y<b}}class ks extends u.E{constructor(t,a,l,f){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=u.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return u._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ga(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(u.e(this,t),t.bounds&&(this.tileBounds=new Ls(t.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,u.Z(t)||this.fire(new u.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(t){return u._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};l.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((v,b)=>{t.reloadPromise={resolve:v,reject:b}}))}else t.actor=this.dispatcher.getActor(),f="LT";t.abortController=new AbortController;try{const v=yield t.actor.sendAsync({type:f,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,v)}catch(v){if(delete t.abortController,t.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,l=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(l,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return u._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return u._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class oo extends u.E{constructor(t,a,l,f){super(),this.id=t,this.dispatcher=l,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},a),u.e(this,u.U(a,["url","scheme","tileSize"]))}load(){return u._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield ga(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(u.e(this,a),a.bounds&&(this.tileBounds=new Ls(a.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,u.Z(a)||this.fire(new u.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return u.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return u._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield mt.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const f=this.map.painter.context,v=f.gl,b=l.data;t.texture=this.map.painter.getTileTexture(b.width),t.texture?t.texture.update(b,{useMipmap:!0}):(t.texture=new u.T(f,b,v.RGBA,{useMipmap:!0}),t.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}}))}abortTile(t){return u._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return u._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class rs extends oo{constructor(t,a,l,f){super(t,a,l,f),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return u._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const f=yield mt.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(f&&f.data){const v=f.data;this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const b=u.b(v)&&u.$()?v:yield this.readImageNow(v),E={type:this.type,uid:t.uid,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const D=yield t.actor.sendAsync({type:"LDT",data:E});t.dem=D,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}}))}readImageNow(t){return u._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&u.a0()){const a=t.width+2,l=t.height+2;try{return new u.R({width:a,height:l},yield u.a1(t,-1,-1,a,l))}catch{}}return Ae.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,l=Math.pow(2,a.z),f=(a.x-1+l)%l,v=a.x===0?t.wrap-1:t.wrap,b=(a.x+1+l)%l,E=a.x+1===l?t.wrap+1:t.wrap,D={};return D[new u.a2(t.overscaledZ,v,a.z,f,a.y).key]={backfilled:!1},D[new u.a2(t.overscaledZ,E,a.z,b,a.y).key]={backfilled:!1},a.y>0&&(D[new u.a2(t.overscaledZ,v,a.z,f,a.y-1).key]={backfilled:!1},D[new u.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},D[new u.a2(t.overscaledZ,E,a.z,b,a.y-1).key]={backfilled:!1}),a.y+1<l&&(D[new u.a2(t.overscaledZ,v,a.z,f,a.y+1).key]={backfilled:!1},D[new u.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},D[new u.a2(t.overscaledZ,E,a.z,b,a.y+1).key]={backfilled:!1}),D}unloadTile(t){return u._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Fa(g){return g.type==="GeometryCollection"?g.geometries.map((t=>t.coordinates)).flat(1/0):g.coordinates.flat(1/0)}function Bl(g){const t=new hn;let a;switch(g.type){case"FeatureCollection":a=g.features.map((l=>Fa(l.geometry))).flat(1/0);break;case"Feature":a=Fa(g.geometry);break;default:a=Fa(g)}if(a.length==0)return t;for(let l=0;l<a.length-1;l+=2)t.extend([a[l],a[l+1]]);return t}class Wn extends u.E{constructor(t,a,l,f){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=l.getActor(),this.setEventedParent(f),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=u.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:u.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:u.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(u.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||u.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return u._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const l=this._updateWorkerData();return a?l:this}updateData(t,a){this._pendingWorkerUpdate.diff=u.a6(this._pendingWorkerUpdate.diff,t);const l=this._updateWorkerData();return a?l:this}getData(){return u._(this,void 0,void 0,(function*(){const t=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return u._(this,void 0,void 0,(function*(){return Bl(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:l}})}_updateWorkerData(){return u._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void u.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,l=u.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(l.request=this.map._requestManager.transformRequest(Ae.resolveURL(t),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=t,this._pendingWorkerUpdate.data=void 0):a&&(l.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new u.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||f.abandoned)return void this.fire(new u.l("dataabort",{dataType:"source"}));f.data&&(this._data={geojson:f.data});const v=this._applyDiffToSource(a),b=this._getShouldReloadTileOptions(v);let E=null;f.resourceTiming&&f.resourceTiming[this.id]&&(E=f.resourceTiming[this.id].slice(0));const D={dataType:"source"};this._collectResourceTiming&&E&&E.length>0&&u.e(D,{resourceTiming:E}),this.fire(new u.l("data",Object.assign(Object.assign({},D),{sourceDataType:"metadata"}))),this.fire(new u.l("data",Object.assign(Object.assign({},D),{sourceDataType:"content",shouldReloadTileOptions:b})))}catch(f){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new u.l("dataabort",{dataType:"source"}));this.fire(new u.k(f))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const f=u.a7(this._data.geojson,a);if(!f)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:f}}if(!this._data.updateable)return;const l=u.a8(this._data.updateable,t,a);return t.removeAll||this._options.cluster?void 0:l}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((a=>Bl(a)))}}shouldReloadTile(t,{affectedBounds:a}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:l,extent:f}=this.workerOptions.geojsonVtOptions,v=(function({x:b,y:E,z:D},I=0){const k=u.a3((b-I)/Math.pow(2,D)),V=u.a4((E+1+I)/Math.pow(2,D)),N=u.a3((b+1+I)/Math.pow(2,D)),H=u.a4((E-I)/Math.pow(2,D));return new hn([k,V],[N,H])})(t.tileID.canonical,l/f);for(const b of a)if(v.intersects(b))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return u._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const f=yield this.actor.sendAsync({type:a,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(f,this.map.painter,a==="RT")}))}abortTile(t){return u._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return u._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Or extends u.E{constructor(t,a,l,f){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=l,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=a}load(t){return u._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield mt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,u.Z(a)||this.fire(new u.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(u.a9.fromLngLat);var l;return this.tileID=(function(f){const v=u.aa.fromPoints(f),b=v.width(),E=v.height(),D=Math.max(b,E),I=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),k=Math.pow(2,I);return new u.ac(I,Math.floor((v.minX+v.maxX)/2*k),Math.floor((v.minY+v.maxY)/2*k))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((f=>this.tileID.getTilePoint(f)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new u.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const f in this.tiles){const v=this.tiles[f];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,l=!0)}l&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return u._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:l,maxX:f,maxY:v}=u.aa.fromPoints(t),b={};for(let E=0;E<=u.ab;E++){const D=Math.pow(2,E),I=Math.floor(a*D),k=Math.floor(l*D),V=Math.floor(f*D),N=Math.floor(v*D);b[E]={minTileX:I,minTileY:k,maxTileX:V,maxTileY:N}}return b}}class Re extends Or{constructor(t,a,l,f){super(t,a,l,f),this.roundZoom=!0,this.type="video",this.options=a}load(){return u._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield u.ad(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new u.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new u.k(new u.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new u.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const f in this.tiles){const v=this.tiles[f];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,l=!0)}l&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class W extends Or{constructor(t,a,l,f){super(t,a,l,f),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((v=>!Array.isArray(v)||v.length!==2||v.some((b=>typeof b!="number"))))||this.fire(new u.k(new u.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.k(new u.ae(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new u.k(new u.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new u.k(new u.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.k(new u.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return u._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,l=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new u.T(a,this.canvas,l.RGBA,{premultiply:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let f=!1;for(const v in this.tiles){const b=this.tiles[v];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,f=!0)}f&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Y={},ie=g=>{switch(g){case"geojson":return Wn;case"image":return Or;case"raster":return oo;case"raster-dem":return rs;case"vector":return ks;case"video":return Re;case"canvas":return W}return Y[g]},_e="RTLPluginLoaded";class xe extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=so()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return u._(this,arguments,void 0,(function*(a,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ae.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return u._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.l(_e))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Be=null;function Pe(){return Be||(Be=new xe),Be}var Te,Oe;(function(g){g[g.Base=0]="Base",g[g.Parent=1]="Parent"})(Te||(Te={})),(function(g){g[g.Departing=0]="Departing",g[g.Incoming=1]="Incoming"})(Oe||(Oe={}));class Je{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=u.af(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:l,fadeEndTime:f}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=l,this.fadeEndTime=f}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=De(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(f,v){const b={};if(!v)return b;for(const E of f){const D=E.layerIds.map((I=>v.getLayer(I))).filter(Boolean);if(D.length!==0){E.layers=D,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map((I=>D.filter((k=>k.id===I))[0])));for(const I of D)b[I.id]=E}}return b})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const v=this.buckets[f];if(v instanceof u.ah){if(this.hasSymbolBuckets=!0,!l)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const v=this.buckets[f];if(v instanceof u.ah&&v.hasRTLText){this.hasRTLText=!0,Pe().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const v=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(v))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new u.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const f=this.buckets[l];f.uploadPending()&&f.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new u.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new u.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,l,f,v,b,E,D,I,k,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:b,tileSize:this.tileSize,pixelPosMatrix:k,transform:D,params:E,queryPadding:this.queryPadding*I,getElevation:V},t,a,l):{}}querySourceFeatures(t,a){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const f=l.loadVTLayers(),v=a&&a.sourceLayer?a.sourceLayer:"",b=f[u.ai]||f[v];if(!b)return;const E=u.aj(a?.filter,a?.globalState),{z:D,x:I,y:k}=this.tileID.canonical,V={z:D,x:I,y:k};for(let N=0;N<b.length;N++){const H=b.feature(N);if(E.needGeometry){const se=u.ak(H,!0);if(!E.filter(new u.H(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!E.filter(new u.H(this.tileID.overscaledZ),H))continue;const K=l.getId(H,v),re=new u.al(H,D,I,k,K);re.tile=V,t.push(re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const l=u.am(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let f=!1;if(this.expirationTime>l)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const v=this.expirationTime-a;v?this.expirationTime=l+Math.max(v,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const v=this.buckets[f],b=v.layers[0].sourceLayer||u.ai,E=l[b],D=t[b];if(!E||!D||Object.keys(D).length===0)continue;v.update(D,E,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const I=a&&a.style&&a.style.getLayer(f);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(v)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<De()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=De()+t}setDependencies(t,a){const l={};for(const f of a)l[f]=!0;this.dependencies[t]=l}hasDependency(t,a){for(const l of t){const f=this.dependencies[l];if(f){for(const v of a)if(f[v])return!0}}return!1}}class et{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,l){const f=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},u.e(this.stateChanges[t][f],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const v in this.state[t])v!==f&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const v in this.state[t][f])l[v]||(this.deletedStates[t][f][v]=null)}else for(const v in l)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][v]===null&&delete this.deletedStates[t][f][v]}removeFeatureState(t,a,l){if(this.deletedStates[t]===null)return;const f=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&a!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][l]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(l in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][l]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,a){const l=String(a),f=u.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const v=this.deletedStates[t][a];if(v===null)return{};for(const b in v)delete f[b]}return f}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const l={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const v={};for(const b in this.stateChanges[f])this.state[f][b]||(this.state[f][b]={}),u.e(this.state[f][b],this.stateChanges[f][b]),v[b]=this.state[f][b];l[f]=v}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const v={};if(this.deletedStates[f]===null)for(const b in this.state[f])v[b]={},this.state[f][b]={};else for(const b in this.deletedStates[f]){if(this.deletedStates[f][b]===null)this.state[f][b]={};else for(const E of Object.keys(this.deletedStates[f][b]))delete this.state[f][b][E];v[b]=this.state[f][b]}l[f]=l[f]||{},u.e(l[f],v)}this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0&&t.setFeatureState(l,a)}}const wt=89.25;function Pt(g,t){const a=u.an(t.lat,-u.ao,u.ao);return new u.P(u.Y(t.lng)*g,u.X(a)*g)}function Vt(g,t){return new u.a9(t.x/g,t.y/g).toLngLat()}function bi(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(u.ap(90-g.pitch)),Math.tan(u.ap(wt-g.pitch)))}function ci(g,t){const a=g.canonical,l=t/u.aq(a.z),f=a.x+Math.pow(2,a.z)*g.wrap,v=u.ar(new Float64Array(16));return u.O(v,v,[f*l,a.y*l,0]),u.Q(v,v,[l/u.a5,l/u.a5,1]),v}function Ie(g,t,a,l,f){const v=u.a9.fromLngLat(g,t),b=f*u.as(1,g.lat),{x:E,y:D,z:I}=Si(a,l);return new u.a9(v.x+b*-E,v.y+b*-D,v.z+b*-I)}function Si(g,t){const a=u.ap(g),l=u.ap(t),f=Math.cos(-a),v=Math.sin(a);return{x:v*Math.sin(l),y:-v*Math.cos(l),z:f}}function Cn(g,t,a){const l=t.intersectsFrustum(g);if(!a||l===0)return l;const f=t.intersectsPlane(a);return f===0?0:l===2&&f===2?2:1}function qt(g,t,a){let l=0;const f=(a-t)/10;for(let v=0;v<10;v++)l+=f*Math.pow(Math.cos(t+(v+.5)/10*(a-t)),g);return l}function Mi(g,t){return function(a,l,f,v,b){const E=2*((g-1)/u.at(Math.cos(u.ap(wt-b))/Math.cos(u.ap(wt)))-1),D=Math.acos(f/v),I=2*qt(E-1,0,u.ap(b/2)),k=Math.min(u.ap(wt),D+u.ap(b/2)),V=qt(E-1,Math.min(k,D-u.ap(b/2)),k),N=Math.atan(l/f),H=Math.hypot(l,f);let K=a;return K+=u.at(v/H/Math.max(.5,Math.cos(u.ap(b/2)))),K+=E*u.at(Math.cos(N))/2,K-=u.at(Math.max(1,V/I/t))/2,K}}const Un=Mi(9.314,3);function Di(g,t){const a=(t.roundZoom?Math.round:Math.floor)(g.zoom+u.at(g.tileSize/t.tileSize));return Math.max(0,a)}function dn(g,t){const a=g.getCameraFrustum(),l=g.getClippingPlane(),f=g.screenPointToMercatorCoordinate(g.getCameraPoint()),v=u.a9.fromLngLat(g.center,g.elevation);f.z=v.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const b=g.getCoveringTilesDetailsProvider(),E=b.allowVariableZoom(g,t),D=Di(g,t),I=t.minzoom||0,k=t.maxzoom!==void 0?t.maxzoom:g.maxZoom,V=Math.min(Math.max(0,D),k),N=Math.pow(2,V),H=[N*f.x,N*f.y,0],K=[N*v.x,N*v.y,0],re=Math.hypot(v.x-f.x,v.y-f.y),se=Math.abs(v.z-f.z),ae=Math.hypot(re,se),ue=me=>({zoom:0,x:0,y:0,wrap:me,fullyVisible:!1}),ge=[],le=[];if(g.renderWorldCopies&&b.allowWorldCopies())for(let me=1;me<=3;me++)ge.push(ue(-me)),ge.push(ue(me));for(ge.push(ue(0));ge.length>0;){const me=ge.pop(),ve=me.x,fe=me.y;let Se=me.fullyVisible;const Ne={x:ve,y:fe,z:me.zoom},Le=b.getTileBoundingVolume(Ne,me.wrap,g.elevation,t);if(!Se){const ft=Cn(a,Le,l);if(ft===0)continue;Se=ft===2}const Fe=b.distanceToTile2d(f.x,f.y,Ne,Le);let je=D;E&&(je=(t.calculateTileZoom||Un)(g.zoom+u.at(g.tileSize/t.tileSize),Fe,se,ae,g.fov)),je=(t.roundZoom?Math.round:Math.floor)(je),je=Math.max(0,je);const dt=Math.min(je,k);if(me.wrap=b.getWrap(v,Ne,me.wrap),me.zoom>=dt){if(me.zoom<I)continue;const ft=V-me.zoom,nt=H[0]-.5-(ve<<ft),gt=H[1]-.5-(fe<<ft),Gt=t.reparseOverscaled?Math.max(me.zoom,je):me.zoom;le.push({tileID:new u.a2(me.zoom===k?Gt:me.zoom,me.wrap,me.zoom,ve,fe),distanceSq:u.au([K[0]-.5-ve,K[1]-.5-fe]),tileDistanceToCamera:Math.sqrt(nt*nt+gt*gt)})}else for(let ft=0;ft<4;ft++)ge.push({zoom:me.zoom+1,x:(ve<<1)+ft%2,y:(fe<<1)+(ft>>1),wrap:me.wrap,fullyVisible:Se})}return le.sort(((me,ve)=>me.distanceSq-ve.distanceSq)).map((me=>me.tileID))}const Oi=u.aa.fromPoints([new u.P(0,0),new u.P(u.a5,u.a5)]);function Dn(g){return g==="raster"||g==="image"||g==="video"}function Ol(g,t,a,l,f,v,b){if(!t.hasData())return!1;const{tileID:E,fadingRole:D,fadingDirection:I,fadingParentID:k}=t;if(D===Te.Base&&I===Oe.Incoming&&k)return a[k.key]=k,!0;const V=Math.max(E.overscaledZ-f,v);for(let N=E.overscaledZ-1;N>=V;N--){const H=E.scaledTo(N),K=g.getLoadedTile(H);if(K)return t.setCrossFadeLogic({fadingRole:Te.Base,fadingDirection:Oe.Incoming,fadingParentID:K.tileID,fadeEndTime:l+b}),K.setCrossFadeLogic({fadingRole:Te.Parent,fadingDirection:Oe.Departing,fadeEndTime:l+b}),a[H.key]=H,!0}return!1}function Uo(g,t,a,l,f,v){if(!t.hasData())return!1;const b=t.tileID.children(f);let E=ut(g,t,b,a,l,f,v);if(E)return!0;for(const D of b)ut(g,t,D.children(f),a,l,f,v)&&(E=!0);return E}function ut(g,t,a,l,f,v,b){if(a[0].overscaledZ>=v)return!1;let E=!1;for(const D of a){const I=g.getLoadedTile(D);if(!I)continue;const{fadingRole:k,fadingDirection:V,fadingParentID:N}=I;k===Te.Base&&V===Oe.Departing&&N||(I.setCrossFadeLogic({fadingRole:Te.Base,fadingDirection:Oe.Departing,fadingParentID:t.tileID,fadeEndTime:f+b}),t.setCrossFadeLogic({fadingRole:Te.Parent,fadingDirection:Oe.Incoming,fadeEndTime:f+b})),l[D.key]=D,E=!0}return E}function gr(g,t,a,l){const f=g.tileID;return!!g.selfFading||!g.hasData()&&!!t.has(f)&&(g.setSelfFadeLogic(a+l),!0)}function yr(g,t){var a;g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let l=t.tileID.canonical.x-g.tileID.canonical.x;const f=t.tileID.canonical.y-g.tileID.canonical.y,v=Math.pow(2,g.tileID.canonical.z),b=t.tileID.key;l===0&&f===0||Math.abs(f)>1||(Math.abs(l)>1&&(Math.abs(l+v)===1?l+=v:Math.abs(l-v)===1&&(l-=v)),t.dem&&g.dem&&(g.dem.backfillBorder(t.dem,l,f),!((a=g.neighboringTiles)===null||a===void 0)&&a[b]&&(g.neighboringTiles[b].backfilled=!0)))}class ja{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const l in this._tiles){const f=this._tiles[l];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+t),a[f.tileID.key]=f}this._tiles=a}setFeatureState(t,a){for(const l in this._tiles)this._tiles[l].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(u.aw).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var l;return(l=this.getTileById(t))===null||l===void 0?void 0:l.isRenderable(a)}getRenderableIds(t=0,a){const l=[];for(const f of this.getAllIds())this.isIdRenderable(f,a)&&l.push(this.getTileById(f));return a?l.sort(((f,v)=>{const b=f.tileID,E=v.tileID,D=new u.P(b.canonical.x,b.canonical.y)._rotate(-t),I=new u.P(E.canonical.x,E.canonical.y)._rotate(-t);return b.overscaledZ-E.overscaledZ||I.y-D.y||I.x-D.x})).map((f=>f.tileID.key)):l.map((f=>f.tileID)).sort(u.aw).map((f=>f.key))}}class qi extends u.E{constructor(t,a,l){super(),this.id=t,this.dispatcher=l,this.on("data",(f=>this._dataHandler(f))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((f,v,b,E)=>{const D=new(ie(v.type))(f,v,b,E);if(D.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${D.id}`);return D})(t,a,l,this),this._inViewTiles=new ja,this._outOfViewCache=new u.ax(0,(f=>this._unloadTile(f))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new et,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new ja}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,l){return u._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,l)}catch(f){t.state="errored",f.status!==404?this._source.fire(new u.k(f,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new u.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const l=this.getLoadedTile(t.scaledTo(a));if(l)return this._inViewTiles.isIdRenderable(l.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const l of this._inViewTiles.getAllIds()){const f=this._inViewTiles.getTileById(l);a&&!this._source.shouldReloadTile(f,a)||(t?this._reloadTile(l,"expired"):f.state!=="errored"&&this._reloadTile(l,"reloading"))}}}_reloadTile(t,a){return u._(this,void 0,void 0,(function*(){const l=this._inViewTiles.getTileById(t);l&&(l.state!=="loading"&&(l.state=a),yield this._loadTile(l,t,a))}))}_tileLoaded(t,a,l){t.timeAdded=De(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(f,v){var b,E;const D=v.getRenderableIds();for(const I of D){if(!f.neighboringTiles||!f.neighboringTiles[I])continue;const k=v.getTileById(I);f.neighboringTiles[I].backfilled||yr(f,k),!((E=(b=k.neighboringTiles)===null||b===void 0?void 0:b[f.tileID.key])===null||E===void 0)&&E.backfilled||yr(k,f)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new u.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const l=this._getLoadedDescendents(a),f=new Set;for(const v of a){const b=l[v.key];if(!b?.length){f.add(v);continue}const E=v.overscaledZ+qi.maxOverzooming,D=b.filter((V=>V.tileID.overscaledZ<=E));if(!D.length){f.add(v);continue}const I=Math.min(...D.map((V=>V.tileID.overscaledZ))),k=D.filter((V=>V.tileID.overscaledZ===I)).map((V=>V.tileID));for(const V of k)t[V.key]=V;this._areDescendentsComplete(k,I,v.overscaledZ)||f.add(v)}return f}_getLoadedDescendents(t){var a;const l={};for(const f of this._inViewTiles.getAllTiles().filter((v=>v.hasData())))for(const v of t)f.tileID.isChildOf(v)&&(l[a=v.key]||(l[a]=[])).push(f);return l}_areDescendentsComplete(t,a,l){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-l)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,f=Math.floor(a*l*(this._maxTileCacheZoomLevels===null?u.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._outOfViewCache.setMaxSize(v)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((D=>new u.a2(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y))):(l=dn(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((D=>this._source.hasTile(D))))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const f=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,f&&this.fire(new u.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const v=Di(t,this._source),b=this._updateRetainedTiles(l,v),E=Dn(this._source.type);E&&this._rasterFadeDuration>0&&!a&&(function(D,I,k,V,N,H,K){const re=De(),se=u.av(I);for(const ae of I){const ue=D.getTileById(ae.key);ue.fadingDirection!==Oe.Departing&&ue.fadeOpacity!==0||ue.resetFadeLogic(),Ol(D,ue,k,re,V,N,K)||Uo(D,ue,k,re,H,K)||gr(ue,se,re,K)||ue.resetFadeLogic()}})(this._inViewTiles,l,b,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),E?this._cleanUpRasterTiles(b):this._cleanUpVectorTiles(b)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(a);t[a]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(a):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const l of t)if(l.canonical.z>this._source.minzoom){const f=l.scaledTo(l.canonical.z-1);a.push(f);const v=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));a.push(v)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var l;const f=new Set;for(const I of t)this._addTile(I).hasData()||f.add(I);const v=t.reduce(((I,k)=>(I[k.key]=k,I)),{}),b=this._retainLoadedChildren(v,f),E={},D=Math.max(a-qi.maxUnderzooming,this._source.minzoom);for(const I of b){let k=this._inViewTiles.getTileById(I.key),V=k?.wasRequested();for(let N=I.overscaledZ-1;N>=D;--N){const H=I.scaledTo(N);if(E[H.key])break;if(E[H.key]=!0,k=this.getTile(H),!k&&V&&(k=this._addTile(H)),k){const K=k.hasData();if((K||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||V)&&(v[H.key]=H),V=k.wasRequested(),K)break}}}return v}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const l=a;return a||(a=new Je(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),l||this._source.fire(new u.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const l=a.getExpiryTimeout();l&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),l))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||l.state=="errored")&&t.some((f=>f.equals(l.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,l){const f=[],v=this.transform;if(!v)return f;const b=v.getCoveringTilesDetailsProvider().allowWorldCopies(),E=l?v.getCameraQueryGeometry(t):t,D=H=>v.screenPointToMercatorCoordinate(H,this.terrain),I=this.transformBbox(t,D,!b),k=this.transformBbox(E,D,!b),V=this.getIds(),N=u.aa.fromPoints(k);for(let H=0;H<V.length;H++){const K=this._inViewTiles.getTileById(V[H]);if(K.holdingForSymbolFade())continue;const re=b?[K.tileID]:[K.tileID.unwrapTo(-1),K.tileID.unwrapTo(0)],se=Math.pow(2,v.zoom-K.tileID.overscaledZ),ae=a*K.queryPadding*u.a5/K.tileSize/se;for(const ue of re){const ge=N.map((le=>ue.getTilePoint(new u.a9(le.x,le.y))));if(ge.expandBy(ae),ge.intersects(Oi)){const le=I.map((ve=>ue.getTilePoint(ve))),me=k.map((ve=>ue.getTilePoint(ve)));f.push({tile:K,tileID:b?ue:ue.unwrapTo(0),queryGeometry:le,cameraQueryGeometry:me,scale:se})}}}return f}transformBbox(t,a,l){let f=t.map(a);if(l){const v=u.aa.fromPoints(t);v.shrinkBy(.001*Math.min(v.width(),v.height()));const b=v.map(a);u.aa.fromPoints(f).covers(b)||(f=f.map((E=>E.x>.5?new u.a9(E.x-1,E.y,E.z):E)))}return f}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((l=>this._inViewTiles.getTileById(l).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!Dn(this._source.type)||!(function(t,a){if(a<=0)return!1;const l=De();for(const f of t.getAllTiles())if(f.fadeEndTime>=l)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,l){this._state.updateState(t=t||u.ai,a,l)}removeFeatureState(t,a,l){this._state.removeFeatureState(t=t||u.ai,a,l)}getFeatureState(t,a){return this._state.getState(t=t||u.ai,a)}setDependencies(t,a,l){const f=this._inViewTiles.getTileById(t);f&&f.setDependencies(a,l)}reloadTilesForDependencies(t,a){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).hasDependency(t,a)&&this._reloadTile(l,"reloading");this._outOfViewCache.filter((l=>!l.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}qi.maxUnderzooming=10,qi.maxOverzooming=3;class pt{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=u.an(t,0,1);let a=1,l=this._distances[a];const f=t*this.paddedLength+this.padding;for(;l<f&&a<this._distances.length;)l=this._distances[++a];const v=a-1,b=this._distances[v],E=l-b,D=E>0?(f-b)/E:0;return this.points[v].mult(1-D).add(this.points[a].mult(D))}}function Ht(g,t){let a=!0;return g==="always"||g!=="never"&&t!=="never"||(a=!1),a}class Jt{constructor(t,a,l){const f=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(a/l);for(let b=0;b<this.xCellCount*this.yCellCount;b++)f.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,l,f,v){this._forEachCell(a,l,f,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(v)}insertCircle(t,a,l,f){this._forEachCell(a-f,l-f,a+f,l+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(l),this.circles.push(f)}_insertBoxCell(t,a,l,f,v,b){this.boxCells[v].push(b)}_insertCircleCell(t,a,l,f,v,b){this.circleCells[v].push(b)}_query(t,a,l,f,v,b,E){if(l<0||t>this.width||f<0||a>this.height)return[];const D=[];if(t<=0&&a<=0&&this.width<=l&&this.height<=f){if(v)return[{key:null,x1:t,y1:a,x2:l,y2:f}];for(let I=0;I<this.boxKeys.length;I++)D.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const k=this.circles[3*I],V=this.circles[3*I+1],N=this.circles[3*I+2];D.push({key:this.circleKeys[I],x1:k-N,y1:V-N,x2:k+N,y2:V+N})}}else this._forEachCell(t,a,l,f,this._queryCell,D,{hitTest:v,overlapMode:b,seenUids:{box:{},circle:{}}},E);return D}query(t,a,l,f){return this._query(t,a,l,f,!1,null)}hitTest(t,a,l,f,v,b){return this._query(t,a,l,f,!0,v,b).length>0}hitTestCircle(t,a,l,f,v){const b=t-l,E=t+l,D=a-l,I=a+l;if(E<0||b>this.width||I<0||D>this.height)return!1;const k=[];return this._forEachCell(b,D,E,I,this._queryCellCircle,k,{hitTest:!0,overlapMode:f,circle:{x:t,y:a,radius:l},seenUids:{box:{},circle:{}}},v),k.length>0}_queryCell(t,a,l,f,v,b,E,D){const{seenUids:I,hitTest:k,overlapMode:V}=E,N=this.boxCells[v];if(N!==null){const K=this.bboxes;for(const re of N)if(!I.box[re]){I.box[re]=!0;const se=4*re,ae=this.boxKeys[re];if(t<=K[se+2]&&a<=K[se+3]&&l>=K[se+0]&&f>=K[se+1]&&(!D||D(ae))&&(!k||!Ht(V,ae.overlapMode))&&(b.push({key:ae,x1:K[se],y1:K[se+1],x2:K[se+2],y2:K[se+3]}),k))return!0}}const H=this.circleCells[v];if(H!==null){const K=this.circles;for(const re of H)if(!I.circle[re]){I.circle[re]=!0;const se=3*re,ae=this.circleKeys[re];if(this._circleAndRectCollide(K[se],K[se+1],K[se+2],t,a,l,f)&&(!D||D(ae))&&(!k||!Ht(V,ae.overlapMode))){const ue=K[se],ge=K[se+1],le=K[se+2];if(b.push({key:ae,x1:ue-le,y1:ge-le,x2:ue+le,y2:ge+le}),k)return!0}}}return!1}_queryCellCircle(t,a,l,f,v,b,E,D){const{circle:I,seenUids:k,overlapMode:V}=E,N=this.boxCells[v];if(N!==null){const K=this.bboxes;for(const re of N)if(!k.box[re]){k.box[re]=!0;const se=4*re,ae=this.boxKeys[re];if(this._circleAndRectCollide(I.x,I.y,I.radius,K[se+0],K[se+1],K[se+2],K[se+3])&&(!D||D(ae))&&!Ht(V,ae.overlapMode))return b.push(!0),!0}}const H=this.circleCells[v];if(H!==null){const K=this.circles;for(const re of H)if(!k.circle[re]){k.circle[re]=!0;const se=3*re,ae=this.circleKeys[re];if(this._circlesCollide(K[se],K[se+1],K[se+2],I.x,I.y,I.radius)&&(!D||D(ae))&&!Ht(V,ae.overlapMode))return b.push(!0),!0}}}_forEachCell(t,a,l,f,v,b,E,D){const I=this._convertToXCellCoord(t),k=this._convertToYCellCoord(a),V=this._convertToXCellCoord(l),N=this._convertToYCellCoord(f);for(let H=I;H<=V;H++)for(let K=k;K<=N;K++)if(v.call(this,t,a,l,f,this.xCellCount*K+H,b,E,D))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,l,f,v,b){const E=f-t,D=v-a,I=l+b;return I*I>E*E+D*D}_circleAndRectCollide(t,a,l,f,v,b,E){const D=(b-f)/2,I=Math.abs(t-(f+D));if(I>D+l)return!1;const k=(E-v)/2,V=Math.abs(a-(v+k));if(V>k+l)return!1;if(I<=D||V<=k)return!0;const N=I-D,H=V-k;return N*N+H*H<=l*l}}function Qr(g,t,a){const l=u.N();if(!g){const{vecSouth:V,vecEast:N}=as(t),H=Z();H[0]=N[0],H[1]=N[1],H[2]=V[0],H[3]=V[1],f=H,(k=(b=(v=H)[0])*(I=v[3])-(D=v[2])*(E=v[1]))&&(f[0]=I*(k=1/k),f[1]=-E*k,f[2]=-D*k,f[3]=b*k),l[0]=H[0],l[1]=H[1],l[4]=H[2],l[5]=H[3]}var f,v,b,E,D,I,k;return u.Q(l,l,[1/a,1/a,1]),l}function Rc(g,t,a,l){if(g){const f=u.N();if(!t){const{vecSouth:v,vecEast:b}=as(a);f[0]=b[0],f[1]=b[1],f[4]=v[0],f[5]=v[1]}return u.Q(f,f,[l,l,1]),f}return a.pixelsToClipSpaceMatrix}function as(g){const t=Math.cos(g.rollInRadians),a=Math.sin(g.rollInRadians),l=Math.cos(g.pitchInRadians),f=Math.cos(g.bearingInRadians),v=Math.sin(g.bearingInRadians),b=u.aC();b[0]=-f*l*a-v*t,b[1]=-v*l*a+f*t;const E=u.aD(b);E<1e-9?u.aE(b):u.aF(b,b,1/E);const D=u.aC();D[0]=f*l*t-v*a,D[1]=v*l*t+f*a;const I=u.aD(D);return I<1e-9?u.aE(D):u.aF(D,D,1/I),{vecEast:D,vecSouth:b}}function Zt(g,t,a,l){let f;l?(f=[g,t,l(g,t),1],u.aH(f,f,a)):(f=[g,t,0,1],ya(f,f,a));const v=f[3];return{point:new u.P(f[0]/v,f[1]/v),signedDistanceFromCamera:v,isOccluded:!1}}function Go(g,t){return .5+g/t*.5}function ss(g,t){return g.x>=-t[0]&&g.x<=t[0]&&g.y>=-t[1]&&g.y<=t[1]}function Bs(g,t,a,l,f,v,b,E,D,I,k,V,N){const H=a?g.textSizeData:g.iconSizeData,K=u.ay(H,t.transform.zoom),re=[256/t.width*2+1,256/t.height*2+1],se=a?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;se.clear();const ae=g.lineVertexArray,ue=a?g.text.placedSymbolArray:g.icon.placedSymbolArray,ge=t.transform.width/t.transform.height;let le=!1;for(let me=0;me<ue.length;me++){const ve=ue.get(me);if(ve.hidden||ve.writingMode===u.az.vertical&&!le){us(ve.numGlyphs,se);continue}le=!1;const fe=new u.P(ve.anchorX,ve.anchorY),Se={getElevation:N,pitchedLabelPlaneMatrix:l,lineVertexArray:ae,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:fe,unwrappedTileID:D,width:I,height:k,translation:V},Ne=jl(ve.anchorX,ve.anchorY,Se);if(!ss(Ne.point,re)){us(ve.numGlyphs,se);continue}const Le=Go(t.transform.cameraToCenterDistance,Ne.signedDistanceFromCamera),Fe=u.aA(H,K,ve),je=v?Fe*t.transform.getPitchedTextCorrection(ve.anchorX,ve.anchorY,D)/Le:Fe*Le,dt=fn({projectionContext:Se,pitchedLabelPlaneMatrixInverse:f,symbol:ve,fontSize:je,flip:!1,keepUpright:b,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:se,aspectRatio:ge,rotateToLine:E});le=dt.useVertical,(dt.notEnoughRoom||le||dt.needsFlipping&&fn({projectionContext:Se,pitchedLabelPlaneMatrixInverse:f,symbol:ve,fontSize:je,flip:!0,keepUpright:b,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:se,aspectRatio:ge,rotateToLine:E}).notEnoughRoom)&&us(ve.numGlyphs,se)}a?g.text.dynamicLayoutVertexBuffer.updateData(se):g.icon.dynamicLayoutVertexBuffer.updateData(se)}function os(g,t,a,l,f,v,b,E){const D=v.glyphStartIndex+v.numGlyphs,I=v.lineStartIndex,k=v.lineStartIndex+v.lineLength,V=t.getoffsetX(v.glyphStartIndex),N=t.getoffsetX(D-1),H=Na(g*V,a,l,f,v.segment,I,k,E,b);if(!H)return null;const K=Na(g*N,a,l,f,v.segment,I,k,E,b);return K?E.projectionCache.anyProjectionOccluded?null:{first:H,last:K}:null}function ls(g,t,a,l){return g===u.az.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*l?{useVertical:!0}:(g===u.az.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function fn(g){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:l,fontSize:f,flip:v,keepUpright:b,glyphOffsetArray:E,dynamicLayoutVertexArray:D,aspectRatio:I,rotateToLine:k}=g,V=f/24,N=l.lineOffsetX*V,H=l.lineOffsetY*V;let K;if(l.numGlyphs>1){const re=l.glyphStartIndex+l.numGlyphs,se=l.lineStartIndex,ae=l.lineStartIndex+l.lineLength,ue=os(V,E,N,H,v,l,k,t);if(!ue)return{notEnoughRoom:!0};const ge=Os(ue.first.point.x,ue.first.point.y,t,a),le=Os(ue.last.point.x,ue.last.point.y,t,a);if(b&&!v){const me=ls(l.writingMode,ge,le,I);if(me)return me}K=[ue.first];for(let me=l.glyphStartIndex+1;me<re-1;me++){const ve=Na(V*E.getoffsetX(me),N,H,v,l.segment,se,ae,t,k);if(!ve)return{notEnoughRoom:!0};K.push(ve)}K.push(ue.last)}else{if(b&&!v){const se=hi(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,ae=l.lineStartIndex+l.segment+1,ue=new u.P(t.lineVertexArray.getx(ae),t.lineVertexArray.gety(ae)),ge=hi(ue.x,ue.y,t),le=ge.signedDistanceFromCamera>0?ge.point:Fl(t.tileAnchorPoint,ue,se,1,t),me=Os(se.x,se.y,t,a),ve=Os(le.x,le.y,t,a),fe=ls(l.writingMode,me,ve,I);if(fe)return fe}const re=Na(V*E.getoffsetX(l.glyphStartIndex),N,H,v,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,t,k);if(!re||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};K=[re]}for(const re of K)u.aG(D,re.point,re.angle);return{}}function Fl(g,t,a,l,f){const v=g.add(g.sub(t)._unit()),b=hi(v.x,v.y,f).point,E=a.sub(b);return a.add(E._mult(l/E.mag()))}function _r(g,t,a){const l=t.projectionCache;if(l.projections[g])return l.projections[g];const f=new u.P(t.lineVertexArray.getx(g),t.lineVertexArray.gety(g)),v=hi(f.x,f.y,t);if(v.signedDistanceFromCamera>0)return l.projections[g]=v.point,l.anyProjectionOccluded=l.anyProjectionOccluded||v.isOccluded,v.point;const b=g-a.direction;return Fl(a.distanceFromAnchor===0?t.tileAnchorPoint:new u.P(t.lineVertexArray.getx(b),t.lineVertexArray.gety(b)),f,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function hi(g,t,a){const l=g+a.translation[0],f=t+a.translation[1];let v;return a.pitchWithMap?(v=Zt(l,f,a.pitchedLabelPlaneMatrix,a.getElevation),v.isOccluded=!1):(v=a.transform.projectTileCoordinates(l,f,a.unwrappedTileID,a.getElevation),v.point.x=(.5*v.point.x+.5)*a.width,v.point.y=(.5*-v.point.y+.5)*a.height),v}function Os(g,t,a,l){if(a.pitchWithMap){const f=[g,t,0,1];return u.aH(f,f,l),a.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],a.unwrappedTileID,a.getElevation).point}return{x:g/a.width*2-1,y:1-t/a.height*2}}function jl(g,t,a){return a.transform.projectTileCoordinates(g,t,a.unwrappedTileID,a.getElevation)}function Nl(g,t,a){return g._unit()._perp()._mult(t*a)}function lo(g,t,a,l,f,v,b,E,D){if(E.projectionCache.offsets[g])return E.projectionCache.offsets[g];const I=a.add(t);if(g+D.direction<l||g+D.direction>=f)return E.projectionCache.offsets[g]=I,I;const k=_r(g+D.direction,E,D),V=Nl(k.sub(a),b,D.direction),N=a.add(V),H=k.add(V);return E.projectionCache.offsets[g]=u.aI(v,I,N,H)||I,E.projectionCache.offsets[g]}function Na(g,t,a,l,f,v,b,E,D){const I=l?g-t:g+t;let k=I>0?1:-1,V=0;l&&(k*=-1,V=Math.PI),k<0&&(V+=Math.PI);let N,H=k>0?v+f:v+f+1;E.projectionCache.cachedAnchorPoint?N=E.projectionCache.cachedAnchorPoint:(N=hi(E.tileAnchorPoint.x,E.tileAnchorPoint.y,E).point,E.projectionCache.cachedAnchorPoint=N);let K,re,se=N,ae=N,ue=0,ge=0;const le=Math.abs(I),me=[];let ve;for(;ue+ge<=le;){if(H+=k,H<v||H>=b)return null;ue+=ge,ae=se,re=K;const Ne={absOffsetX:le,direction:k,distanceFromAnchor:ue,previousVertex:ae};if(se=_r(H,E,Ne),a===0)me.push(ae),ve=se.sub(ae);else{let Le;const Fe=se.sub(ae);Le=Fe.mag()===0?Nl(_r(H+k,E,Ne).sub(se),a,k):Nl(Fe,a,k),re||(re=ae.add(Le)),K=lo(H,Le,se,v,b,re,a,E,Ne),me.push(re),ve=K.sub(re)}ge=ve.mag()}const fe=ve._mult((le-ue)/ge)._add(re||ae),Se=V+Math.atan2(se.y-ae.y,se.x-ae.x);return me.push(fe),{point:fe,angle:D?Se:0,path:me}}const Pu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function us(g,t){for(let a=0;a<g;a++){const l=t.length;t.resize(l+4),t.float32.set(Pu,3*l)}}function ya(g,t,a){const l=t[0],f=t[1];return g[0]=a[0]*l+a[4]*f+a[12],g[1]=a[1]*l+a[5]*f+a[13],g[3]=a[3]*l+a[7]*f+a[15],g}const yi=100;class kh{constructor(t,a=new Jt(t.width+200,t.height+200,25),l=new Jt(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+yi,this.screenBottomBoundary=t.height+yi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,l,f,v,b,E,D,I,k,V,N){const H=this.projectAndGetPerspectiveRatio(t.anchorPointX+D[0],t.anchorPointY+D[1],v,k,N),K=l*H.perspectiveRatio;let re;if(b||E)re=this._projectCollisionBox(t,K,f,v,b,E,D,H,k,V,N);else{const ve=H.x+(V?V.x*K:0),fe=H.y+(V?V.y*K:0);re={allPointsOccluded:!1,box:[ve+t.x1*K,fe+t.y1*K,ve+t.x2*K,fe+t.y2*K]}}const[se,ae,ue,ge]=re.box,le=b?re.allPointsOccluded:H.isOccluded;let me=le;return me||(me=H.perspectiveRatio<this.perspectiveRatioCutoff),me||(me=!this.isInsideGrid(se,ae,ue,ge)),me||a!=="always"&&this.grid.hitTest(se,ae,ue,ge,a,I)?{box:[se,ae,ue,ge],placeable:!1,offscreen:!1,occluded:le}:{box:[se,ae,ue,ge],placeable:!0,offscreen:this.isOffscreen(se,ae,ue,ge),occluded:le}}placeCollisionCircles(t,a,l,f,v,b,E,D,I,k,V,N,H,K){const re=[],se=new u.P(a.anchorX,a.anchorY),ae=this.getPerspectiveRatio(se.x,se.y,b,K),ue=(I?v*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,b)/ae:v*ae)/u.aM,ge={getElevation:K,pitchedLabelPlaneMatrix:E,lineVertexArray:l,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:se,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:H},le=os(ue,f,a.lineOffsetX*ue,a.lineOffsetY*ue,!1,a,!1,ge);let me=!1,ve=!1,fe=!0;if(le){const Se=.5*V*ae+N,Ne=new u.P(-100,-100),Le=new u.P(this.screenRightBoundary,this.screenBottomBoundary),Fe=new pt,je=le.first,dt=le.last;let ft=[];for(let Gt=je.path.length-1;Gt>=1;Gt--)ft.push(je.path[Gt]);for(let Gt=1;Gt<dt.path.length;Gt++)ft.push(dt.path[Gt]);const nt=2.5*Se;if(I){const Gt=this.projectPathToScreenSpace(ft,ge);ft=Gt.some((Ti=>Ti.signedDistanceFromCamera<=0))?[]:Gt.map((Ti=>Ti.point))}let gt=[];if(ft.length>0){const Gt=ft[0].clone(),Ti=ft[0].clone();for(let Zi=1;Zi<ft.length;Zi++)Gt.x=Math.min(Gt.x,ft[Zi].x),Gt.y=Math.min(Gt.y,ft[Zi].y),Ti.x=Math.max(Ti.x,ft[Zi].x),Ti.y=Math.max(Ti.y,ft[Zi].y);gt=Gt.x>=Ne.x&&Ti.x<=Le.x&&Gt.y>=Ne.y&&Ti.y<=Le.y?[ft]:Ti.x<Ne.x||Gt.x>Le.x||Ti.y<Ne.y||Gt.y>Le.y?[]:u.aJ([ft],Ne.x,Ne.y,Le.x,Le.y)}for(const Gt of gt){Fe.reset(Gt,.25*Se);let Ti=0;Ti=Fe.length<=.5*Se?1:Math.ceil(Fe.paddedLength/nt)+1;for(let Zi=0;Zi<Ti;Zi++){const Ni=Zi/Math.max(Ti-1,1),Wi=Fe.lerp(Ni),zi=Wi.x+yi,un=Wi.y+yi;re.push(zi,un,Se,0);const Ki=zi-Se,Jn=un-Se,yn=zi+Se,_n=un+Se;if(fe=fe&&this.isOffscreen(Ki,Jn,yn,_n),ve=ve||this.isInsideGrid(Ki,Jn,yn,_n),t!=="always"&&this.grid.hitTestCircle(zi,un,Se,t,k)&&(me=!0,!D))return{circles:[],offscreen:!1,collisionDetected:me}}}}return{circles:!D&&me||!ve||ae<this.perspectiveRatioCutoff?[]:re,offscreen:fe,collisionDetected:me}}projectPathToScreenSpace(t,a){const l=(function(f,v){const b=u.N();return u.aB(b,v.pitchedLabelPlaneMatrix),f.map((E=>{const D=Zt(E.x,E.y,b,v.getElevation),I=v.transform.projectTileCoordinates(D.point.x,D.point.y,v.unwrappedTileID,v.getElevation);return I.point.x=(.5*I.point.x+.5)*v.width,I.point.y=(.5*-I.point.y+.5)*v.height,I}))})(t,a);return(function(f){let v=0,b=0,E=0,D=0;for(let I=0;I<f.length;I++)f[I].isOccluded?(E=I+1,D=0):(D++,D>b&&(b=D,v=E));return f.slice(v,v+b)})(l)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],l=new u.aa;for(const V of t){const N=new u.P(V.x+yi,V.y+yi);l.extend(N),a.push(N)}const{minX:f,minY:v,maxX:b,maxY:E}=l,D=this.grid.query(f,v,b,E).concat(this.ignoredGrid.query(f,v,b,E)),I={},k={};for(const V of D){const N=V.key;if(I[N.bucketInstanceId]===void 0&&(I[N.bucketInstanceId]={}),I[N.bucketInstanceId][N.featureIndex])continue;const H=[new u.P(V.x1,V.y1),new u.P(V.x2,V.y1),new u.P(V.x2,V.y2),new u.P(V.x1,V.y2)];u.aK(a,H)&&(I[N.bucketInstanceId][N.featureIndex]=!0,k[N.bucketInstanceId]===void 0&&(k[N.bucketInstanceId]=[]),k[N.bucketInstanceId].push(N.featureIndex))}return k}insertCollisionBox(t,a,l,f,v,b){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:v,collisionGroupID:b,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,l,f,v,b){const E=l?this.ignoredGrid:this.grid,D={bucketInstanceId:f,featureIndex:v,collisionGroupID:b,overlapMode:a};for(let I=0;I<t.length;I+=4)E.insertCircle(D,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,a,l,f,v){if(v){let b;f?(b=[t,a,f(t,a),1],u.aH(b,b,v)):(b=[t,a,0,1],ya(b,b,v));const E=b[3];return{x:(b[0]/E+1)/2*this.transform.width+yi,y:(-b[1]/E+1)/2*this.transform.height+yi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/E*.5,isOccluded:!1,signedDistanceFromCamera:E}}{const b=this.transform.projectTileCoordinates(t,a,l,f);return{x:(b.point.x+1)/2*this.transform.width+yi,y:(1-b.point.y)/2*this.transform.height+yi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5,isOccluded:b.isOccluded,signedDistanceFromCamera:b.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,l,f){const v=this.transform.projectTileCoordinates(t,a,l,f);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(t,a,l,f){return l<yi||t>=this.screenRightBoundary||f<yi||a>this.screenBottomBoundary}isInsideGrid(t,a,l,f){return l>=0&&t<this.gridRightBoundary&&f>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=u.ar([]);return u.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,l,f,v,b,E,D,I,k,V){let N=1,H=0,K=0,re=1;const se=t.anchorPointX+E[0],ae=t.anchorPointY+E[1];if(b&&!v){const ft=this.projectAndGetPerspectiveRatio(se+1,ae,f,I,V),nt=ft.x-D.x,gt=Math.atan((ft.y-D.y)/nt)+(nt<0?Math.PI:0),Gt=Math.sin(gt),Ti=Math.cos(gt);N=Ti,H=Gt,K=-Gt,re=Ti}else if(!b&&v){const ft=as(this.transform);N=ft.vecEast[0],H=ft.vecEast[1],K=ft.vecSouth[0],re=ft.vecSouth[1]}let ue=D.x,ge=D.y,le=a;v&&(ue=se,ge=ae,le=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),le*=this.transform.getPitchedTextCorrection(se,ae,f),k||(le*=u.an(.5+D.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),k&&(ue+=N*k.x*le+K*k.y*le,ge+=H*k.x*le+re*k.y*le);const me=t.x1*le,ve=t.x2*le,fe=(me+ve)/2,Se=t.y1*le,Ne=t.y2*le,Le=(Se+Ne)/2,Fe=[{offsetX:me,offsetY:Se},{offsetX:fe,offsetY:Se},{offsetX:ve,offsetY:Se},{offsetX:ve,offsetY:Le},{offsetX:ve,offsetY:Ne},{offsetX:fe,offsetY:Ne},{offsetX:me,offsetY:Ne},{offsetX:me,offsetY:Le}];let je=[];for(const{offsetX:ft,offsetY:nt}of Fe)je.push(new u.P(ue+N*ft+K*nt,ge+H*ft+re*nt));let dt=!1;if(v){const ft=je.map((nt=>this.projectAndGetPerspectiveRatio(nt.x,nt.y,f,I,V)));dt=ft.some((nt=>!nt.isOccluded)),je=ft.map((nt=>new u.P(nt.x,nt.y)))}else dt=!0;return{box:u.aL(je),allPointsOccluded:!dt}}}class Qd{constructor(t,a,l,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):f&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class qo{constructor(t,a,l,f,v){this.text=new Qd(t?t.text:null,a,l,v),this.icon=new Qd(t?t.icon:null,a,f,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Bh{constructor(t,a,l){this.text=t,this.icon=a,this.skipFade=l}}class zu{constructor(t,a,l,f,v){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=l,this.bucketIndex=f,this.tileID=v}}class Jd{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:l=>l.collisionGroupID===a}}return this.collisionGroups[t]}}function Ar(g,t,a,l,f){const{horizontalAlign:v,verticalAlign:b}=u.aS(g);return new u.P(-(v-.5)*t+l[0]*f,-(b-.5)*a+l[1]*f)}class Ru{constructor(t,a,l,f,v){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new kh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Jd(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(l,f)=>a.getElevation(t,l,f):null}getBucketParts(t,a,l,f){const v=l.getBucket(a),b=l.latestFeatureIndex;if(!v||!b||a.id!==v.layerIds[0])return;const E=l.collisionBoxArray,D=v.layers[0].layout,I=v.layers[0].paint,k=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),V=l.tileSize/u.a5,N=l.tileID.toUnwrapped(),H=D.get("text-rotation-alignment")==="map",K=u.aN(l,1,this.transform.zoom),re=u.aO(this.collisionIndex.transform,l,I.get("text-translate"),I.get("text-translate-anchor")),se=u.aO(this.collisionIndex.transform,l,I.get("icon-translate"),I.get("icon-translate-anchor")),ae=Qr(H,this.transform,K);this.retainedQueryData[v.bucketInstanceId]=new zu(v.bucketInstanceId,b,v.sourceLayerIndex,v.index,l.tileID);const ue={bucket:v,layout:D,translationText:re,translationIcon:se,unwrappedTileID:N,pitchedLabelPlaneMatrix:ae,scale:k,textPixelRatio:V,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:u.ay(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(f)for(const ge of v.sortKeyRanges){const{sortKey:le,symbolInstanceStart:me,symbolInstanceEnd:ve}=ge;t.push({sortKey:le,symbolInstanceStart:me,symbolInstanceEnd:ve,parameters:ue})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(t,a,l,f,v,b,E,D,I,k,V,N,H,K,re,se,ae,ue,ge,le){const me=u.aP[t.textAnchor],ve=[t.textOffset0,t.textOffset1],fe=Ar(me,l,f,ve,v),Se=this.collisionIndex.placeCollisionBox(a,N,D,I,k,E,b,se,V.predicate,ge,fe,le);if((!ue||this.collisionIndex.placeCollisionBox(ue,N,D,I,k,E,b,ae,V.predicate,ge,fe,le).placeable)&&Se.placeable){let Ne;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(Ne=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:ve,width:l,height:f,anchor:me,textBoxScale:v,prevAnchor:Ne},this.markUsedJustification(K,me,H,re),K.allowVerticalPlacement&&(this.markUsedOrientation(K,re,H),this.placedOrientations[H.crossTileID]=re),{shift:fe,placedGlyphBoxes:Se}}}placeLayerBucketPart(t,a,l){const{bucket:f,layout:v,translationText:b,translationIcon:E,unwrappedTileID:D,pitchedLabelPlaneMatrix:I,textPixelRatio:k,holdingForFade:V,collisionBoxArray:N,partiallyEvaluatedTextSize:H,collisionGroup:K}=t.parameters,re=v.get("text-optional"),se=v.get("icon-optional"),ae=u.aQ(v,"text-overlap","text-allow-overlap"),ue=ae==="always",ge=u.aQ(v,"icon-overlap","icon-allow-overlap"),le=ge==="always",me=v.get("text-rotation-alignment")==="map",ve=v.get("text-pitch-alignment")==="map",fe=v.get("icon-text-fit")!=="none",Se=v.get("symbol-z-order")==="viewport-y",Ne=ue&&(le||!f.hasIconData()||se),Le=le&&(ue||!f.hasTextData()||re);!f.collisionArrays&&N&&f.deserializeCollisionBoxes(N);const Fe=this.retainedQueryData[f.bucketInstanceId].tileID,je=this._getTerrainElevationFunc(Fe),dt=this.transform.getFastPathSimpleProjectionMatrix(Fe),ft=(nt,gt,Gt)=>{var Ti,Zi;if(a[nt.crossTileID])return;if(V)return void(this.placements[nt.crossTileID]=new Bh(!1,!1,!1));let Ni=!1,Wi=!1,zi=!0,un=null,Ki={box:null,placeable:!1,offscreen:null,occluded:!1},Jn={placeable:!1},yn=null,_n=null,er=null,Cs=0,Ds=0,Ya=0;gt.textFeatureIndex?Cs=gt.textFeatureIndex:nt.useRuntimeCollisionCircles&&(Cs=nt.featureIndex),gt.verticalTextFeatureIndex&&(Ds=gt.verticalTextFeatureIndex);const Gr=gt.textBox;if(Gr){const qr=Ai=>{let Vi=u.az.horizontal;if(f.allowVerticalPlacement&&!Ai&&this.prevPlacement){const Rn=this.prevPlacement.placedOrientations[nt.crossTileID];Rn&&(this.placedOrientations[nt.crossTileID]=Rn,Vi=Rn,this.markUsedOrientation(f,Vi,nt))}return Vi},ua=(Ai,Vi)=>{if(f.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&gt.verticalTextBox){for(const Rn of f.writingModes)if(Rn===u.az.vertical?(Ki=Vi(),Jn=Ki):Ki=Ai(),Ki&&Ki.placeable)break}else Ki=Ai()},Ca=nt.textAnchorOffsetStartIndex,Da=nt.textAnchorOffsetEndIndex;if(Da===Ca){const Ai=(Vi,Rn)=>{const Fn=this.collisionIndex.placeCollisionBox(Vi,ae,k,Fe,D,ve,me,b,K.predicate,je,void 0,dt);return Fn&&Fn.placeable&&(this.markUsedOrientation(f,Rn,nt),this.placedOrientations[nt.crossTileID]=Rn),Fn};ua((()=>Ai(Gr,u.az.horizontal)),(()=>{const Vi=gt.verticalTextBox;return f.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&Vi?Ai(Vi,u.az.vertical):{box:null,offscreen:null}})),qr(Ki&&Ki.placeable)}else{let Ai=u.aP[(Zi=(Ti=this.prevPlacement)===null||Ti===void 0?void 0:Ti.variableOffsets[nt.crossTileID])===null||Zi===void 0?void 0:Zi.anchor];const Vi=(Fn,sh,oh)=>{const Do=Fn.x2-Fn.x1,_f=Fn.y2-Fn.y1,Po=nt.textBoxScale,lh=fe&&ge==="never"?sh:null;let Ks=null,Qs=ae==="never"?1:2,Ka="never";Ai&&Qs++;for(let uh=0;uh<Qs;uh++){for(let pc=Ca;pc<Da;pc++){const mc=f.textAnchorOffsets.get(pc);if(Ai&&mc.textAnchor!==Ai)continue;const gc=this.attemptAnchorPlacement(mc,Fn,Do,_f,Po,me,ve,k,Fe,D,K,Ka,nt,f,oh,b,E,lh,je);if(gc&&(Ks=gc.placedGlyphBoxes,Ks&&Ks.placeable))return Ni=!0,un=gc.shift,Ks}Ai?Ai=null:Ka=ae}return l&&!Ks&&(Ks={box:this.collisionIndex.placeCollisionBox(Gr,"always",k,Fe,D,ve,me,b,K.predicate,je,void 0,dt).box,offscreen:!1,placeable:!1,occluded:!1}),Ks};ua((()=>Vi(Gr,gt.iconBox,u.az.horizontal)),(()=>{const Fn=gt.verticalTextBox;return f.allowVerticalPlacement&&(!Ki||!Ki.placeable)&&nt.numVerticalGlyphVertices>0&&Fn?Vi(Fn,gt.verticalIconBox,u.az.vertical):{box:null,occluded:!0,offscreen:null}})),Ki&&(Ni=Ki.placeable,zi=Ki.offscreen);const Rn=qr(Ki&&Ki.placeable);if(!Ni&&this.prevPlacement){const Fn=this.prevPlacement.variableOffsets[nt.crossTileID];Fn&&(this.variableOffsets[nt.crossTileID]=Fn,this.markUsedJustification(f,Fn.anchor,nt,Rn))}}}if(yn=Ki,Ni=yn&&yn.placeable,zi=yn&&yn.offscreen,nt.useRuntimeCollisionCircles&&nt.centerJustifiedTextSymbolIndex>=0){const qr=f.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex),ua=u.aA(f.textSizeData,H,qr),Ca=v.get("text-padding");_n=this.collisionIndex.placeCollisionCircles(ae,qr,f.lineVertexArray,f.glyphOffsetArray,ua,D,I,l,ve,K.predicate,nt.collisionCircleDiameter,Ca,b,je),_n.circles.length&&_n.collisionDetected&&!l&&u.w("Collisions detected, but collision boxes are not shown"),Ni=ue||_n.circles.length>0&&!_n.collisionDetected,zi=zi&&_n.offscreen}if(gt.iconFeatureIndex&&(Ya=gt.iconFeatureIndex),gt.iconBox){const qr=ua=>this.collisionIndex.placeCollisionBox(ua,ge,k,Fe,D,ve,me,E,K.predicate,je,fe&&un?un:void 0,dt);Jn&&Jn.placeable&&gt.verticalIconBox?(er=qr(gt.verticalIconBox),Wi=er.placeable):(er=qr(gt.iconBox),Wi=er.placeable),zi=zi&&er.offscreen}const pl=re||nt.numHorizontalGlyphVertices===0&&nt.numVerticalGlyphVertices===0,uu=se||nt.numIconVertices===0;pl||uu?uu?pl||(Wi=Wi&&Ni):Ni=Wi&&Ni:Wi=Ni=Wi&&Ni;const Wa=Wi&&er.placeable;if(Ni&&yn.placeable&&this.collisionIndex.insertCollisionBox(yn.box,ae,v.get("text-ignore-placement"),f.bucketInstanceId,Jn&&Jn.placeable&&Ds?Ds:Cs,K.ID),Wa&&this.collisionIndex.insertCollisionBox(er.box,ge,v.get("icon-ignore-placement"),f.bucketInstanceId,Ya,K.ID),_n&&Ni&&this.collisionIndex.insertCollisionCircles(_n.circles,ae,v.get("text-ignore-placement"),f.bucketInstanceId,Cs,K.ID),l&&this.storeCollisionData(f.bucketInstanceId,Gt,gt,yn,er,_n),nt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[nt.crossTileID]=new Bh((Ni||Ne)&&!yn?.occluded,(Wi||Le)&&!er?.occluded,zi||f.justReloaded),a[nt.crossTileID]=!0};if(Se){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const nt=f.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let gt=nt.length-1;gt>=0;--gt){const Gt=nt[gt];ft(f.symbolInstances.get(Gt),f.collisionArrays[Gt],Gt)}}else for(let nt=t.symbolInstanceStart;nt<t.symbolInstanceEnd;nt++)ft(f.symbolInstances.get(nt),f.collisionArrays[nt],nt);f.justReloaded=!1}storeCollisionData(t,a,l,f,v,b){if(l.textBox||l.iconBox){let E,D;this.collisionBoxArrays.has(t)?E=this.collisionBoxArrays.get(t):(E=new Map,this.collisionBoxArrays.set(t,E)),E.has(a)?D=E.get(a):(D={text:null,icon:null},E.set(a,D)),l.textBox&&(D.text=f.box),l.iconBox&&(D.icon=v.box)}if(b){let E=this.collisionCircleArrays[t];E===void 0&&(E=this.collisionCircleArrays[t]=[]);for(let D=0;D<b.circles.length;D+=4)E.push(b.circles[D+0]-yi),E.push(b.circles[D+1]-yi),E.push(b.circles[D+2]),E.push(b.collisionDetected?1:0)}}markUsedJustification(t,a,l,f){let v;v=f===u.az.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[u.aR(a)];const b=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const E of b)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=v>=0&&E!==v?0:l.crossTileID)}markUsedOrientation(t,a,l){const f=a===u.az.horizontal||a===u.az.horizontalOnly?a:0,v=a===u.az.vertical?a:0,b=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const E of b)t.text.placedSymbolArray.get(E).placedOrientation=f;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let l=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const f=a?a.symbolFadeChange(t):1,v=a?a.opacities:{},b=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(const D in this.placements){const I=this.placements[D],k=v[D];k?(this.opacities[D]=new qo(k,f,I.text,I.icon),l=l||I.text!==k.text.placed||I.icon!==k.icon.placed):(this.opacities[D]=new qo(null,f,I.text,I.icon,I.skipFade),l=l||I.text||I.icon)}for(const D in v){const I=v[D];if(!this.opacities[D]){const k=new qo(I,f,!1,!1);k.isHidden()||(this.opacities[D]=k,l=l||I.text.placed||I.icon.placed)}}for(const D in b)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=b[D]);for(const D in E)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=E[D]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const l={};for(const f of a){const v=f.getBucket(t);v&&f.latestFeatureIndex&&t.id===v.layerIds[0]&&this.updateBucketOpacities(v,f.tileID,l,f.collisionBoxArray)}}updateBucketOpacities(t,a,l,f){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const v=t.layers[0],b=v.layout,E=new qo(null,0,!1,!1,!0),D=b.get("text-allow-overlap"),I=b.get("icon-allow-overlap"),k=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),V=b.get("text-rotation-alignment")==="map",N=b.get("text-pitch-alignment")==="map",H=b.get("icon-text-fit")!=="none",K=new qo(null,0,D&&(I||!t.hasIconData()||b.get("icon-optional")),I&&(D||!t.hasTextData()||b.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const re=(ae,ue,ge)=>{for(let le=0;le<ue/4;le++)ae.opacityVertexArray.emplaceBack(ge);ae.hasVisibleVertices=ae.hasVisibleVertices||ge!==Ho},se=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ae=0;ae<t.symbolInstances.length;ae++){const ue=t.symbolInstances.get(ae),{numHorizontalGlyphVertices:ge,numVerticalGlyphVertices:le,crossTileID:me}=ue;let ve=this.opacities[me];l[me]?ve=E:ve||(ve=K,this.opacities[me]=ve),l[me]=!0;const fe=ue.numIconVertices>0,Se=this.placedOrientations[ue.crossTileID],Ne=Se===u.az.vertical,Le=Se===u.az.horizontal||Se===u.az.horizontalOnly;if(ge>0||le>0){const je=Lc(ve.text);re(t.text,ge,Ne?Ho:je),re(t.text,le,Le?Ho:je);const dt=ve.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach((gt=>{gt>=0&&(t.text.placedSymbolArray.get(gt).hidden=dt||Ne?1:0)})),ue.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=dt||Le?1:0);const ft=this.variableOffsets[ue.crossTileID];ft&&this.markUsedJustification(t,ft.anchor,ue,Se);const nt=this.placedOrientations[ue.crossTileID];nt&&(this.markUsedJustification(t,"left",ue,nt),this.markUsedOrientation(t,nt,ue))}if(fe){const je=Lc(ve.icon),dt=!(H&&ue.verticalPlacedIconSymbolIndex&&Ne);ue.placedIconSymbolIndex>=0&&(re(t.icon,ue.numIconVertices,dt?je:Ho),t.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=ve.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(re(t.icon,ue.numVerticalIconVertices,dt?Ho:je),t.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=ve.icon.isHidden())}const Fe=se&&se.has(ae)?se.get(ae):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const je=t.collisionArrays[ae];if(je){let dt=new u.P(0,0);if(je.textBox||je.verticalTextBox){let ft=!0;if(k){const nt=this.variableOffsets[me];nt?(dt=Ar(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale),V&&dt._rotate(N?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ft=!1}if(je.textBox||je.verticalTextBox){let nt;je.textBox&&(nt=Ne),je.verticalTextBox&&(nt=Le),Ic(t.textCollisionBox.collisionVertexArray,ve.text.placed,!ft||nt,Fe.text,dt.x,dt.y)}}if(je.iconBox||je.verticalIconBox){const ft=!!(!Le&&je.verticalIconBox);let nt;je.iconBox&&(nt=ft),je.verticalIconBox&&(nt=!ft),Ic(t.iconCollisionBox.collisionVertexArray,ve.icon.placed,nt,Fe.icon,H?dt.x:0,H?dt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const l=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function Ic(g,t,a,l,f,v){l&&l.length!==0||(l=[0,0,0,0]);const b=l[0]-yi,E=l[1]-yi,D=l[2]-yi,I=l[3]-yi;g.emplaceBack(t?1:0,a?1:0,f||0,v||0,b,E),g.emplaceBack(t?1:0,a?1:0,f||0,v||0,D,E),g.emplaceBack(t?1:0,a?1:0,f||0,v||0,D,I),g.emplaceBack(t?1:0,a?1:0,f||0,v||0,b,I)}const Iu=Math.pow(2,25),uo=Math.pow(2,24),ef=Math.pow(2,17),Vl=Math.pow(2,16),Fs=Math.pow(2,9),tf=Math.pow(2,8),Zo=Math.pow(2,1);function Lc(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const t=g.placed?1:0,a=Math.floor(127*g.opacity);return a*Iu+t*uo+a*ef+t*Vl+a*Fs+t*tf+a*Zo+t}const Ho=0;class co{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,l,f,v){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(b,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort(((E,D)=>E.sortKey-D.sortKey)));this._currentPartIndex<b.length;)if(a.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,v())return!0;return!1}}class Ul{constructor(t,a,l,f,v,b,E,D){this.placement=new Ru(t,a,b,E,D),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(t,a,l){const f=De(),v=()=>!this._forceFullPlacement&&De()-f>2;for(;this._currentPlacementIndex>=0;){const b=a[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=E)&&(!b.maxzoom||b.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new co(b)),this._inProgressLayer.continuePlacement(l[b.source],this.placement,this._showCollisionBoxes,b,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Qt=512/u.a5/2;class Va{constructor(t,a,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const f=new Map;for(let v=0;v<a.length;v++){const b=a.get(v),E=b.key,D=f.get(E);D?D.push(b):f.set(E,[b])}for(const[v,b]of f){const E={positions:b.map((D=>({x:Math.floor(D.anchorX*Qt),y:Math.floor(D.anchorY*Qt)}))),crossTileIDs:b.map((D=>D.crossTileID))};if(E.positions.length>128){const D=new u.aT(E.positions.length,16,Uint16Array);for(const{x:I,y:k}of E.positions)D.add(I,k);D.finish(),delete E.positions,E.index=D}this._symbolsByKey[v]=E}}getScaledCoordinates(t,a){const{x:l,y:f,z:v}=this.tileID.canonical,{x:b,y:E,z:D}=a.canonical,I=Qt/Math.pow(2,D-v),k=(E*u.a5+t.anchorY)*I,V=f*u.a5*Qt;return{x:Math.floor((b*u.a5+t.anchorX)*I-l*u.a5*Qt),y:Math.floor(k-V)}}findMatches(t,a,l){const f=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let v=0;v<t.length;v++){const b=t.get(v);if(b.crossTileID)continue;const E=this._symbolsByKey[b.key];if(!E)continue;const D=this.getScaledCoordinates(b,a);if(E.index){const I=E.index.range(D.x-f,D.y-f,D.x+f,D.y+f).sort();for(const k of I){const V=E.crossTileIDs[k];if(!l[V]){l[V]=!0,b.crossTileID=V;break}}}else if(E.positions)for(let I=0;I<E.positions.length;I++){const k=E.positions[I],V=E.crossTileIDs[I];if(Math.abs(k.x-D.x)<=f&&Math.abs(k.y-D.y)<=f&&!l[V]){l[V]=!0,b.crossTileID=V;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Oh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Lu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const l in this.indexes){const f=this.indexes[l],v={};for(const b in f){const E=f[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),v[E.tileID.key]=E}this.indexes[l]=v}this.lng=t}addBucket(t,a,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const f=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const b=this.indexes[v];if(Number(v)>t.overscaledZ)for(const E in b){const D=b[E];D.tileID.isChildOf(t)&&D.findMatches(a.symbolInstances,t,f)}else{const E=b[t.scaledTo(Number(v)).key];E&&E.findMatches(a.symbolInstances,t,f)}}for(let v=0;v<a.symbolInstances.length;v++){const b=a.symbolInstances.get(v);b.crossTileID||(b.crossTileID=l.generate(),f[b.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Va(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const l of a.getCrossTileIDsLists())for(const f of l)delete this.usedCrossTileIDs[t][f]}removeStaleBuckets(t){let a=!1;for(const l in this.indexes){const f=this.indexes[l];for(const v in f)t[f[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,f[v]),delete f[v],a=!0)}return a}}class Gn{constructor(){this.layerIndexes={},this.crossTileIDs=new Oh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,l){let f=this.layerIndexes[t.id];f===void 0&&(f=this.layerIndexes[t.id]=new Lu);let v=!1;const b={};f.handleWrapJump(l);for(const E of a){const D=E.getBucket(t);D&&t.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(E.tileID,D,this.crossTileIDs)&&(v=!0),b[D.bucketInstanceId]=!0)}return f.removeStaleBuckets(b)&&(v=!0),v}pruneUnusedLayers(t){const a={};t.forEach((l=>{a[l]=!0}));for(const l in this.layerIndexes)a[l]||delete this.layerIndexes[l]}}var Pn="void main() {fragColor=vec4(1.0);}";const Qi={prelude:jt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:jt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:jt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:jt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:jt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:jt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:jt(Pn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:jt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:jt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:jt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:jt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:jt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:jt(Pn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:jt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:jt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:jt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:jt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:jt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:jt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:jt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:jt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:jt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:jt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:jt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:jt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:jt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:jt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:jt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:jt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:jt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function jt(g,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/in ([\w]+) ([\w]+)/g),f=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=v?v.concat(f):f,E={};return{fragmentSource:g=g.replace(a,((D,I,k,V,N)=>(E[N]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${k} ${V} ${N};
#else
uniform ${k} ${V} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${k} ${V} ${N} = u_${N};
#endif
`))),vertexSource:t=t.replace(a,((D,I,k,V,N)=>{const H=V==="float"?"vec2":"vec4",K=N.match(/color/)?"color":H;return E[N]?I==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${k} ${H} a_${N};
out ${k} ${V} ${N};
#else
uniform ${k} ${V} u_${N};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${k} ${V} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${K}(a_${N}, u_${N}_t);
#else
    ${k} ${V} ${N} = u_${N};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${k} ${H} a_${N};
#else
uniform ${k} ${V} u_${N};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${k} ${V} ${N} = a_${N};
#else
    ${k} ${V} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${k} ${V} ${N} = unpack_mix_${K}(a_${N}, u_${N}_t);
#else
    ${k} ${V} ${N} = u_${N};
#endif
`})),staticAttributes:l,staticUniforms:b}}class Fi{constructor(t,a,l){this.vertexBuffer=t,this.indexBuffer=a,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var _a=u.aU([{name:"a_pos",type:"Int16",components:2}]);const pn="#define PROJECTION_MERCATOR",Cr="mercator";class qn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Cr}get shaderDefine(){return pn}get shaderPreludeCode(){return Qi.projectionMercator}get vertexShaderPreludeCode(){return Qi.projectionMercator.vertexSource}get subdivisionGranularity(){return u.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,l,f,v){if(this._cachedMesh)return this._cachedMesh;const b=new u.aW;b.emplaceBack(0,0),b.emplaceBack(u.a5,0),b.emplaceBack(0,u.a5),b.emplaceBack(u.a5,u.a5);const E=t.createVertexBuffer(b,_a.members),D=u.aX.simpleSegment(0,0,4,2),I=new u.aY;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3);const k=t.createIndexBuffer(I);return this._cachedMesh=new Fi(E,k,D),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Jr{constructor(t=0,a=0,l=0,f=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(l)||l<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=l,this.right=f}interpolate(t,a,l){return a.top!=null&&t.top!=null&&(this.top=u.G.number(t.top,a.top,l)),a.bottom!=null&&t.bottom!=null&&(this.bottom=u.G.number(t.bottom,a.bottom,l)),a.left!=null&&t.left!=null&&(this.left=u.G.number(t.left,a.left,l)),a.right!=null&&t.right!=null&&(this.right=u.G.number(t.right,a.right,l)),this}getCenter(t,a){const l=u.an((this.left+t-this.right)/2,0,t),f=u.an((this.top+a-this.bottom)/2,0,a);return new u.P(l,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Jr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function cs(g,t){if(!g.renderWorldCopies||g.lngRange)return;const a=t.lng-g.center.lng;t.lng+=a>180?-360:a<-180?360:0}function Ji(g){return Math.max(0,Math.floor(g))}class ho{constructor(t,a){var l;this.applyConstrain=(f,v)=>this._constrainOverride!==null?this._constrainOverride(f,v):this._callbacks.defaultConstrain(f,v),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(l=a?.constrainOverride)!==null&&l!==void 0?l:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new u.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ji(this._zoom),this._scale=u.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Jr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,l){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Ji(this._zoom),this._scale=u.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Jr(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!l&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=u.W(t,-180,180)*Math.PI/180;var l,f,v,b,E,D,I,k,V;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=Z(),l=this._rotationMatrix,v=-this._bearingInRadians,b=(f=this._rotationMatrix)[0],E=f[1],D=f[2],I=f[3],k=Math.sin(v),V=Math.cos(v),l[0]=b*V+D*k,l[1]=E*V+I*k,l[2]=b*-k+D*V,l[3]=E*-k+I*V)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=u.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return u.aZ(this._fovInRadians)}setFov(t){t=u.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=u.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=u.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,l){this._unmodified=!1,this._edgeInsets.interpolate(t,a,l),this.constrainInternal(),this._calcMatrices()}resize(t,a,l=!0){this._width=t,this._height=a,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new hn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-u.ao,u.ao])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:l,minY:f,maxX:v,maxY:b}=u.aa.fromPoints(a).extend(t);return[new u.P(l,f),new u.P(v,f),new u.P(v,b),new u.P(l,b),new u.P(l,f)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:l}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(l),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=u.ar(new Float64Array(16));u.Q(t,t,[this._width/2,-this._height/2,1]),u.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=u.ar(new Float64Array(16)),u.Q(t,t,[1,-1,1]),u.O(t,t,[-1,-1,0]),u.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,l,f){const v=l!==void 0?l:this.bearing,b=f=f!==void 0?f:this.pitch,{distanceToCenter:E,clampedElevation:D}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,b),{x:I,y:k}=Si(b,v),V=u.a9.fromLngLat(t,a);let N,H,K=u.a_(1,V.y),re=0;do{if(re+=1,re>10)break;H=E/K,N=new u.a9(V.x+I*H,V.y+k*H),K=1/N.meterInMercatorCoordinateUnits()}while(Math.abs(E-H*K)>1e-12);return{center:N.toLngLat(),elevation:D,zoom:u.at(this.height/2/Math.tan(this.fovInRadians/2)/H/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,l=u.as(1,this.center.lat)*this.worldSize,f=u.a9.fromLngLat(this.center,this.elevation),v=f.x/a,b=f.y/a,E=f.z/a,D=this.pitch,I=this.bearing,{x:k,y:V,z:N}=Si(D,I),H=this.cameraToCenterDistance,K=v+H*-k,re=b+H*-V,se=E+H*N,{distanceToCenter:ae,clampedElevation:ue}=this._distanceToCenterFromAltElevationPitch(se/l,t,D),ge=ae*l,le=new u.a9((K+k*ge)*a,(re+V*ge)*a,0).toLngLat(),me=u.as(1,le.lat),ve=u.at(this.height/2/Math.tan(this.fovInRadians/2)/ae/me/this.tileSize);this._elevation=ue,this._center=le,this.setZoom(ve)}_distanceToCenterFromAltElevationPitch(t,a,l){const f=-Math.cos(u.ap(l)),v=t-a;let b,E=a;return f*v>=0||Math.abs(f)<.1?(b=1e4,E=t+b*f):b=-v/f,{distanceToCenter:b,clampedElevation:E}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=u.as(1,this.center.lat)*this.worldSize;return Ie(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/u.a5,1/a/u.a5]}}class ea{constructor(t,a){this.min=t,this.max=a,this.center=u.a$([],u.b0([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],l=u.b1(this.min),f=u.b1(this.max);for(let v=0;v<a.length;v++)l[v]=a[v]?this.min[v]:this.center[v],f[v]=a[v]?this.center[v]:this.max[v];return f[2]=this.max[2],new ea(l,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let l=0;l<t.planes.length;l++){const f=this.intersectsPlane(t.planes[l]);if(f===0)return 0;f===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],l=t[3];for(let f=0;f<3;f++)t[f]>0?(a+=t[f]*this.min[f],l+=t[f]*this.max[f]):(l+=t[f]*this.min[f],a+=t[f]*this.max[f]);return a>=0?2:l<0?0:1}}class $o{distanceToTile2d(t,a,l,f){const v=f.distanceX([t,a]),b=f.distanceY([t,a]);return Math.hypot(v,b)}getWrap(t,a,l){return l}getTileBoundingVolume(t,a,l,f){var v,b;let E=0,D=0;if(f?.terrain){const k=new u.a2(t.z,a,t.z,t.x,t.y),V=f.terrain.getMinMaxElevation(k);E=(v=V.minElevation)!==null&&v!==void 0?v:Math.min(0,l),D=(b=V.maxElevation)!==null&&b!==void 0?b:Math.max(0,l)}const I=1<<t.z;return new ea([a+t.x/I,t.y/I,E],[a+(t.x+1)/I,(t.y+1)/I,D])}allowVariableZoom(t,a){const l=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,f=u.an(78.5-l/2,0,60);return!!a.terrain||t.pitch>f}allowWorldCopies(){return!0}prepareNextFrame(){}}class Dr{constructor(t,a,l){this.points=t,this.planes=a,this.aabb=l}static fromInvProjectionMatrix(t,a=1,l=0,f,v){const b=v?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],E=Math.pow(2,l),D=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((N=>(function(H,K,re,se){const ae=u.aH([],H,K),ue=1/ae[3]/re*se;return u.b6(ae,ae,[ue,ue,1/ae[3],ue])})(N,t,a,E)));f&&(function(N,H,K,re){const se=re?4:0,ae=re?0:4;let ue=0;const ge=[],le=[];for(let fe=0;fe<4;fe++){const Se=u.b2([],N[fe+ae],N[fe+se]),Ne=u.b7(Se);u.a$(Se,Se,1/Ne),ge.push(Ne),le.push(Se)}for(let fe=0;fe<4;fe++){const Se=u.b8(N[fe+se],le[fe],K);ue=Se!==null&&Se>=0?Math.max(ue,Se):Math.max(ue,ge[fe])}const me=(function(fe,Se){const Ne=u.b2([],fe[Se[0]],fe[Se[1]]),Le=u.b2([],fe[Se[2]],fe[Se[1]]),Fe=[0,0,0,0];return u.b3(Fe,u.b4([],Ne,Le)),Fe[3]=-u.b5(Fe,fe[Se[0]]),Fe})(N,H),ve=(function(fe,Se){const Ne=u.b9(fe),Le=u.ba([],fe,1/Ne),Fe=u.b2([],Se,u.a$([],Le,u.b5(Se,Le))),je=u.b9(Fe);if(je>0){const dt=Math.sqrt(1-Le[3]*Le[3]),ft=u.a$([],Le,-Le[3]),nt=u.b0([],ft,u.a$([],Fe,dt/je));return u.bb(Se,nt)}return null})(K,me);if(ve!==null){const fe=ve/u.b5(le[0],me);ue=Math.min(ue,fe)}for(let fe=0;fe<4;fe++){const Se=Math.min(ue,ge[fe]);N[fe+ae]=[N[fe+se][0]+le[fe][0]*Se,N[fe+se][1]+le[fe][1]*Se,N[fe+se][2]+le[fe][2]*Se,1]}})(D,b[0],f,v);const I=b.map((N=>{const H=u.b2([],D[N[0]],D[N[1]]),K=u.b2([],D[N[2]],D[N[1]]),re=u.b3([],u.b4([],H,K)),se=-u.b5(re,D[N[1]]);return re.concat(se)})),k=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],V=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const N of D)for(let H=0;H<3;H++)k[H]=Math.min(k[H],N[H]),V[H]=Math.max(V[H],N[H]);return new Dr(D,I,new ea(k,V))}}class On{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,l=!0){this._helper.resize(t,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,l)=>{l=u.an(+l,this.minZoom,this.maxZoom);const f={center:new u.V(a.lng,a.lat),zoom:l};let v=this._helper._lngRange;if(!this._helper._renderWorldCopies&&v===null){const le=179.9999999999;v=[-le,le]}const b=this.tileSize*u.aq(f.zoom);let E=0,D=b,I=0,k=b,V=0,N=0;const{x:H,y:K}=this.size;if(this._helper._latRange){const le=this._helper._latRange;E=u.X(le[1])*b,D=u.X(le[0])*b,D-E<K&&(V=K/(D-E))}v&&(I=u.W(u.Y(v[0])*b,0,b),k=u.W(u.Y(v[1])*b,0,b),k<I&&(k+=b),k-I<H&&(N=H/(k-I)));const{x:re,y:se}=Pt(b,a);let ae,ue;const ge=Math.max(N||0,V||0);if(ge){const le=new u.P(N?(k+I)/2:re,V?(D+E)/2:se);return f.center=Vt(b,le).wrap(),f.zoom+=u.at(ge),f}if(this._helper._latRange){const le=K/2;se-le<E&&(ue=E+le),se+le>D&&(ue=D-le)}if(v){const le=(I+k)/2;let me=re;this._helper._renderWorldCopies&&(me=u.W(re,le-b/2,le+b/2));const ve=H/2;me-ve<I&&(ae=I+ve),me+ve>k&&(ae=k-ve)}if(ae!==void 0||ue!==void 0){const le=new u.P(ae??re,ue??se);f.center=Vt(b,le).wrap()}return f},this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new ho({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._coveringTilesDetailsProvider=new $o}clone(){const t=new On;return t.apply(this),t}apply(t,a,l){this._helper.apply(t,a,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new u.bc(0,t)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new u.P(0,0)),f=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,0)),v=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,this._helper._height)),b=this.screenPointToMercatorCoordinate(new u.P(0,this._helper._height)),E=Math.floor(Math.min(l.x,f.x,v.x,b.x)),D=Math.floor(Math.max(l.x,f.x,v.x,b.x)),I=1;for(let k=E-I;k<=D+I;k++)k!==0&&a.push(new u.bc(k,t))}return a}getCameraFrustum(){return Dr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),l=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(t,a){const l=u.as(this.elevation,this.center.lat),f=this.screenPointToMercatorCoordinateAtZ(a,l),v=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),b=u.a9.fromLngLat(t),E=new u.a9(b.x-(f.x-v.x),b.y-(f.y-v.y));this.setCenter(E?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(u.a9.fromLngLat(t),a.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(u.a9.fromLngLat(t))}screenPointToLocation(t,a){var l;return(l=this.screenPointToMercatorCoordinate(t,a))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const l=a.pointCoordinate(t);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const l=a||0,f=[t.x,t.y,0,1],v=[t.x,t.y,1,1];u.aH(f,f,this._pixelMatrixInverse),u.aH(v,v,this._pixelMatrixInverse);const b=f[3],E=v[3],D=f[1]/b,I=v[1]/E,k=f[2]/b,V=v[2]/E,N=k===V?0:(l-k)/(V-k);return new u.a9(u.G.number(f[0]/b,v[0]/E,N)/this.worldSize,u.G.number(D,I,N)/this.worldSize,l)}coordinatePoint(t,a=0,l=this._pixelMatrix){const f=[t.x*this.worldSize,t.y*this.worldSize,a,1];return u.aH(f,f,l),new u.P(f[0]/f[3],f[1]/f[3])}getBounds(){const t=Math.max(0,this._helper._height/2-bi(this));return new hn().extend(this.screenPointToLocation(new u.P(0,t))).extend(this.screenPointToLocation(new u.P(this._helper._width,t))).extend(this.screenPointToLocation(new u.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new u.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-bi(this)}calculatePosMatrix(t,a=!1,l){var f;const v=(f=t.key)!==null&&f!==void 0?f:u.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),b=a?this._alignedPosMatrixCache:this._posMatrixCache;if(b.has(v)){const I=b.get(v);return l?I.f32:I.f64}const E=ci(t,this.worldSize);u.S(E,a?this._alignedProjMatrix:this._viewProjMatrix,E);const D={f64:E,f32:new Float32Array(E)};return b.set(v,D),l?D.f32:D.f64}calculateFogMatrix(t){const a=t.key,l=this._fogMatrixCacheF32;if(l.has(a))return l.get(a);const f=ci(t,this.worldSize);return u.S(f,this._fogMatrix,f),l.set(a,new Float32Array(f)),l.get(a)}calculateCenterFromCameraLngLatAlt(t,a,l,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,f)}_calculateNearFarZIfNeeded(t,a,l){if(!this._helper.autoCalculateNearFarZ)return;const f=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),v=t-f*this._helper._pixelPerMeter/Math.cos(a),b=f<0?v:t,E=Math.PI/2+this.pitchInRadians,D=u.ap(this.fov)*(Math.abs(Math.cos(u.ap(this.roll)))*this.height+Math.abs(Math.sin(u.ap(this.roll)))*this.width)/this.height*(.5+l.y/this.height),I=Math.sin(D)*b/Math.sin(u.an(Math.PI-E-D,.01,Math.PI-.01)),k=bi(this),V=Math.atan(k/this._helper.cameraToCenterDistance),N=u.ap(.75),H=V>N?2*V*(.5+l.y/(2*k)):N,K=Math.sin(H)*b/Math.sin(u.an(Math.PI-E-H,.01,Math.PI-.01)),re=Math.min(I,K);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*re+b),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=Pt(this.worldSize,this.center),l=a.x,f=a.y;this._helper._pixelPerMeter=u.as(1,this.center.lat)*this.worldSize;const v=u.ap(Math.min(this.pitch,wt)),b=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(v));let E;this._calculateNearFarZIfNeeded(b,v,t),E=new Float64Array(16),u.be(E,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),u.aB(this._invProjMatrix,E),E[8]=2*-t.x/this._helper._width,E[9]=2*t.y/this._helper._height,this._projectionMatrix=u.bf(E),u.Q(E,E,[1,-1,1]),u.O(E,E,[0,0,-this._helper.cameraToCenterDistance]),u.bg(E,E,-this.rollInRadians),u.bh(E,E,this.pitchInRadians),u.bg(E,E,-this.bearingInRadians),u.O(E,E,[-l,-f,0]),this._mercatorMatrix=u.Q([],E,[this.worldSize,this.worldSize,this.worldSize]),u.Q(E,E,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=u.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,E),u.O(E,E,[0,0,-this.elevation]),this._viewProjMatrix=E,this._invViewProjMatrix=u.aB([],E);const D=[0,0,-1,1];u.aH(D,D,this._invViewProjMatrix),this._cameraPosition=[D[0]/D[3],D[1]/D[3],D[2]/D[3]],this._fogMatrix=new Float64Array(16),u.be(this._fogMatrix,this.fovInRadians,this.width/this.height,b,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,u.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),u.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),u.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),u.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),u.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),u.O(this._fogMatrix,this._fogMatrix,[-l,-f,0]),u.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),u.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=u.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,E);const I=this._helper._width%2/2,k=this._helper._height%2/2,V=Math.cos(this.bearingInRadians),N=Math.sin(-this.bearingInRadians),H=l-Math.round(l)+V*I+N*k,K=f-Math.round(f)+V*k+N*I,re=new Float64Array(E);if(u.O(re,re,[H>.5?H-1:H,K>.5?K-1:K,0]),this._alignedProjMatrix=re,E=u.aB(new Float64Array(16),this._pixelMatrix),!E)throw new Error("failed to invert matrix");this._pixelMatrixInverse=E,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new u.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return u.aH(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=u.as(1,this.center.lat)*this.worldSize;return Ie(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const l=u.a9.fromLngLat(t),f=[l.x*this.worldSize,l.y*this.worldSize,a,1];return u.aH(f,f,this._viewProjMatrix),f[2]/f[3]}getProjectionData(t){const{overscaledTileID:a,aligned:l,applyTerrainMatrix:f}=t,v=this._helper.getMercatorTileCoordinates(a),b=a?this.calculatePosMatrix(a,l,!0):null;let E;return E=a&&a.terrainRttPosMatrix32f&&f?a.terrainRttPosMatrix32f:b||u.bi(),{mainMatrix:E,tileMercatorCoords:v,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:E}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,l){return 1}transformLightDirection(t){return u.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,l,f){const v=this.calculatePosMatrix(l);let b;f?(b=[t,a,f(t,a),1],u.aH(b,b,v)):(b=[t,a,0,1],ya(b,b,v));const E=b[3];return{point:new u.P(b[0]/E,b[1]/E),signedDistanceFromCamera:E,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const l=u.a9.fromLngLat(t,a),f=l.meterInMercatorCoordinateUnits(),v=u.bj();return u.O(v,v,[l.x,l.y,l.z]),u.bg(v,v,Math.PI),u.bh(v,v,Math.PI/2),u.Q(v,v,[-f,f,f]),v}getProjectionDataForCustomLayer(t=!0){const a=new u.a2(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),f=ci(a,this.worldSize);u.S(f,this._viewProjMatrix,f),l.tileMercatorCoords=[0,0,1,1];const v=[u.a5,u.a5,this.worldSize/this._helper.pixelsPerMeter],b=u.bk();return u.Q(b,f,v),l.fallbackMatrix=b,l.mainMatrix=b,l}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Pr(){u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function ku(g){if(g.useSlerp)if(g.k<1){const t=u.bl(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),a=u.bl(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),l=new Float64Array(4);u.bm(l,t,a,g.k);const f=u.bn(l);g.tr.setRoll(f.roll),g.tr.setPitch(f.pitch),g.tr.setBearing(f.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(u.G.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(u.G.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(u.G.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function Xo(g,t,a,l,f){const v=f.padding,b=Pt(f.worldSize,a.getNorthWest()),E=Pt(f.worldSize,a.getNorthEast()),D=Pt(f.worldSize,a.getSouthEast()),I=Pt(f.worldSize,a.getSouthWest()),k=u.ap(-l),V=b.rotate(k),N=E.rotate(k),H=D.rotate(k),K=I.rotate(k),re=new u.P(Math.max(V.x,N.x,K.x,H.x),Math.max(V.y,N.y,K.y,H.y)),se=new u.P(Math.min(V.x,N.x,K.x,H.x),Math.min(V.y,N.y,K.y,H.y)),ae=re.sub(se),ue=(f.width-(v.left+v.right+t.left+t.right))/ae.x,ge=(f.height-(v.top+v.bottom+t.top+t.bottom))/ae.y;if(ge<0||ue<0)return void Pr();const le=Math.min(u.at(f.scale*Math.min(ue,ge)),g.maxZoom),me=u.P.convert(g.offset),ve=new u.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(u.ap(l)),fe=me.add(ve).mult(f.scale/u.aq(le));return{center:Vt(f.worldSize,b.add(D).div(2).sub(fe)),zoom:le,bearing:l}}class Yo{get useGlobeControls(){return!1}handlePanInertia(t,a){const l=t.mag(),f=Math.abs(bi(a));return{easingOffset:t.mult(Math.min(.75*f/l,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,l){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(l,t.around)}cameraForBoxAndBearing(t,a,l,f,v){return Xo(t,a,l,f,v)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(u.V.convert(a.center))}handleEaseTo(t,a){const l=t.zoom,f=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},b={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},E=a.zoom!==void 0,D=!t.isPaddingEqual(a.padding);let I=!1;const k=E?+a.zoom:t.zoom;let V=t.centerPoint.add(a.offsetAsPoint);const N=t.screenPointToLocation(V),{center:H,zoom:K}=t.applyConstrain(u.V.convert(a.center||N),k??l);cs(t,H);const re=Pt(t.worldSize,N),se=Pt(t.worldSize,H).sub(re),ae=u.aq(K-l);return I=K!==l,{easeFunc:ue=>{if(I&&t.setZoom(u.G.number(l,K,ue)),u.bo(v,b)||ku({startEulerAngles:v,endEulerAngles:b,tr:t,k:ue,useSlerp:v.roll!=b.roll}),D&&(t.interpolatePadding(f,a.padding,ue),V=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const ge=u.aq(t.zoom-l),le=K>l?Math.min(2,ae):Math.max(.5,ae),me=Math.pow(le,1-ue),ve=Vt(t.worldSize,re.add(se.mult(ue*me)).mult(ge));t.setLocationAtPoint(t.renderWorldCopies?ve.wrap():ve,V)}},isZooming:I,elevationCenter:H}}handleFlyTo(t,a){const l=a.zoom!==void 0,f=t.zoom,v=t.applyConstrain(u.V.convert(a.center||a.locationAtOffset),l?+a.zoom:f),b=v.center,E=v.zoom;cs(t,b);const D=Pt(t.worldSize,a.locationAtOffset),I=Pt(t.worldSize,b).sub(D),k=I.mag(),V=u.aq(E-f);let N;if(a.minZoom!==void 0){const H=Math.min(+a.minZoom,f,E),K=t.applyConstrain(b,H).zoom;N=u.aq(K-f)}return{easeFunc:(H,K,re,se)=>{t.setZoom(H===1?E:f+u.at(K));const ae=H===1?b:Vt(t.worldSize,D.add(I.mult(re)).mult(K));t.setLocationAtPoint(t.renderWorldCopies?ae.wrap():ae,se)},scaleOfZoom:V,targetCenter:b,scaleOfMinZoom:N,pixelPathLength:k}}}class Pi{constructor(t,a,l){this.blendFunction=t,this.blendColor=a,this.mask=l}}Pi.Replace=[1,0],Pi.disabled=new Pi(Pi.Replace,u.bp.transparent,[!1,!1,!1,!1]),Pi.unblended=new Pi(Pi.Replace,u.bp.transparent,[!0,!0,!0,!0]),Pi.alphaBlended=new Pi([1,771],u.bp.transparent,[!0,!0,!0,!0]);const fo=2305;class ni{constructor(t,a,l){this.enable=t,this.mode=a,this.frontFace=l}}ni.disabled=new ni(!1,1029,fo),ni.backCCW=new ni(!0,1029,fo),ni.frontCCW=new ni(!0,1028,fo);class $t{constructor(t,a,l){this.func=t,this.mask=a,this.range=l}}$t.ReadOnly=!1,$t.ReadWrite=!0,$t.disabled=new $t(519,$t.ReadOnly,[0,1]);const Wo=7680;class di{constructor(t,a,l,f,v,b){this.test=t,this.ref=a,this.mask=l,this.fail=f,this.depthFail=v,this.pass=b}}di.disabled=new di({func:519,mask:0},0,0,Wo,Wo,Wo);const Bu=new WeakMap;function va(g){var t;if(Bu.has(g))return Bu.get(g);{const a=(t=g.getParameter(g.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Bu.set(g,a),a}}class po{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,l=a.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const f=new u.aW;f.emplaceBack(-1,-1),f.emplaceBack(2,-1),f.emplaceBack(-1,2);const v=new u.aY;v.emplaceBack(0,1,2),this._fullscreenTriangle=new Fi(a.createVertexBuffer(f,_a.members),a.createIndexBuffer(v),u.aX.simpleSegment(0,0,f.length,v.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(l.TEXTURE1);const b=l.createTexture();l.bindTexture(l.TEXTURE_2D,b),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(b),va(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const l=this._cachedRenderContext.context,f=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:u.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,f.TRIANGLES,$t.disabled,di.disabled,Pi.unblended,ni.disabled,((v,b)=>({u_input:v,u_output_expected:b}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&va(f)){f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.readBuffer(f.COLOR_ATTACHMENT0),f.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);const v=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);f.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:v}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&va(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return u.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=po._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const mo=u.a5/128;function nf(g,t){const a=g.granularity!==void 0?Math.max(g.granularity,1):1,l=a+(g.generateBorders?2:0),f=a+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),v=l+1,b=f+1,E=g.generateBorders?-1:0,D=g.generateBorders||g.extendToNorthPole?-1:0,I=a+(g.generateBorders?1:0),k=a+(g.generateBorders||g.extendToSouthPole?1:0),V=v*b,N=l*f*6,H=v*b>65536;if(H&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const K=H||t==="32bit",re=new Int16Array(2*V);let se=0;for(let ge=D;ge<=k;ge++)for(let le=E;le<=I;le++){let me=le/a*u.a5;le===-1&&(me=-mo),le===a+1&&(me=u.a5+mo);let ve=ge/a*u.a5;ge===-1&&(ve=g.extendToNorthPole?u.br:-mo),ge===a+1&&(ve=g.extendToSouthPole?u.bs:u.a5+mo),re[se++]=me,re[se++]=ve}const ae=K?new Uint32Array(N):new Uint16Array(N);let ue=0;for(let ge=0;ge<f;ge++)for(let le=0;le<l;le++){const me=le+1+ge*v,ve=le+(ge+1)*v,fe=le+1+(ge+1)*v;ae[ue++]=le+ge*v,ae[ue++]=ve,ae[ue++]=me,ae[ue++]=me,ae[ue++]=ve,ae[ue++]=fe}return{vertices:re.buffer.slice(0),indices:ae.buffer.slice(0),uses32bitIndices:K}}const Ou=new u.aV({fill:new u.bt(128,2),line:new u.bt(512,0),tile:new u.bt(128,32),stencil:new u.bt(128,1),circle:3});class Fh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Qi.projectionGlobe}get vertexShaderPreludeCode(){return Qi.projectionMercator.vertexSource}get subdivisionGranularity(){return Ou}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new po(t));const a=u.X(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,f=this._errorMeasurement.updateErrorLoop(a,l),v=De();f!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=f,this._errorMeasurementLastChangeTime=v);const b=Math.min(Math.max((v-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=u.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,u.bv(b))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,l,f,v){const b=(v==="stencil"?Ou.stencil:Ou.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:b,generateBorders:l,extendToNorthPole:a.y===0&&f,extendToSouthPole:a.y===(1<<a.z)-1&&f})}_getMesh(t,a){const l=this._getMeshKey(a);if(l in this._tileMeshCache)return this._tileMeshCache[l];const f=(function(v,b){const E=nf(b,"16bit"),D=u.aW.deserialize({arrayBuffer:E.vertices,length:E.vertices.byteLength/2/2}),I=u.aY.deserialize({arrayBuffer:E.indices,length:E.indices.byteLength/2/3});return new Fi(v.createVertexBuffer(D,_a.members),v.createIndexBuffer(I),u.aX.simpleSegment(0,0,D.length,I.length))})(t,a);return this._tileMeshCache[l]=f,f}recalculate(t){}hasTransition(){const t=De();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Lp=new u.t({type:new u.D(u.u.projection.type)});class jh extends u.E{constructor(t){super(),this._transitionable=new u.x(Lp,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.H(0)),this._mercatorProjection=new qn,this._verticalPerspectiveProjection=new Fh}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof u.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,l,f,v){return this.currentProjection.getMeshFromTileID(t,a,l,f,v)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function zr(g){const t=Ko(g.worldSize,g.center.lat);return 2*Math.PI*t}function hs(g,t,a,l,f){const v=1/(1<<f),b=t/u.a5*v+l*v,E=u.by((g/u.a5*v+a*v)*Math.PI*2+Math.PI,2*Math.PI),D=2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI,I=Math.cos(D),k=new Float64Array(3);return k[0]=Math.sin(E)*I,k[1]=Math.sin(D),k[2]=Math.cos(E)*I,k}function en(g){return(function(t,a){const l=Math.cos(a),f=new Float64Array(3);return f[0]=Math.sin(t)*l,f[1]=Math.sin(a),f[2]=Math.cos(t)*l,f})(g.lng*Math.PI/180,g.lat*Math.PI/180)}function Ko(g,t){return g/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Fu(g){const t=Math.asin(g[1])/Math.PI*180,a=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(a>1e-6){const l=g[0]/a,f=Math.acos(g[2]/a),v=(l>0?f:-f)/Math.PI*180;return new u.V(u.W(v,-180,180),t)}return new u.V(0,t)}function ju(g){return Math.cos(g*Math.PI/180)}function mn(g,t){const a=ju(g),l=ju(t);return u.at(l/a)}function rf(g,t){const a=g.rotate(t.bearingInRadians),l=t.zoom+mn(t.center.lat,0),f=u.bu(1/ju(t.center.lat),1/ju(Math.min(Math.abs(t.center.lat),60)),u.bx(l,7,3,0,1)),v=360/zr({worldSize:t.worldSize,center:{lat:t.center.lat}});return new u.V(t.center.lng-a.x*v*f,u.an(t.center.lat+a.y*v,-u.ao,u.ao))}function kc(g){const t=.5*g,a=Math.sin(t),l=Math.cos(t);return Math.log(a+l)-Math.log(l-a)}function af(g,t,a,l){const f=g.lat+a*l;if(Math.abs(a)>1){const v=(Math.sign(g.lat+a)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,b=Math.abs(g.lat+a)*Math.PI/180,E=kc(v+l*(b-v)),D=kc(v),I=kc(b);return new u.V(g.lng+t*((E-D)/(I-D)),f)}return new u.V(g.lng+t*l,f)}class kp{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,l,f){const v=`${t.z}_${t.x}_${t.y}_${f?.terrain?"t":""}`,b=this._cache.get(v);if(b)return b;const E=this._cachePrevious.get(v);if(E)return this._cache.set(v,E),E;const D=this._boundingVolumeFactory(t,a,l,f);return this._cache.set(v,D),this._hadAnyChanges=!0,D}}class Gl{constructor(t,a,l,f){this.min=l,this.max=f,this.points=t,this.planes=a}static fromAabb(t,a){const l=[];for(let f=0;f<8;f++)l.push([1&~f?t[0]:a[0],(f>>1&1)==1?a[1]:t[1],(f>>2&1)==1?a[2]:t[2]]);return new Gl(l,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,l){const f=u.bB([],l[0],l[1],l[2]),v=u.bC([],[a[0],0,0],f),b=u.bC([],[0,a[1],0],f),E=u.bC([],[0,0,a[2]],f),D=[...t],I=[...t];for(let V=0;V<8;V++)for(let N=0;N<3;N++){const H=t[N]+v[N]*(1&~V?-1:1)+b[N]*((V>>1&1)==1?1:-1)+E[N]*((V>>2&1)==1?1:-1);D[N]=Math.min(D[N],H),I[N]=Math.max(I[N],H)}const k=[];for(let V=0;V<8;V++){const N=[...t];u.b0(N,N,u.a$([],v,1&~V?-1:1)),u.b0(N,N,u.a$([],b,(V>>1&1)==1?1:-1)),u.b0(N,N,u.a$([],E,(V>>2&1)==1?1:-1)),k.push(N)}return new Gl(k,[[...v,-u.b5(v,k[0])],[...b,-u.b5(b,k[0])],[...E,-u.b5(E,k[0])],[-v[0],-v[1],-v[2],-u.b5(v,k[7])],[-b[0],-b[1],-b[2],-u.b5(b,k[7])],[-E[0],-E[1],-E[2],-u.b5(E,k[7])]],D,I)}intersectsFrustum(t){let a=!0;const l=this.points.length,f=this.planes.length,v=t.planes.length,b=t.points.length;for(let E=0;E<v;E++){const D=t.planes[E];let I=0;for(let k=0;k<l;k++){const V=this.points[k];D[0]*V[0]+D[1]*V[1]+D[2]*V[2]+D[3]>=0&&I++}if(I===0)return 0;I<l&&(a=!1)}if(a)return 2;for(let E=0;E<f;E++){const D=this.planes[E];let I=0;for(let k=0;k<b;k++){const V=t.points[k];D[0]*V[0]+D[1]*V[1]+D[2]*V[2]+D[3]>=0&&I++}if(I===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let l=0;for(let f=0;f<a;f++){const v=this.points[f];t[0]*v[0]+t[1]*v[1]+t[2]*v[2]+t[3]>=0&&l++}return l===a?2:l===0?0:1}}function Bc(g,t,a){const l=g-t;return l<0?-l:Math.max(0,l-a)}function ql(g,t,a,l,f){const v=g-a;let b;return b=v<0?Math.min(-v,1+v-f):v>1?Math.min(Math.max(v-f,0),1-v):0,Math.max(b,Bc(t,l,f))}class Nh{constructor(){this._boundingVolumeCache=new kp(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,l,f){const v=1<<l.z,b=1/v,E=l.x/v,D=l.y/v;let I=2;return I=Math.min(I,ql(t,a,E,D,b)),I=Math.min(I,ql(t,a,E+.5,-D-b,b)),I=Math.min(I,ql(t,a,E+.5,2-D-b,b)),I}getWrap(t,a,l){const f=1<<a.z,v=1/f,b=a.x/f,E=Bc(t.x,b,v),D=Bc(t.x,b-1,v),I=Bc(t.x,b+1,v),k=Math.min(E,D,I);return k===I?1:k===D?-1:0}allowVariableZoom(t,a){return Di(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,l,f){return this._boundingVolumeCache.getTileBoundingVolume(t,a,l,f)}_computeTileBoundingVolume(t,a,l,f){var v,b;let E=0,D=0;if(f?.terrain){const I=new u.a2(t.z,a,t.z,t.x,t.y),k=f.terrain.getMinMaxElevation(I);E=(v=k.minElevation)!==null&&v!==void 0?v:Math.min(0,l),D=(b=k.maxElevation)!==null&&b!==void 0?b:Math.max(0,l)}if(E/=u.bE,D/=u.bE,E+=1,D+=1,t.z<=0)return Gl.fromAabb([-D,-D,-D],[D,D,D]);if(t.z===1)return Gl.fromAabb([t.x===0?-D:0,t.y===0?0:-D,-D],[t.x===0?0:D,t.y===0?D:0,D]);{const I=[hs(0,0,t.x,t.y,t.z),hs(u.a5,0,t.x,t.y,t.z),hs(u.a5,u.a5,t.x,t.y,t.z),hs(0,u.a5,t.x,t.y,t.z)],k=[];for(const Fe of I)k.push(u.a$([],Fe,D));if(D!==E)for(const Fe of I)k.push(u.a$([],Fe,E));t.y===0&&k.push([0,1,0]),t.y===(1<<t.z)-1&&k.push([0,-1,0]);const V=[1,1,1],N=[-1,-1,-1];for(const Fe of k)for(let je=0;je<3;je++)V[je]=Math.min(V[je],Fe[je]),N[je]=Math.max(N[je],Fe[je]);const H=hs(u.a5/2,u.a5/2,t.x,t.y,t.z),K=u.b4([],[0,1,0],H);u.b3(K,K);const re=u.b4([],H,K);u.b3(re,re);const se=u.b4([],I[2],I[1]);u.b3(se,se);const ae=u.b4([],I[0],I[3]);u.b3(ae,ae),k.push(u.a$([],H,D)),t.y>=(1<<t.z)/2&&k.push(u.a$([],hs(u.a5/2,0,t.x,t.y,t.z),D)),t.y<(1<<t.z)/2&&k.push(u.a$([],hs(u.a5/2,u.a5,t.x,t.y,t.z),D));const ue=Nu(H,k),ge=Nu(re,k),le=[-H[0],-H[1],-H[2],ue.max],me=[H[0],H[1],H[2],-ue.min],ve=[-re[0],-re[1],-re[2],ge.max],fe=[re[0],re[1],re[2],-ge.min],Se=[...se,0],Ne=[...ae,0],Le=[];return t.y===0?Le.push(u.bD(Ne,Se,le),u.bD(Ne,Se,me)):Le.push(u.bD(ve,Se,le),u.bD(ve,Se,me),u.bD(ve,Ne,le),u.bD(ve,Ne,me)),t.y===(1<<t.z)-1?Le.push(u.bD(Ne,Se,le),u.bD(Ne,Se,me)):Le.push(u.bD(fe,Se,le),u.bD(fe,Se,me),u.bD(fe,Ne,le),u.bD(fe,Ne,me)),new Gl(Le,[le,me,ve,fe,Se,Ne],V,N)}}}function Nu(g,t){let a=1/0,l=-1/0;for(const f of t){const v=u.b5(g,f);a=Math.min(a,v),l=Math.max(l,v)}return{min:a,max:l}}class Zl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=u.bF(),this._projectionMatrix=u.bj(),this._globeViewProjMatrix32f=u.bi(),this._globeViewProjMatrixNoCorrection=u.bj(),this._globeViewProjMatrixNoCorrectionInverted=u.bj(),this._globeProjMatrixInverted=u.bj(),this._cameraPosition=u.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,l)=>{const f=u.an(a.lat,-u.ao,u.ao),v=u.an(+l,this.minZoom+mn(0,f),this.maxZoom);return{center:new u.V(a.lng,f),zoom:v}},this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new ho({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._coveringTilesDetailsProvider=new Nh}clone(){const t=new Zl;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=u.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:l}=t,f=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:f,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,l=this.cameraToCenterDistance/t,f=Math.sin(a)*l,v=Math.cos(a)*l+1,b=1/Math.sqrt(f*f+v*v)*1;let E=-f,D=v;const I=Math.sqrt(E*E+D*D);E/=I,D/=I;const k=[0,E,D];u.bG(k,k,[0,0,0],-this.bearingInRadians),u.bH(k,k,[0,0,0],-1*this.center.lat*Math.PI/180),u.bI(k,k,[0,0,0],this.center.lng*Math.PI/180);const V=1/u.b7(k);return u.a$(k,k,V),[...k,-b*V]}isLocationOccluded(t){return!this.isSurfacePointVisible(en(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,f=Math.cos(l),v=[Math.sin(a)*f,Math.sin(l),Math.cos(a)*f],b=[v[2],0,-v[0]],E=[0,0,0];u.b4(E,b,v),u.b3(b,b),u.b3(E,E);const D=[0,0,0];return u.b3(D,[b[0]*t[0]+E[0]*t[1]+v[0]*t[2],b[1]*t[0]+E[1]*t[1]+v[1]*t[2],b[2]*t[0]+E[2]*t[1]+v[2]*t[2]]),D}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,l){const f=(function(E,D,I){const k=1/(1<<I.z);return new u.a9(E/u.a5*k+I.x*k,D/u.a5*k+I.y*k)})(t,a,l.canonical),v=(b=f.y,[u.by(f.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI]);var b;return this.getCircleRadiusCorrection()/Math.cos(v[1])}projectTileCoordinates(t,a,l,f){const v=l.canonical,b=hs(t,a,v.x,v.y,v.z),E=1+(f?f(t,a):0)/u.bE,D=[b[0]*E,b[1]*E,b[2]*E,1];u.aH(D,D,this._globeViewProjMatrixNoCorrection);const I=this._cachedClippingPlane,k=I[0]*b[0]+I[1]*b[1]+I[2]*b[2]+I[3]<0;return{point:new u.P(D[0]/D[3],D[1]/D[3]),signedDistanceFromCamera:D[3],isOccluded:k}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Ko(this.worldSize,this.center.lat),a=u.bk(),l=u.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),u.be(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const f=this.centerOffset;a[8]=2*-f.x/this._helper._width,a[9]=2*f.y/this._helper._height,this._projectionMatrix=u.bf(a),this._globeProjMatrixInverted=u.bk(),u.aB(this._globeProjMatrixInverted,a),u.O(a,a,[0,0,-this.cameraToCenterDistance]),u.bg(a,a,this.rollInRadians),u.bh(a,a,-this.pitchInRadians),u.bg(a,a,this.bearingInRadians),u.O(a,a,[0,0,-t]);const v=u.bz();v[0]=t,v[1]=t,v[2]=t,u.bh(l,a,this.center.lat*Math.PI/180),u.bJ(l,l,-this.center.lng*Math.PI/180),u.Q(l,l,v),this._globeViewProjMatrixNoCorrection=l,u.bh(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),u.bJ(a,a,-this.center.lng*Math.PI/180),u.Q(a,a,v),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=u.bk(),u.aB(this._globeViewProjMatrixNoCorrectionInverted,l);const b=u.bz();this._cameraPosition=u.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,u.bG(this._cameraPosition,this._cameraPosition,b,-this.rollInRadians),u.bH(this._cameraPosition,this._cameraPosition,b,this.pitchInRadians),u.bG(this._cameraPosition,this._cameraPosition,b,-this.bearingInRadians),u.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),u.bH(this._cameraPosition,this._cameraPosition,b,-this.center.lat*Math.PI/180),u.bI(this._cameraPosition,this._cameraPosition,b,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const E=u.bf(this._globeViewProjMatrixNoCorrectionInverted);u.Q(E,E,[1,1,-1]),this._cachedFrustum=Dr.fromInvProjectionMatrix(E,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){u.w("calculateFogMatrix is not supported on globe projection.");const a=u.bk();return u.ar(a),a}getVisibleUnwrappedCoordinates(t){return[new u.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&u.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=en(t);u.a$(l,l,1+a/u.bE);const f=u.bF();return u.aH(f,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),f[2]/f[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,l=[new u.P(0,0),new u.P(t,0),new u.P(this.width,0),new u.P(this.width,a),new u.P(this.width,this.height),new u.P(t,this.height),new u.P(0,this.height),new u.P(0,a)],f=[];for(const V of l)f.push(this.unprojectScreenPoint(V));let v=0,b=0,E=0,D=0;const I=this.center;for(const V of f){const N=u.bK(I.lng,V.lng),H=u.bK(I.lat,V.lat);N<b&&(b=N),N>v&&(v=N),H<D&&(D=H),H>E&&(E=H)}const k=[I.lng+b,I.lat+D,I.lng+v,I.lat+E];return this.isSurfacePointOnScreen([0,1,0])&&(k[3]=90,k[0]=-180,k[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(k[1]=-90,k[0]=-180,k[2]=180),new hn(k)}calculateCenterFromCameraLngLatAlt(t,a,l,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,f)}setLocationAtPoint(t,a){const l=en(this.unprojectScreenPoint(a)),f=en(t),v=u.bz();u.bL(v);const b=u.bz();u.bI(b,l,v,-this.center.lng*Math.PI/180),u.bH(b,b,v,this.center.lat*Math.PI/180);const E=f[0]*f[0]+f[2]*f[2],D=b[0]*b[0];if(E<D)return;const I=Math.sqrt(E-D),k=-I,V=u.bM(f[0],f[2],b[0],I),N=u.bM(f[0],f[2],b[0],k),H=u.bz();u.bI(H,f,v,-V);const K=u.bM(H[1],H[2],b[1],b[2]),re=u.bz();u.bI(re,f,v,-N);const se=u.bM(re[1],re[2],b[1],b[2]),ae=.5*Math.PI,ue=K>=-ae&&K<=ae,ge=se>=-ae&&se<=ae;let le,me;if(ue&&ge){const Ne=this.center.lng*Math.PI/180,Le=this.center.lat*Math.PI/180;u.bN(V,Ne)+u.bN(K,Le)<u.bN(N,Ne)+u.bN(se,Le)?(le=V,me=K):(le=N,me=se)}else if(ue)le=V,me=K;else{if(!ge)return;le=N,me=se}const ve=le/Math.PI*180,fe=me/Math.PI*180,Se=this.center.lat;this.setCenter(new u.V(ve,u.an(fe,-90,90))),this.setZoom(this.zoom+mn(Se,this.center.lat))}locationToScreenPoint(t,a){const l=en(t);if(a){const f=a.getElevationForLngLatZoom(t,this._helper._tileZoom);u.a$(l,l,1+f/u.bE)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(t){const a=u.bF();return u.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new u.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const l=a.pointCoordinate(t);if(l)return l}return u.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var l;return(l=this.screenPointToMercatorCoordinate(t,a))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(t,a){const l=this._cameraPosition,f=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(l,f)}getRayDirectionFromPixel(t){const a=u.bF();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,u.aH(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const l=u.bz();l[0]=a[0]-this._cameraPosition[0],l[1]=a[1]-this._cameraPosition[1],l[2]=a[2]-this._cameraPosition[2];const f=u.bz();return u.b3(f,l),f}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=u.bF();return u.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const l=u.b5(t,a),f=u.bz(),v=u.bz();u.a$(v,a,l),u.b2(f,t,v);const b=1-u.b5(f,f);if(b<0)return null;const E=u.b5(t,t)-1,D=-l+(l<0?1:-1)*Math.sqrt(b),I=E/D,k=D;return{tMin:Math.min(I,k),tMax:Math.max(I,k)}}unprojectScreenPoint(t){const a=this._cameraPosition,l=this.getRayDirectionFromPixel(t),f=this.rayPlanetIntersection(a,l);if(f){const k=u.bz();u.b0(k,a,[l[0]*f.tMin,l[1]*f.tMin,l[2]*f.tMin]);const V=u.bz();return u.b3(V,k),Fu(V)}const v=this._cachedClippingPlane,b=v[0]*l[0]+v[1]*l[1]+v[2]*l[2],E=-u.bb(v,a)/b,D=u.bz();if(E>0)u.b0(D,a,[l[0]*E,l[1]*E,l[2]*E]);else{const k=u.bz();u.b0(k,a,[2*l[0],2*l[1],2*l[2]]);const V=u.bb(this._cachedClippingPlane,k);u.b2(D,k,[this._cachedClippingPlane[0]*V,this._cachedClippingPlane[1]*V,this._cachedClippingPlane[2]*V])}const I=(function(k){const V=u.bz();return V[0]=k[0]*-k[3],V[1]=k[1]*-k[3],V[2]=k[2]*-k[3],{center:V,radius:Math.sqrt(1-k[3]*k[3])}})(v);return Fu((function(k,V,N){const H=u.bz();u.b2(H,N,k);const K=u.bz();return u.bA(K,k,H,V/u.b9(H)),K})(I.center,I.radius,D))}getMatrixForModel(t,a){const l=u.V.convert(t),f=1/u.bE,v=u.bj();return u.bJ(v,v,l.lng/180*Math.PI),u.bh(v,v,-l.lat/180*Math.PI),u.O(v,v,[0,0,1+a/u.bE]),u.bh(v,v,.5*Math.PI),u.Q(v,v,[f,f,f]),v}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new u.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class Hl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,l=!0){this._helper.resize(t,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,l)=>this.currentTransform.defaultConstrain(a,l),this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new ho({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._globeness=1,this._mercatorTransform=new On,this._verticalPerspectiveTransform=new Zl}clone(){const t=new Hl;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),l=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:a.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return u.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return u.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,l){const f=this._mercatorTransform.getPitchedTextCorrection(t,a,l),v=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,l);return u.bu(f,v,this._globeness)}projectTileCoordinates(t,a,l,f){return this.currentTransform.projectTileCoordinates(t,a,l,f)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,l,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,f)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return l.fallbackMatrix=a.mainMatrix,l}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Tn{get useGlobeControls(){return!0}handlePanInertia(t,a){const l=rf(t,a);return Math.abs(l.lng-a.center.lng)>180&&(l.lng=a.center.lng+179.5*Math.sign(l.lng-a.center.lng)),{easingCenter:l,easingOffset:new u.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const l=t.around,f=a.screenPointToLocation(l);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const v=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const b=a.zoom-v;if(b===0)return;const E=u.bK(a.center.lng,f.lng),D=E/(Math.abs(E/180)+1),I=u.bK(a.center.lat,f.lat),k=a.getRayDirectionFromPixel(l),V=a.cameraPosition,N=-1*u.b5(V,k),H=u.bz();u.b0(H,V,[k[0]*N,k[1]*N,k[2]*N]);const K=u.b7(H)-1,re=Math.exp(.5*-Math.max(K-.3,0)),se=Ko(a.worldSize,a.center.lat)/Math.min(a.width,a.height),ae=u.bx(se,.9,.5,1,.25),ue=(1-u.aq(-b))*Math.min(re,ae),ge=a.center.lat,le=a.zoom,me=new u.V(a.center.lng+D*ue,u.an(a.center.lat+I*ue,-u.ao,u.ao));a.setLocationAtPoint(f,l);const ve=a.center,fe=u.bx(Math.abs(E),45,85,0,1),Se=u.bx(se,.75,.35,0,1),Ne=Math.pow(Math.max(fe,Se),.25),Le=u.bK(ve.lng,me.lng),Fe=u.bK(ve.lat,me.lat);a.setCenter(new u.V(ve.lng+Le*Ne,ve.lat+Fe*Ne).wrap()),a.setZoom(le+mn(ge,a.center.lat))}handleMapControlsPan(t,a,l){if(!t.panDelta)return;const f=a.center.lat,v=a.zoom;a.setCenter(rf(t.panDelta,a).wrap()),a.setZoom(v+mn(f,a.center.lat))}cameraForBoxAndBearing(t,a,l,f,v){const b=Xo(t,a,l,f,v),E=a.left/v.width*2-1,D=(v.width-a.right)/v.width*2-1,I=a.top/v.height*-2+1,k=(v.height-a.bottom)/v.height*-2+1,V=u.bK(l.getWest(),l.getEast())<0,N=V?l.getEast():l.getWest(),H=V?l.getWest():l.getEast(),K=Math.max(l.getNorth(),l.getSouth()),re=Math.min(l.getNorth(),l.getSouth()),se=N+.5*u.bK(N,H),ae=K+.5*u.bK(K,re),ue=v.clone();ue.setCenter(b.center),ue.setBearing(b.bearing),ue.setPitch(0),ue.setRoll(0),ue.setZoom(b.zoom);const ge=ue.modelViewProjectionMatrix,le=[en(l.getNorthWest()),en(l.getNorthEast()),en(l.getSouthWest()),en(l.getSouthEast()),en(new u.V(H,ae)),en(new u.V(N,ae)),en(new u.V(se,K)),en(new u.V(se,re))],me=en(b.center);let ve=Number.POSITIVE_INFINITY;for(const fe of le)E<0&&(ve=Tn.getLesserNonNegativeNonNull(ve,Tn.solveVectorScale(fe,me,ge,"x",E))),D>0&&(ve=Tn.getLesserNonNegativeNonNull(ve,Tn.solveVectorScale(fe,me,ge,"x",D))),I>0&&(ve=Tn.getLesserNonNegativeNonNull(ve,Tn.solveVectorScale(fe,me,ge,"y",I))),k<0&&(ve=Tn.getLesserNonNegativeNonNull(ve,Tn.solveVectorScale(fe,me,ge,"y",k)));if(Number.isFinite(ve)&&ve!==0)return b.zoom=ue.zoom+u.at(ve),b;Pr()}handleJumpToCenterZoom(t,a){const l=t.center.lat,f=t.applyConstrain(a.center?u.V.convert(a.center):t.center,t.zoom).center;t.setCenter(f.wrap());const v=a.zoom!==void 0?+a.zoom:t.zoom+mn(l,f.lat);t.zoom!==v&&t.setZoom(v)}handleEaseTo(t,a){const l=t.zoom,f=t.center,v=t.padding,b={roll:t.roll,pitch:t.pitch,bearing:t.bearing},E={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},D=a.zoom!==void 0,I=!t.isPaddingEqual(a.padding);let k=!1;const V=a.center?u.V.convert(a.center):f,N=t.applyConstrain(V,l).center;cs(t,N);const H=t.clone();H.setCenter(N),H.setZoom(D?+a.zoom:l+mn(f.lat,V.lat)),H.setBearing(a.bearing);const K=new u.P(u.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),u.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));H.setLocationAtPoint(N,K);const re=(a.offset&&a.offsetAsPoint.mag())>0?H.center:N,se=D?+a.zoom:l+mn(f.lat,re.lat),ae=l+mn(f.lat,0),ue=se+mn(re.lat,0),ge=u.bK(f.lng,re.lng),le=u.bK(f.lat,re.lat),me=u.aq(ue-ae);return k=se!==l,{easeFunc:ve=>{if(u.bo(b,E)||ku({startEulerAngles:b,endEulerAngles:E,tr:t,k:ve,useSlerp:b.roll!=E.roll}),I&&t.interpolatePadding(v,a.padding,ve),a.around)u.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const fe=ue>ae?Math.min(2,me):Math.max(.5,me),Se=Math.pow(fe,1-ve),Ne=af(f,ge,le,ve*Se);t.setCenter(Ne.wrap())}if(k){const fe=u.G.number(ae,ue,ve)+mn(0,t.center.lat);t.setZoom(fe)}},isZooming:k,elevationCenter:re}}handleFlyTo(t,a){const l=a.zoom!==void 0,f=t.center,v=t.zoom,b=t.padding,E=!t.isPaddingEqual(a.padding),D=t.applyConstrain(u.V.convert(a.center||a.locationAtOffset),v).center,I=l?+a.zoom:t.zoom+mn(t.center.lat,D.lat),k=t.clone();k.setCenter(D),k.setZoom(I),k.setBearing(a.bearing);const V=new u.P(u.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),u.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));k.setLocationAtPoint(D,V);const N=k.center;cs(t,N);const H=(function(le,me,ve){const fe=en(me),Se=en(ve),Ne=u.b5(fe,Se),Le=Math.acos(Ne),Fe=zr(le);return Le/(2*Math.PI)*Fe})(t,f,N),K=v+mn(f.lat,0),re=I+mn(N.lat,0),se=u.aq(re-K);let ae;if(typeof a.minZoom=="number"){const le=+a.minZoom+mn(N.lat,0),me=Math.min(le,K,re)+mn(0,N.lat),ve=t.applyConstrain(N,me).zoom+mn(N.lat,0);ae=u.aq(ve-K)}const ue=u.bK(f.lng,N.lng),ge=u.bK(f.lat,N.lat);return{easeFunc:(le,me,ve,fe)=>{const Se=af(f,ue,ge,ve);E&&t.interpolatePadding(b,a.padding,le);const Ne=le===1?N:Se;t.setCenter(Ne.wrap());const Le=K+u.at(me);t.setZoom(le===1?I:Le+mn(0,Ne.lat))},scaleOfZoom:se,targetCenter:N,scaleOfMinZoom:ae,pixelPathLength:H}}static solveVectorScale(t,a,l,f,v){const b=f==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],E=[l[3],l[7],l[11],l[15]],D=t[0]*b[0]+t[1]*b[1]+t[2]*b[2],I=t[0]*E[0]+t[1]*E[1]+t[2]*E[2],k=a[0]*b[0]+a[1]*b[1]+a[2]*b[2],V=a[0]*E[0]+a[1]*E[1]+a[2]*E[2];return k+v*I===D+v*V||E[3]*(D-k)+b[3]*(V-I)+D*V==k*I?null:(k+b[3]-v*V-v*E[3])/(k-D-v*V+v*I)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class $l{constructor(t){this._globe=t,this._mercatorCameraHelper=new Yo,this._verticalPerspectiveCameraHelper=new Tn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,l){this.currentHelper.handleMapControlsPan(t,a,l)}cameraForBoxAndBearing(t,a,l,f,v){return this.currentHelper.cameraForBoxAndBearing(t,a,l,f,v)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const Xl=(g,t)=>u.B(g,t&&t.filter((a=>a.identifier!=="source.canvas"))),Yl=u.bO();class go extends u.E{constructor(t,a={}){var l,f;super(),this._rtlPluginLoaded=()=>{for(const b in this.tileManagers){const E=this.tileManagers[b].getSource().type;E!=="vector"&&E!=="geojson"||this.tileManagers[b].reload()}},this.map=t,this.dispatcher=new Er(Hi(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((b,E)=>this.getGlyphs(b,E))),this.dispatcher.registerMessageHandler("GI",((b,E)=>this.getImages(b,E))),this.dispatcher.registerMessageHandler("GDA",((b,E)=>this.getDashes(b,E))),this.imageManager=new ki,this.imageManager.setEventedParent(this);const v=((l=t._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((f=document.documentElement)===null||f===void 0?void 0:f.lang)||void 0;this.glyphManager=new ht(t._requestManager,a.localIdeographFontFamily,v),this.lineAtlas=new Mt(256,512),this.crossTileSymbolIndex=new Gn,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",u.bP()),Pe().on(_e,this._rtlPluginLoaded),this.on("data",(b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const E=this.tileManagers[b.sourceId];if(!E)return;const D=E.getSource();if(D&&D.vectorLayerIds)for(const I in this._layers){const k=this._layers[I];k.source===D.id&&this._validateLayer(k)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new u.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var l,f,v;this._checkLoaded();const b=a===null?(v=(f=(l=this.stylesheet.state)===null||l===void 0?void 0:l[t])===null||f===void 0?void 0:f.default)!==null&&v!==void 0?v:null:a;if(u.bR(b,this._globalState[t]))return this;this._globalState[t]=b,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const l in t)!u.bR(this._globalState[l],t[l].default)&&(a.push(l),this._globalState[l]=t[l].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,l={};for(const f of t){l[f]=this._globalState[f];for(const v in this._layers){const b=this._layers[v],E=b.getLayoutAffectingGlobalStateRefs(),D=b.getPaintAffectingGlobalStateRefs(),I=b.getVisibilityAffectingGlobalStateRefs();if(E.has(f)&&a.add(b.source),D.has(f))for(const{name:k,value:V}of D.get(f))this._updatePaintProperty(b,k,V);I?.has(f)&&(b.recalculateVisibility(),this._updateLayer(b))}}this.dispatcher.broadcast("UGS",l);for(const f in this.tileManagers)a.has(f)&&(this._reloadSource(f),this._changed=!0)}loadURL(t,a={},l){this.fire(new u.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const f=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const v=this._loadStyleRequest;u.j(f,this._loadStyleRequest).then((b=>{this._loadStyleRequest=null,this._load(b.data,a,l)})).catch((b=>{this._loadStyleRequest=null,b&&!v.signal.aborted&&this.fire(new u.k(b))}))}loadJSON(t,a={},l){this.fire(new u.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ae.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,l)})).catch((()=>{}))}loadEmpty(){this.fire(new u.l("dataloading",{dataType:"style"})),this._load(Yl,{validate:!1})}_load(t,a,l){var f,v;let b=a.transformStyle?a.transformStyle(l,t):t;if(!a.validate||!Xl(this,u.C(b))){b=Object.assign({},b),this._loaded=!0,this.stylesheet=b;for(const E in b.sources)this.addSource(E,b.sources[E],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new si(this.stylesheet.light),this._setProjectionInternal(((f=this.stylesheet.projection)===null||f===void 0?void 0:f.type)||"mercator"),this.sky=new ot(this.stylesheet.sky),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new u.l("data",{dataType:"style"})),this.fire(new u.l("style.load"))}}_createLayers(){var t,a,l;const f=u.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",f),this._order=f.map((v=>v.id)),this._layers={},this._serializedLayers=null;for(const v of f){const b=u.bT(v,this._globalState);if(b.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=b,u.bU(b)&&this.tileManagers[b.source]){const E=(l=(a=v.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&l!==void 0?l:b.paint.get("raster-fade-duration");this.tileManagers[b.source].setRasterFadeDuration(E)}}}_loadSprite(t,a=!1,l=void 0){this.imageManager.setLoaded(!1);const f=new AbortController;let v;this._spriteRequest=f,(function(b,E,D,I){return u._(this,void 0,void 0,(function*(){const k=Xt(b),V=D>1?"@2x":"",N={},H={};for(const{id:K,url:re}of k){const se=E.transformRequest(ct(re,V,".json"),"SpriteJSON");N[K]=u.j(se,I);const ae=E.transformRequest(ct(re,V,".png"),"SpriteImage");H[K]=mt.getImage(ae,I)}return yield Promise.all([...Object.values(N),...Object.values(H)]),(function(K,re){return u._(this,void 0,void 0,(function*(){const se={};for(const ae in K){se[ae]={};const ue=Ae.getImageCanvasContext((yield re[ae]).data),ge=(yield K[ae]).data;for(const le in ge){const{width:me,height:ve,x:fe,y:Se,sdf:Ne,pixelRatio:Le,stretchX:Fe,stretchY:je,content:dt,textFitWidth:ft,textFitHeight:nt}=ge[le];se[ae][le]={data:null,pixelRatio:Le,sdf:Ne,stretchX:Fe,stretchY:je,content:dt,textFitWidth:ft,textFitHeight:nt,spriteData:{width:me,height:ve,x:fe,y:Se,context:ue}}}}return se}))})(N,H)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((b=>{if(this._spriteRequest=null,b)for(const E in b){this._spritesImagesIds[E]=[];const D=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter((I=>!(I in b))):[];for(const I of D)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in b[E]){const k=E==="default"?I:`${E}:${I}`;this._spritesImagesIds[E].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,b[E][I],!1):this.imageManager.addImage(k,b[E][I]),a&&(this._changedImages[k]=!0)}}})).catch((b=>{this._spriteRequest=null,v=b,f.signal.aborted||this.fire(new u.k(v))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"})),l&&l(v)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const l=t.sourceLayer;if(!l)return;const f=a.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(l)===-1)&&this.fire(new u.k(new Error(`Source layer "${l}" does not exist on source "${f.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const l=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?u.bV(l):l);const f=[];for(const v of t)if(l[v]){const b=a?u.bV(l[v]):l[v];f.push(b)}return f}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const l of a){const f=this._layers[l];f.type!=="custom"&&(t[l]=f.serialize())}return t}hasTransitions(){var t,a,l;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const f in this.tileManagers)if(this.tileManagers[f].hasTransition())return!0;for(const f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const f=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(f.length||v.length)&&this._updateWorkerLayers(f,v);for(const b in this._updatedSources){const E=this._updatedSources[b];if(E==="reload")this._reloadSource(b);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const l={};for(const f in this.tileManagers){const v=this.tileManagers[f];l[f]=v.used,v.used=!1}for(const f of this._order){const v=this._layers[f];v.recalculate(t,this._availableImages),!v.isHidden(t.zoom)&&v.source&&(this.tileManagers[v.source].used=!0)}for(const f in l){const v=this.tileManagers[f];!!l[f]!=!!v.used&&v.fire(new u.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new u.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var l;this._checkLoaded();const f=this.serialize();if(t=a.transformStyle?a.transformStyle(f,t):t,((l=a.validate)===null||l===void 0||l)&&Xl(this,u.C(t)))return!1;(t=u.bV(t)).layers=u.bS(t.layers);const v=u.bW(f,t),b=this._getOperationsToPerform(v);if(b.unimplemented.length>0)throw new Error(`Unimplemented: ${b.unimplemented.join(", ")}.`);if(b.operations.length===0)return!1;for(const E of b.operations)E();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],l=[];for(const f of t)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,f.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,f.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,f.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,f.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,f.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,f.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,f.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,f.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,f.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,f.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,f.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,f.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,f.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,f.args)));break;case"setProjection":this.setProjection.apply(this,f.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,f.args)));break;case"setTransition":a.push((()=>{}));break;default:l.push(f.command)}return{operations:a,unimplemented:l}}addImage(t,a){if(this.getImage(t))return this.fire(new u.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new u.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,l={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(u.C.source,`sources.${t}`,a,null,l))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const f=this.tileManagers[t]=new qi(t,a,this.dispatcher);f.style=this,f.setEventedParent(this,(()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:t}))),f.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new u.k(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new u.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.tileManagers[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,l={}){this._checkLoaded();const f=t.id;if(this.getLayer(f))return void this.fire(new u.k(new Error(`Layer "${f}" already exists on this map.`)));let v;if(t.type==="custom"){if(Xl(this,u.bX(t)))return;v=u.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(f,t.source),t=u.bV(t),t=u.e(t,{source:f})),this._validate(u.C.layer,`layers.${f}`,t,{arrayIndex:-1},l))return;v=u.bT(t,this._globalState),this._validateLayer(v),v.setEventedParent(this,{layer:{id:f}})}const b=a?this._order.indexOf(a):this._order.length;if(a&&b===-1)this.fire(new u.k(new Error(`Cannot add layer "${f}" before non-existing layer "${a}".`)));else{if(this._order.splice(b,0,f),this._layerOrderChanged=!0,this._layers[f]=v,this._removedLayers[f]&&v.source&&v.type!=="custom"){const E=this._removedLayers[f];delete this._removedLayers[f],E.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.tileManagers[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const l=this._order.indexOf(t);this._order.splice(l,1);const f=a?this._order.indexOf(a):this._order.length;a&&f===-1?this.fire(new u.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(f,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new u.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,l){this._checkLoaded();const f=this.getLayer(t);f?f.minzoom===a&&f.maxzoom===l||(a!=null&&(f.minzoom=a),l!=null&&(f.maxzoom=l),this._updateLayer(f)):this.fire(new u.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,l={}){this._checkLoaded();const f=this.getLayer(t);if(f){if(!u.bR(f.filter,a))return a==null?(f.setFilter(void 0),void this._updateLayer(f)):void(this._validate(u.C.filter,`layers.${f.id}.filter`,a,null,l)||(f.setFilter(u.bV(a)),this._updateLayer(f)))}else this.fire(new u.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return u.bV(this.getLayer(t).filter)}setLayoutProperty(t,a,l,f={}){this._checkLoaded();const v=this.getLayer(t);v?u.bR(v.getLayoutProperty(a),l)||(v.setLayoutProperty(a,l,f),this._updateLayer(v)):this.fire(new u.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const l=this.getLayer(t);if(l)return l.getLayoutProperty(a);this.fire(new u.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,l,f={}){this._checkLoaded();const v=this.getLayer(t);v?u.bR(v.getPaintProperty(a),l)||this._updatePaintProperty(v,a,l,f):this.fire(new u.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,l,f={}){t.setPaintProperty(a,l,f)&&this._updateLayer(t),u.bU(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const l=t.source,f=t.sourceLayer,v=this.tileManagers[l];if(v===void 0)return void this.fire(new u.k(new Error(`The source '${l}' does not exist in the map's style.`)));const b=v.getSource().type;b==="geojson"&&f?this.fire(new u.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||f?(t.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),v.setFeatureState(f,t.id,a)):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const l=t.source,f=this.tileManagers[l];if(f===void 0)return void this.fire(new u.k(new Error(`The source '${l}' does not exist in the map's style.`)));const v=f.getSource().type,b=v==="vector"?t.sourceLayer:void 0;v!=="vector"||b?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new u.k(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(b,t.id,a):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,l=t.sourceLayer,f=this.tileManagers[a];if(f!==void 0)return f.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),f.getFeatureState(l,t.id)):void this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=u.bY(this.tileManagers,(v=>v.serialize())),a=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,f=this.stylesheet;return u.bZ({version:f.version,name:f.name,metadata:f.metadata,light:f.light,sky:f.sky,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,projection:f.projection,sources:t,layers:a,terrain:l},(v=>v!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=b=>this._layers[b].type==="fill-extrusion",l={},f=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(a(E)){l[E]=b;for(const D of t){const I=D[E];if(I)for(const k of I)f.push(k)}}}f.sort(((b,E)=>E.intersectionZ-b.intersectionZ));const v=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(a(E))for(let D=f.length-1;D>=0;D--){const I=f[D].feature;if(l[I.layer.id]<b)break;v.push(I),f.pop()}else for(const D of t){const I=D[E];if(I)for(const k of I)v.push(k.feature)}}return v}queryRenderedFeatures(t,a,l){a&&a.filter&&this._validate(u.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const f={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new u.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const I of a.layers){const k=this._layers[I];if(!k)return this.fire(new u.k(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];f[k.source]=!0}}const v=[];a.availableImages=this._availableImages;const b=this._serializedAllLayers(),E=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,D=Object.assign(Object.assign({},a),{layers:E,globalState:this._globalState});for(const I in this.tileManagers)a.layers&&!f[I]||v.push(kl(this.tileManagers[I],this._layers,b,t,D,l,this.map.terrain?(k,V,N)=>this.map.terrain.getElevation(k,V,N):void 0));return this.placement&&v.push((function(I,k,V,N,H,K,re){const se={},ae=K.queryRenderedSymbols(N),ue=[];for(const ge of Object.keys(ae).map(Number))ue.push(re[ge]);ue.sort(sn);for(const ge of ue){const le=ge.featureIndex.lookupSymbolFeatures(ae[ge.bucketInstanceId],k,ge.bucketIndex,ge.sourceLayerIndex,{filterSpec:H.filter,globalState:H.globalState},H.layers,H.availableImages,I);for(const me in le){const ve=se[me]=se[me]||[],fe=le[me];fe.sort(((Se,Ne)=>{const Le=ge.featureSortOrder;if(Le){const Fe=Le.indexOf(Se.featureIndex);return Le.indexOf(Ne.featureIndex)-Fe}return Ne.featureIndex-Se.featureIndex}));for(const Se of fe)ve.push(Se)}}return(function(ge,le,me){for(const ve in ge)for(const fe of ge[ve])Br(fe,me[le[ve].source]);return ge})(se,I,V)})(this._layers,b,this.tileManagers,t,D,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(t,a){a?.filter&&this._validate(u.C.filter,"querySourceFeatures.filter",a.filter,null,a);const l=this.tileManagers[t];return l?(function(f,v){const b=f.getRenderableIds().map((I=>f.getTileByID(I))),E=[],D={};for(let I=0;I<b.length;I++){const k=b[I],V=k.tileID.canonical.key;D[V]||(D[V]=!0,k.querySourceFeatures(E,v))}return E})(l,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const l=this.light.getLight();let f=!1;for(const b in t)if(!u.bR(t[b],l[b])){f=!0;break}if(!f)return;const v={now:De(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(v)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const l=this.getSky();let f=!1;if(!t&&!l)return;if(t&&!l)f=!0;else if(!t&&l)f=!0;else for(const b in t)if(!u.bR(t[b],l[b])){f=!0;break}if(!f)return;const v={now:De(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(v)}_setProjectionInternal(t){const a=(function(l,f){const v={constrainOverride:f};if(Array.isArray(l)){const b=new jh({type:l});return{projection:b,transform:new Hl(v),cameraHelper:new $l(b)}}switch(l){case"mercator":return{projection:new qn,transform:new On(v),cameraHelper:new Yo};case"globe":{const b=new jh({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:b,transform:new Hl(v),cameraHelper:new $l(b)}}case"vertical-perspective":return{projection:new Fh,transform:new Zl(v),cameraHelper:new Tn};default:return u.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new qn,transform:new On(v),cameraHelper:new Yo}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const l in this.tileManagers)this.tileManagers[l].reload()}_validate(t,a,l,f,v={}){return(!v||v.validate!==!1)&&Xl(this,t.call(u.C,u.e({key:a,style:this.serialize(),value:l,styleSpec:u.u},f)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Pe().off(_e,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const l=this.tileManagers[a];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,l,f,v=!1){let b=!1,E=!1;const D={};for(const I of this._order){const k=this._layers[I];if(k.type!=="symbol")continue;if(!D[k.source]){const N=this.tileManagers[k.source];D[k.source]=N.getRenderableIds(!0).map((H=>N.getTileByID(H))).sort(((H,K)=>K.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(K.tileID)?-1:1)))}const V=this.crossTileSymbolIndex.addLayer(k,D[k.source],t.center.lng);b=b||V}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(De(),t.zoom))&&(this.pauseablePlacement=new Ul(t,this.map.terrain,this._order,v,a,l,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(De()),E=!0),b&&this.pauseablePlacement.placement.setStale()),E||b)for(const I of this._order){const k=this._layers[I];k.type==="symbol"&&this.placement.updateLayerOpacities(k,D[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(De())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return u._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,a.icons),l}))}getGlyphs(t,a){return u._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(a.stacks),f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(u.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return u._(this,void 0,void 0,(function*(){const l={};for(const[f,v]of Object.entries(a.dashes))l[f]=this.lineAtlas.getDash(v.dasharray,v.round);return l}))}addSprite(t,a,l={},f){this._checkLoaded();const v=[{id:t,url:a}],b=[...Xt(this.stylesheet.sprite),...v];this._validate(u.C.sprite,"sprite",b,null,l)||(this.stylesheet.sprite=b,this._loadSprite(v,!0,f))}removeSprite(t){this._checkLoaded();const a=Xt(this.stylesheet.sprite);if(a.find((l=>l.id===t))){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;a.splice(a.findIndex((l=>l.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}else this.fire(new u.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Xt(this.stylesheet.sprite)}setSprite(t,a={},l){this._checkLoaded(),t&&this._validate(u.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var sf=u.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Vu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,l,f,v,b,E,D,I){this.context=t;let k=this.boundPaintVertexBuffers.length!==f.length;for(let V=0;!k&&V<f.length;V++)this.boundPaintVertexBuffers[V]!==f[V]&&(k=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==l||k||this.boundIndexBuffer!==v||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==I?this.freshBind(a,l,f,v,b,E,D,I):(t.bindVertexArray.set(this.vao),E&&E.bind(),v&&v.dynamicDraw&&v.bind(),D&&D.bind(),I&&I.bind())}freshBind(t,a,l,f,v,b,E,D){const I=t.numAttributes,k=this.context,V=k.gl;this.vao&&this.destroy(),this.vao=k.createVertexArray(),k.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=f,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=D,a.enableAttributes(V,t);for(const N of l)N.enableAttributes(V,t);b&&b.enableAttributes(V,t),E&&E.enableAttributes(V,t),D&&D.enableAttributes(V,t),a.bind(),a.setVertexAttribPointers(V,t,v);for(const N of l)N.bind(),N.setVertexAttribPointers(V,t,v);b&&(b.bind(),b.setVertexAttribPointers(V,t,v)),f&&f.bind(),E&&(E.bind(),E.setVertexAttribPointers(V,t,v)),D&&(D.bind(),D.setVertexAttribPointers(V,t,v)),k.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const of=(g,t,a,l,f)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):u.bp.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:a?a.calculateFogBlendOpacity(l):0,u_horizon_color:a?a.properties.get("horizon-color"):u.bp.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),Ua={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Oc(g){const t=[];for(let a=0;a<g.length;a++){if(g[a]===null)continue;const l=g[a].split(" ");t.push(l.pop())}return t}class lf{constructor(t,a,l,f,v,b,E,D,I=[]){const k=t.gl;this.program=k.createProgram();const V=Oc(a.staticAttributes),N=l?l.getBinderAttributes():[],H=V.concat(N),K=Qi.prelude.staticUniforms?Oc(Qi.prelude.staticUniforms):[],re=E.staticUniforms?Oc(E.staticUniforms):[],se=a.staticUniforms?Oc(a.staticUniforms):[],ae=l?l.getBinderUniforms():[],ue=K.concat(re).concat(se).concat(ae),ge=[];for(const Le of ue)ge.indexOf(Le)<0&&ge.push(Le);const le=l?l.defines():[];va(k)&&le.unshift("#version 300 es"),v&&le.push("#define OVERDRAW_INSPECTOR;"),b&&le.push("#define TERRAIN3D;"),D&&le.push(D),I&&le.push(...I);let me=le.concat(Qi.prelude.fragmentSource,E.fragmentSource,a.fragmentSource).join(`
`),ve=le.concat(Qi.prelude.vertexSource,E.vertexSource,a.vertexSource).join(`
`);va(k)||(me=(function(Le){return Le.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(me),ve=(function(Le){return Le.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ve));const fe=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(fe,me),k.compileShader(fe),!k.getShaderParameter(fe,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(fe)}`);k.attachShader(this.program,fe);const Se=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(Se,ve),k.compileShader(Se),!k.getShaderParameter(Se,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(Se)}`);k.attachShader(this.program,Se),this.attributes={};const Ne={};this.numAttributes=H.length;for(let Le=0;Le<this.numAttributes;Le++)H[Le]&&(k.bindAttribLocation(this.program,Le,H[Le]),this.attributes[H[Le]]=Le);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(Se),k.deleteShader(fe);for(let Le=0;Le<ge.length;Le++){const Fe=ge[Le];if(Fe&&!Ne[Fe]){const je=k.getUniformLocation(this.program,Fe);je&&(Ne[Fe]=je)}}this.fixedUniforms=f(t,Ne),this.terrainUniforms=((Le,Fe)=>({u_depth:new u.b_(Le,Fe.u_depth),u_terrain:new u.b_(Le,Fe.u_terrain),u_terrain_dim:new u.bq(Le,Fe.u_terrain_dim),u_terrain_matrix:new u.c0(Le,Fe.u_terrain_matrix),u_terrain_unpack:new u.c1(Le,Fe.u_terrain_unpack),u_terrain_exaggeration:new u.bq(Le,Fe.u_terrain_exaggeration)}))(t,Ne),this.projectionUniforms=((Le,Fe)=>({u_projection_matrix:new u.c0(Le,Fe.u_projection_matrix),u_projection_tile_mercator_coords:new u.c1(Le,Fe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new u.c1(Le,Fe.u_projection_clipping_plane),u_projection_transition:new u.bq(Le,Fe.u_projection_transition),u_projection_fallback_matrix:new u.c0(Le,Fe.u_projection_fallback_matrix)}))(t,Ne),this.binderUniforms=l?l.getUniforms(t,Ne):[]}draw(t,a,l,f,v,b,E,D,I,k,V,N,H,K,re,se,ae,ue,ge){const le=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(f),t.setColorMode(v),t.setCullFace(b),D){t.activeTexture.set(le.TEXTURE2),le.bindTexture(le.TEXTURE_2D,D.depthTexture),t.activeTexture.set(le.TEXTURE3),le.bindTexture(le.TEXTURE_2D,D.texture);for(const ve in this.terrainUniforms)this.terrainUniforms[ve].set(D[ve])}if(I)for(const ve in I)this.projectionUniforms[Ua[ve]].set(I[ve]);if(E)for(const ve in this.fixedUniforms)this.fixedUniforms[ve].set(E[ve]);se&&se.setUniforms(t,this.binderUniforms,K,{zoom:re});let me=0;switch(a){case le.LINES:me=2;break;case le.TRIANGLES:me=3;break;case le.LINE_STRIP:me=1}for(const ve of H.get()){const fe=ve.vaos||(ve.vaos={});(fe[k]||(fe[k]=new Vu)).bind(t,this,V,se?se.getPaintVertexBuffers():[],N,ve.vertexOffset,ae,ue,ge),le.drawElements(a,ve.primitiveLength*me,le.UNSIGNED_SHORT,ve.primitiveOffset*me*2)}}}function uf(g,t,a){const l=1/u.aN(a,1,t.transform.tileZoom),f=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,t.transform.tileZoom)/f,b=v*(a.tileID.canonical.x+a.tileID.wrap*f),E=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[l,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}const Fc=(g,t,a,l)=>{const f=g.style.light,v=f.properties.get("position"),b=[v.x,v.y,v.z],E=u.c4();f.properties.get("anchor")==="viewport"&&u.c5(E,g.transform.bearingInRadians),u.c6(b,b,E);const D=g.transform.transformLightDirection(b),I=f.properties.get("color");return{u_lightpos:b,u_lightpos_globe:D,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:l}},jc=(g,t,a,l,f,v,b)=>u.e(Fc(g,t,a,l),uf(v,g,b),{u_height_factor:-Math.pow(2,f.overscaledZ)/b.tileSize/8}),Qo=(g,t,a,l)=>u.e(uf(t,g,a),{u_fill_translate:l}),Wl=(g,t)=>({u_world:g,u_fill_translate:t}),cf=(g,t,a,l,f)=>u.e(Qo(g,t,a,f),{u_world:l}),Uu=(g,t,a,l,f)=>{const v=g.transform;let b,E,D=0;if(a.paint.get("circle-pitch-alignment")==="map"){const I=u.aN(t,1,v.zoom);b=!0,E=[I,I],D=I/(u.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*f}else b=!1,E=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+b,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:E,u_globe_extrude_scale:D,u_translate:l}},yo=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),Vh=g=>({u_viewport_size:[g.width,g.height]}),Gu=(g,t=1)=>({u_color:g,u_overlay:0,u_overlay_scale:t}),_o=(g,t,a,l)=>{const f=u.aN(g,1,t)/(u.a5*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:u.aN(g,1,t),u_intensity:a,u_globe_extrude_scale:f}},Uh=(g,t,a,l)=>{const f=u.N();u.c7(f,0,g.width,g.height,0,0,1);const v=g.context.gl;return{u_matrix:f,u_world:[v.drawingBufferWidth,v.drawingBufferHeight],u_image:a,u_color_ramp:l,u_opacity:t.paint.get("heatmap-opacity")}},qu=(g,t,a)=>{const l=a.paint.get("hillshade-accent-color");let f;switch(a.paint.get("hillshade-method")){case"basic":f=4;break;case"combined":f=1;break;case"igor":f=2;break;case"multidirectional":f=3;break;default:f=0}const v=a.getIlluminationProperties();for(let b=0;b<v.directionRadians.length;b++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(v.directionRadians[b]+=g.transform.bearingInRadians);return{u_image:0,u_latrange:Bp(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:v.altitudeRadians,u_azimuths:v.directionRadians,u_accent:l,u_method:f,u_highlights:v.highlightColor,u_shadows:v.shadowColor}},hf=(g,t)=>{const a=t.stride,l=u.N();return u.c7(l,0,u.a5,-u.a5,0,0,1),u.O(l,l,[0,-u.a5,0]),{u_matrix:l,u_image:1,u_dimension:[a,a],u_zoom:g.overscaledZ,u_unpack:t.getUnpackVector()}};function Bp(g,t){const a=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new u.a9(0,l/a).toLngLat().lat,new u.a9(0,(l+1)/a).toLngLat().lat]}const df=(g,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:g.paint.get("color-relief-opacity")}),Zu=(g,t,a,l)=>{const f=g.transform;return{u_translation:Hu(g,t,a),u_ratio:l/u.aN(t,1,f.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},ff=(g,t,a,l,f)=>u.e(Zu(g,t,a,l),{u_image:0,u_image_height:f}),Gh=(g,t,a,l,f)=>{const v=g.transform,b=xa(t,v);return{u_translation:Hu(g,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:l/u.aN(t,1,v.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[b,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Fr=(g,t,a,l,f)=>{const v=xa(t,g.transform);return u.e(Zu(g,t,a,l),{u_tileratio:v,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image:0,u_mix:f.t,u_lineatlas_width:g.lineAtlas.width,u_lineatlas_height:g.lineAtlas.height})},vo=(g,t,a,l,f,v)=>{const b=xa(t,g.transform);return u.e(Zu(g,t,a,l),{u_image:0,u_image_height:v,u_tileratio:b,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image_dash:1,u_mix:f.t,u_lineatlas_width:g.lineAtlas.width,u_lineatlas_height:g.lineAtlas.height})};function xa(g,t){return 1/u.aN(g,1,t.tileZoom)}function Hu(g,t,a){return u.aO(g.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Nc=(g,t,a,l,f)=>{return{u_tl_parent:g,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(b=l.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(v=l.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Vc(l.paint.get("raster-hue-rotate")),u_coords_top:[f[0].x,f[0].y,f[1].x,f[1].y],u_coords_bottom:[f[3].x,f[3].y,f[2].x,f[2].y]};var v,b};function Vc(g){g*=Math.PI/180;const t=Math.sin(g),a=Math.cos(g);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const $u=(g,t,a,l,f,v,b,E,D,I,k,V,N)=>{const H=b.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:H.width/H.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_label_plane_matrix:E,u_coord_matrix:D,u_is_text:+k,u_pitch_with_map:+l,u_is_along_line:f,u_is_variable_anchor:v,u_texsize:V,u_texture:0,u_translation:I,u_pitched_scale:N}},Uc=(g,t,a,l,f,v,b,E,D,I,k,V,N,H)=>{const K=b.transform;return u.e($u(g,t,a,l,f,v,b,E,D,I,k,V,H),{u_gamma_scale:l?Math.cos(K.pitch*Math.PI/180)*K.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:1})},ba=(g,t,a,l,f,v,b,E,D,I,k,V,N)=>u.e(Uc(g,t,a,l,f,v,b,E,D,I,!0,k,0,N),{u_texsize_icon:V,u_texture_icon:1}),Xu=(g,t)=>({u_opacity:g,u_color:t}),Yu=(g,t,a,l,f)=>u.e((function(v,b,E,D){const I=E.imageManager.getPattern(v.from.toString()),k=E.imageManager.getPattern(v.to.toString()),{width:V,height:N}=E.imageManager.getPixelSize(),H=Math.pow(2,D.tileID.overscaledZ),K=D.tileSize*Math.pow(2,E.transform.tileZoom)/H,re=K*(D.tileID.canonical.x+D.tileID.wrap*H),se=K*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[V,N],u_mix:b.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/u.aN(D,1,E.transform.tileZoom),u_pixel_coord_upper:[re>>16,se>>16],u_pixel_coord_lower:[65535&re,65535&se]}})(a,f,t,l),{u_opacity:g}),Gc=(g,t)=>{},pf={fillExtrusion:(g,t)=>({u_lightpos:new u.c2(g,t.u_lightpos),u_lightpos_globe:new u.c2(g,t.u_lightpos_globe),u_lightintensity:new u.bq(g,t.u_lightintensity),u_lightcolor:new u.c2(g,t.u_lightcolor),u_vertical_gradient:new u.bq(g,t.u_vertical_gradient),u_opacity:new u.bq(g,t.u_opacity),u_fill_translate:new u.c3(g,t.u_fill_translate)}),fillExtrusionPattern:(g,t)=>({u_lightpos:new u.c2(g,t.u_lightpos),u_lightpos_globe:new u.c2(g,t.u_lightpos_globe),u_lightintensity:new u.bq(g,t.u_lightintensity),u_lightcolor:new u.c2(g,t.u_lightcolor),u_vertical_gradient:new u.bq(g,t.u_vertical_gradient),u_height_factor:new u.bq(g,t.u_height_factor),u_opacity:new u.bq(g,t.u_opacity),u_fill_translate:new u.c3(g,t.u_fill_translate),u_image:new u.b_(g,t.u_image),u_texsize:new u.c3(g,t.u_texsize),u_pixel_coord_upper:new u.c3(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.c3(g,t.u_pixel_coord_lower),u_scale:new u.c2(g,t.u_scale),u_fade:new u.bq(g,t.u_fade)}),fill:(g,t)=>({u_fill_translate:new u.c3(g,t.u_fill_translate)}),fillPattern:(g,t)=>({u_image:new u.b_(g,t.u_image),u_texsize:new u.c3(g,t.u_texsize),u_pixel_coord_upper:new u.c3(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.c3(g,t.u_pixel_coord_lower),u_scale:new u.c2(g,t.u_scale),u_fade:new u.bq(g,t.u_fade),u_fill_translate:new u.c3(g,t.u_fill_translate)}),fillOutline:(g,t)=>({u_world:new u.c3(g,t.u_world),u_fill_translate:new u.c3(g,t.u_fill_translate)}),fillOutlinePattern:(g,t)=>({u_world:new u.c3(g,t.u_world),u_image:new u.b_(g,t.u_image),u_texsize:new u.c3(g,t.u_texsize),u_pixel_coord_upper:new u.c3(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.c3(g,t.u_pixel_coord_lower),u_scale:new u.c2(g,t.u_scale),u_fade:new u.bq(g,t.u_fade),u_fill_translate:new u.c3(g,t.u_fill_translate)}),circle:(g,t)=>({u_camera_to_center_distance:new u.bq(g,t.u_camera_to_center_distance),u_scale_with_map:new u.b_(g,t.u_scale_with_map),u_pitch_with_map:new u.b_(g,t.u_pitch_with_map),u_extrude_scale:new u.c3(g,t.u_extrude_scale),u_device_pixel_ratio:new u.bq(g,t.u_device_pixel_ratio),u_globe_extrude_scale:new u.bq(g,t.u_globe_extrude_scale),u_translate:new u.c3(g,t.u_translate)}),collisionBox:(g,t)=>({u_pixel_extrude_scale:new u.c3(g,t.u_pixel_extrude_scale)}),collisionCircle:(g,t)=>({u_viewport_size:new u.c3(g,t.u_viewport_size)}),debug:(g,t)=>({u_color:new u.b$(g,t.u_color),u_overlay:new u.b_(g,t.u_overlay),u_overlay_scale:new u.bq(g,t.u_overlay_scale)}),depth:Gc,clippingMask:Gc,heatmap:(g,t)=>({u_extrude_scale:new u.bq(g,t.u_extrude_scale),u_intensity:new u.bq(g,t.u_intensity),u_globe_extrude_scale:new u.bq(g,t.u_globe_extrude_scale)}),heatmapTexture:(g,t)=>({u_matrix:new u.c0(g,t.u_matrix),u_world:new u.c3(g,t.u_world),u_image:new u.b_(g,t.u_image),u_color_ramp:new u.b_(g,t.u_color_ramp),u_opacity:new u.bq(g,t.u_opacity)}),hillshade:(g,t)=>({u_image:new u.b_(g,t.u_image),u_latrange:new u.c3(g,t.u_latrange),u_exaggeration:new u.bq(g,t.u_exaggeration),u_altitudes:new u.c9(g,t.u_altitudes),u_azimuths:new u.c9(g,t.u_azimuths),u_accent:new u.b$(g,t.u_accent),u_method:new u.b_(g,t.u_method),u_shadows:new u.c8(g,t.u_shadows),u_highlights:new u.c8(g,t.u_highlights)}),hillshadePrepare:(g,t)=>({u_matrix:new u.c0(g,t.u_matrix),u_image:new u.b_(g,t.u_image),u_dimension:new u.c3(g,t.u_dimension),u_zoom:new u.bq(g,t.u_zoom),u_unpack:new u.c1(g,t.u_unpack)}),colorRelief:(g,t)=>({u_image:new u.b_(g,t.u_image),u_unpack:new u.c1(g,t.u_unpack),u_dimension:new u.c3(g,t.u_dimension),u_elevation_stops:new u.b_(g,t.u_elevation_stops),u_color_stops:new u.b_(g,t.u_color_stops),u_color_ramp_size:new u.b_(g,t.u_color_ramp_size),u_opacity:new u.bq(g,t.u_opacity)}),line:(g,t)=>({u_translation:new u.c3(g,t.u_translation),u_ratio:new u.bq(g,t.u_ratio),u_device_pixel_ratio:new u.bq(g,t.u_device_pixel_ratio),u_units_to_pixels:new u.c3(g,t.u_units_to_pixels)}),lineGradient:(g,t)=>({u_translation:new u.c3(g,t.u_translation),u_ratio:new u.bq(g,t.u_ratio),u_device_pixel_ratio:new u.bq(g,t.u_device_pixel_ratio),u_units_to_pixels:new u.c3(g,t.u_units_to_pixels),u_image:new u.b_(g,t.u_image),u_image_height:new u.bq(g,t.u_image_height)}),linePattern:(g,t)=>({u_translation:new u.c3(g,t.u_translation),u_texsize:new u.c3(g,t.u_texsize),u_ratio:new u.bq(g,t.u_ratio),u_device_pixel_ratio:new u.bq(g,t.u_device_pixel_ratio),u_image:new u.b_(g,t.u_image),u_units_to_pixels:new u.c3(g,t.u_units_to_pixels),u_scale:new u.c2(g,t.u_scale),u_fade:new u.bq(g,t.u_fade)}),lineSDF:(g,t)=>({u_translation:new u.c3(g,t.u_translation),u_ratio:new u.bq(g,t.u_ratio),u_device_pixel_ratio:new u.bq(g,t.u_device_pixel_ratio),u_units_to_pixels:new u.c3(g,t.u_units_to_pixels),u_image:new u.b_(g,t.u_image),u_mix:new u.bq(g,t.u_mix),u_tileratio:new u.bq(g,t.u_tileratio),u_crossfade_from:new u.bq(g,t.u_crossfade_from),u_crossfade_to:new u.bq(g,t.u_crossfade_to),u_lineatlas_width:new u.bq(g,t.u_lineatlas_width),u_lineatlas_height:new u.bq(g,t.u_lineatlas_height)}),lineGradientSDF:(g,t)=>({u_translation:new u.c3(g,t.u_translation),u_ratio:new u.bq(g,t.u_ratio),u_device_pixel_ratio:new u.bq(g,t.u_device_pixel_ratio),u_units_to_pixels:new u.c3(g,t.u_units_to_pixels),u_image:new u.b_(g,t.u_image),u_image_height:new u.bq(g,t.u_image_height),u_tileratio:new u.bq(g,t.u_tileratio),u_crossfade_from:new u.bq(g,t.u_crossfade_from),u_crossfade_to:new u.bq(g,t.u_crossfade_to),u_image_dash:new u.b_(g,t.u_image_dash),u_mix:new u.bq(g,t.u_mix),u_lineatlas_width:new u.bq(g,t.u_lineatlas_width),u_lineatlas_height:new u.bq(g,t.u_lineatlas_height)}),raster:(g,t)=>({u_tl_parent:new u.c3(g,t.u_tl_parent),u_scale_parent:new u.bq(g,t.u_scale_parent),u_buffer_scale:new u.bq(g,t.u_buffer_scale),u_fade_t:new u.bq(g,t.u_fade_t),u_opacity:new u.bq(g,t.u_opacity),u_image0:new u.b_(g,t.u_image0),u_image1:new u.b_(g,t.u_image1),u_brightness_low:new u.bq(g,t.u_brightness_low),u_brightness_high:new u.bq(g,t.u_brightness_high),u_saturation_factor:new u.bq(g,t.u_saturation_factor),u_contrast_factor:new u.bq(g,t.u_contrast_factor),u_spin_weights:new u.c2(g,t.u_spin_weights),u_coords_top:new u.c1(g,t.u_coords_top),u_coords_bottom:new u.c1(g,t.u_coords_bottom)}),symbolIcon:(g,t)=>({u_is_size_zoom_constant:new u.b_(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.b_(g,t.u_is_size_feature_constant),u_size_t:new u.bq(g,t.u_size_t),u_size:new u.bq(g,t.u_size),u_camera_to_center_distance:new u.bq(g,t.u_camera_to_center_distance),u_pitch:new u.bq(g,t.u_pitch),u_rotate_symbol:new u.b_(g,t.u_rotate_symbol),u_aspect_ratio:new u.bq(g,t.u_aspect_ratio),u_fade_change:new u.bq(g,t.u_fade_change),u_label_plane_matrix:new u.c0(g,t.u_label_plane_matrix),u_coord_matrix:new u.c0(g,t.u_coord_matrix),u_is_text:new u.b_(g,t.u_is_text),u_pitch_with_map:new u.b_(g,t.u_pitch_with_map),u_is_along_line:new u.b_(g,t.u_is_along_line),u_is_variable_anchor:new u.b_(g,t.u_is_variable_anchor),u_texsize:new u.c3(g,t.u_texsize),u_texture:new u.b_(g,t.u_texture),u_translation:new u.c3(g,t.u_translation),u_pitched_scale:new u.bq(g,t.u_pitched_scale)}),symbolSDF:(g,t)=>({u_is_size_zoom_constant:new u.b_(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.b_(g,t.u_is_size_feature_constant),u_size_t:new u.bq(g,t.u_size_t),u_size:new u.bq(g,t.u_size),u_camera_to_center_distance:new u.bq(g,t.u_camera_to_center_distance),u_pitch:new u.bq(g,t.u_pitch),u_rotate_symbol:new u.b_(g,t.u_rotate_symbol),u_aspect_ratio:new u.bq(g,t.u_aspect_ratio),u_fade_change:new u.bq(g,t.u_fade_change),u_label_plane_matrix:new u.c0(g,t.u_label_plane_matrix),u_coord_matrix:new u.c0(g,t.u_coord_matrix),u_is_text:new u.b_(g,t.u_is_text),u_pitch_with_map:new u.b_(g,t.u_pitch_with_map),u_is_along_line:new u.b_(g,t.u_is_along_line),u_is_variable_anchor:new u.b_(g,t.u_is_variable_anchor),u_texsize:new u.c3(g,t.u_texsize),u_texture:new u.b_(g,t.u_texture),u_gamma_scale:new u.bq(g,t.u_gamma_scale),u_device_pixel_ratio:new u.bq(g,t.u_device_pixel_ratio),u_is_halo:new u.b_(g,t.u_is_halo),u_translation:new u.c3(g,t.u_translation),u_pitched_scale:new u.bq(g,t.u_pitched_scale)}),symbolTextAndIcon:(g,t)=>({u_is_size_zoom_constant:new u.b_(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.b_(g,t.u_is_size_feature_constant),u_size_t:new u.bq(g,t.u_size_t),u_size:new u.bq(g,t.u_size),u_camera_to_center_distance:new u.bq(g,t.u_camera_to_center_distance),u_pitch:new u.bq(g,t.u_pitch),u_rotate_symbol:new u.b_(g,t.u_rotate_symbol),u_aspect_ratio:new u.bq(g,t.u_aspect_ratio),u_fade_change:new u.bq(g,t.u_fade_change),u_label_plane_matrix:new u.c0(g,t.u_label_plane_matrix),u_coord_matrix:new u.c0(g,t.u_coord_matrix),u_is_text:new u.b_(g,t.u_is_text),u_pitch_with_map:new u.b_(g,t.u_pitch_with_map),u_is_along_line:new u.b_(g,t.u_is_along_line),u_is_variable_anchor:new u.b_(g,t.u_is_variable_anchor),u_texsize:new u.c3(g,t.u_texsize),u_texsize_icon:new u.c3(g,t.u_texsize_icon),u_texture:new u.b_(g,t.u_texture),u_texture_icon:new u.b_(g,t.u_texture_icon),u_gamma_scale:new u.bq(g,t.u_gamma_scale),u_device_pixel_ratio:new u.bq(g,t.u_device_pixel_ratio),u_is_halo:new u.b_(g,t.u_is_halo),u_translation:new u.c3(g,t.u_translation),u_pitched_scale:new u.bq(g,t.u_pitched_scale)}),background:(g,t)=>({u_opacity:new u.bq(g,t.u_opacity),u_color:new u.b$(g,t.u_color)}),backgroundPattern:(g,t)=>({u_opacity:new u.bq(g,t.u_opacity),u_image:new u.b_(g,t.u_image),u_pattern_tl_a:new u.c3(g,t.u_pattern_tl_a),u_pattern_br_a:new u.c3(g,t.u_pattern_br_a),u_pattern_tl_b:new u.c3(g,t.u_pattern_tl_b),u_pattern_br_b:new u.c3(g,t.u_pattern_br_b),u_texsize:new u.c3(g,t.u_texsize),u_mix:new u.bq(g,t.u_mix),u_pattern_size_a:new u.c3(g,t.u_pattern_size_a),u_pattern_size_b:new u.c3(g,t.u_pattern_size_b),u_scale_a:new u.bq(g,t.u_scale_a),u_scale_b:new u.bq(g,t.u_scale_b),u_pixel_coord_upper:new u.c3(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.c3(g,t.u_pixel_coord_lower),u_tile_units_to_pixels:new u.bq(g,t.u_tile_units_to_pixels)}),terrain:(g,t)=>({u_texture:new u.b_(g,t.u_texture),u_ele_delta:new u.bq(g,t.u_ele_delta),u_fog_matrix:new u.c0(g,t.u_fog_matrix),u_fog_color:new u.b$(g,t.u_fog_color),u_fog_ground_blend:new u.bq(g,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.bq(g,t.u_fog_ground_blend_opacity),u_horizon_color:new u.b$(g,t.u_horizon_color),u_horizon_fog_blend:new u.bq(g,t.u_horizon_fog_blend),u_is_globe_mode:new u.bq(g,t.u_is_globe_mode)}),terrainDepth:(g,t)=>({u_ele_delta:new u.bq(g,t.u_ele_delta)}),terrainCoords:(g,t)=>({u_texture:new u.b_(g,t.u_texture),u_terrain_coords_id:new u.bq(g,t.u_terrain_coords_id),u_ele_delta:new u.bq(g,t.u_ele_delta)}),projectionErrorMeasurement:(g,t)=>({u_input:new u.bq(g,t.u_input),u_output_expected:new u.bq(g,t.u_output_expected)}),atmosphere:(g,t)=>({u_sun_pos:new u.c2(g,t.u_sun_pos),u_atmosphere_blend:new u.bq(g,t.u_atmosphere_blend),u_globe_position:new u.c2(g,t.u_globe_position),u_globe_radius:new u.bq(g,t.u_globe_radius),u_inv_proj_matrix:new u.c0(g,t.u_inv_proj_matrix)}),sky:(g,t)=>({u_sky_color:new u.b$(g,t.u_sky_color),u_horizon_color:new u.b$(g,t.u_horizon_color),u_horizon:new u.c3(g,t.u_horizon),u_horizon_normal:new u.c3(g,t.u_horizon_normal),u_sky_horizon_blend:new u.bq(g,t.u_sky_horizon_blend),u_sky_blend:new u.bq(g,t.u_sky_blend)})};class Jo{constructor(t,a,l){this.context=t;const f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const el={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qh{constructor(t,a,l,f){this.length=a.length,this.attributes=l,this.itemSize=a.bytesPerElement,this.dynamicDraw=f,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let l=0;l<this.attributes.length;l++){const f=a.attributes[this.attributes[l].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,a,l){for(let f=0;f<this.attributes.length;f++){const v=this.attributes[f],b=a.attributes[v.name];b!==void 0&&t.vertexAttribPointer(b,v.components,t[el[v.type]],!1,this.itemSize,v.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _i{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ds extends _i{getDefault(){return u.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Wu extends _i{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ku extends _i{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class qc extends _i{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class tl extends _i{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Qu extends _i{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Kl extends _i{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ta extends _i{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Zh extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Zc extends _i{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ia extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class fs extends _i{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Rr extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class js extends _i{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class il extends _i{getDefault(){return u.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class nl extends _i{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ju extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class xo extends _i{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class wa extends _i{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Hh extends _i{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ql extends _i{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Kt extends _i{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Hc extends _i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class na extends _i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class $c extends _i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ra extends _i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class mf extends _i{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xc extends _i{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const l=this.gl;va(l)?l.bindVertexArray(t):(a=l.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class bo extends _i{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class $h extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Yc extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class wo extends _i{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Jl extends wo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ir extends wo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class To extends wo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const So="Framebuffer is not complete";class rl{constructor(t,a,l,f,v){this.context=t,this.width=a,this.height=l;const b=t.gl,E=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new Jl(t,E),f)this.depthAttachment=v?new To(t,E):new Ir(t,E);else if(v)throw new Error("Stencil cannot be set without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error(So)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class Mo{constructor(t){var a,l;if(this.gl=t,this.clearColor=new ds(this),this.clearDepth=new Wu(this),this.clearStencil=new Ku(this),this.colorMask=new qc(this),this.depthMask=new tl(this),this.stencilMask=new Qu(this),this.stencilFunc=new Kl(this),this.stencilOp=new ta(this),this.stencilTest=new Zh(this),this.depthRange=new Zc(this),this.depthTest=new ia(this),this.depthFunc=new fs(this),this.blend=new Rr(this),this.blendFunc=new js(this),this.blendColor=new il(this),this.blendEquation=new nl(this),this.cullFace=new Ju(this),this.cullFaceSide=new xo(this),this.frontFace=new wa(this),this.program=new Hh(this),this.activeTexture=new Ql(this),this.viewport=new Kt(this),this.bindFramebuffer=new Hc(this),this.bindRenderbuffer=new na(this),this.bindTexture=new $c(this),this.bindVertexBuffer=new ra(this),this.bindElementBuffer=new mf(this),this.bindVertexArray=new Xc(this),this.pixelStoreUnpack=new bo(this),this.pixelStoreUnpackPremultiplyAlpha=new $h(this),this.pixelStoreUnpackFlipY=new Yc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),va(t)){this.HALF_FLOAT=t.HALF_FLOAT;const f=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:f?.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:f?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const f=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=f?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new Jo(this,t,a)}createVertexBuffer(t,a,l){return new qh(this,t,a,l)}createRenderbuffer(t,a,l){const f=this.gl,v=f.createRenderbuffer();return this.bindRenderbuffer.set(v),f.renderbufferStorage(f.RENDERBUFFER,t,a,l),this.bindRenderbuffer.set(null),v}createFramebuffer(t,a,l,f){return new rl(this,t,a,l,f)}clear({color:t,depth:a,stencil:l}){const f=this.gl;let v=0;t&&(v|=f.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(v|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),l!==void 0&&(v|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),f.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){u.bR(t.blendFunction,Pi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return va(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return va(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Zn;function Kn(g,t,a,l,f){const v=g.context,b=g.transform,E=v.gl,D=g.useProgram("collisionBox"),I=[];let k=0,V=0;for(let ae=0;ae<l.length;ae++){const ue=l[ae],ge=t.getTile(ue).getBucket(a);if(!ge)continue;const le=f?ge.textCollisionBox:ge.iconCollisionBox,me=ge.collisionCircleArray;me.length>0&&(I.push({circleArray:me,circleOffset:V,coord:ue}),k+=me.length/4,V=k),le&&D.draw(v,E.LINES,$t.disabled,di.disabled,g.colorModeForRenderPass(),ni.disabled,yo(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(ue),b.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,null,g.transform.zoom,null,null,le.collisionVertexBuffer)}if(!f||!I.length)return;const N=g.useProgram("collisionCircle"),H=new u.ca;H.resize(4*k),H._trim();let K=0;for(const ae of I)for(let ue=0;ue<ae.circleArray.length/4;ue++){const ge=4*ue,le=ae.circleArray[ge+0],me=ae.circleArray[ge+1],ve=ae.circleArray[ge+2],fe=ae.circleArray[ge+3];H.emplace(K++,le,me,ve,fe,0),H.emplace(K++,le,me,ve,fe,1),H.emplace(K++,le,me,ve,fe,2),H.emplace(K++,le,me,ve,fe,3)}(!Zn||Zn.length<2*k)&&(Zn=(function(ae){const ue=2*ae,ge=new u.cc;ge.resize(ue),ge._trim();for(let le=0;le<ue;le++){const me=6*le;ge.uint16[me+0]=4*le+0,ge.uint16[me+1]=4*le+1,ge.uint16[me+2]=4*le+2,ge.uint16[me+3]=4*le+2,ge.uint16[me+4]=4*le+3,ge.uint16[me+5]=4*le+0}return ge})(k));const re=v.createIndexBuffer(Zn,!0),se=v.createVertexBuffer(H,u.cb.members,!0);for(const ae of I){const ue=Vh(g.transform);N.draw(v,E.TRIANGLES,$t.disabled,di.disabled,g.colorModeForRenderPass(),ni.disabled,ue,g.style.map.terrain&&g.style.map.terrain.getTerrainData(ae.coord),null,a.id,se,re,u.aX.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,g.transform.zoom,null,null,null)}se.destroy(),re.destroy()}const ps=u.ar(new Float32Array(16));function ms(g,t,a,l,f,v){const{horizontalAlign:b,verticalAlign:E}=u.aS(g);return new u.P((-(b-.5)*t/f+l[0])*v,(-(E-.5)*a/f+l[1])*v)}function jr(g,t,a,l,f,v){const b=t.tileAnchorPoint.add(new u.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let E=l.mult(v);a||(E=E.rotate(-f));const D=b.add(E);return Zt(D.x,D.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const E=hi(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(g),D=Math.atan(E.y/E.x)+(E.x<0?Math.PI:0);return g.add(l.rotate(D))}return g.add(l)}function Ns(g,t,a,l,f,v,b,E,D,I,k,V){const N=g.text.placedSymbolArray,H=g.text.dynamicLayoutVertexArray,K=g.icon.dynamicLayoutVertexArray,re={};H.clear();for(let se=0;se<N.length;se++){const ae=N.get(se),ue=ae.hidden||!ae.crossTileID||g.allowVerticalPlacement&&!ae.placedOrientation?null:l[ae.crossTileID];if(ue){const ge=new u.P(ae.anchorX,ae.anchorY),le={getElevation:V,width:f.width,height:f.height,pitchedLabelPlaneMatrix:v,pitchWithMap:a,transform:f,tileAnchorPoint:ge,translation:I,unwrappedTileID:k},me=a?jl(ge.x,ge.y,le):hi(ge.x,ge.y,le),ve=Go(f.cameraToCenterDistance,me.signedDistanceFromCamera);let fe=u.aA(g.textSizeData,E,ae)*ve/u.aM;a&&(fe*=g.tilePixelRatio/b);const{width:Se,height:Ne,anchor:Le,textOffset:Fe,textBoxScale:je}=ue,dt=ms(Le,Se,Ne,Fe,je,fe),ft=f.getPitchedTextCorrection(ge.x+I[0],ge.y+I[1],k),nt=jr(me.point,le,t,dt,-f.bearingInRadians,ft),gt=g.allowVerticalPlacement&&ae.placedOrientation===u.az.vertical?Math.PI/2:0;for(let Gt=0;Gt<ae.numGlyphs;Gt++)u.aG(H,nt,gt);D&&ae.associatedIconIndex>=0&&(re[ae.associatedIconIndex]={shiftedAnchor:nt,angle:gt})}else us(ae.numGlyphs,H)}if(D){K.clear();const se=g.icon.placedSymbolArray;for(let ae=0;ae<se.length;ae++){const ue=se.get(ae);if(ue.hidden)us(ue.numGlyphs,K);else{const ge=re[ae];if(ge)for(let le=0;le<ue.numGlyphs;le++)u.aG(K,ge.shiftedAnchor,ge.angle);else us(ue.numGlyphs,K)}}g.icon.dynamicLayoutVertexBuffer.updateData(K)}g.text.dynamicLayoutVertexBuffer.updateData(H)}function Xh(g,t,a){return a.iconsInText&&t?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function al(g,t,a,l,f,v,b,E,D,I,k,V,N){const H=g.context,K=H.gl,re=g.transform,se=E==="map",ae=D==="map",ue=E!=="viewport"&&a.layout.get("symbol-placement")!=="point",ge=se&&!ae&&!ue,le=!a.layout.get("symbol-sort-key").isConstant();let me=!1;const ve=g.getDepthModeForSublayer(0,$t.ReadOnly),fe=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Se=[],Ne=re.getCircleRadiusCorrection();for(const Le of l){const Fe=t.getTile(Le),je=Fe.getBucket(a);if(!je)continue;const dt=f?je.text:je.icon;if(!dt||!dt.segments.get().length||!dt.hasVisibleVertices)continue;const ft=dt.programConfigurations.get(a.id),nt=f||je.sdfIcons,gt=f?je.textSizeData:je.iconSizeData,Gt=ae||re.pitch!==0,Ti=g.useProgram(Xh(nt,f,je),ft),Zi=u.ay(gt,re.zoom),Ni=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Le);let Wi,zi,un,Ki,Jn=[0,0],yn=null;if(f)zi=Fe.glyphAtlasTexture,un=K.LINEAR,Wi=Fe.glyphAtlasTexture.size,je.iconsInText&&(Jn=Fe.imageAtlasTexture.size,yn=Fe.imageAtlasTexture,Ki=Gt||g.options.rotating||g.options.zooming||gt.kind==="composite"||gt.kind==="camera"?K.LINEAR:K.NEAREST);else{const Ai=a.layout.get("icon-size").constantOr(0)!==1||je.iconsNeedLinear;zi=Fe.imageAtlasTexture,un=nt||g.options.rotating||g.options.zooming||Ai||Gt?K.LINEAR:K.NEAREST,Wi=Fe.imageAtlasTexture.size}const _n=u.aN(Fe,1,g.transform.zoom),er=Qr(se,g.transform,_n),Cs=u.N();u.aB(Cs,er);const Ds=Rc(ae,se,g.transform,_n),Ya=u.aO(re,Fe,v,b),Gr=re.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),pl=fe&&je.hasTextData(),uu=a.layout.get("icon-text-fit")!=="none"&&pl&&je.hasIconData();if(ue){const Ai=g.style.map.terrain?(Rn,Fn)=>g.style.map.terrain.getElevation(Le,Rn,Fn):null,Vi=a.layout.get("text-rotation-alignment")==="map";Bs(je,g,f,er,Cs,ae,I,Vi,Le.toUnwrapped(),re.width,re.height,Ya,Ai)}const Wa=f&&fe||uu,qr=ue||Wa?ps:ae?er:g.transform.clipSpaceToPixelsMatrix,ua=nt&&a.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ca;Ca=nt?je.iconsInText?ba(gt.kind,Zi,ge,ae,ue,Wa,g,qr,Ds,Ya,Wi,Jn,Ne):Uc(gt.kind,Zi,ge,ae,ue,Wa,g,qr,Ds,Ya,f,Wi,0,Ne):$u(gt.kind,Zi,ge,ae,ue,Wa,g,qr,Ds,Ya,f,Wi,Ne);const Da={program:Ti,buffers:dt,uniformValues:Ca,projectionData:Gr,atlasTexture:zi,atlasTextureIcon:yn,atlasInterpolation:un,atlasInterpolationIcon:Ki,isSDF:nt,hasHalo:ua};if(le&&je.canOverlap){me=!0;const Ai=dt.segments.get();for(const Vi of Ai)Se.push({segments:new u.aX([Vi]),sortKey:Vi.sortKey,state:Da,terrainData:Ni})}else Se.push({segments:dt.segments,sortKey:0,state:Da,terrainData:Ni})}me&&Se.sort(((Le,Fe)=>Le.sortKey-Fe.sortKey));for(const Le of Se){const Fe=Le.state;if(H.activeTexture.set(K.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,K.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(H.activeTexture.set(K.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),Fe.isSDF){const je=Fe.uniformValues;Fe.hasHalo&&(je.u_is_halo=1,eu(Fe.buffers,Le.segments,a,g,Fe.program,ve,k,V,je,Fe.projectionData,Le.terrainData)),je.u_is_halo=0}eu(Fe.buffers,Le.segments,a,g,Fe.program,ve,k,V,Fe.uniformValues,Fe.projectionData,Le.terrainData)}}function eu(g,t,a,l,f,v,b,E,D,I,k){const V=l.context;f.draw(V,V.gl.TRIANGLES,v,b,E,ni.backCCW,D,k,I,a.id,g.layoutVertexBuffer,g.indexBuffer,t,a.paint,l.transform.zoom,g.programConfigurations.get(a.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Yh(g,t,a,l,f){const v=g.context,b=v.gl,E=di.disabled,D=new Pi([b.ONE,b.ONE],u.bp.transparent,[!0,!0,!0,!0]),I=t.getBucket(a);if(!I)return;const k=l.key;let V=a.heatmapFbos.get(k);V||(V=ji(v,t.tileSize,t.tileSize),a.heatmapFbos.set(k,V)),v.bindFramebuffer.set(V.framebuffer),v.viewport.set([0,0,t.tileSize,t.tileSize]),v.clear({color:u.bp.transparent});const N=I.programConfigurations.get(a.id),H=g.useProgram("heatmap",N,!f),K=g.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),re=g.style.map.terrain.getTerrainData(l);H.draw(v,b.TRIANGLES,$t.disabled,E,D,ni.disabled,_o(t,g.transform.zoom,a.paint.get("heatmap-intensity"),1),re,K,a.id,I.layoutVertexBuffer,I.indexBuffer,I.segments,a.paint,g.transform.zoom,N)}function Qn(g,t,a,l,f){const v=g.context,b=v.gl,E=g.transform;v.setColorMode(g.colorModeForRenderPass());const D=ui(v,t),I=a.key,k=t.heatmapFbos.get(I);if(!k)return;v.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,k.colorAttachment.get()),v.activeTexture.set(b.TEXTURE1),D.bind(b.LINEAR,b.CLAMP_TO_EDGE);const V=E.getProjectionData({overscaledTileID:a,applyTerrainMatrix:f,applyGlobeMatrix:!l});g.useProgram("heatmapTexture").draw(v,b.TRIANGLES,$t.disabled,di.disabled,g.colorModeForRenderPass(),ni.disabled,Uh(g,t,0,1),null,V,t.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,t.paint,E.zoom),k.destroy(),t.heatmapFbos.delete(I)}function ji(g,t,a){var l,f;const v=g.gl,b=v.createTexture();v.bindTexture(v.TEXTURE_2D,b),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR);const E=(l=g.HALF_FLOAT)!==null&&l!==void 0?l:v.UNSIGNED_BYTE,D=(f=g.RGBA16F)!==null&&f!==void 0?f:v.RGBA;v.texImage2D(v.TEXTURE_2D,0,D,t,a,0,v.RGBA,E,null);const I=g.createFramebuffer(t,a,!1,!1);return I.colorAttachment.set(b),I}function ui(g,t){return t.colorRampTexture||(t.colorRampTexture=new u.T(g,t.colorRamp,g.gl.RGBA)),t.colorRampTexture}function Vs(g,t,a,l,f,v,b,E){let D=256;if(f.stepInterpolant){const I=t.getSource().maxzoom,k=b.canonical.z===I?Math.ceil(1<<g.transform.maxZoom-b.canonical.z):1;D=u.an(u.ce(v.maxLineLength/u.a5*1024*k),256,a.maxTextureSize)}return E.gradient=u.cf({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:D,image:E.gradient||void 0,clips:v.lineClipsArray}),E.texture?E.texture.update(E.gradient):E.texture=new u.T(a,E.gradient,l.RGBA),E.version=f.gradientVersion,E.texture}function aa(g,t,a,l,f){g.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),l.updatePaintBuffers(f)}function on(g,t,a,l,f,v){(f||g.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),g.lineAtlas.bind(t)),l.updatePaintBuffers(v)}function Nr(g,t,a,l,f,v,b){const E=v.gradients[f.id];let D=E.texture;f.gradientVersion!==E.version&&(D=Vs(g,t,a,l,f,v,b,E)),a.activeTexture.set(l.TEXTURE0),D.bind(f.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function Vr(g,t,a,l,f,v,b,E,D){const I=v.gradients[f.id];let k=I.texture;f.gradientVersion!==I.version&&(k=Vs(g,t,a,l,f,v,b,I)),a.activeTexture.set(l.TEXTURE0),k.bind(f.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE1),g.lineAtlas.bind(a),E.updatePaintBuffers(D)}function ec(g,t,a,l,f){if(!a||!l||!l.imageAtlas)return;const v=l.imageAtlas.patternPositions;let b=v[a.to.toString()],E=v[a.from.toString()];if(!b&&E&&(b=E),!E&&b&&(E=b),!b||!E){const D=f.getPaintProperty(t);b=v[D],E=v[D]}b&&E&&g.setConstantPatternPositions(b,E)}function gs(g,t,a,l,f,v,b,E){const D=g.context.gl,I="fill-pattern",k=a.paint.get(I),V=k&&k.constantOr(1),N=a.getCrossfadeParameters();let H,K,re,se,ae;const ue=g.transform,ge=a.paint.get("fill-translate"),le=a.paint.get("fill-translate-anchor");b?(K=V&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=D.LINES):(K=V?"fillPattern":"fill",H=D.TRIANGLES);const me=k.constantOr(null);for(const ve of l){const fe=t.getTile(ve);if(V&&!fe.patternsLoaded())continue;const Se=fe.getBucket(a);if(!Se)continue;const Ne=Se.programConfigurations.get(a.id),Le=g.useProgram(K,Ne),Fe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ve);V&&(g.context.activeTexture.set(D.TEXTURE0),fe.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Ne.updatePaintBuffers(N)),ec(Ne,I,me,fe,a);const je=ue.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),dt=u.aO(ue,fe,ge,le);if(b){se=Se.indexBuffer2,ae=Se.segments2;const nt=[D.drawingBufferWidth,D.drawingBufferHeight];re=K==="fillOutlinePattern"&&V?cf(g,N,fe,nt,dt):Wl(nt,dt)}else se=Se.indexBuffer,ae=Se.segments,re=V?Qo(g,N,fe,dt):{u_fill_translate:dt};const ft=g.stencilModeForClipping(ve);Le.draw(g.context,H,f,ft,v,ni.backCCW,re,Fe,je,a.id,Se.layoutVertexBuffer,se,ae,a.paint,g.transform.zoom,Ne)}}function ys(g,t,a,l,f,v,b,E){const D=g.context,I=D.gl,k="fill-extrusion-pattern",V=a.paint.get(k),N=V.constantOr(1),H=a.getCrossfadeParameters(),K=a.paint.get("fill-extrusion-opacity"),re=V.constantOr(null),se=g.transform;for(const ae of l){const ue=t.getTile(ae),ge=ue.getBucket(a);if(!ge)continue;const le=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ae),me=ge.programConfigurations.get(a.id),ve=g.useProgram(N?"fillExtrusionPattern":"fillExtrusion",me);N&&(g.context.activeTexture.set(I.TEXTURE0),ue.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),me.updatePaintBuffers(H));const fe=se.getProjectionData({overscaledTileID:ae,applyGlobeMatrix:!E,applyTerrainMatrix:!0});ec(me,k,re,ue,a);const Se=u.aO(se,ue,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ne=a.paint.get("fill-extrusion-vertical-gradient"),Le=N?jc(g,Ne,K,Se,ae,H,ue):Fc(g,Ne,K,Se);ve.draw(D,D.gl.TRIANGLES,f,v,b,ni.backCCW,Le,le,fe,a.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,a.paint,g.transform.zoom,me,g.style.map.terrain&&ge.centroidVertexBuffer)}}function _s(g,t,a,l,f,v,b,E,D){var I;const k=g.style.projection,V=g.context,N=g.transform,H=V.gl,K=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],re=g.useProgram("hillshade",null,!1,K),se=!g.options.moving;for(const ae of l){const ue=t.getTile(ae),ge=ue.fbo;if(!ge)continue;const le=k.getMeshFromTileID(V,ae.canonical,E,!0,"raster"),me=(I=g.style.map.terrain)===null||I===void 0?void 0:I.getTerrainData(ae);V.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,ge.colorAttachment.get());const ve=N.getProjectionData({overscaledTileID:ae,aligned:se,applyGlobeMatrix:!D,applyTerrainMatrix:!0});re.draw(V,H.TRIANGLES,v,f[ae.overscaledZ],b,ni.backCCW,qu(g,ue,a),me,ve,a.id,le.vertexBuffer,le.indexBuffer,le.segments)}}function Us(g,t,a,l,f,v,b,E,D){var I;const k=g.style.projection,V=g.context,N=g.transform,H=V.gl,K=g.useProgram("colorRelief"),re=!g.options.moving;let se=!0,ae=0;for(const ue of l){const ge=t.getTile(ue),le=ge.dem;if(se){const Le=H.getParameter(H.MAX_TEXTURE_SIZE),{elevationTexture:Fe,colorTexture:je}=a.getColorRampTextures(V,Le,le.getUnpackVector());V.activeTexture.set(H.TEXTURE1),Fe.bind(H.NEAREST,H.CLAMP_TO_EDGE),V.activeTexture.set(H.TEXTURE4),je.bind(H.LINEAR,H.CLAMP_TO_EDGE),se=!1,ae=Fe.size[0]}if(!le||!le.data)continue;const me=le.stride,ve=le.getPixels();if(V.activeTexture.set(H.TEXTURE0),V.pixelStoreUnpackPremultiplyAlpha.set(!1),ge.demTexture=ge.demTexture||g.getTileTexture(me),ge.demTexture){const Le=ge.demTexture;Le.update(ve,{premultiply:!1}),Le.bind(H.LINEAR,H.CLAMP_TO_EDGE)}else ge.demTexture=new u.T(V,ve,H.RGBA,{premultiply:!1}),ge.demTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const fe=k.getMeshFromTileID(V,ue.canonical,E,!0,"raster"),Se=(I=g.style.map.terrain)===null||I===void 0?void 0:I.getTerrainData(ue),Ne=N.getProjectionData({overscaledTileID:ue,aligned:re,applyGlobeMatrix:!D,applyTerrainMatrix:!0});K.draw(V,H.TRIANGLES,v,f[ue.overscaledZ],b,ni.backCCW,df(a,ge.dem,ae),Se,Ne,a.id,fe.vertexBuffer,fe.indexBuffer,fe.segments)}}const Gs=[new u.P(0,0),new u.P(u.a5,0),new u.P(u.a5,u.a5),new u.P(0,u.a5)];function Ta(g,t,a,l,f,v,b,E,D=!1,I=!1){const k=l[l.length-1].overscaledZ,V=g.context,N=V.gl,H=g.useProgram("raster"),K=g.transform,re=g.style.projection,se=g.colorModeForRenderPass(),ae=!g.options.moving,ue=a.paint.get("raster-opacity"),ge=a.paint.get("raster-resampling"),le=a.paint.get("raster-fade-duration"),me=!!g.style.map.terrain;for(const ve of l){const fe=g.getDepthModeForSublayer(ve.overscaledZ-k,ue===1?$t.ReadWrite:$t.ReadOnly,N.LESS),Se=t.getTile(ve),Ne=ge==="nearest"?N.NEAREST:N.LINEAR;V.activeTexture.set(N.TEXTURE0),Se.texture.bind(Ne,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),V.activeTexture.set(N.TEXTURE1);const{parentTile:Le,parentScaleBy:Fe,parentTopLeft:je,fadeValues:dt}=vs(Se,t,le,me);Se.fadeOpacity=dt.tileOpacity,Le?(Le.fadeOpacity=dt.parentTileOpacity,Le.texture.bind(Ne,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST)):Se.texture.bind(Ne,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),Se.texture.useMipmap&&V.extTextureFilterAnisotropic&&g.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const ft=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ve),nt=K.getProjectionData({overscaledTileID:ve,aligned:ae,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),gt=Nc(je,Fe,dt.fadeMix,a,E),Gt=re.getMeshFromTileID(V,ve.canonical,v,b,"raster");H.draw(V,N.TRIANGLES,fe,f?f[ve.overscaledZ]:di.disabled,se,D?ni.frontCCW:ni.backCCW,gt,ft,nt,a.id,Gt.vertexBuffer,Gt.indexBuffer,Gt.segments)}}function vs(g,t,a,l){const f={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||l)return f;if(g.fadingParentID){const v=t.getLoadedTile(g.fadingParentID);if(!v)return f;const b=Math.pow(2,v.tileID.overscaledZ-g.tileID.overscaledZ),E=[g.tileID.canonical.x*b%1,g.tileID.canonical.y*b%1],D=(function(I,k,V){const N=De(),H=(N-k.timeAdded)/V,K=I.fadingDirection===Oe.Incoming,re=u.an((N-I.timeAdded)/V,0,1),se=u.an(1-H,0,1),ae=K?re:se;return{tileOpacity:ae,parentTileOpacity:K?se:re,fadeMix:{opacity:1,mix:1-ae}}})(g,v,a);return{parentTile:v,parentScaleBy:b,parentTopLeft:E,fadeValues:D}}if(g.selfFading){const v=(function(b,E){const D=(De()-b.timeAdded)/E,I=u.an(D,0,1);return{tileOpacity:I,fadeMix:{opacity:I,mix:0}}})(g,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:v}}return f}const qs=new u.bp(1,0,0,1),xs=new u.bp(0,1,0,1),Wc=new u.bp(0,0,1,1),Kc=new u.bp(1,0,1,1),sa=new u.bp(0,1,1,1);function tu(g,t,a,l){zn(g,0,t+a/2,g.transform.width,a,l)}function Zs(g,t,a,l){zn(g,t-a/2,0,a,g.transform.height,l)}function zn(g,t,a,l,f,v){const b=g.context,E=b.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*g.pixelRatio,a*g.pixelRatio,l*g.pixelRatio,f*g.pixelRatio),b.clear({color:v}),E.disable(E.SCISSOR_TEST)}function tc(g,t,a){const l=g.context,f=l.gl,v=g.useProgram("debug"),b=$t.disabled,E=di.disabled,D=g.colorModeForRenderPass(),I="$debug",k=g.style.map.terrain&&g.style.map.terrain.getTerrainData(a);l.activeTexture.set(f.TEXTURE0);const V=t.getTileByID(a.key).latestRawTileData,N=Math.floor((V&&V.byteLength||0)/1024),H=t.getTile(a).tileSize,K=512/Math.min(H,512)*(a.overscaledZ/g.transform.zoom)*.5;let re=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(re+=` => ${a.overscaledZ}`),(function(ae,ue){ae.initDebugOverlayCanvas();const ge=ae.debugOverlayCanvas,le=ae.context.gl,me=ae.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,ge.width,ge.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(ue,5,5),me.strokeText(ue,5,5),ae.debugOverlayTexture.update(ge),ae.debugOverlayTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE)})(g,`${re} ${N}kB`);const se=g.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(l,f.TRIANGLES,b,E,Pi.alphaBlended,ni.disabled,Gu(u.bp.transparent,K),null,se,I,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),v.draw(l,f.LINE_STRIP,b,E,D,ni.disabled,Gu(u.bp.red),k,se,I,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Qc(g,t,a,l){const{isRenderingGlobe:f}=l,v=g.context,b=v.gl,E=g.transform,D=g.colorModeForRenderPass(),I=g.getDepthModeFor3D(),k=g.useProgram("terrain");v.bindFramebuffer.set(null),v.viewport.set([0,0,g.width,g.height]);for(const V of a){const N=t.getTerrainMesh(V.tileID),H=g.renderToTexture.getTexture(V),K=t.getTerrainData(V.tileID);v.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,H.texture);const re=t.getMeshFrameDelta(E.zoom),se=E.calculateFogMatrix(V.tileID.toUnwrapped()),ae=of(re,se,g.style.sky,E.pitch,f),ue=E.getProjectionData({overscaledTileID:V.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});k.draw(v,b.TRIANGLES,I,di.disabled,D,ni.backCCW,ae,K,ue,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}function Wh(g,t){if(!t.mesh){const a=new u.aW;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const l=new u.aY;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),t.mesh=new Fi(g.createVertexBuffer(a,_a.members),g.createIndexBuffer(l),u.aX.simpleSegment(0,0,a.length,l.length))}return t.mesh}class gf{constructor(t,a){this.context=new Mo(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=qi.maxOverzooming+qi.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Gn}resize(t,a,l){if(this.width=Math.floor(t*l),this.height=Math.floor(a*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const t=this.context,a=new u.aW;a.emplaceBack(0,0),a.emplaceBack(u.a5,0),a.emplaceBack(0,u.a5),a.emplaceBack(u.a5,u.a5),this.tileExtentBuffer=t.createVertexBuffer(a,_a.members),this.tileExtentSegments=u.aX.simpleSegment(0,0,4,2);const l=new u.aW;l.emplaceBack(0,0),l.emplaceBack(u.a5,0),l.emplaceBack(0,u.a5),l.emplaceBack(u.a5,u.a5),this.debugBuffer=t.createVertexBuffer(l,_a.members),this.debugSegments=u.aX.simpleSegment(0,0,4,5);const f=new u.ch;f.emplaceBack(0,0,0,0),f.emplaceBack(u.a5,0,u.a5,0),f.emplaceBack(0,u.a5,0,u.a5),f.emplaceBack(u.a5,u.a5,u.a5,u.a5),this.rasterBoundsBuffer=t.createVertexBuffer(f,sf.members),this.rasterBoundsSegments=u.aX.simpleSegment(0,0,4,2);const v=new u.aW;v.emplaceBack(0,0),v.emplaceBack(u.a5,0),v.emplaceBack(0,u.a5),v.emplaceBack(u.a5,u.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(v,_a.members),this.rasterBoundsSegmentsPosOnly=u.aX.simpleSegment(0,0,4,5);const b=new u.aW;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(b,_a.members),this.viewportSegments=u.aX.simpleSegment(0,0,4,2);const E=new u.ci;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(E);const D=new u.aY;D.emplaceBack(1,0,2),D.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(D);const I=this.context.gl;this.stencilClearMode=new di({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.tileExtentMesh=new Fi(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=u.N();u.c7(l,0,this.width,this.height,0,0,1),u.Q(l,l,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const f={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,$t.disabled,this.stencilClearMode,Pi.disabled,ni.disabled,null,null,f,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const f=this.context;f.setColorMode(Pi.disabled),f.setDepthMode($t.disabled);const v={};for(const b of a)v[b.key]=this.nextStencilID++;this._renderTileMasks(v,a,l,!0),this._renderTileMasks(v,a,l,!1),this._tileClippingMaskIDs=v}_renderTileMasks(t,a,l,f){const v=this.context,b=v.gl,E=this.style.projection,D=this.transform,I=this.useProgram("clippingMask");for(const k of a){const V=t[k.key],N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k),H=E.getMeshFromTileID(this.context,k.canonical,f,!0,"stencil"),K=D.getProjectionData({overscaledTileID:k,applyGlobeMatrix:!l,applyTerrainMatrix:!0});I.draw(v,b.TRIANGLES,$t.disabled,new di({func:b.ALWAYS,mask:0},V,255,b.KEEP,b.KEEP,b.REPLACE),Pi.disabled,l?ni.disabled:ni.backCCW,null,N,K,"$clipping",H.vertexBuffer,H.indexBuffer,H.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,l=this.style.projection,f=this.transform,v=this.useProgram("depth"),b=this.getDepthModeFor3D(),E=dn(f,{tileSize:f.tileSize});for(const D of E){const I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),k=l.getMeshFromTileID(this.context,D.canonical,!0,!0,"raster"),V=f.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(t,a.TRIANGLES,b,di.disabled,Pi.disabled,ni.backCCW,null,I,V,"$clipping",k.vertexBuffer,k.indexBuffer,k.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new di({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new di({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,l=t.sort(((b,E)=>E.overscaledZ-b.overscaledZ)),f=l[l.length-1].overscaledZ,v=l[0].overscaledZ-f+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const b={};for(let E=0;E<v;E++)b[E+f]=new di({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[b,l]}return[{[f]:di.disabled},l]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,l=t.sort(((b,E)=>E.overscaledZ-b.overscaledZ)),f=l[l.length-1].overscaledZ,v=l[0].overscaledZ-f+1;if(this.clearStencil(),v>1){const b={},E={};for(let D=0;D<v;D++)b[D+f]=new di({func:a.GREATER,mask:255},v+1+D,255,a.KEEP,a.KEEP,a.REPLACE),E[D+f]=new di({func:a.GREATER,mask:255},1+D,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*v+1,[b,E,l]}return this.nextStencilID=3,[{[f]:new di({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[f]:new di({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Pi([t.CONSTANT_COLOR,t.ONE],new u.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Pi.unblended:Pi.alphaBlended}getDepthModeForSublayer(t,a,l){if(!this.opaquePassEnabledForLayer())return $t.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new $t(l||this.context.gl.LEQUAL,a,[f,f])}getDepthModeFor3D(){return new $t(this.context.gl.LEQUAL,$t.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var l,f;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(De()),this.imageManager.beginFrame();const v=this.style._order,b=this.style.tileManagers,E={},D={},I={},k={isRenderingToTexture:!1,isRenderingGlobe:((l=t.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const N in b){const H=b[N];H.used&&H.prepare(this.context),E[N]=H.getVisibleCoordinates(!1),D[N]=E[N].slice().reverse(),I[N]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<v.length;N++)if(this.style._layers[v[N]].is3D()){this.opaquePassCutoff=N;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const N of v){const H=this.style._layers[N];if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const K=D[H.source];(H.type==="custom"||K.length)&&this.renderLayer(this,b[H.source],H,K,k)}if((f=this.style.projection)===null||f===void 0||f.updateGPUdependent({context:this.context,useProgram:N=>this.useProgram(N)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?u.bp.black:u.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(N,H){const K=N.context,re=K.gl,se=((ve,fe,Se)=>{const Ne=Math.cos(fe.rollInRadians),Le=Math.sin(fe.rollInRadians),Fe=bi(fe),je=fe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ve.properties.get("sky-color"),u_horizon_color:ve.properties.get("horizon-color"),u_horizon:[(fe.width/2-Fe*Le)*Se,(fe.height/2+Fe*Ne)*Se],u_horizon_normal:[-Le,Ne],u_sky_horizon_blend:ve.properties.get("sky-horizon-blend")*fe.height/2*Se,u_sky_blend:je}})(H,N.style.map.transform,N.pixelRatio),ae=new $t(re.LEQUAL,$t.ReadWrite,[0,1]),ue=di.disabled,ge=N.colorModeForRenderPass(),le=N.useProgram("sky"),me=Wh(K,H);le.draw(K,re.TRIANGLES,ae,ue,ge,ni.disabled,se,null,void 0,"sky",me.vertexBuffer,me.indexBuffer,me.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[v[this.currentLayer]],H=b[N.source],K=E[N.source];this._renderTileClippingMasks(N,K,!1),this.renderLayer(this,H,N,K,k)}this.renderPass="translucent";let V=!1;for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const N=this.style._layers[v[this.currentLayer]],H=b[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N,k))continue;this.opaquePassEnabledForLayer()||V||(V=!0,k.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const K=(N.type==="symbol"?I:D)[N.source];this._renderTileClippingMasks(N,E[N.source],!!this.renderToTexture),this.renderLayer(this,H,N,K,k)}if(k.isRenderingGlobe&&(function(N,H,K){const re=N.context,se=re.gl,ae=N.useProgram("atmosphere"),ue=new $t(se.LEQUAL,$t.ReadOnly,[0,1]),ge=N.transform,le=(function(je,dt){const ft=je.properties.get("position"),nt=[-ft.x,-ft.y,-ft.z],gt=u.ar(new Float64Array(16));return je.properties.get("anchor")==="map"&&(u.bg(gt,gt,dt.rollInRadians),u.bh(gt,gt,-dt.pitchInRadians),u.bg(gt,gt,dt.bearingInRadians),u.bh(gt,gt,dt.center.lat*Math.PI/180),u.bJ(gt,gt,-dt.center.lng*Math.PI/180)),u.cg(nt,nt,gt),nt})(K,N.transform),me=ge.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ve=H.properties.get("atmosphere-blend")*me.projectionTransition;if(ve===0)return;const fe=Ko(ge.worldSize,ge.center.lat),Se=ge.inverseProjectionMatrix,Ne=new Float64Array(4);Ne[3]=1,u.aH(Ne,Ne,ge.modelViewProjectionMatrix),Ne[0]/=Ne[3],Ne[1]/=Ne[3],Ne[2]/=Ne[3],Ne[3]=1,u.aH(Ne,Ne,Se),Ne[0]/=Ne[3],Ne[1]/=Ne[3],Ne[2]/=Ne[3],Ne[3]=1;const Le=((je,dt,ft,nt,gt)=>({u_sun_pos:je,u_atmosphere_blend:dt,u_globe_position:ft,u_globe_radius:nt,u_inv_proj_matrix:gt}))(le,ve,[Ne[0],Ne[1],Ne[2]],fe,Se),Fe=Wh(re,H);ae.draw(re,se.TRIANGLES,ue,di.disabled,Pi.alphaBlended,ni.disabled,Le,null,null,"atmosphere",Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const N=(function(H,K){let re=null;const se=Object.values(H._layers).flatMap((le=>le.source&&!le.isHidden(K)?[H.tileManagers[le.source]]:[])),ae=se.filter((le=>le.getSource().type==="vector")),ue=se.filter((le=>le.getSource().type!=="vector")),ge=le=>{(!re||re.getSource().maxzoom<le.getSource().maxzoom)&&(re=le)};return ae.forEach((le=>ge(le))),re||ue.forEach((le=>ge(le))),re})(this.style,this.transform.zoom);N&&(function(H,K,re){for(let se=0;se<re.length;se++)tc(H,K,re[se])})(this,N,N.getVisibleCoordinates())}this.options.showPadding&&(function(N){const H=N.transform.padding;tu(N,N.transform.height-(H.top||0),3,qs),tu(N,H.bottom||0,3,xs),Zs(N,H.left||0,3,Wc),Zs(N,N.transform.width-(H.right||0),3,Kc);const K=N.transform.centerPoint;(function(re,se,ae,ue){zn(re,se-1,ae-10,2,20,ue),zn(re,se-10,ae-1,20,2,ue)})(N,K.x,N.transform.height-K.y,sa)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let f=this.terrainFacilitator.dirty;f||(f=t?!u.cj(a,l):!u.ck(a,l)),f||(f=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),f&&(u.cl(a,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(v,b){const E=v.context,D=E.gl,I=v.transform,k=Pi.unblended,V=new $t(D.LEQUAL,$t.ReadWrite,[0,1]),N=b.tileManager.getRenderableTiles(),H=v.useProgram("terrainDepth");E.bindFramebuffer.set(b.getFramebuffer("depth").framebuffer),E.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),E.clear({color:u.bp.transparent,depth:1});for(const K of N){const re=b.getTerrainMesh(K.tileID),se=b.getTerrainData(K.tileID),ae=I.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ue={u_ele_delta:b.getMeshFrameDelta(I.zoom)};H.draw(E,D.TRIANGLES,V,di.disabled,k,ni.backCCW,ue,se,ae,"terrain",re.vertexBuffer,re.indexBuffer,re.segments)}E.bindFramebuffer.set(null),E.viewport.set([0,0,v.width,v.height])})(this,this.style.map.terrain),(function(v,b){const E=v.context,D=E.gl,I=v.transform,k=Pi.unblended,V=new $t(D.LEQUAL,$t.ReadWrite,[0,1]),N=b.getCoordsTexture(),H=b.tileManager.getRenderableTiles(),K=v.useProgram("terrainCoords");E.bindFramebuffer.set(b.getFramebuffer("coords").framebuffer),E.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),E.clear({color:u.bp.transparent,depth:1}),b.coordsIndex=[];for(const re of H){const se=b.getTerrainMesh(re.tileID),ae=b.getTerrainData(re.tileID);E.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,N.texture);const ue={u_terrain_coords_id:(255-b.coordsIndex.length)/255,u_texture:0,u_ele_delta:b.getMeshFrameDelta(I.zoom)},ge=I.getProjectionData({overscaledTileID:re.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});K.draw(E,D.TRIANGLES,V,di.disabled,k,ni.backCCW,ue,ae,ge,"terrain",se.vertexBuffer,se.indexBuffer,se.segments),b.coordsIndex.push(re.tileID.key)}E.bindFramebuffer.set(null),E.viewport.set([0,0,v.width,v.height])})(this,this.style.map.terrain))}renderLayer(t,a,l,f,v){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(f||[]).length)&&(this.id=l.id,u.cm(l)?(function(b,E,D,I,k,V){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:N}=V,H=di.disabled,K=b.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(re,se,ae,ue,ge,le,me,ve,fe){const Se=se.transform,Ne=se.style.map.terrain,Le=ge==="map",Fe=le==="map";for(const je of re){const dt=ue.getTile(je),ft=dt.getBucket(ae);if(!ft||!ft.text||!ft.text.segments.get().length)continue;const nt=u.ay(ft.textSizeData,Se.zoom),gt=u.aN(dt,1,se.transform.zoom),Gt=Qr(Le,se.transform,gt),Ti=ae.layout.get("icon-text-fit")!=="none"&&ft.hasIconData();if(nt){const Zi=Math.pow(2,Se.zoom-dt.tileID.overscaledZ),Ni=Ne?(Wi,zi)=>Ne.getElevation(je,Wi,zi):null;Ns(ft,Le,Fe,fe,Se,Gt,Zi,nt,Ti,u.aO(Se,dt,me,ve),je.toUnwrapped(),Ni)}}})(I,b,D,E,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),k),D.paint.get("icon-opacity").constantOr(1)!==0&&al(b,E,D,I,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),H,K,N),D.paint.get("text-opacity").constantOr(1)!==0&&al(b,E,D,I,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),H,K,N),E.map.showCollisionBoxes&&(Kn(b,E,D,I,!0),Kn(b,E,D,I,!1))})(t,a,l,f,this.style.placement.variableOffsets,v):u.cn(l)?(function(b,E,D,I,k){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:V}=k,N=D.paint.get("circle-opacity"),H=D.paint.get("circle-stroke-width"),K=D.paint.get("circle-stroke-opacity"),re=!D.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(H.constantOr(1)===0||K.constantOr(1)===0))return;const se=b.context,ae=se.gl,ue=b.transform,ge=b.getDepthModeForSublayer(0,$t.ReadOnly),le=di.disabled,me=b.colorModeForRenderPass(),ve=[],fe=ue.getCircleRadiusCorrection();for(let Se=0;Se<I.length;Se++){const Ne=I[Se],Le=E.getTile(Ne),Fe=Le.getBucket(D);if(!Fe)continue;const je=D.paint.get("circle-translate"),dt=D.paint.get("circle-translate-anchor"),ft=u.aO(ue,Le,je,dt),nt=Fe.programConfigurations.get(D.id),gt=b.useProgram("circle",nt),Gt=Fe.layoutVertexBuffer,Ti=Fe.indexBuffer,Zi=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ne),Ni={programConfiguration:nt,program:gt,layoutVertexBuffer:Gt,indexBuffer:Ti,uniformValues:Uu(b,Le,D,ft,fe),terrainData:Zi,projectionData:ue.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!V,applyTerrainMatrix:!0})};if(re){const Wi=Fe.segments.get();for(const zi of Wi)ve.push({segments:new u.aX([zi]),sortKey:zi.sortKey,state:Ni})}else ve.push({segments:Fe.segments,sortKey:0,state:Ni})}re&&ve.sort(((Se,Ne)=>Se.sortKey-Ne.sortKey));for(const Se of ve){const{programConfiguration:Ne,program:Le,layoutVertexBuffer:Fe,indexBuffer:je,uniformValues:dt,terrainData:ft,projectionData:nt}=Se.state;Le.draw(se,ae.TRIANGLES,ge,le,me,ni.backCCW,dt,ft,nt,D.id,Fe,je,Se.segments,D.paint,b.transform.zoom,Ne)}})(t,a,l,f,v):u.co(l)?(function(b,E,D,I,k){if(D.paint.get("heatmap-opacity")===0)return;const V=b.context,{isRenderingToTexture:N,isRenderingGlobe:H}=k;if(b.style.map.terrain){for(const K of I){const re=E.getTile(K);E.hasRenderableParent(K)||(b.renderPass==="offscreen"?Yh(b,re,D,K,H):b.renderPass==="translucent"&&Qn(b,D,K,N,H))}V.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?(function(K,re,se,ae){const ue=K.context,ge=ue.gl,le=K.transform,me=di.disabled,ve=new Pi([ge.ONE,ge.ONE],u.bp.transparent,[!0,!0,!0,!0]);(function(fe,Se,Ne){const Le=fe.gl;fe.activeTexture.set(Le.TEXTURE1),fe.viewport.set([0,0,Se.width/4,Se.height/4]);let Fe=Ne.heatmapFbos.get(u.cd);Fe?(Le.bindTexture(Le.TEXTURE_2D,Fe.colorAttachment.get()),fe.bindFramebuffer.set(Fe.framebuffer)):(Fe=ji(fe,Se.width/4,Se.height/4),Ne.heatmapFbos.set(u.cd,Fe))})(ue,K,se),ue.clear({color:u.bp.transparent});for(let fe=0;fe<ae.length;fe++){const Se=ae[fe];if(re.hasRenderableParent(Se))continue;const Ne=re.getTile(Se),Le=Ne.getBucket(se);if(!Le)continue;const Fe=Le.programConfigurations.get(se.id),je=K.useProgram("heatmap",Fe),dt=le.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ft=le.getCircleRadiusCorrection();je.draw(ue,ge.TRIANGLES,$t.disabled,me,ve,ni.backCCW,_o(Ne,le.zoom,se.paint.get("heatmap-intensity"),ft),null,dt,se.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,se.paint,le.zoom,Fe)}ue.viewport.set([0,0,K.width,K.height])})(b,E,D,I):b.renderPass==="translucent"&&(function(K,re){const se=K.context,ae=se.gl;se.setColorMode(K.colorModeForRenderPass());const ue=re.heatmapFbos.get(u.cd);ue&&(se.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_2D,ue.colorAttachment.get()),se.activeTexture.set(ae.TEXTURE1),ui(se,re).bind(ae.LINEAR,ae.CLAMP_TO_EDGE),K.useProgram("heatmapTexture").draw(se,ae.TRIANGLES,$t.disabled,di.disabled,K.colorModeForRenderPass(),ni.disabled,Uh(K,re,0,1),null,null,re.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments,re.paint,K.transform.zoom))})(b,D)})(t,a,l,f,v):u.cp(l)?(function(b,E,D,I,k){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:V}=k,N=D.paint.get("line-opacity"),H=D.paint.get("line-width");if(N.constantOr(1)===0||H.constantOr(1)===0)return;const K=b.getDepthModeForSublayer(0,$t.ReadOnly),re=b.colorModeForRenderPass(),se=D.paint.get("line-dasharray"),ae=se.constantOr(1),ue=D.paint.get("line-pattern"),ge=ue.constantOr(1),le=D.paint.get("line-gradient"),me=D.getCrossfadeParameters();let ve;ve=ge?"linePattern":ae&&le?"lineGradientSDF":ae?"lineSDF":le?"lineGradient":"line";const fe=b.context,Se=fe.gl,Ne=b.transform;let Le=!0;for(const Fe of I){const je=E.getTile(Fe);if(ge&&!je.patternsLoaded())continue;const dt=je.getBucket(D);if(!dt)continue;const ft=dt.programConfigurations.get(D.id),nt=b.context.program.get(),gt=b.useProgram(ve,ft),Gt=Le||gt.program!==nt,Ti=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Fe),Zi=ue.constantOr(null),Ni=se&&se.constantOr(null);if(Zi&&je.imageAtlas){const Jn=je.imageAtlas,yn=Jn.patternPositions[Zi.to.toString()],_n=Jn.patternPositions[Zi.from.toString()];yn&&_n&&ft.setConstantPatternPositions(yn,_n)}else if(Ni){const Jn=D.layout.get("line-cap")==="round",yn=b.lineAtlas.getDash(Ni.to,Jn),_n=b.lineAtlas.getDash(Ni.from,Jn);ft.setConstantDashPositions(yn,_n)}const Wi=Ne.getProjectionData({overscaledTileID:Fe,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),zi=Ne.getPixelScale();let un;ge?(un=Gh(b,je,D,zi,me),aa(fe,Se,je,ft,me)):ae&&le?(un=vo(b,je,D,zi,me,dt.lineClipsArray.length),Vr(b,E,fe,Se,D,dt,Fe,ft,me)):ae?(un=Fr(b,je,D,zi,me),on(b,fe,Se,ft,Gt,me)):le?(un=ff(b,je,D,zi,dt.lineClipsArray.length),Nr(b,E,fe,Se,D,dt,Fe)):un=Zu(b,je,D,zi);const Ki=b.stencilModeForClipping(Fe);gt.draw(fe,Se.TRIANGLES,K,Ki,re,ni.disabled,un,Ti,Wi,D.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,D.paint,b.transform.zoom,ft,dt.layoutVertexBuffer2),Le=!1}})(t,a,l,f,v):u.cq(l)?(function(b,E,D,I,k){const V=D.paint.get("fill-color"),N=D.paint.get("fill-opacity");if(N.constantOr(1)===0)return;const{isRenderingToTexture:H}=k,K=b.colorModeForRenderPass(),re=D.paint.get("fill-pattern"),se=b.opaquePassEnabledForLayer()&&!re.constantOr(1)&&V.constantOr(u.bp.transparent).a===1&&N.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===se){const ae=b.getDepthModeForSublayer(1,b.renderPass==="opaque"?$t.ReadWrite:$t.ReadOnly);gs(b,E,D,I,ae,K,!1,H)}if(b.renderPass==="translucent"&&D.paint.get("fill-antialias")){const ae=b.getDepthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,$t.ReadOnly);gs(b,E,D,I,ae,K,!0,H)}})(t,a,l,f,v):u.cr(l)?(function(b,E,D,I,k){const V=D.paint.get("fill-extrusion-opacity");if(V===0)return;const{isRenderingToTexture:N}=k;if(b.renderPass==="translucent"){const H=new $t(b.context.gl.LEQUAL,$t.ReadWrite,b.depthRangeFor3D);if(V!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))ys(b,E,D,I,H,di.disabled,Pi.disabled,N),ys(b,E,D,I,H,b.stencilModeFor3D(),b.colorModeForRenderPass(),N);else{const K=b.colorModeForRenderPass();ys(b,E,D,I,H,di.disabled,K,N)}}})(t,a,l,f,v):u.cs(l)?(function(b,E,D,I,k){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const{isRenderingToTexture:V}=k,N=b.context,H=b.style.projection.useSubdivision,K=b.getDepthModeForSublayer(0,$t.ReadOnly),re=b.colorModeForRenderPass();if(b.renderPass==="offscreen")(function(se,ae,ue,ge,le,me,ve){const fe=se.context,Se=fe.gl;for(const Ne of ue){const Le=ae.getTile(Ne),Fe=Le.dem;if(!Fe||!Fe.data||!Le.needsHillshadePrepare)continue;const je=Fe.dim,dt=Fe.stride,ft=Fe.getPixels();if(fe.activeTexture.set(Se.TEXTURE1),fe.pixelStoreUnpackPremultiplyAlpha.set(!1),Le.demTexture=Le.demTexture||se.getTileTexture(dt),Le.demTexture){const gt=Le.demTexture;gt.update(ft,{premultiply:!1}),gt.bind(Se.NEAREST,Se.CLAMP_TO_EDGE)}else Le.demTexture=new u.T(fe,ft,Se.RGBA,{premultiply:!1}),Le.demTexture.bind(Se.NEAREST,Se.CLAMP_TO_EDGE);fe.activeTexture.set(Se.TEXTURE0);let nt=Le.fbo;if(!nt){const gt=new u.T(fe,{width:je,height:je,data:null},Se.RGBA);gt.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),nt=Le.fbo=fe.createFramebuffer(je,je,!0,!1),nt.colorAttachment.set(gt.texture)}fe.bindFramebuffer.set(nt.framebuffer),fe.viewport.set([0,0,je,je]),se.useProgram("hillshadePrepare").draw(fe,Se.TRIANGLES,le,me,ve,ni.disabled,hf(Le.tileID,Fe),null,null,ge.id,se.rasterBoundsBuffer,se.quadTriangleIndexBuffer,se.rasterBoundsSegments),Le.needsHillshadePrepare=!1}})(b,E,I,D,K,di.disabled,re),N.viewport.set([0,0,b.width,b.height]);else if(b.renderPass==="translucent")if(H){const[se,ae,ue]=b.stencilConfigForOverlapTwoPass(I);_s(b,E,D,ue,se,K,re,!1,V),_s(b,E,D,ue,ae,K,re,!0,V)}else{const[se,ae]=b.getStencilConfigForOverlapAndUpdateStencilID(I);_s(b,E,D,ae,se,K,re,!1,V)}})(t,a,l,f,v):u.ct(l)?(function(b,E,D,I,k){if(b.renderPass!=="translucent"||!I.length)return;const{isRenderingToTexture:V}=k,N=b.style.projection.useSubdivision,H=b.getDepthModeForSublayer(0,$t.ReadOnly),K=b.colorModeForRenderPass();if(N){const[re,se,ae]=b.stencilConfigForOverlapTwoPass(I);Us(b,E,D,ae,re,H,K,!1,V),Us(b,E,D,ae,se,H,K,!0,V)}else{const[re,se]=b.getStencilConfigForOverlapAndUpdateStencilID(I);Us(b,E,D,se,re,H,K,!1,V)}})(t,a,l,f,v):u.bU(l)?(function(b,E,D,I,k){if(b.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!I.length)return;const{isRenderingToTexture:V}=k,N=E.getSource(),H=b.style.projection.useSubdivision;if(N instanceof Or)Ta(b,E,D,I,null,!1,!1,N.tileCoords,N.flippedWindingOrder,V);else if(H){const[K,re,se]=b.stencilConfigForOverlapTwoPass(I);Ta(b,E,D,se,K,!1,!0,Gs,!1,V),Ta(b,E,D,se,re,!0,!0,Gs,!1,V)}else{const[K,re]=b.getStencilConfigForOverlapAndUpdateStencilID(I);Ta(b,E,D,re,K,!1,!0,Gs,!1,V)}})(t,a,l,f,v):u.cu(l)?(function(b,E,D,I,k){const V=D.paint.get("background-color"),N=D.paint.get("background-opacity");if(N===0)return;const{isRenderingToTexture:H}=k,K=b.context,re=K.gl,se=b.style.projection,ae=b.transform,ue=ae.tileSize,ge=D.paint.get("background-pattern");if(b.isPatternMissing(ge))return;const le=!ge&&V.a===1&&N===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==le)return;const me=di.disabled,ve=b.getDepthModeForSublayer(0,le==="opaque"?$t.ReadWrite:$t.ReadOnly),fe=b.colorModeForRenderPass(),Se=b.useProgram(ge?"backgroundPattern":"background"),Ne=I||dn(ae,{tileSize:ue,terrain:b.style.map.terrain});ge&&(K.activeTexture.set(re.TEXTURE0),b.imageManager.bind(b.context));const Le=D.getCrossfadeParameters();for(const Fe of Ne){const je=ae.getProjectionData({overscaledTileID:Fe,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),dt=ge?Yu(N,b,ge,{tileID:Fe,tileSize:ue},Le):Xu(N,V),ft=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Fe),nt=se.getMeshFromTileID(K,Fe.canonical,!1,!0,"raster");Se.draw(K,re.TRIANGLES,ve,me,fe,ni.backCCW,dt,ft,je,D.id,nt.vertexBuffer,nt.indexBuffer,nt.segments)}})(t,0,l,f,v):u.cv(l)&&(function(b,E,D,I){const{isRenderingGlobe:k}=I,V=b.context,N=D.implementation,H=b.style.projection,K=b.transform,re=K.getProjectionDataForCustomLayer(k),se={farZ:K.farZ,nearZ:K.nearZ,fov:K.fov*Math.PI/180,modelViewProjectionMatrix:K.modelViewProjectionMatrix,projectionMatrix:K.projectionMatrix,shaderData:{variantName:H.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${H.shaderPreludeCode.vertexSource}`,define:H.shaderDefine},defaultProjectionData:re},ae=N.renderingMode?N.renderingMode:"2d";if(b.renderPass==="offscreen"){const ue=N.prerender;ue&&(b.setCustomLayerDefaults(),V.setColorMode(b.colorModeForRenderPass()),ue.call(N,V.gl,se),V.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),V.setColorMode(b.colorModeForRenderPass()),V.setStencilMode(di.disabled);const ue=ae==="3d"?b.getDepthModeFor3D():b.getDepthModeForSublayer(0,$t.ReadOnly);V.setDepthMode(ue),N.render(V.gl,se),V.setDirty(),b.setBaseState(),V.bindFramebuffer.set(null)}})(t,0,l,v))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!a||!l}useProgram(t,a,l=!1,f=[]){this.cache=this.cache||{};const v=!!this.style.map.terrain,b=this.style.projection,E=l?Qi.projectionMercator:b.shaderPreludeCode,D=l?pn:b.shaderDefine,I=t+(a?a.cacheKey:"")+`/${l?Cr:b.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(v?"/terrain":"")+(f?`/${f.join("/")}`:"");return this.cache[I]||(this.cache[I]=new lf(this.context,Qi[t],a,pf[t],this._showOverdrawInspector,v,E,D,f)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const l in this._tileTextures){const f=this._tileTextures[l];if(f)for(const v of f)v.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const l in this.cache){const f=this.cache[l];f&&f.program&&this.context.gl.deleteProgram(f.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function Kh(g,t){let a,l=!1,f=null,v=null;const b=()=>{f=null,l&&(g.apply(v,a),f=setTimeout(b,t),l=!1)};return(...E)=>(l=!0,v=this,a=E,f||b(),f)}class Sn{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let l;return a.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(l=f)})),(l&&l[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:l,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const l=a.join("/");let f=l;f.split("&").length>0&&(f=f.split("&")[0]),this._hashName&&(f=`${this._hashName}=${l}`);let v=window.location.hash.replace(f,"");v.startsWith("#&")?v=v.slice(0,1)+v.slice(2):v==="#"&&(v="");let b=window.location.href.replace(/(#.+)?$/,v);b=b.replace("&&","&"),window.history.replaceState(window.history.state,null,b)},this._updateHash=Kh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,f=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,f),b=Math.round(a.lng*v)/v,E=Math.round(a.lat*v)/v,D=this._map.getBearing(),I=this._map.getPitch();let k="";if(k+=t?`/${b}/${E}/${l}`:`${l}/${E}/${b}`,(D||I)&&(k+="/"+Math.round(10*D)/10),I&&(k+=`/${Math.round(I)}`),this._hashName){const V=this._hashName;let N=!1;const H=window.location.hash.slice(1).split("&").map((K=>{const re=K.split("=")[0];return re===V?(N=!0,`${re}=${k}`):K})).filter((K=>K));return N||H.push(`${V}=${k}`),`#${H.join("&")}`}return`#${k}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new u.V(+t[2],+t[1])}catch{return!1}const a=+t[0],l=+(t[3]||0),f=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&l>=-180&&l<=180&&f>=this._map.getMinPitch()&&f<=this._map.getMaxPitch()}}const bs={linearity:.3,easing:u.cw(0,0,.3,1)},iu=u.e({deceleration:2500,maxSpeed:1400},bs),vr=u.e({deceleration:20,maxSpeed:1400},bs),oa=u.e({deceleration:1e3,maxSpeed:360},bs),sl=u.e({deceleration:1e3,maxSpeed:90},bs),xr=u.e({deceleration:1e3,maxSpeed:360},bs);class Op{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:De(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=De();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,a.roll+=v.rollDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(a.pan.mag()){const v=ic(a.pan.mag(),l,u.e({},iu,t||{})),b=a.pan.mult(v.amount/a.pan.mag()),E=this._map.cameraHelper.handlePanInertia(b,this._map.transform);f.center=E.easingCenter,f.offset=E.easingOffset,nu(f,v)}if(a.zoom){const v=ic(a.zoom,l,vr);f.zoom=this._map.transform.zoom+v.amount,nu(f,v)}if(a.bearing){const v=ic(a.bearing,l,oa);f.bearing=this._map.transform.bearing+u.an(v.amount,-179,179),nu(f,v)}if(a.pitch){const v=ic(a.pitch,l,sl);f.pitch=this._map.transform.pitch+v.amount,nu(f,v)}if(a.roll){const v=ic(a.roll,l,xr);f.roll=this._map.transform.roll+u.an(v.amount,-179,179),nu(f,v)}if(f.zoom||f.bearing){const v=a.pinchAround===void 0?a.around:a.pinchAround;f.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),u.e(f,{noMoveStart:!0})}}function nu(g,t){(!g.duration||g.duration<t.duration)&&(g.duration=t.duration,g.easing=t.easing)}function ic(g,t,a){const{maxSpeed:l,linearity:f,deceleration:v}=a,b=u.an(g*f/(t/1e3),-l,l),E=Math.abs(b)/(v*f);return{easing:a.easing,duration:1e3*E,amount:b*(E/2)}}class Hn extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l,f={}){l=l instanceof MouseEvent?l:new MouseEvent(t,l);const v=oe.mousePos(a.getCanvas(),l),b=a.unproject(v);super(t,u.e({point:v,lngLat:b,originalEvent:l},f)),this._defaultPrevented=!1,this.target=a}}class Ga extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l){const f=t==="touchend"?l.changedTouches:l.touches,v=oe.touchPos(a.getCanvasContainer(),f),b=v.map((D=>a.unproject(D))),E=v.reduce(((D,I,k,V)=>D.add(I.div(V.length))),new u.P(0,0));super(t,{points:v,point:E,lngLats:b,lngLat:a.unproject(E),originalEvent:l}),this._defaultPrevented=!1}}class Jc extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class eh{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Jc(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Hn(t.type,this._map,t))}mouseup(t){this._map.fire(new Hn(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Hn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Hn(t.type,this._map,t))}mouseover(t){this._map.fire(new Hn(t.type,this._map,t))}mouseout(t){this._map.fire(new Hn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ga(t.type,this._map,t))}touchmove(t){this._map.fire(new Ga(t.type,this._map,t))}touchend(t){this._map.fire(new Ga(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ga(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yf{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Hn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Hn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qa{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(u.P.convert(t),this._map.terrain)}}class Eo{constructor(t,a){this._map=t,this._tr=new qa(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(oe.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const l=a;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=l,this._box||(this._box=oe.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(f.x,l.x),b=Math.max(f.x,l.x),E=Math.min(f.y,l.y),D=Math.max(f.y,l.y);oe.setTransform(this._box,`translate(${v}px,${E}px)`),this._box.style.width=b-v+"px",this._box.style.height=D-E+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const l=this._startPos,f=a;if(this.reset(),oe.suppressClick(),l.x!==f.x||l.y!==f.y)return this._map.fire(new u.l("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(l,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(oe.remove(this._box),this._box=null),oe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new u.l(t,{originalEvent:a}))}}function Ur(g,t){if(g.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${t.length}`);const a={};for(let l=0;l<g.length;l++)a[g[l].identifier]=t[l];return a}class xt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=(function(f){const v=new u.P(0,0);for(const b of f)v._add(b);return v.div(f.length)})(a),this.touches=Ur(l,a)))}touchmove(t,a,l){if(this.aborted||!this.centroid)return;const f=Ur(l,a);for(const v in this.touches){const b=f[v];(!b||b.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,a,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class nc{constructor(t){this.singleTap=new xt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,l){this.singleTap.touchstart(t,a,l)}touchmove(t,a,l){this.singleTap.touchmove(t,a,l)}touchend(t,a,l){const f=this.singleTap.touchend(t,a,l);if(f){const v=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(f)<30;if(v&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class th{constructor(t){this._tr=new qa(t),this._zoomIn=new nc({numTouches:1,numTaps:2}),this._zoomOut=new nc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,l){this._zoomIn.touchstart(t,a,l),this._zoomOut.touchstart(t,a,l)}touchmove(t,a,l){this._zoomIn.touchmove(t,a,l),this._zoomOut.touchmove(t,a,l)}touchend(t,a,l){const f=this._zoomIn.touchend(t,a,l),v=this._zoomOut.touchend(t,a,l),b=this._tr;return f?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(f)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sa{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const f=Array.isArray(a)?a[0]:a;return!this._moved&&f.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(l,f))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&oe.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Za=0,ru=2,ih={[Za]:1,[ru]:2};class ws{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=oe.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,l){const f=ih[l];return a.buttons===void 0||(a.buttons&f)!==f})(t,this._eventButton)}isValidEndEvent(t){return oe.mouseButton(t)===this._eventButton}}class ol{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class rc{constructor(t=new ws({checkCorrectEvent:()=>!0}),a=new ol){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,l){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?l(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const Ts=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=t=>{t.preventDefault()}};class nh{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,l){return this._calculateTransform(t,a,l)}touchmove(t,a,l){if(this._active){if(!this._shouldBePrevented(l.length))return t.preventDefault(),this._calculateTransform(t,a,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,l){this._calculateTransform(t,a,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,l){l.length>0&&(this._active=!0);const f=Ur(l,a),v=new u.P(0,0),b=new u.P(0,0);let E=0;for(const I in f){const k=f[I],V=this._touches[I];V&&(v._add(k),b._add(k.sub(V)),E++,f[I]=k)}if(this._touches=f,this._shouldBePrevented(E)||!b.mag())return;const D=b.div(E);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(E),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ac{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,l){if(!this._firstTwoTouches)return;t.preventDefault();const[f,v]=this._firstTwoTouches,b=Ss(l,a,f),E=Ss(l,a,v);if(!b||!E)return;const D=this._aroundCenter?null:b.add(E).div(2);return this._move([b,E],D,t)}touchend(t,a,l){if(!this._firstTwoTouches)return;const[f,v]=this._firstTwoTouches,b=Ss(l,a,f),E=Ss(l,a,v);b&&E||(this._active&&oe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ss(g,t,a){for(let l=0;l<g.length;l++)if(g[l].identifier===a)return t[l]}function Qh(g,t){return Math.log(g/t)/Math.LN2}class Ms extends ac{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Qh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qh(this._distance,l),pinchAround:a}}}function rh(g,t){return 180*g.angleWith(t)/Math.PI}class sc extends ac{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,l){const f=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:rh(this._vector,f),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,l=rh(t,this._startVector);return Math.abs(l)<a}}function Es(g){return Math.abs(g.y)>Math.abs(g.x)}class Hs extends ac{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,l){super.touchstart(t,a,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,Es(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=t[0].sub(this._lastPoints[0]),v=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,v,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,l){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,v=a.mag()>=2;if(!f&&!v)return;if(!f||!v)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const b=t.y>0==a.y>0;return Es(t)&&Es(a)&&b}}const Ma={panStep:100,bearingStep:15,pitchStep:10};class Ei{constructor(t){this._tr=new qa(t);const a=Ma;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,l=0,f=0,v=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(l=0,f=0),{cameraAnimation:E=>{const D=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:Jh,zoom:a?Math.round(D.zoom)+a*(t.shiftKey?2:1):D.zoom,bearing:D.bearing+l*this._bearingStep,pitch:D.pitch+f*this._pitchStep,offset:[-v*this._panStep,-b*this._panStep],center:D.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jh(g){return g*(2-g)}const $s=4.000244140625,Ao=1/450;class oc{constructor(t,a){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new qa(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ao}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=De(),f=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,a!==0&&a%$s==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=oe.mousePos(this._map.getCanvas(),t),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(u.V.convert(l.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const E=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=E),typeof this._targetZoom=="number"&&(this._targetZoom+=E)}if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>$s?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&D!==0&&(D=1/D);const I=typeof this._targetZoom!="number"?t.scale:u.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),u.at(I*D)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,l=this._startZoom,f=this._easing;let v,b=!1;if(this._type==="wheel"&&l&&f){const E=De()-this._lastWheelEventTime,D=Math.min((E+5)/200,1),I=f(D);v=u.G.number(l,a,I),D<1?this._frameId||(this._frameId=!0):b=!0}else v=a,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=v,{noInertia:!0,needsRenderFrame:!b,zoomDelta:v-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=u.cy;if(this._prevEase){const l=this._prevEase,f=(De()-l.start)/l.duration,v=l.easing(f+.01)-l.easing(f),b=.27/Math.sqrt(v*v+1e-4)*.01,E=Math.sqrt(.0729-b*b);a=u.cw(b,E,.25,1)}return this._prevEase={start:De(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ah{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ll{constructor(t){this._tr=new qa(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lc{constructor(){this._tap=new nc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,l){if(!this._swipePoint)if(this._tapTime){const f=a[0],v=t.timeStamp-this._tapTime<500,b=this._tapPoint.dist(f)<30;v&&b?l.length>0&&(this._swipePoint=f,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,a,l)}touchmove(t,a,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const f=a[0],v=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,a,l)}touchend(t,a,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const f=this._tap.touchend(t,a,l);f&&(this._tapTime=t.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ed{constructor(t,a,l){this._el=t,this._mousePan=a,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class la{constructor(t,a,l,f){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=l,this._mouseRoll=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class ul{constructor(t,a,l,f){this._el=t,this._touchZoom=a,this._touchRotate=l,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Tt{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=oe.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=a,this._container.appendChild(f);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=l,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(oe.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new u.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Dt=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class Ea extends u.l{}function au(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class uc{constructor(t,a){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,v)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const b=f.type==="renderFrame"?void 0:f,E={needsRenderFrame:!1},D={},I={};for(const{handlerName:N,handler:H,allowed:K}of this._handlers){if(!H.isEnabled())continue;let re;if(this._blockedByActive(I,K,N))H.reset();else if(H[v||f.type]){if(u.cz(f,v||f.type)){const se=oe.mousePos(this._map.getCanvas(),f);re=H[v||f.type](f,se)}else if(u.cA(f,v||f.type)){const se=this._getMapTouches(f.touches),ae=oe.touchPos(this._map.getCanvas(),se);re=H[v||f.type](f,ae,se)}else u.cB(v||f.type)||(re=H[v||f.type](f));this.mergeHandlerResult(E,D,re,N,b),re&&re.needsRenderFrame&&this._triggerRenderFrame()}(re||H.isActive())&&(I[N]=H)}const k={};for(const N in this._previousActiveHandlers)I[N]||(k[N]=b);this._previousActiveHandlers=I,(Object.keys(k).length||au(E))&&(this._changes.push([E,D,k]),this._triggerRenderFrame()),(Object.keys(I).length||au(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=E;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Op(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,v,b]of this._listeners)oe.addEventListener(f,v,f===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[t,a,l]of this._listeners)oe.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const a=this._map,l=a.getCanvasContainer();this._add("mapEvent",new eh(a,t));const f=a.boxZoom=new Eo(a,t);this._add("boxZoom",f),t.interactive&&t.boxZoom&&f.enable();const v=a.cooperativeGestures=new Tt(a,t.cooperativeGestures);this._add("cooperativeGestures",v),t.cooperativeGestures&&v.enable();const b=new th(a),E=new ll(a);a.doubleClickZoom=new ah(E,b),this._add("tapZoom",b),this._add("clickZoom",E),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const D=new lc;this._add("tapDragZoom",D);const I=a.touchPitch=new Hs(a);this._add("touchPitch",I),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const k=()=>a.project(a.getCenter()),V=(function({enable:le,clickTolerance:me,aroundCenter:ve=!0,minPixelCenterThreshold:fe=100,rotateDegreesPerPixelMoved:Se=.8},Ne){const Le=new ws({checkCorrectEvent:Fe=>oe.mouseButton(Fe)===0&&Fe.ctrlKey||oe.mouseButton(Fe)===2&&!Fe.ctrlKey});return new Sa({clickTolerance:me,move:(Fe,je)=>{const dt=Ne();if(ve&&Math.abs(dt.y-Fe.y)>fe)return{bearingDelta:u.cx(new u.P(Fe.x,je.y),je,dt)};let ft=(je.x-Fe.x)*Se;return ve&&je.y<dt.y&&(ft=-ft),{bearingDelta:ft}},moveStateManager:Le,enable:le,assignEvents:Ts})})(t,k),N=(function({enable:le,clickTolerance:me,pitchDegreesPerPixelMoved:ve=-.5}){const fe=new ws({checkCorrectEvent:Se=>oe.mouseButton(Se)===0&&Se.ctrlKey||oe.mouseButton(Se)===2});return new Sa({clickTolerance:me,move:(Se,Ne)=>({pitchDelta:(Ne.y-Se.y)*ve}),moveStateManager:fe,enable:le,assignEvents:Ts})})(t),H=(function({enable:le,clickTolerance:me,rollDegreesPerPixelMoved:ve=.3},fe){const Se=new ws({checkCorrectEvent:Ne=>oe.mouseButton(Ne)===2&&Ne.ctrlKey});return new Sa({clickTolerance:me,move:(Ne,Le)=>{const Fe=fe();let je=(Le.x-Ne.x)*ve;return Le.y<Fe.y&&(je=-je),{rollDelta:je}},moveStateManager:Se,enable:le,assignEvents:Ts})})(t,k);a.dragRotate=new la(t,V,N,H),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",N,["mouseRotate","mouseRoll"]),this._add("mouseRoll",H,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const K=(function({enable:le,clickTolerance:me}){const ve=new ws({checkCorrectEvent:fe=>oe.mouseButton(fe)===0&&!fe.ctrlKey});return new Sa({clickTolerance:me,move:(fe,Se)=>({around:Se,panDelta:Se.sub(fe)}),activateOnStart:!0,moveStateManager:ve,enable:le,assignEvents:Ts})})(t),re=new nh(t,a);a.dragPan=new ed(l,K,re),this._add("mousePan",K),this._add("touchPan",re,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const se=new sc,ae=new Ms;a.touchZoomRotate=new ul(l,ae,se,D),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new yf(a));const ue=a.scrollZoom=new oc(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ue,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const ge=a.keyboard=new Ei(a);this._add("keyboard",ge),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,l){this._handlers.push({handlerName:t,handler:a,allowed:l}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Dt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,l){for(const f in t)if(f!==l&&(!a||a.indexOf(f)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const l of t)this._el.contains(l.target)&&a.push(l);return a}mergeHandlerResult(t,a,l,f,v){if(!l)return;u.e(t,l);const b={handlerName:f,originalEvent:l.originalEvent||v};l.zoomDelta!==void 0&&(a.zoom=b),l.panDelta!==void 0&&(a.drag=b),l.rollDelta!==void 0&&(a.roll=b),l.pitchDelta!==void 0&&(a.pitch=b),l.bearingDelta!==void 0&&(a.rotate=b)}_applyChanges(){const t={},a={},l={};for(const[f,v,b]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new u.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.rollDelta&&(t.rollDelta=(t.rollDelta||0)+f.rollDelta),f.around!==void 0&&(t.around=f.around),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),u.e(a,v),u.e(l,b);this._updateMapTransform(t,a,l),this._changes=[]}_updateMapTransform(t,a,l){const f=this._map,v=f._getTransformForUpdate(),b=f.terrain;if(!(au(t)||b&&this._terrainMovement))return this._fireEvents(a,l,!0);f._stop(!0);let{panDelta:E,zoomDelta:D,bearingDelta:I,pitchDelta:k,rollDelta:V,around:N,pinchAround:H}=t;H!==void 0&&(N=H),N=N||f.transform.centerPoint,b&&!v.isPointOnMapSurface(N)&&(N=v.centerPoint);const K={panDelta:E,zoomDelta:D,rollDelta:V,pitchDelta:k,bearingDelta:I,around:N};this._map.cameraHelper.useGlobeControls&&!v.isPointOnMapSurface(N)&&(N=v.centerPoint);const re=N.distSqr(v.centerPoint)<.01?v.center:v.screenPointToLocation(E?N.sub(E):N);this._handleMapControls({terrain:b,tr:v,deltasForHelper:K,preZoomAroundLoc:re,combinedEventsInProgress:a,panDelta:E}),f._applyUpdatedTransform(v),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,l,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:l,preZoomAroundLoc:f,combinedEventsInProgress:v,panDelta:b}){const E=this._map.cameraHelper;if(E.handleMapControlsRollPitchBearingZoom(l,a),t)return E.useGlobeControls?(this._terrainMovement||!v.drag&&!v.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void E.handleMapControlsPan(l,a,f)):this._terrainMovement||!v.drag&&!v.zoom?void(v.drag&&this._terrainMovement&&b?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(b))):E.handleMapControlsPan(l,a,f)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void E.handleMapControlsPan(l,a,f));E.handleMapControlsPan(l,a,f)}_fireEvents(t,a,l){const f=Dt(this._eventsInProgress),v=Dt(t),b={};for(const V in t){const{originalEvent:N}=t[V];this._eventsInProgress[V]||(b[`${V}start`]=N),this._eventsInProgress[V]=t[V]}!f&&v&&this._fireEvent("movestart",v.originalEvent);for(const V in b)this._fireEvent(V,b[V]);v&&this._fireEvent("move",v.originalEvent);for(const V in t){const{originalEvent:N}=t[V];this._fireEvent(V,N)}const E={};let D;for(const V in this._eventsInProgress){const{handlerName:N,originalEvent:H}=this._eventsInProgress[V];this._handlersById[N].isActive()||(delete this._eventsInProgress[V],D=a[N]||H,E[`${V}end`]=D)}for(const V in E)this._fireEvent(V,E[V]);const I=Dt(this._eventsInProgress),k=(f||v)&&!I;if(k&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const V=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&V.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(V)}if(l&&k){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;!V||!V.essential&&Ae.prefersReducedMotion?(this._map.fire(new u.l("moveend",{originalEvent:D})),N(this._map.getBearing())&&this._map.resetNorth()):(N(V.bearing||this._map.getBearing())&&(V.bearing=0),V.freezeElevation=!0,this._map.easeTo(V,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new u.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Ea("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Mn extends u.E{constructor(t,a,l){super(),this._renderFrameCallback=()=>{const f=Math.min((De()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new u.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,l){return t=u.P.convert(t).mult(-1),this.panTo(this.transform.center,u.e({offset:t},a),l)}panTo(t,a,l){return this.easeTo(u.e({center:t},a),l)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,l){return this.easeTo(u.e({zoom:t},a),l)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new u.l("movestart",a)).fire(new u.l("move",a)).fire(new u.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,l){return this.easeTo(u.e({bearing:t},a),l)}resetNorth(t,a){return this.rotateTo(0,u.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(u.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=hn.convert(t).adjustAntiMeridian();const l=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,a)}_cameraForBoxAndBearing(t,a,l,f){const v={top:0,bottom:0,right:0,left:0};if(typeof(f=u.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const I=f.padding;f.padding={top:I,bottom:I,right:I,left:I}}const b=u.e(v,f.padding);f.padding=b;const E=this.transform,D=new hn(t,a);return this.cameraHelper.cameraForBoxAndBearing(f,b,D,l,E)}fitBounds(t,a,l){return this._fitInternal(this.cameraForBounds(t,a),a,l)}fitScreenCoordinates(t,a,l,f,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(u.P.convert(t)),this.transform.screenPointToLocation(u.P.convert(a)),l,f),f,v)}_fitInternal(t,a,l){return t?(delete(a=u.e(t,a)).padding,a.linear?this.easeTo(a,l):this.flyTo(a,l)):this}jumpTo(t,a){this.stop();const l=this._getTransformForUpdate();let f=!1,v=!1,b=!1;const E=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,t);const D=l.zoom!==E;return"elevation"in t&&l.elevation!==+t.elevation&&l.setElevation(+t.elevation),"bearing"in t&&l.bearing!==+t.bearing&&(f=!0,l.setBearing(+t.bearing)),"pitch"in t&&l.pitch!==+t.pitch&&(v=!0,l.setPitch(+t.pitch)),"roll"in t&&l.roll!==+t.roll&&(b=!0,l.setRoll(+t.roll)),t.padding==null||l.isPaddingEqual(t.padding)||l.setPadding(t.padding),this._applyUpdatedTransform(l),this.fire(new u.l("movestart",a)).fire(new u.l("move",a)),D&&this.fire(new u.l("zoomstart",a)).fire(new u.l("zoom",a)).fire(new u.l("zoomend",a)),f&&this.fire(new u.l("rotatestart",a)).fire(new u.l("rotate",a)).fire(new u.l("rotateend",a)),v&&this.fire(new u.l("pitchstart",a)).fire(new u.l("pitch",a)).fire(new u.l("pitchend",a)),b&&this.fire(new u.l("rollstart",a)).fire(new u.l("roll",a)).fire(new u.l("rollend",a)),this.fire(new u.l("moveend",a))}calculateCameraOptionsFromTo(t,a,l,f=0){const v=u.a9.fromLngLat(t,a),b=u.a9.fromLngLat(l,f),E=b.x-v.x,D=b.y-v.y,I=b.z-v.z,k=Math.hypot(E,D,I);if(k===0)throw new Error("Can't calculate camera options with same From and To");const V=Math.hypot(E,D),N=u.at(this.transform.cameraToCenterDistance/k/this.transform.tileSize),H=180*Math.atan2(E,-D)/Math.PI;let K=180*Math.acos(V/k)/Math.PI;return K=I<0?90-K:90+K,{center:b.toLngLat(),elevation:f,zoom:N,pitch:K,bearing:H}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,l,f,v){const b=this.transform.calculateCenterFromCameraLngLatAlt(t,a,l,f);return{center:b.center,elevation:b.elevation,zoom:b.zoom,bearing:l,pitch:f,roll:v}}easeTo(t,a){this._stop(!1,t.easeId),((t=u.e({offset:[0,0],duration:500,easing:u.cy},t)).animate===!1||!t.essential&&Ae.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),f=this.getBearing(),v=l.pitch,b=l.roll,E="bearing"in t?this._normalizeBearing(t.bearing,f):f,D="pitch"in t?+t.pitch:v,I="roll"in t?this._normalizeBearing(t.roll,b):b,k="padding"in t?t.padding:l.padding,V=u.P.convert(t.offset);let N,H;t.around&&(N=u.V.convert(t.around),H=l.locationToScreenPoint(N));const K={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},re=this.cameraHelper.handleEaseTo(l,{bearing:E,pitch:D,roll:I,padding:k,around:N,aroundPoint:H,offsetAsPoint:V,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||f!==E,this._pitching=this._pitching||D!==v,this._rolling=this._rolling||I!==b,this._padding=!l.isPaddingEqual(k),this._zooming=this._zooming||re.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,K),this.terrain&&this._prepareElevation(re.elevationCenter),this._ease((se=>{re.easeFunc(se),this.terrain&&!t.freezeElevation&&this._updateElevation(se),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),(se=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,se)}),t),this}_prepareEase(t,a,l={}){this._moving=!0,a||l.moving||this.fire(new u.l("movestart",t)),this._zooming&&!l.zooming&&this.fire(new u.l("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new u.l("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new u.l("pitchstart",t)),this._rolling&&!l.rolling&&this.fire(new u.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(a-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(u.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),l=t.getCameraAltitude(),f=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(l<f){const v=this.calculateCameraOptionsFromTo(a,f,t.center,t.elevation);return{pitch:v.pitch,zoom:v.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((f=>this._elevateCameraIfInsideTerrain(f))),this.transformCameraUpdate&&a.push((f=>this.transformCameraUpdate(f))),!a.length)return;const l=t.clone();for(const f of a){const v=l.clone(),{center:b,zoom:E,roll:D,pitch:I,bearing:k,elevation:V}=f(v);b&&v.setCenter(b),V!==void 0&&v.setElevation(V),E!==void 0&&v.setZoom(E),D!==void 0&&v.setRoll(D),I!==void 0&&v.setPitch(I),k!==void 0&&v.setBearing(k),l.apply(v)}this.transform.apply(l)}_fireMoveEvents(t){this.fire(new u.l("move",t)),this._zooming&&this.fire(new u.l("zoom",t)),this._rotating&&this.fire(new u.l("rotate",t)),this._pitching&&this.fire(new u.l("pitch",t)),this._rolling&&this.fire(new u.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const l=this._zooming,f=this._rotating,v=this._pitching,b=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new u.l("zoomend",t)),f&&this.fire(new u.l("rotateend",t)),v&&this.fire(new u.l("pitchend",t)),b&&this.fire(new u.l("rollend",t)),this.fire(new u.l("moveend",t))}flyTo(t,a){if(!t.essential&&Ae.prefersReducedMotion){const je=u.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(je,a)}this.stop(),t=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.cy},t);const l=this._getTransformForUpdate(),f=l.bearing,v=l.pitch,b=l.roll,E=l.padding,D="bearing"in t?this._normalizeBearing(t.bearing,f):f,I="pitch"in t?+t.pitch:v,k="roll"in t?this._normalizeBearing(t.roll,b):b,V="padding"in t?t.padding:l.padding,N=u.P.convert(t.offset);let H=l.centerPoint.add(N);const K=l.screenPointToLocation(H),re=this.cameraHelper.handleFlyTo(l,{bearing:D,pitch:I,roll:k,padding:V,locationAtOffset:K,offsetAsPoint:N,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let se=t.curve;const ae=Math.max(l.width,l.height),ue=ae/re.scaleOfZoom,ge=re.pixelPathLength;typeof re.scaleOfMinZoom=="number"&&(se=Math.sqrt(ae/re.scaleOfMinZoom/ge*2));const le=se*se;function me(je){const dt=(ue*ue-ae*ae+(je?-1:1)*le*le*ge*ge)/(2*(je?ue:ae)*le*ge);return Math.log(Math.sqrt(dt*dt+1)-dt)}function ve(je){return(Math.exp(je)-Math.exp(-je))/2}function fe(je){return(Math.exp(je)+Math.exp(-je))/2}const Se=me(!1);let Ne=function(je){return fe(Se)/fe(Se+se*je)},Le=function(je){return ae*((fe(Se)*(ve(dt=Se+se*je)/fe(dt))-ve(Se))/le)/ge;var dt},Fe=(me(!0)-Se)/se;if(Math.abs(ge)<2e-6||!isFinite(Fe)){if(Math.abs(ae-ue)<1e-6)return this.easeTo(t,a);const je=ue<ae?-1:1;Fe=Math.abs(Math.log(ue/ae))/se,Le=()=>0,Ne=dt=>Math.exp(je*se*dt)}return t.duration="duration"in t?+t.duration:1e3*Fe/("screenSpeed"in t?+t.screenSpeed/se:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==D,this._pitching=I!==v,this._rolling=k!==b,this._padding=!l.isPaddingEqual(V),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(re.targetCenter),this._ease((je=>{const dt=je*Fe,ft=1/Ne(dt),nt=Le(dt);this._rotating&&l.setBearing(u.G.number(f,D,je)),this._pitching&&l.setPitch(u.G.number(v,I,je)),this._rolling&&l.setRoll(u.G.number(b,k,je)),this._padding&&(l.interpolatePadding(E,V,je),H=l.centerPoint.add(N)),re.easeFunc(je,ft,nt,H),this.terrain&&!t.freezeElevation&&this._updateElevation(je),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,a)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,a,l){l.animate===!1||l.duration===0?(t(1),a()):(this._easeStart=De(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=u.W(t,-180,180);const l=Math.abs(t-a);return Math.abs(t-360-a)<l&&(t-=360),Math.abs(t+360-a)<l&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(u.V.convert(t),this.transform):null}}const ln={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class gn{constructor(t=ln){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=oe.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=oe.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=oe.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){oe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const l=this._map._getUIString(`AttributionControl.${a}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((f=>typeof f!="string"?"":f))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const a=this._map.style.tileManagers;for(const f in a){const v=a[f];if(v.used||v.usedForTerrain){const b=v.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t=t.filter((f=>String(f).trim())),t.sort(((f,v)=>f.length-v.length)),t=t.filter(((f,v)=>{for(let b=v+1;b<t.length;b++)if(t[b].indexOf(f)>=0)return!1;return!0}));const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=oe.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class cc{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const l=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=oe.create("div","maplibregl-ctrl");const a=oe.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){oe.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Xs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,l=a?this._queue.concat(a):this._queue;for(const f of l)if(f.id===t)return void(f.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const l of a)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ii=u.aU([{name:"a_pos3d",type:"Int16",components:3}]);class wi extends u.E{constructor(t){super(),this._lastTilesetChange=De(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const l={};for(const f of dn(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))l[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.terrainRttPosMatrix32f=new Float64Array(16),u.c7(f.terrainRttPosMatrix32f,0,u.a5,u.a5,0,0,1),this._tiles[f.key]=new Je(f,this.tileSize),this._lastTilesetChange=De());for(const f in this._tiles)l[f]||delete this._tiles[f]}freeRtt(t){for(const a in this._tiles){const l=this._tiles[a];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const l of this._renderableTilesKeys){const f=this._tiles[l].tileID,v=t.clone(),b=u.bk();if(f.canonical.equals(t.canonical))u.c7(b,0,u.a5,u.a5,0,0,1);else if(f.canonical.isChildOf(t.canonical)){const E=f.canonical.z-t.canonical.z,D=f.canonical.x-(f.canonical.x>>E<<E),I=f.canonical.y-(f.canonical.y>>E<<E),k=u.a5>>E;u.c7(b,0,k,k,0,0,1),u.O(b,b,[-D*k,-I*k,0])}else{if(!t.canonical.isChildOf(f.canonical))continue;{const E=t.canonical.z-f.canonical.z,D=t.canonical.x-(t.canonical.x>>E<<E),I=t.canonical.y-(t.canonical.y>>E<<E),k=u.a5>>E;u.c7(b,0,u.a5,u.a5,0,0,1),u.O(b,b,[D*k,I*k,0]),u.Q(b,b,[1/2**E,1/2**E,0])}}v.terrainRttPosMatrix32f=new Float32Array(b),a[l]=v}return a}_getTerrainCoordsForTileRanges(t,a){const l={};for(const f of this._renderableTilesKeys){const v=this._tiles[f].tileID;if(!this._isWithinTileRanges(v,a))continue;const b=t.clone(),E=u.bk();if(v.canonical.z===t.canonical.z){const D=t.canonical.x-v.canonical.x,I=t.canonical.y-v.canonical.y;u.c7(E,0,u.a5,u.a5,0,0,1),u.O(E,E,[D*u.a5,I*u.a5,0])}else if(v.canonical.z>t.canonical.z){const D=v.canonical.z-t.canonical.z,I=v.canonical.x-(v.canonical.x>>D<<D),k=v.canonical.y-(v.canonical.y>>D<<D),V=t.canonical.x-(v.canonical.x>>D),N=t.canonical.y-(v.canonical.y>>D),H=u.a5>>D;u.c7(E,0,H,H,0,0,1),u.O(E,E,[-I*H+V*u.a5,-k*H+N*u.a5,0])}else{const D=t.canonical.z-v.canonical.z,I=t.canonical.x-(t.canonical.x>>D<<D),k=t.canonical.y-(t.canonical.y>>D<<D),V=(t.canonical.x>>D)-v.canonical.x,N=(t.canonical.y>>D)-v.canonical.y,H=u.a5<<D;u.c7(E,0,H,H,0,0,1),u.O(E,E,[I*u.a5+V*H,k*u.a5+N*H,0])}b.terrainRttPosMatrix32f=new Float32Array(E),l[f]=b}return l}getSourceTile(t,a){const l=this.tileManager._source;let f=t.overscaledZ-this.deltaZoom;if(f>l.maxzoom&&(f=l.maxzoom),f<l.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(f).key);let v=this.findTileInCaches(this._sourceTileCache[t.key]);if(!v?.dem&&a)for(;f>=l.minzoom&&!v?.dem;)v=this.findTileInCaches(t.scaledTo(f--).key);return v}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class ti{constructor(t,a,l){this._meshCache={},this.painter=t,this.tileManager=new wi(a),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,l,f=u.a5){var v;if(!(a>=0&&a<f&&l>=0&&l<f))return 0;const b=this.getTerrainData(t),E=(v=b.tile)===null||v===void 0?void 0:v.dem;if(!E)return 0;const D=u.cC([],[a/f*u.a5,l/f*u.a5],b.u_terrain_matrix),I=[D[0]*E.dim,D[1]*E.dim],k=Math.floor(I[0]),V=Math.floor(I[1]),N=I[0]-k,H=I[1]-V;return E.get(k,V)*(1-N)*(1-H)+E.get(k+1,V)*N*(1-H)+E.get(k,V+1)*(1-N)*H+E.get(k+1,V+1)*N*H}getElevationForLngLatZoom(t,a){if(!u.cD(a,t.wrap()))return 0;const{tileID:l,mercatorX:f,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(l,f%u.a5,v%u.a5,u.a5)}getElevationForLngLat(t,a){const l=dn(a,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let f=0;for(const v of l)v.canonical.z>f&&(f=Math.min(v.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,f)}getElevation(t,a,l,f=u.a5){return this.getDEMElevation(t,a,l,f)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const f=this.painter.context,v=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new u.T(f,v,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new u.T(f,new u.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.ar([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const f=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new u.T(f,a.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),a.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const l=a&&a.toString()+a.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const f=this.tileManager.getSource().maxzoom;let v=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=f?v=t.canonical.z-f:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=t.canonical.x-(t.canonical.x>>v<<v),E=t.canonical.y-(t.canonical.y>>v<<v),D=u.cE(new Float64Array(16),[1/(u.a5<<v),1/(u.a5<<v),0]);u.O(D,D,[b*u.a5,E*u.a5,0]),this._demMatrixCache[t.key]={matrix:D,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,l=a.width/devicePixelRatio,f=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new u.T(a.context,{width:l,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new u.T(a.context,{width:l,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(l,f,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,l,f))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,b=0;v<this._coordsTextureSize;v++)for(let E=0;E<this._coordsTextureSize;E++,b+=4)a[b+0]=255&E,a[b+1]=255&v,a[b+2]=E>>8<<4|v>>8,a[b+3]=0;const l=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),f=new u.T(t,l,t.gl.RGBA,{premultiply:!1});return f.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),l=this.painter.context,f=l.gl,v=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),b=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),E=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(v,E-b-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null);const D=a[0]+(a[2]>>4<<8),I=a[1]+((15&a[2])<<8),k=this.coordsIndex[255-a[3]],V=k&&this.tileManager.getTileByID(k);if(!V)return null;const N=this._coordsTextureSize,H=(1<<V.tileID.canonical.z)*N;return new u.a9((V.tileID.canonical.x*N+D)/H+V.tileID.wrap,(V.tileID.canonical.y*N+I)/H,this.getElevation(V.tileID,D,I,N))}depthAtPoint(t){const a=new Uint8Array(4),l=this.painter.context,f=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const l=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,f=l&&t.canonical.y===0,v=l&&t.canonical.y===(1<<t.canonical.z)-1,b=`m_${f?"n":""}_${v?"s":""}`;if(this._meshCache[b])return this._meshCache[b];const E=this.painter.context,D=new u.cF,I=new u.aY,k=this.meshSize,V=u.a5/k,N=k*k;for(let fe=0;fe<=k;fe++)for(let Se=0;Se<=k;Se++)D.emplaceBack(Se*V,fe*V,0);for(let fe=0;fe<N;fe+=k+1)for(let Se=0;Se<k;Se++)I.emplaceBack(Se+fe,k+Se+fe+1,k+Se+fe+2),I.emplaceBack(Se+fe,k+Se+fe+2,Se+fe+1);const H=D.length,K=H+(k+1),re=(k+1)*k,se=f?u.br:0,ae=f?0:1,ue=v?u.bs:u.a5,ge=v?0:1;for(let fe=0;fe<=k;fe++)D.emplaceBack(fe*V,se,ae);for(let fe=0;fe<=k;fe++)D.emplaceBack(fe*V,ue,ge);for(let fe=0;fe<k;fe++)I.emplaceBack(re+fe,K+fe,K+fe+1),I.emplaceBack(re+fe,K+fe+1,re+fe+1),I.emplaceBack(0+fe,H+fe+1,H+fe),I.emplaceBack(0+fe,0+fe+1,H+fe+1);const le=D.length,me=le+2*(k+1);for(const fe of[0,1])for(let Se=0;Se<=k;Se++)for(const Ne of[0,1])D.emplaceBack(fe*u.a5,Se*V,Ne);for(let fe=0;fe<2*k;fe+=2)I.emplaceBack(le+fe,le+fe+1,le+fe+3),I.emplaceBack(le+fe,le+fe+3,le+fe+2),I.emplaceBack(me+fe,me+fe+3,me+fe+1),I.emplaceBack(me+fe,me+fe+2,me+fe+3);const ve=new Fi(E.createVertexBuffer(D,ii.members),E.createIndexBuffer(I),u.aX.simpleSegment(0,0,D.length,I.length));return this._meshCache[b]=ve,ve}getMeshFrameDelta(t){return 2*Math.PI*u.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var l;if(!u.cD(a,t.wrap()))return 0;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(l=this.getMinMaxElevation(f).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return a&&a.dem&&(l.minElevation=a.dem.min*this.exaggeration,l.maxElevation=a.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,a){const l=u.a9.fromLngLat(t.wrap()),f=(1<<a)*u.a5,v=l.x*f,b=l.y*f,E=Math.floor(v/u.a5),D=Math.floor(b/u.a5);return{tileID:new u.a2(a,0,a,E,D),mercatorX:v,mercatorY:b}}}class tn{constructor(t,a,l){this._context=t,this._size=a,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new u.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(l.texture),{id:t,fbo:a,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const Aa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Ha{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new tn(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((l=>!t._layers[l].isHidden(a))),this._coordsAscending={};for(const l in t.tileManagers){this._coordsAscending[l]={};const f=t.tileManagers[l].getVisibleCoordinates(),v=t.tileManagers[l].getSource(),b=v instanceof Or?v.terrainTileRanges:null;for(const E of f){const D=this.terrain.tileManager.getTerrainCoords(E,b);for(const I in D)this._coordsAscending[l][I]||(this._coordsAscending[l][I]=[]),this._coordsAscending[l][I].push(D[I])}}this._coordsAscendingStr={};for(const l of t._order){const f=t._layers[l],v=f.source;if(Aa[f.type]&&!this._coordsAscendingStr[v]){this._coordsAscendingStr[v]={};for(const b in this._coordsAscending[v])this._coordsAscendingStr[v][b]=this._coordsAscending[v][b].map((E=>E.key)).sort().join()}}for(const l of this._renderableTiles)for(const f in this._coordsAscendingStr){const v=this._coordsAscendingStr[f][l.tileID.key];v&&v!==l.rttCoords[f]&&(l.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),f=t.type,v=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Aa[f]&&(this._prevType&&Aa[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(t.id),!b))return!0;if(Aa[this._prevType]||Aa[f]&&b){this._prevType=f;const E=this._stacks.length-1,D=this._stacks[E]||[];for(const I of this._renderableTiles){if(this.pool.isFull()&&(Qc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(I),I.rtt[E]){const V=this.pool.getObjectForId(I.rtt[E].id);if(V.stamp===I.rtt[E].stamp){this.pool.useObject(V);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),I.rtt[E]={id:k.id,stamp:k.stamp},v.context.bindFramebuffer.set(k.fbo.framebuffer),v.context.clear({color:u.bp.transparent,stencil:0}),v.currentStencilSource=void 0;for(let V=0;V<D.length;V++){const N=v.style._layers[D[V]],H=N.source?this._coordsAscending[N.source][I.tileID.key]:[I.tileID];v.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),v._renderTileClippingMasks(N,H,!0),v.renderLayer(v,v.style.tileManagers[N.source],N,H,l),N.source&&(I.rttCoords[N.source]=this._coordsAscendingStr[N.source][I.tileID.key])}}return Qc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),Aa[f]}return!1}}const cl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},hl=j,Ys={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ln,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},td={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Yi{constructor(t,a,l=!1){this.mousedown=v=>{this.startMove(v,oe.mousePos(this.element,v)),oe.addEventListener(window,"mousemove",this.mousemove),oe.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.move(v,oe.mousePos(this.element,v))},this.mouseup=v=>{this._rotatePitchHandler.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=oe.touchPos(this.element,v.targetTouches)[0],this.startMove(v,this._startPos),oe.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),oe.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=oe.touchPos(this.element,v.targetTouches)[0],this.move(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const f=new rc;this._rotatePitchHandler=new Sa({clickTolerance:3,move:(v,b)=>{const E=a.getBoundingClientRect(),D=new u.P((E.bottom-E.top)/2,(E.right-E.left)/2);return{bearingDelta:u.cx(new u.P(v.x,b.y),b,D),pitchDelta:l?-.5*(b.y-v.y):void 0}},moveStateManager:f,enable:!0,assignEvents:()=>{}}),this.map=t,oe.addEventListener(a,"mousedown",this.mousedown),oe.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),oe.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),oe.disableDrag()}move(t,a){const l=this.map,{bearingDelta:f,pitchDelta:v}=this._rotatePitchHandler.dragMove(t,a)||{};f&&l.setBearing(l.getBearing()+f),v&&l.setPitch(l.getPitch()+v)}off(){const t=this.element;oe.removeEventListener(t,"mousedown",this.mousedown),oe.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),oe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),oe.removeEventListener(window,"touchend",this.touchend),oe.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){oe.enableDrag(),oe.removeEventListener(window,"mousemove",this.mousemove),oe.removeEventListener(window,"mouseup",this.mouseup),oe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),oe.removeEventListener(window,"touchend",this.touchend)}}let $a;function su(g,t,a,l=!1){if(l||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return g?.wrap();const f=new u.V(g.lng,g.lat);if(g=new u.V(g.lng,g.lat),t){const v=new u.V(g.lng-360,g.lat),b=new u.V(g.lng+360,g.lat),E=a.locationToScreenPoint(g).distSqr(t);a.locationToScreenPoint(v).distSqr(t)<E?g=v:a.locationToScreenPoint(b).distSqr(t)<E&&(g=b)}for(;Math.abs(g.lng-a.center.lng)>180;){const v=a.locationToScreenPoint(g);if(v.x>=0&&v.y>=0&&v.x<=a.width&&v.y<=a.height)break;g.lng>a.center.lng?g.lng-=360:g.lng+=360}return g.lng!==f.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(g))?g:f}const ou={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function hc(g,t,a){const l=g.classList;for(const f in ou)l.remove(`maplibregl-${a}-anchor-${f}`);l.add(`maplibregl-${a}-anchor-${t}`)}class dc extends u.E{constructor(t){if(super(),this._onKeyPress=a=>{const l=a.code,f=a.charCode||a.keyCode;l!=="Space"&&l!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=a=>{const l=a.originalEvent.target,f=this._element;this._popup&&(l===f||f.contains(l))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=su(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),oe.setTransform(this._element,`${ou[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${f}`),Ae.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.l("dragstart"))),this.fire(new u.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=u.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=oe.create("div");const a=oe.createNS("http://www.w3.org/2000/svg","svg"),l=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${l}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${l}`);const v=oe.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const b=oe.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const E=oe.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of D){const ue=oe.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",ae.rx),ue.setAttributeNS(null,"ry",ae.ry),E.appendChild(ue)}const I=oe.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);const k=oe.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(k);const V=oe.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"opacity","0.25"),V.setAttributeNS(null,"fill","#000000");const N=oe.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),V.appendChild(N);const H=oe.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const K=oe.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=oe.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const se=oe.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),K.appendChild(re),K.appendChild(se),b.appendChild(E),b.appendChild(I),b.appendChild(V),b.appendChild(H),b.appendChild(K),a.appendChild(b),a.setAttributeNS(null,"height",l*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=u.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),hc(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),oe.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,l;const f=(a=this._map)===null||a===void 0?void 0:a.terrain,v=this._map.transform.isLocationOccluded(this._lngLat);if(!f||v){const H=v?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==H&&(this._element.style.opacity=H))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const b=this._map,E=b.terrain.depthAtPoint(this._pos),D=b.terrain.getElevationForLngLat(this._lngLat,b.transform);if(b.transform.lngLatToCameraDepth(this._lngLat,D)-E<.006)return void(this._element.style.opacity=this._opacity);const I=-this._offset.y/b.transform.pixelsPerMeter,k=Math.sin(b.getPitch()*Math.PI/180)*I,V=b.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),N=b.transform.lngLatToCameraDepth(this._lngLat,D+k)-V>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&N&&this._popup.remove(),this._element.style.opacity=N?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=u.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const fc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Co=0,Ws=!1;const cr={maxWidth:100,unit:"metric"};function nn(g,t,a){const l=a&&a.maxWidth||100,f=g._container.clientHeight/2,v=g._container.clientWidth/2,b=g.unproject([v-l/2,f]),E=g.unproject([v+l/2,f]),D=Math.round(g.project(E).x-g.project(b).x),I=Math.min(l,D,g._container.clientWidth),k=b.distanceTo(E);if(a&&a.unit==="imperial"){const V=3.2808*k;V>5280?As(t,I,V/5280,g._getUIString("ScaleControl.Miles")):As(t,I,V,g._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?As(t,I,k/1852,g._getUIString("ScaleControl.NauticalMiles")):k>=1e3?As(t,I,k/1e3,g._getUIString("ScaleControl.Kilometers")):As(t,I,k,g._getUIString("ScaleControl.Meters"))}function As(g,t,a,l){const f=(function(v){const b=Math.pow(10,`${Math.floor(v)}`.length-1);let E=v/b;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:(function(D){const I=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*I)/I})(E),b*E})(a);g.style.width=t*(f/a)+"px",g.innerHTML=`${f}&nbsp;${l}`}const dl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},fl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lu(g){if(g){if(typeof g=="number"){const t=Math.round(Math.abs(g)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,g),"top-left":new u.P(t,t),"top-right":new u.P(-t,t),bottom:new u.P(0,-g),"bottom-left":new u.P(t,-t),"bottom-right":new u.P(-t,-t),left:new u.P(g,0),right:new u.P(-g,0)}}if(g instanceof u.P||Array.isArray(g)){const t=u.P.convert(g);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:u.P.convert(g.center||[0,0]),top:u.P.convert(g.top||[0,0]),"top-left":u.P.convert(g["top-left"]||[0,0]),"top-right":u.P.convert(g["top-right"]||[0,0]),bottom:u.P.convert(g.bottom||[0,0]),"bottom-left":u.P.convert(g["bottom-left"]||[0,0]),"bottom-right":u.P.convert(g["bottom-right"]||[0,0]),left:u.P.convert(g.left||[0,0]),right:u.P.convert(g.right||[0,0])}}return lu(new u.P(0,0))}const Xa=j;M.AJAXError=u.cI,M.Event=u.l,M.Evented=u.E,M.LngLat=u.V,M.MercatorCoordinate=u.a9,M.Point=u.P,M.addProtocol=u.cJ,M.config=u.c,M.removeProtocol=u.cK,M.AttributionControl=gn,M.BoxZoomHandler=Eo,M.CanvasSource=W,M.CooperativeGesturesHandler=Tt,M.DoubleClickZoomHandler=ah,M.DragPanHandler=ed,M.DragRotateHandler=la,M.EdgeInsets=Jr,M.FullscreenControl=class extends u.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){oe.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=oe.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);oe.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},M.GeoJSONSource=Wn,M.GeolocateControl=class extends u.E{constructor(g){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new u.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new u.V(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,f=this._map.getBearing(),v=u.e({bearing:f},this.options.fitBoundsOptions),b=hn.fromLngLat(a,l);this._map.fitBounds(b,v,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new u.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Ws)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=oe.create("button","maplibregl-ctrl-geolocate",this._container),oe.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=oe.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new dc({element:this._dotElement}),this._circleElement=oe.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const l=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.l("trackuserlocationend")),this.fire(new u.l("userlocationlostfocus")))}))}},this.options=u.e({},fc,g)}onAdd(g){return this._map=g,this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return u._(this,arguments,void 0,(function*(t=!1){if($a!==void 0&&!t)return $a;if(window.navigator.permissions===void 0)return $a=!!window.navigator.geolocation,$a;try{$a=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{$a=!!window.navigator.geolocation}return $a}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),oe.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Co=0,Ws=!1}_isOutOfMapMaxBounds(g){const t=this._map.getMaxBounds(),a=g.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const g=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&g))return;const t=this._map.project(g),a=this._map.unproject([t.x+100,t.y]),l=g.distanceTo(a)/100,f=2*this._accuracy/l;this._circleElement.style.width=`${f.toFixed(2)}px`,this._circleElement.style.height=`${f.toFixed(2)}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Co--,Ws=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.l("trackuserlocationstart")),this.fire(new u.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Co++,Co>1?(g={maximumAge:6e5,timeout:0},Ws=!0):(g=this.options.positionOptions,Ws=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},M.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const t=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=oe.create("button","maplibregl-ctrl-globe",this._container),oe.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){oe.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},M.Hash=Sn,M.ImageSource=Or,M.KeyboardHandler=Ei,M.LngLatBounds=hn,M.LogoControl=cc,M.Map=class extends Mn{constructor(g){var t,a;u.cG.mark(u.cH.create);const l=Object.assign(Object.assign(Object.assign({},Ys),g),{canvasContextAttributes:Object.assign(Object.assign({},Ys.canvasContextAttributes),g.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const f=new On,v=new Yo;if(l.minZoom!==void 0&&f.setMinZoom(l.minZoom),l.maxZoom!==void 0&&f.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&f.setMinPitch(l.minPitch),l.maxPitch!==void 0&&f.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&f.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&f.setConstrainOverride(l.transformConstrain),super(f,v,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Xs,this._controls=[],this._mapId=u.af(),this._lostContextStyle={style:null,images:null},this._contextLost=E=>{E.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const D of Object.values(this.style._layers))if(D.type==="custom"&&console.warn(`Custom layer with id '${D.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),D._listeners)for(const[I]of Object.entries(D._listeners))console.warn(`Custom layer with id '${D.id}' had event listeners for event '${I}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new u.l("webglcontextlost",{originalEvent:E}))},this._contextRestored=E=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new u.l("webglcontextrestored",{originalEvent:E}))},this._onMapScroll=E=>{if(E.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},cl),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this._zoomLevelsToOverscale=l.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,l.reduceMotion!==void 0&&(Ae.prefersReducedMotion=l.reduceMotion),this._imageQueueHandle=mt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Et(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let E=!1;const D=Kh((I=>{this._trackResize&&!this._removed&&(this.resize(I),this.redraw())}),50);this._resizeObserver=new ResizeObserver((I=>{E?D(I):E=!0})),this._resizeObserver.observe(this._container)}this.handlers=new uc(this,l),this._hash=l.hash&&new Sn(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,u.e({},l.fitBoundsOptions,{duration:0}))));const b=typeof l.style=="string"||((a=(t=l.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,b),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new gn(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new cc,l.logoPosition),this.on("style.load",(()=>{if(b||this._resizeTransform(),this.transform.unmodified){const E=u.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(E)}})),this.on("data",(E=>{this._update(E.dataType==="style"),this.fire(new u.l(`${E.dataType}data`,E))})),this.on("dataloading",(E=>{this.fire(new u.l(`${E.dataType}dataloading`,E))})),this.on("dataabort",(E=>{this.fire(new u.l("sourcedataabort",E))}))}_getMapId(){return this._mapId}setGlobalStateProperty(g,t){return this.style.setGlobalStateProperty(g,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(g,t){if(t===void 0&&(t=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new u.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=g.onAdd(this);this._controls.push(g);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(a,l.firstChild):l.appendChild(a),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new u.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(g);return t>-1&&this._controls.splice(t,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}coveringTiles(g){return dn(this.transform,g)}calculateCameraOptionsFromTo(g,t,a,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLat(a,this.transform)),super.calculateCameraOptionsFromTo(g,t,a,l)}resize(g,t=!0){const[a,l]=this._containerDimensions(),f=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,f),this.painter.resize(a,l,f),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const E=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,E),this.painter.resize(a,l,E)}this._resizeTransform(t);const v=!this._moving;return v&&(this.stop(),this.fire(new u.l("movestart",g)).fire(new u.l("move",g))),this.fire(new u.l("resize",g)),v&&this.fire(new u.l("moveend",g)),this}_resizeTransform(g=!0){var t;const[a,l]=this._containerDimensions();this.transform.resize(a,l,g),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,l,g)}_getClampedPixelRatio(g,t){const{0:a,1:l}=this._maxCanvasSize,f=this.getPixelRatio(),v=g*f,b=t*f;return Math.min(v>a?a/v:1,b>l?l/b:1)*f}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(hn.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(g),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(g),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}setTransformConstrain(g){return this.transform.setConstrainOverride(g),this._update()}project(g){return this.transform.locationToScreenPoint(u.V.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(u.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,t,a){if(g==="mouseenter"||g==="mouseover"){let l=!1;return{layers:t,listener:a,delegates:{mousemove:v=>{const b=t.filter((D=>this.getLayer(D))),E=b.length!==0?this.queryRenderedFeatures(v.point,{layers:b}):[];E.length?l||(l=!0,a.call(this,new Hn(g,this,v.originalEvent,{features:E}))):l=!1},mouseout:()=>{l=!1}}}}if(g==="mouseleave"||g==="mouseout"){let l=!1;return{layers:t,listener:a,delegates:{mousemove:b=>{const E=t.filter((D=>this.getLayer(D)));(E.length!==0?this.queryRenderedFeatures(b.point,{layers:E}):[]).length?l=!0:l&&(l=!1,a.call(this,new Hn(g,this,b.originalEvent)))},mouseout:b=>{l&&(l=!1,a.call(this,new Hn(g,this,b.originalEvent)))}}}}{const l=f=>{const v=t.filter((E=>this.getLayer(E))),b=v.length!==0?this.queryRenderedFeatures(f.point,{layers:v}):[];b.length&&(f.features=b,a.call(this,f),delete f.features)};return{layers:t,listener:a,delegates:{[g]:l}}}}_saveDelegatedListener(g,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(t)}_removeDelegatedListener(g,t,a){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const l=this._delegatedListeners[g];for(let f=0;f<l.length;f++){const v=l[f];if(v.listener===a&&v.layers.length===t.length&&v.layers.every((b=>t.includes(b)))){for(const b in v.delegates)this.off(b,v.delegates[b]);return void l.splice(f,1)}}}on(g,t,a){if(a===void 0)return super.on(g,t);const l=typeof t=="string"?[t]:t,f=this._createDelegatedListener(g,l,a);this._saveDelegatedListener(g,f);for(const v in f.delegates)this.on(v,f.delegates[v]);return{unsubscribe:()=>{this._removeDelegatedListener(g,l,a)}}}once(g,t,a){if(a===void 0)return super.once(g,t);const l=typeof t=="string"?[t]:t,f=this._createDelegatedListener(g,l,a);for(const v in f.delegates){const b=f.delegates[v];f.delegates[v]=(...E)=>{this._removeDelegatedListener(g,l,a),b(...E)}}this._saveDelegatedListener(g,f);for(const v in f.delegates)this.once(v,f.delegates[v]);return this}off(g,t,a){return a===void 0?super.off(g,t):(this._removeDelegatedListener(g,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(g,t){if(!this.style)return[];let a;const l=g instanceof u.P||Array.isArray(g),f=l?g:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:g)||{},f instanceof u.P||typeof f[0]=="number")a=[u.P.convert(f)];else{const v=u.P.convert(f[0]),b=u.P.convert(f[1]);a=[v,new u.P(b.x,v.y),b,new u.P(v.x,b.y),v]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(g,t){return this.style.querySourceFeatures(g,t)}setStyle(g,t){return(t=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(g,t))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const t=this._locale[g];if(t==null)throw new Error(`Missing UI string '${g}'`);return t}_updateStyle(g,t){var a,l;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(g,t)));const f=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new go(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,t,f):this.style.loadJSON(g,t,f),this):((l=(a=this.style)===null||a===void 0?void 0:a.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new go(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,t){if(typeof g=="string"){const a=this._requestManager.transformRequest(g,"Style");u.j(a,new AbortController).then((l=>{this._updateDiff(l.data,t)})).catch((l=>{l&&this.fire(new u.k(l))}))}else typeof g=="object"&&this._updateDiff(g,t)}_updateDiff(g,t){try{this.style.setState(g,t)&&this._update(!0)}catch(a){u.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(g,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(g,t){return this._lazyInitEmptyStyle(),this.style.addSource(g,t),this._update(!0)}isSourceLoaded(g){const t=this.style&&this.style.tileManagers[g];if(t!==void 0)return t.loaded();this.fire(new u.k(new Error(`There is no tile manager with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const t=this.style.tileManagers[g.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const l=this.style._layers[a];l.type==="hillshade"&&l.source===g.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===g.source&&u.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ti(this.painter,t,g),this.painter.renderToTexture=new Ha(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var l;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=a.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new u.l("terrain",{terrain:g})),this}getTerrain(){var g,t;return(t=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const g=this.style&&this.style.tileManagers;for(const t of Object.values(g))if(!t.areTilesLoaded())return!1;return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}setSourceTileLodParams(g,t,a){if(a){const l=this.getSource(a);if(!l)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);l.calculateTileZoom=Mi(Math.max(1,g),Math.max(1,t))}else for(const l in this.style.tileManagers)this.style.tileManagers[l].getSource().calculateTileZoom=Mi(Math.max(1,g),Math.max(1,t));return this._update(!0),this}refreshTiles(g,t){const a=this.style.tileManagers[g];if(!a)throw new Error(`There is no tile manager with ID "${g}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((l=>new u.ac(l.z,l.x,l.y))))}addImage(g,t,a={}){const{pixelRatio:l=1,sdf:f=!1,stretchX:v,stretchY:b,content:E,textFitWidth:D,textFitHeight:I}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||u.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:V,data:N}=t,H=t;return this.style.addImage(g,{data:new u.R({width:k,height:V},new Uint8Array(N)),pixelRatio:l,stretchX:v,stretchY:b,content:E,textFitWidth:D,textFitHeight:I,sdf:f,version:0,userImage:H}),H.onAdd&&H.onAdd(this,g),this}}{const{width:k,height:V,data:N}=Ae.getImageData(t);this.style.addImage(g,{data:new u.R({width:k,height:V},N),pixelRatio:l,stretchX:v,stretchY:b,content:E,textFitWidth:D,textFitHeight:I,sdf:f,version:0})}}updateImage(g,t){const a=this.style.getImage(g);if(!a)return this.fire(new u.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||u.b(t)?Ae.getImageData(t):t,{width:f,height:v,data:b}=l;if(f===void 0||v===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==a.data.width||v!==a.data.height)return this.fire(new u.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(t instanceof HTMLImageElement||u.b(t));return a.data.replace(b,E),this.style.updateImage(g,a),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new u.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return mt.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,t){return this._lazyInitEmptyStyle(),this.style.addLayer(g,t),this._update(!0)}moveLayer(g,t){return this.style.moveLayer(g,t),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,t,a){return this.style.setLayerZoomRange(g,t,a),this._update(!0)}setFilter(g,t,a={}){return this.style.setFilter(g,t,a),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,t,a,l={}){return this.style.setPaintProperty(g,t,a,l),this._update(!0)}getPaintProperty(g,t){return this.style.getPaintProperty(g,t)}setLayoutProperty(g,t,a,l={}){return this.style.setLayoutProperty(g,t,a,l),this._update(!0)}getLayoutProperty(g,t){return this.style.getLayoutProperty(g,t)}setGlyphs(g,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,t,a,(l=>{l||this._update(!0)})),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,t,(a=>{a||this._update(!0)})),this}setLight(g,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,t){return this.style.setFeatureState(g,t),this._update()}removeFeatureState(g,t){return this.style.removeFeatureState(g,t),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,t=0;return this._container&&(g=this._container.clientWidth||400,t=this._container.clientHeight||300),[g,t]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const t=this._canvasContainer=oe.create("div","maplibregl-canvas-container",g);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=oe.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),l=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],l);const f=this._controlContainer=oe.create("div","maplibregl-control-container",g),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((b=>{v[b]=oe.create("div",`maplibregl-ctrl-${b} `,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,t,a){this._canvas.width=Math.floor(a*g),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{t={requestedAttributes:g},l&&(t.statusMessage=l.statusMessage,t.type=l.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!a){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new gf(a,this.transform),We.testSupport(a)}migrateProjection(g,t){super.migrateProjection(g,t),this.painter.transform=g,this.fire(new u.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var t,a,l,f,v;const b=this._idleTriggered?this._fadeDuration:0,E=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let D=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,N=De();this.style.zoomHistory.update(V,N);const H=new u.H(V,{now:N,fadeDuration:b,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),K=H.crossFadingFactor();K===1&&K===this._crossFadingFactor||(D=!0,this._crossFadingFactor=K),this.style.update(H)}const I=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==E;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((f=this.style.projection)===null||f===void 0?void 0:f.transitionState,(v=this.style.projection)===null||v===void 0?void 0:v.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||I)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,I),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,showPadding:this.showPadding}),this.fire(new u.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.cG.mark(u.cH.load),this.fire(new u.l("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const k=this._sourcesDirty||this._styleDirty||this._placementDirty;return k||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.l("idle")),!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,u.cG.mark(u.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),mt.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),oe.remove(this._canvasContainer),oe.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),u.cG.clearMetrics(),this._removed=!0,this.fire(new u.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ae.frame(this._frameRequest,(g=>{u.cG.frame(g),this._frameRequest=null;try{this._render(g)}catch(t){if(!u.Z(t)&&!(function(a){return a.message===So})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return hl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},M.MapMouseEvent=Hn,M.MapTouchEvent=Ga,M.MapWheelEvent=Jc,M.Marker=dc,M.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const l=this._map._getUIString(`NavigationControl.${a}`);t.title=l,t.setAttribute("aria-label",l)},this.options=u.e({},td,g),this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),oe.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),oe.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=oe.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yi(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){oe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,t){const a=oe.create("button",g,this._container);return a.type="button",a.addEventListener("click",t),a}},M.Popup=class extends u.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&oe.remove(this._content),this._container&&(oe.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=oe.create("div","maplibregl-popup",this._map.getContainer()),this._tip=oe.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=su(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const f=lu(this.options.offset);if(!l){const b=this._container.offsetWidth,E=this._container.offsetHeight;let D;D=a.y+f.bottom.y<E?["top"]:a.y>this._map.transform.height-E?["bottom"]:[],a.x<b/2?D.push("left"):a.x>this._map.transform.width-b/2&&D.push("right"),l=D.length===0?"bottom":D.join("-")}let v=a.add(f[l]);this.options.subpixelPositioning||(v=v.round()),oe.setTransform(this._container,`${ou[l]} translate(${v.x}px,${v.y}px)`),hc(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(dl),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=u.V.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const t=document.createDocumentFragment(),a=document.createElement("body");let l;for(a.innerHTML=g;l=a.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=oe.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=oe.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(fl);g&&g.focus()}},M.RasterDEMTileSource=rs,M.RasterTileSource=oo,M.ScaleControl=class{constructor(g){this._onMove=()=>{nn(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,nn(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},cr),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){oe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},M.ScrollZoomHandler=oc,M.Style=go,M.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=oe.create("button","maplibregl-ctrl-terrain",this._container),oe.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){oe.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},M.TwoFingersTouchPitchHandler=Hs,M.TwoFingersTouchRotateHandler=sc,M.TwoFingersTouchZoomHandler=Ms,M.TwoFingersTouchZoomRotateHandler=ul,M.VectorTileSource=ks,M.VideoSource=Re,M.addSourceType=(g,t)=>u._(void 0,void 0,void 0,(function*(){if(ie(g))throw new Error(`A source type called "${g}" already exists.`);((a,l)=>{Y[a]=l})(g,t)})),M.clearPrewarmedResources=function(){const g=li;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(zt),li=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},M.createTileMesh=nf,M.getMaxParallelImageRequests=function(){return u.c.MAX_PARALLEL_IMAGE_REQUESTS},M.getRTLTextPluginStatus=function(){return Pe().getRTLTextPluginStatus()},M.getVersion=function(){return Xa},M.getWorkerCount=function(){return Ot.workerCount},M.getWorkerUrl=function(){return u.c.WORKER_URL},M.importScriptInWorkers=function(g){return so().broadcast("IS",g)},M.isTimeFrozen=function(){return Ce.isFrozen()},M.now=De,M.prewarm=function(){Hi().acquire(zt)},M.restoreNow=function(){Ce.restoreNow()},M.setMaxParallelImageRequests=function(g){u.c.MAX_PARALLEL_IMAGE_REQUESTS=g},M.setNow=function(g){Ce.setNow(g)},M.setRTLTextPlugin=function(g,t){return Pe().setRTLTextPlugin(g,t)},M.setWorkerCount=function(g){Ot.workerCount=g},M.setWorkerUrl=function(g){u.c.WORKER_URL=g}}));var O=T;return O}))})(gy)),gy.exports}var DT=CT();const fv=Ax(DT),PT=()=>{console.log("FullScreenMap Version: 2.0.debug");const d=we.useRef(null),y=we.useRef(null);we.useEffect(()=>{y.current||d.current&&(y.current=new fv.Map({container:d.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap Contributors"}},layers:[{id:"osm-tiles",type:"raster",source:"osm",minzoom:0,maxzoom:19}]},center:[-.1014,39.9378],zoom:6}),y.current.addControl(new fv.NavigationControl,"bottom-right"),y.current.on("load",async()=>{await T(),M()}))},[]);const T=async()=>{if(!y.current)return;const u=y.current,j=(de,Ae)=>new Promise(Ce=>{if(u.hasImage(de)){Ce();return}u.loadImage(Ae,(De,oe)=>{if(De){console.error(`Error loading icon ${de} at ${Ae}:`,De),Ce();return}oe&&!u.hasImage(de)&&(u.addImage(de,oe),console.log(`Icon loaded: ${de}`)),Ce()})});try{await Promise.all([j("plane-icon","/assets/img/map_plane.png"),j("ship-icon","/assets/img/map_ship.png")])}catch(de){console.error("Error loading icons:",de)}const Z=(de,Ae)=>{if(!u.getSource(de))try{u.addSource(de,Ae)}catch(Ce){console.error(`Error adding source ${de}:`,Ce)}},X=(de,Ae)=>{if(!u.getLayer(de.id))try{u.addLayer(de,Ae)}catch(Ce){console.error(`Error adding layer ${de.id}:`,Ce)}},te={type:"FeatureCollection",features:[]};Z("flights",{type:"geojson",data:te}),X({id:"flights-circles",type:"circle",source:"flights",paint:{"circle-radius":6,"circle-color":"#fbbf24","circle-stroke-width":1,"circle-stroke-color":"#000"}}),X({id:"flights-layer",type:"symbol",source:"flights",layout:{"icon-image":"plane-icon","icon-size":.15,"icon-rotate":["-",["coalesce",["get","track"],["get","true_track"],0],45],"icon-rotation-alignment":"map","icon-allow-overlap":!0,"icon-ignore-placement":!0}}),X({id:"flights-labels",type:"symbol",source:"flights",layout:{"text-field":["get","callsign"],"text-offset":[0,2.5],"text-size":14,"text-anchor":"top","text-allow-overlap":!1},paint:{"text-color":"#fbbf24","text-halo-color":"#000","text-halo-width":2}}),Z("ships",{type:"geojson",data:te}),X({id:"ships-circles",type:"circle",source:"ships",paint:{"circle-radius":5,"circle-color":"#0ea5e9","circle-stroke-width":1,"circle-stroke-color":"#000"}}),X({id:"ships-layer",type:"symbol",source:"ships",layout:{"icon-image":"ship-icon","icon-size":.12,"icon-rotate":["-",["get","course"],45],"icon-rotation-alignment":"map","icon-allow-overlap":!0}}),Z("lightning",{type:"geojson",data:te}),X({id:"lightning-heat",type:"heatmap",source:"lightning",paint:{"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"heatmap-opacity":.8}}),X({id:"lightning-points",type:"circle",source:"lightning",minzoom:5,paint:{"circle-radius":4,"circle-color":"#f43f5e","circle-stroke-width":1,"circle-stroke-color":"#fff"}}),S()},S=async()=>{try{const u=await fetch("/api/weather/radar");if(!u.ok)return;const j=await u.json();if(j.ok&&j.url_template&&y.current&&j.frames&&j.frames.length>0){const Z=j.frames[j.frames.length-1],X=`${j.host}${Z.path}/256/{z}/{x}/{y}/2/1_1.png`;if(!y.current.getSource("radar")){y.current.addSource("radar",{type:"raster",tiles:[X],tileSize:256});const te=y.current.getStyle().layers.find(de=>de.type==="symbol")?.id;y.current.addLayer({id:"radar-layer",type:"raster",source:"radar",paint:{"raster-opacity":.6}},te)}}}catch(u){console.error("Radar update failed",u)}},[R,O]=X1.useState({flightCount:0,shipCount:0,lastUpdate:"-"}),M=()=>{const u=async()=>{if(!y.current)return;const Z=y.current;try{let X=0,te=0,de="OK";const Ae=Ce=>{if(!Z.getSource(Ce)){console.warn(`Source ${Ce} missing during refresh, re-adding...`);try{Z.addSource(Ce,{type:"geojson",data:{type:"FeatureCollection",features:[]}})}catch(De){return console.error(`Failed to re-add source ${Ce}:`,De),!1}}return!0};try{const Ce=await fetch(`/api/layers/flights?_t=${Date.now()}`,{headers:{Accept:"application/json"}});if(de=`F:${Ce.status}`,Ce.ok)try{const De=await Ce.json();Ae("flights")&&(Z.getSource("flights").setData(De),X=De.features?.length||0,de+=` C:${X}`)}catch(De){console.error("JSON Parse Error:",De),de+=" ParseErr"}}catch(Ce){console.error("Flights fetch error:",Ce),de="FetchErr"}try{const Ce=await fetch(`/api/layers/ships?_t=${Date.now()}`);if(Ce.ok){const De=await Ce.json();Ae("ships")&&(Z.getSource("ships").setData(De),te=De.features?.length||0)}}catch(Ce){console.error("Ships fetch error:",Ce)}try{const Ce=await fetch(`/api/layers/lightning?_t=${Date.now()}`);if(Ce.ok){const De=await Ce.json();Ae("lightning")&&Z.getSource("lightning").setData(De)}}catch(Ce){console.error("Lightning fetch error:",Ce)}O({flightCount:X,shipCount:te,lastUpdate:new Date().toLocaleTimeString()+` (${de})`}),S()}catch(X){console.error("Map: Refresh failed",X),O(te=>({...te,lastUpdate:"Global Error"}))}};u();const j=setInterval(u,3e4);return()=>clearInterval(j)};return he.jsxs("div",{className:"fs-map-wrapper",children:[he.jsx("div",{ref:d,className:"fs-map-container"}),he.jsxs("div",{className:"fs-map-debug",style:{position:"absolute",top:"10px",left:"10px",background:"red",color:"white",padding:"10px",borderRadius:"5px",fontSize:"12px",fontFamily:"monospace",pointerEvents:"none"},children:[he.jsxs("div",{children:["Flights: ",R.flightCount]}),he.jsxs("div",{children:["Ships: ",R.shipCount]}),he.jsxs("div",{children:["Updated: ",R.lastUpdate]})]})]})},Q_=we.createContext({});function J_(d){const y=we.useRef(null);return y.current===null&&(y.current=d()),y.current}const e0=typeof window<"u",Qx=e0?we.useLayoutEffect:we.useEffect,Py=we.createContext(null);function t0(d,y){d.indexOf(y)===-1&&d.push(y)}function i0(d,y){const T=d.indexOf(y);T>-1&&d.splice(T,1)}const Pc=(d,y,T)=>T>y?y:T<d?d:T;let n0=()=>{};const zc={},Jx=d=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(d);function eb(d){return typeof d=="object"&&d!==null}const tb=d=>/^0[^.\s]+$/u.test(d);function r0(d){let y;return()=>(y===void 0&&(y=d()),y)}const No=d=>d,zT=(d,y)=>T=>y(d(T)),rg=(...d)=>d.reduce(zT),Wm=(d,y,T)=>{const S=y-d;return S===0?1:(T-d)/S};class a0{constructor(){this.subscriptions=[]}add(y){return t0(this.subscriptions,y),()=>i0(this.subscriptions,y)}notify(y,T,S){const R=this.subscriptions.length;if(R)if(R===1)this.subscriptions[0](y,T,S);else for(let O=0;O<R;O++){const M=this.subscriptions[O];M&&M(y,T,S)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Au=d=>d*1e3,jo=d=>d/1e3;function ib(d,y){return y?d*(1e3/y):0}const nb=(d,y,T)=>(((1-3*T+3*y)*d+(3*T-6*y))*d+3*y)*d,RT=1e-7,IT=12;function LT(d,y,T,S,R){let O,M,u=0;do M=y+(T-y)/2,O=nb(M,S,R)-d,O>0?T=M:y=M;while(Math.abs(O)>RT&&++u<IT);return M}function ag(d,y,T,S){if(d===y&&T===S)return No;const R=O=>LT(O,0,1,d,T);return O=>O===0||O===1?O:nb(R(O),y,S)}const rb=d=>y=>y<=.5?d(2*y)/2:(2-d(2*(1-y)))/2,ab=d=>y=>1-d(1-y),sb=ag(.33,1.53,.69,.99),s0=ab(sb),ob=rb(s0),lb=d=>(d*=2)<1?.5*s0(d):.5*(2-Math.pow(2,-10*(d-1))),o0=d=>1-Math.sin(Math.acos(d)),ub=ab(o0),cb=rb(o0),kT=ag(.42,0,1,1),BT=ag(0,0,.58,1),hb=ag(.42,0,.58,1),OT=d=>Array.isArray(d)&&typeof d[0]!="number",db=d=>Array.isArray(d)&&typeof d[0]=="number",FT={linear:No,easeIn:kT,easeInOut:hb,easeOut:BT,circIn:o0,circInOut:cb,circOut:ub,backIn:s0,backInOut:ob,backOut:sb,anticipate:lb},jT=d=>typeof d=="string",pv=d=>{if(db(d)){n0(d.length===4);const[y,T,S,R]=d;return ag(y,T,S,R)}else if(jT(d))return FT[d];return d},cy=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function NT(d,y){let T=new Set,S=new Set,R=!1,O=!1;const M=new WeakSet;let u={delta:0,timestamp:0,isProcessing:!1};function j(X){M.has(X)&&(Z.schedule(X),d()),X(u)}const Z={schedule:(X,te=!1,de=!1)=>{const Ce=de&&R?T:S;return te&&M.add(X),Ce.has(X)||Ce.add(X),X},cancel:X=>{S.delete(X),M.delete(X)},process:X=>{if(u=X,R){O=!0;return}R=!0,[T,S]=[S,T],T.forEach(j),T.clear(),R=!1,O&&(O=!1,Z.process(X))}};return Z}const VT=40;function fb(d,y){let T=!1,S=!0;const R={delta:0,timestamp:0,isProcessing:!1},O=()=>T=!0,M=cy.reduce(($e,Ct)=>($e[Ct]=NT(O),$e),{}),{setup:u,read:j,resolveKeyframes:Z,preUpdate:X,update:te,preRender:de,render:Ae,postRender:Ce}=M,De=()=>{const $e=zc.useManualTiming?R.timestamp:performance.now();T=!1,zc.useManualTiming||(R.delta=S?1e3/60:Math.max(Math.min($e-R.timestamp,VT),1)),R.timestamp=$e,R.isProcessing=!0,u.process(R),j.process(R),Z.process(R),X.process(R),te.process(R),de.process(R),Ae.process(R),Ce.process(R),R.isProcessing=!1,T&&y&&(S=!1,d(De))},oe=()=>{T=!0,S=!0,R.isProcessing||d(De)};return{schedule:cy.reduce(($e,Ct)=>{const Ke=M[Ct];return $e[Ct]=(vt,mt=!1,Et=!1)=>(T||oe(),Ke.schedule(vt,mt,Et)),$e},{}),cancel:$e=>{for(let Ct=0;Ct<cy.length;Ct++)M[cy[Ct]].cancel($e)},state:R,steps:M}}const{schedule:Vn,cancel:Rh,state:ma,steps:s_}=fb(typeof requestAnimationFrame<"u"?requestAnimationFrame:No,!0);let yy;function UT(){yy=void 0}const Is={now:()=>(yy===void 0&&Is.set(ma.isProcessing||zc.useManualTiming?ma.timestamp:performance.now()),yy),set:d=>{yy=d,queueMicrotask(UT)}},pb=d=>y=>typeof y=="string"&&y.startsWith(d),mb=pb("--"),GT=pb("var(--"),l0=d=>GT(d)?qT.test(d.split("/*")[0].trim()):!1,qT=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,zp={test:d=>typeof d=="number",parse:parseFloat,transform:d=>d},Km={...zp,transform:d=>Pc(0,1,d)},hy={...zp,default:1},Zm=d=>Math.round(d*1e5)/1e5,u0=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function ZT(d){return d==null}const HT=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,c0=(d,y)=>T=>!!(typeof T=="string"&&HT.test(T)&&T.startsWith(d)||y&&!ZT(T)&&Object.prototype.hasOwnProperty.call(T,y)),gb=(d,y,T)=>S=>{if(typeof S!="string")return S;const[R,O,M,u]=S.match(u0);return{[d]:parseFloat(R),[y]:parseFloat(O),[T]:parseFloat(M),alpha:u!==void 0?parseFloat(u):1}},$T=d=>Pc(0,255,d),o_={...zp,transform:d=>Math.round($T(d))},$d={test:c0("rgb","red"),parse:gb("red","green","blue"),transform:({red:d,green:y,blue:T,alpha:S=1})=>"rgba("+o_.transform(d)+", "+o_.transform(y)+", "+o_.transform(T)+", "+Zm(Km.transform(S))+")"};function XT(d){let y="",T="",S="",R="";return d.length>5?(y=d.substring(1,3),T=d.substring(3,5),S=d.substring(5,7),R=d.substring(7,9)):(y=d.substring(1,2),T=d.substring(2,3),S=d.substring(3,4),R=d.substring(4,5),y+=y,T+=T,S+=S,R+=R),{red:parseInt(y,16),green:parseInt(T,16),blue:parseInt(S,16),alpha:R?parseInt(R,16)/255:1}}const T_={test:c0("#"),parse:XT,transform:$d.transform},sg=d=>({test:y=>typeof y=="string"&&y.endsWith(d)&&y.split(" ").length===1,parse:parseFloat,transform:y=>`${y}${d}`}),zh=sg("deg"),Cu=sg("%"),ei=sg("px"),YT=sg("vh"),WT=sg("vw"),mv={...Cu,parse:d=>Cu.parse(d)/100,transform:d=>Cu.transform(d*100)},bp={test:c0("hsl","hue"),parse:gb("hue","saturation","lightness"),transform:({hue:d,saturation:y,lightness:T,alpha:S=1})=>"hsla("+Math.round(d)+", "+Cu.transform(Zm(y))+", "+Cu.transform(Zm(T))+", "+Zm(Km.transform(S))+")"},Mr={test:d=>$d.test(d)||T_.test(d)||bp.test(d),parse:d=>$d.test(d)?$d.parse(d):bp.test(d)?bp.parse(d):T_.parse(d),transform:d=>typeof d=="string"?d:d.hasOwnProperty("red")?$d.transform(d):bp.transform(d),getAnimatableNone:d=>{const y=Mr.parse(d);return y.alpha=0,Mr.transform(y)}},KT=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function QT(d){return isNaN(d)&&typeof d=="string"&&(d.match(u0)?.length||0)+(d.match(KT)?.length||0)>0}const yb="number",_b="color",JT="var",eS="var(",gv="${}",tS=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Qm(d){const y=d.toString(),T=[],S={color:[],number:[],var:[]},R=[];let O=0;const u=y.replace(tS,j=>(Mr.test(j)?(S.color.push(O),R.push(_b),T.push(Mr.parse(j))):j.startsWith(eS)?(S.var.push(O),R.push(JT),T.push(j)):(S.number.push(O),R.push(yb),T.push(parseFloat(j))),++O,gv)).split(gv);return{values:T,split:u,indexes:S,types:R}}function vb(d){return Qm(d).values}function xb(d){const{split:y,types:T}=Qm(d),S=y.length;return R=>{let O="";for(let M=0;M<S;M++)if(O+=y[M],R[M]!==void 0){const u=T[M];u===yb?O+=Zm(R[M]):u===_b?O+=Mr.transform(R[M]):O+=R[M]}return O}}const iS=d=>typeof d=="number"?0:Mr.test(d)?Mr.getAnimatableNone(d):d;function nS(d){const y=vb(d);return xb(d)(y.map(iS))}const Ih={test:QT,parse:vb,createTransformer:xb,getAnimatableNone:nS};function l_(d,y,T){return T<0&&(T+=1),T>1&&(T-=1),T<1/6?d+(y-d)*6*T:T<1/2?y:T<2/3?d+(y-d)*(2/3-T)*6:d}function rS({hue:d,saturation:y,lightness:T,alpha:S}){d/=360,y/=100,T/=100;let R=0,O=0,M=0;if(!y)R=O=M=T;else{const u=T<.5?T*(1+y):T+y-T*y,j=2*T-u;R=l_(j,u,d+1/3),O=l_(j,u,d),M=l_(j,u,d-1/3)}return{red:Math.round(R*255),green:Math.round(O*255),blue:Math.round(M*255),alpha:S}}function wy(d,y){return T=>T>0?y:d}const Xn=(d,y,T)=>d+(y-d)*T,u_=(d,y,T)=>{const S=d*d,R=T*(y*y-S)+S;return R<0?0:Math.sqrt(R)},aS=[T_,$d,bp],sS=d=>aS.find(y=>y.test(d));function yv(d){const y=sS(d);if(!y)return!1;let T=y.parse(d);return y===bp&&(T=rS(T)),T}const _v=(d,y)=>{const T=yv(d),S=yv(y);if(!T||!S)return wy(d,y);const R={...T};return O=>(R.red=u_(T.red,S.red,O),R.green=u_(T.green,S.green,O),R.blue=u_(T.blue,S.blue,O),R.alpha=Xn(T.alpha,S.alpha,O),$d.transform(R))},S_=new Set(["none","hidden"]);function oS(d,y){return S_.has(d)?T=>T<=0?d:y:T=>T>=1?y:d}function lS(d,y){return T=>Xn(d,y,T)}function h0(d){return typeof d=="number"?lS:typeof d=="string"?l0(d)?wy:Mr.test(d)?_v:hS:Array.isArray(d)?bb:typeof d=="object"?Mr.test(d)?_v:uS:wy}function bb(d,y){const T=[...d],S=T.length,R=d.map((O,M)=>h0(O)(O,y[M]));return O=>{for(let M=0;M<S;M++)T[M]=R[M](O);return T}}function uS(d,y){const T={...d,...y},S={};for(const R in T)d[R]!==void 0&&y[R]!==void 0&&(S[R]=h0(d[R])(d[R],y[R]));return R=>{for(const O in S)T[O]=S[O](R);return T}}function cS(d,y){const T=[],S={color:0,var:0,number:0};for(let R=0;R<y.values.length;R++){const O=y.types[R],M=d.indexes[O][S[O]],u=d.values[M]??0;T[R]=u,S[O]++}return T}const hS=(d,y)=>{const T=Ih.createTransformer(y),S=Qm(d),R=Qm(y);return S.indexes.var.length===R.indexes.var.length&&S.indexes.color.length===R.indexes.color.length&&S.indexes.number.length>=R.indexes.number.length?S_.has(d)&&!R.values.length||S_.has(y)&&!S.values.length?oS(d,y):rg(bb(cS(S,R),R.values),T):wy(d,y)};function wb(d,y,T){return typeof d=="number"&&typeof y=="number"&&typeof T=="number"?Xn(d,y,T):h0(d)(d,y)}const dS=d=>{const y=({timestamp:T})=>d(T);return{start:(T=!0)=>Vn.update(y,T),stop:()=>Rh(y),now:()=>ma.isProcessing?ma.timestamp:Is.now()}},Tb=(d,y,T=10)=>{let S="";const R=Math.max(Math.round(y/T),2);for(let O=0;O<R;O++)S+=Math.round(d(O/(R-1))*1e4)/1e4+", ";return`linear(${S.substring(0,S.length-2)})`},Ty=2e4;function d0(d){let y=0;const T=50;let S=d.next(y);for(;!S.done&&y<Ty;)y+=T,S=d.next(y);return y>=Ty?1/0:y}function fS(d,y=100,T){const S=T({...d,keyframes:[0,y]}),R=Math.min(d0(S),Ty);return{type:"keyframes",ease:O=>S.next(R*O).value/y,duration:jo(R)}}const pS=5;function Sb(d,y,T){const S=Math.max(y-pS,0);return ib(T-d(S),y-S)}const ur={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},c_=.001;function mS({duration:d=ur.duration,bounce:y=ur.bounce,velocity:T=ur.velocity,mass:S=ur.mass}){let R,O,M=1-y;M=Pc(ur.minDamping,ur.maxDamping,M),d=Pc(ur.minDuration,ur.maxDuration,jo(d)),M<1?(R=Z=>{const X=Z*M,te=X*d,de=X-T,Ae=M_(Z,M),Ce=Math.exp(-te);return c_-de/Ae*Ce},O=Z=>{const te=Z*M*d,de=te*T+T,Ae=Math.pow(M,2)*Math.pow(Z,2)*d,Ce=Math.exp(-te),De=M_(Math.pow(Z,2),M);return(-R(Z)+c_>0?-1:1)*((de-Ae)*Ce)/De}):(R=Z=>{const X=Math.exp(-Z*d),te=(Z-T)*d+1;return-c_+X*te},O=Z=>{const X=Math.exp(-Z*d),te=(T-Z)*(d*d);return X*te});const u=5/d,j=yS(R,O,u);if(d=Au(d),isNaN(j))return{stiffness:ur.stiffness,damping:ur.damping,duration:d};{const Z=Math.pow(j,2)*S;return{stiffness:Z,damping:M*2*Math.sqrt(S*Z),duration:d}}}const gS=12;function yS(d,y,T){let S=T;for(let R=1;R<gS;R++)S=S-d(S)/y(S);return S}function M_(d,y){return d*Math.sqrt(1-y*y)}const _S=["duration","bounce"],vS=["stiffness","damping","mass"];function vv(d,y){return y.some(T=>d[T]!==void 0)}function xS(d){let y={velocity:ur.velocity,stiffness:ur.stiffness,damping:ur.damping,mass:ur.mass,isResolvedFromDuration:!1,...d};if(!vv(d,vS)&&vv(d,_S))if(d.visualDuration){const T=d.visualDuration,S=2*Math.PI/(T*1.2),R=S*S,O=2*Pc(.05,1,1-(d.bounce||0))*Math.sqrt(R);y={...y,mass:ur.mass,stiffness:R,damping:O}}else{const T=mS(d);y={...y,...T,mass:ur.mass},y.isResolvedFromDuration=!0}return y}function Sy(d=ur.visualDuration,y=ur.bounce){const T=typeof d!="object"?{visualDuration:d,keyframes:[0,1],bounce:y}:d;let{restSpeed:S,restDelta:R}=T;const O=T.keyframes[0],M=T.keyframes[T.keyframes.length-1],u={done:!1,value:O},{stiffness:j,damping:Z,mass:X,duration:te,velocity:de,isResolvedFromDuration:Ae}=xS({...T,velocity:-jo(T.velocity||0)}),Ce=de||0,De=Z/(2*Math.sqrt(j*X)),oe=M-O,We=jo(Math.sqrt(j/X)),Ze=Math.abs(oe)<5;S||(S=Ze?ur.restSpeed.granular:ur.restSpeed.default),R||(R=Ze?ur.restDelta.granular:ur.restDelta.default);let $e;if(De<1){const Ke=M_(We,De);$e=vt=>{const mt=Math.exp(-De*We*vt);return M-mt*((Ce+De*We*oe)/Ke*Math.sin(Ke*vt)+oe*Math.cos(Ke*vt))}}else if(De===1)$e=Ke=>M-Math.exp(-We*Ke)*(oe+(Ce+We*oe)*Ke);else{const Ke=We*Math.sqrt(De*De-1);$e=vt=>{const mt=Math.exp(-De*We*vt),Et=Math.min(Ke*vt,300);return M-mt*((Ce+De*We*oe)*Math.sinh(Et)+Ke*oe*Math.cosh(Et))/Ke}}const Ct={calculatedDuration:Ae&&te||null,next:Ke=>{const vt=$e(Ke);if(Ae)u.done=Ke>=te;else{let mt=Ke===0?Ce:0;De<1&&(mt=Ke===0?Au(Ce):Sb($e,Ke,vt));const Et=Math.abs(mt)<=S,Xt=Math.abs(M-vt)<=R;u.done=Et&&Xt}return u.value=u.done?M:vt,u},toString:()=>{const Ke=Math.min(d0(Ct),Ty),vt=Tb(mt=>Ct.next(Ke*mt).value,Ke,30);return Ke+"ms "+vt},toTransition:()=>{}};return Ct}Sy.applyToOptions=d=>{const y=fS(d,100,Sy);return d.ease=y.ease,d.duration=Au(y.duration),d.type="keyframes",d};function E_({keyframes:d,velocity:y=0,power:T=.8,timeConstant:S=325,bounceDamping:R=10,bounceStiffness:O=500,modifyTarget:M,min:u,max:j,restDelta:Z=.5,restSpeed:X}){const te=d[0],de={done:!1,value:te},Ae=Et=>u!==void 0&&Et<u||j!==void 0&&Et>j,Ce=Et=>u===void 0?j:j===void 0||Math.abs(u-Et)<Math.abs(j-Et)?u:j;let De=T*y;const oe=te+De,We=M===void 0?oe:M(oe);We!==oe&&(De=We-te);const Ze=Et=>-De*Math.exp(-Et/S),$e=Et=>We+Ze(Et),Ct=Et=>{const Xt=Ze(Et),ct=$e(Et);de.done=Math.abs(Xt)<=Z,de.value=de.done?We:ct};let Ke,vt;const mt=Et=>{Ae(de.value)&&(Ke=Et,vt=Sy({keyframes:[de.value,Ce(de.value)],velocity:Sb($e,Et,de.value),damping:R,stiffness:O,restDelta:Z,restSpeed:X}))};return mt(0),{calculatedDuration:null,next:Et=>{let Xt=!1;return!vt&&Ke===void 0&&(Xt=!0,Ct(Et),mt(Et)),Ke!==void 0&&Et>=Ke?vt.next(Et-Ke):(!Xt&&Ct(Et),de)}}}function bS(d,y,T){const S=[],R=T||zc.mix||wb,O=d.length-1;for(let M=0;M<O;M++){let u=R(d[M],d[M+1]);if(y){const j=Array.isArray(y)?y[M]||No:y;u=rg(j,u)}S.push(u)}return S}function wS(d,y,{clamp:T=!0,ease:S,mixer:R}={}){const O=d.length;if(n0(O===y.length),O===1)return()=>y[0];if(O===2&&y[0]===y[1])return()=>y[1];const M=d[0]===d[1];d[0]>d[O-1]&&(d=[...d].reverse(),y=[...y].reverse());const u=bS(y,S,R),j=u.length,Z=X=>{if(M&&X<d[0])return y[0];let te=0;if(j>1)for(;te<d.length-2&&!(X<d[te+1]);te++);const de=Wm(d[te],d[te+1],X);return u[te](de)};return T?X=>Z(Pc(d[0],d[O-1],X)):Z}function TS(d,y){const T=d[d.length-1];for(let S=1;S<=y;S++){const R=Wm(0,y,S);d.push(Xn(T,1,R))}}function SS(d){const y=[0];return TS(y,d.length-1),y}function MS(d,y){return d.map(T=>T*y)}function ES(d,y){return d.map(()=>y||hb).splice(0,d.length-1)}function Hm({duration:d=300,keyframes:y,times:T,ease:S="easeInOut"}){const R=OT(S)?S.map(pv):pv(S),O={done:!1,value:y[0]},M=MS(T&&T.length===y.length?T:SS(y),d),u=wS(M,y,{ease:Array.isArray(R)?R:ES(y,R)});return{calculatedDuration:d,next:j=>(O.value=u(j),O.done=j>=d,O)}}const AS=d=>d!==null;function f0(d,{repeat:y,repeatType:T="loop"},S,R=1){const O=d.filter(AS),u=R<0||y&&T!=="loop"&&y%2===1?0:O.length-1;return!u||S===void 0?O[u]:S}const CS={decay:E_,inertia:E_,tween:Hm,keyframes:Hm,spring:Sy};function Mb(d){typeof d.type=="string"&&(d.type=CS[d.type])}class p0{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(y=>{this.resolve=y})}notifyFinished(){this.resolve()}then(y,T){return this.finished.then(y,T)}}const DS=d=>d/100;class m0 extends p0{constructor(y){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:T}=this.options;T&&T.updatedAt!==Is.now()&&this.tick(Is.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=y,this.initAnimation(),this.play(),y.autoplay===!1&&this.pause()}initAnimation(){const{options:y}=this;Mb(y);const{type:T=Hm,repeat:S=0,repeatDelay:R=0,repeatType:O,velocity:M=0}=y;let{keyframes:u}=y;const j=T||Hm;j!==Hm&&typeof u[0]!="number"&&(this.mixKeyframes=rg(DS,wb(u[0],u[1])),u=[0,100]);const Z=j({...y,keyframes:u});O==="mirror"&&(this.mirroredGenerator=j({...y,keyframes:[...u].reverse(),velocity:-M})),Z.calculatedDuration===null&&(Z.calculatedDuration=d0(Z));const{calculatedDuration:X}=Z;this.calculatedDuration=X,this.resolvedDuration=X+R,this.totalDuration=this.resolvedDuration*(S+1)-R,this.generator=Z}updateTime(y){const T=Math.round(y-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=T}tick(y,T=!1){const{generator:S,totalDuration:R,mixKeyframes:O,mirroredGenerator:M,resolvedDuration:u,calculatedDuration:j}=this;if(this.startTime===null)return S.next(0);const{delay:Z=0,keyframes:X,repeat:te,repeatType:de,repeatDelay:Ae,type:Ce,onUpdate:De,finalKeyframe:oe}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,y):this.speed<0&&(this.startTime=Math.min(y-R/this.speed,this.startTime)),T?this.currentTime=y:this.updateTime(y);const We=this.currentTime-Z*(this.playbackSpeed>=0?1:-1),Ze=this.playbackSpeed>=0?We<0:We>R;this.currentTime=Math.max(We,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=R);let $e=this.currentTime,Ct=S;if(te){const Et=Math.min(this.currentTime,R)/u;let Xt=Math.floor(Et),ct=Et%1;!ct&&Et>=1&&(ct=1),ct===1&&Xt--,Xt=Math.min(Xt,te+1),Xt%2&&(de==="reverse"?(ct=1-ct,Ae&&(ct-=Ae/u)):de==="mirror"&&(Ct=M)),$e=Pc(0,1,ct)*u}const Ke=Ze?{done:!1,value:X[0]}:Ct.next($e);O&&(Ke.value=O(Ke.value));let{done:vt}=Ke;!Ze&&j!==null&&(vt=this.playbackSpeed>=0?this.currentTime>=R:this.currentTime<=0);const mt=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&vt);return mt&&Ce!==E_&&(Ke.value=f0(X,this.options,oe,this.speed)),De&&De(Ke.value),mt&&this.finish(),Ke}then(y,T){return this.finished.then(y,T)}get duration(){return jo(this.calculatedDuration)}get iterationDuration(){const{delay:y=0}=this.options||{};return this.duration+jo(y)}get time(){return jo(this.currentTime)}set time(y){y=Au(y),this.currentTime=y,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=y:this.driver&&(this.startTime=this.driver.now()-y/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(y){this.updateTime(Is.now());const T=this.playbackSpeed!==y;this.playbackSpeed=y,T&&(this.time=jo(this.currentTime))}play(){if(this.isStopped)return;const{driver:y=dS,startTime:T}=this.options;this.driver||(this.driver=y(R=>this.tick(R))),this.options.onPlay?.();const S=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=S):this.holdTime!==null?this.startTime=S-this.holdTime:this.startTime||(this.startTime=T??S),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Is.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(y){return this.startTime=0,this.tick(y,!0)}attachTimeline(y){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),y.observe(this)}}function PS(d){for(let y=1;y<d.length;y++)d[y]??(d[y]=d[y-1])}const Xd=d=>d*180/Math.PI,A_=d=>{const y=Xd(Math.atan2(d[1],d[0]));return C_(y)},zS={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:d=>(Math.abs(d[0])+Math.abs(d[3]))/2,rotate:A_,rotateZ:A_,skewX:d=>Xd(Math.atan(d[1])),skewY:d=>Xd(Math.atan(d[2])),skew:d=>(Math.abs(d[1])+Math.abs(d[2]))/2},C_=d=>(d=d%360,d<0&&(d+=360),d),xv=A_,bv=d=>Math.sqrt(d[0]*d[0]+d[1]*d[1]),wv=d=>Math.sqrt(d[4]*d[4]+d[5]*d[5]),RS={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:bv,scaleY:wv,scale:d=>(bv(d)+wv(d))/2,rotateX:d=>C_(Xd(Math.atan2(d[6],d[5]))),rotateY:d=>C_(Xd(Math.atan2(-d[2],d[0]))),rotateZ:xv,rotate:xv,skewX:d=>Xd(Math.atan(d[4])),skewY:d=>Xd(Math.atan(d[1])),skew:d=>(Math.abs(d[1])+Math.abs(d[4]))/2};function D_(d){return d.includes("scale")?1:0}function P_(d,y){if(!d||d==="none")return D_(y);const T=d.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let S,R;if(T)S=RS,R=T;else{const u=d.match(/^matrix\(([-\d.e\s,]+)\)$/u);S=zS,R=u}if(!R)return D_(y);const O=S[y],M=R[1].split(",").map(LS);return typeof O=="function"?O(M):M[O]}const IS=(d,y)=>{const{transform:T="none"}=getComputedStyle(d);return P_(T,y)};function LS(d){return parseFloat(d.trim())}const Rp=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Ip=new Set(Rp),Tv=d=>d===zp||d===ei,kS=new Set(["x","y","z"]),BS=Rp.filter(d=>!kS.has(d));function OS(d){const y=[];return BS.forEach(T=>{const S=d.getValue(T);S!==void 0&&(y.push([T,S.get()]),S.set(T.startsWith("scale")?1:0))}),y}const Yd={width:({x:d},{paddingLeft:y="0",paddingRight:T="0"})=>d.max-d.min-parseFloat(y)-parseFloat(T),height:({y:d},{paddingTop:y="0",paddingBottom:T="0"})=>d.max-d.min-parseFloat(y)-parseFloat(T),top:(d,{top:y})=>parseFloat(y),left:(d,{left:y})=>parseFloat(y),bottom:({y:d},{top:y})=>parseFloat(y)+(d.max-d.min),right:({x:d},{left:y})=>parseFloat(y)+(d.max-d.min),x:(d,{transform:y})=>P_(y,"x"),y:(d,{transform:y})=>P_(y,"y")};Yd.translateX=Yd.x;Yd.translateY=Yd.y;const Wd=new Set;let z_=!1,R_=!1,I_=!1;function Eb(){if(R_){const d=Array.from(Wd).filter(S=>S.needsMeasurement),y=new Set(d.map(S=>S.element)),T=new Map;y.forEach(S=>{const R=OS(S);R.length&&(T.set(S,R),S.render())}),d.forEach(S=>S.measureInitialState()),y.forEach(S=>{S.render();const R=T.get(S);R&&R.forEach(([O,M])=>{S.getValue(O)?.set(M)})}),d.forEach(S=>S.measureEndState()),d.forEach(S=>{S.suspendedScrollY!==void 0&&window.scrollTo(0,S.suspendedScrollY)})}R_=!1,z_=!1,Wd.forEach(d=>d.complete(I_)),Wd.clear()}function Ab(){Wd.forEach(d=>{d.readKeyframes(),d.needsMeasurement&&(R_=!0)})}function FS(){I_=!0,Ab(),Eb(),I_=!1}class g0{constructor(y,T,S,R,O,M=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...y],this.onComplete=T,this.name=S,this.motionValue=R,this.element=O,this.isAsync=M}scheduleResolve(){this.state="scheduled",this.isAsync?(Wd.add(this),z_||(z_=!0,Vn.read(Ab),Vn.resolveKeyframes(Eb))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:y,name:T,element:S,motionValue:R}=this;if(y[0]===null){const O=R?.get(),M=y[y.length-1];if(O!==void 0)y[0]=O;else if(S&&T){const u=S.readValue(T,M);u!=null&&(y[0]=u)}y[0]===void 0&&(y[0]=M),R&&O===void 0&&R.set(y[0])}PS(y)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(y=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,y),Wd.delete(this)}cancel(){this.state==="scheduled"&&(Wd.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const jS=d=>d.startsWith("--");function NS(d,y,T){jS(y)?d.style.setProperty(y,T):d.style[y]=T}const VS=r0(()=>window.ScrollTimeline!==void 0),US={};function GS(d,y){const T=r0(d);return()=>US[y]??T()}const Cb=GS(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),qm=([d,y,T,S])=>`cubic-bezier(${d}, ${y}, ${T}, ${S})`,Sv={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:qm([0,.65,.55,1]),circOut:qm([.55,0,1,.45]),backIn:qm([.31,.01,.66,-.59]),backOut:qm([.33,1.53,.69,.99])};function Db(d,y){if(d)return typeof d=="function"?Cb()?Tb(d,y):"ease-out":db(d)?qm(d):Array.isArray(d)?d.map(T=>Db(T,y)||Sv.easeOut):Sv[d]}function qS(d,y,T,{delay:S=0,duration:R=300,repeat:O=0,repeatType:M="loop",ease:u="easeOut",times:j}={},Z=void 0){const X={[y]:T};j&&(X.offset=j);const te=Db(u,R);Array.isArray(te)&&(X.easing=te);const de={delay:S,duration:R,easing:Array.isArray(te)?"linear":te,fill:"both",iterations:O+1,direction:M==="reverse"?"alternate":"normal"};return Z&&(de.pseudoElement=Z),d.animate(X,de)}function Pb(d){return typeof d=="function"&&"applyToOptions"in d}function ZS({type:d,...y}){return Pb(d)&&Cb()?d.applyToOptions(y):(y.duration??(y.duration=300),y.ease??(y.ease="easeOut"),y)}class HS extends p0{constructor(y){if(super(),this.finishedTime=null,this.isStopped=!1,!y)return;const{element:T,name:S,keyframes:R,pseudoElement:O,allowFlatten:M=!1,finalKeyframe:u,onComplete:j}=y;this.isPseudoElement=!!O,this.allowFlatten=M,this.options=y,n0(typeof y.type!="string");const Z=ZS(y);this.animation=qS(T,S,R,Z,O),Z.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!O){const X=f0(R,this.options,u,this.speed);this.updateMotionValue?this.updateMotionValue(X):NS(T,S,X),this.animation.cancel()}j?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:y}=this;y==="idle"||y==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const y=this.animation.effect?.getComputedTiming?.().duration||0;return jo(Number(y))}get iterationDuration(){const{delay:y=0}=this.options||{};return this.duration+jo(y)}get time(){return jo(Number(this.animation.currentTime)||0)}set time(y){this.finishedTime=null,this.animation.currentTime=Au(y)}get speed(){return this.animation.playbackRate}set speed(y){y<0&&(this.finishedTime=null),this.animation.playbackRate=y}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(y){this.animation.startTime=y}attachTimeline({timeline:y,observe:T}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,y&&VS()?(this.animation.timeline=y,No):T(this)}}const zb={anticipate:lb,backInOut:ob,circInOut:cb};function $S(d){return d in zb}function XS(d){typeof d.ease=="string"&&$S(d.ease)&&(d.ease=zb[d.ease])}const Mv=10;class YS extends HS{constructor(y){XS(y),Mb(y),super(y),y.startTime&&(this.startTime=y.startTime),this.options=y}updateMotionValue(y){const{motionValue:T,onUpdate:S,onComplete:R,element:O,...M}=this.options;if(!T)return;if(y!==void 0){T.set(y);return}const u=new m0({...M,autoplay:!1}),j=Au(this.finishedTime??this.time);T.setWithVelocity(u.sample(j-Mv).value,u.sample(j).value,Mv),u.stop()}}const Ev=(d,y)=>y==="zIndex"?!1:!!(typeof d=="number"||Array.isArray(d)||typeof d=="string"&&(Ih.test(d)||d==="0")&&!d.startsWith("url("));function WS(d){const y=d[0];if(d.length===1)return!0;for(let T=0;T<d.length;T++)if(d[T]!==y)return!0}function KS(d,y,T,S){const R=d[0];if(R===null)return!1;if(y==="display"||y==="visibility")return!0;const O=d[d.length-1],M=Ev(R,y),u=Ev(O,y);return!M||!u?!1:WS(d)||(T==="spring"||Pb(T))&&S}function L_(d){d.duration=0,d.type="keyframes"}const QS=new Set(["opacity","clipPath","filter","transform"]),JS=r0(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function eM(d){const{motionValue:y,name:T,repeatDelay:S,repeatType:R,damping:O,type:M}=d;if(!(y?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:j,transformTemplate:Z}=y.owner.getProps();return JS()&&T&&QS.has(T)&&(T!=="transform"||!Z)&&!j&&!S&&R!=="mirror"&&O!==0&&M!=="inertia"}const tM=40;class iM extends p0{constructor({autoplay:y=!0,delay:T=0,type:S="keyframes",repeat:R=0,repeatDelay:O=0,repeatType:M="loop",keyframes:u,name:j,motionValue:Z,element:X,...te}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Is.now();const de={autoplay:y,delay:T,type:S,repeat:R,repeatDelay:O,repeatType:M,name:j,motionValue:Z,element:X,...te},Ae=X?.KeyframeResolver||g0;this.keyframeResolver=new Ae(u,(Ce,De,oe)=>this.onKeyframesResolved(Ce,De,de,!oe),j,Z,X),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(y,T,S,R){this.keyframeResolver=void 0;const{name:O,type:M,velocity:u,delay:j,isHandoff:Z,onUpdate:X}=S;this.resolvedAt=Is.now(),KS(y,O,M,u)||((zc.instantAnimations||!j)&&X?.(f0(y,S,T)),y[0]=y[y.length-1],L_(S),S.repeat=0);const de={startTime:R?this.resolvedAt?this.resolvedAt-this.createdAt>tM?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:T,...S,keyframes:y},Ae=!Z&&eM(de)?new YS({...de,element:de.motionValue.owner.current}):new m0(de);Ae.finished.then(()=>this.notifyFinished()).catch(No),this.pendingTimeline&&(this.stopTimeline=Ae.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=Ae}get finished(){return this._animation?this.animation.finished:this._finished}then(y,T){return this.finished.finally(y).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),FS()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(y){this.animation.time=y}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(y){this.animation.speed=y}get startTime(){return this.animation.startTime}attachTimeline(y){return this._animation?this.stopTimeline=this.animation.attachTimeline(y):this.pendingTimeline=y,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const nM=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function rM(d){const y=nM.exec(d);if(!y)return[,];const[,T,S,R]=y;return[`--${T??S}`,R]}function Rb(d,y,T=1){const[S,R]=rM(d);if(!S)return;const O=window.getComputedStyle(y).getPropertyValue(S);if(O){const M=O.trim();return Jx(M)?parseFloat(M):M}return l0(R)?Rb(R,y,T+1):R}function y0(d,y){return d?.[y]??d?.default??d}const Ib=new Set(["width","height","top","left","right","bottom",...Rp]),aM={test:d=>d==="auto",parse:d=>d},Lb=d=>y=>y.test(d),kb=[zp,ei,Cu,zh,WT,YT,aM],Av=d=>kb.find(Lb(d));function sM(d){return typeof d=="number"?d===0:d!==null?d==="none"||d==="0"||tb(d):!0}const oM=new Set(["brightness","contrast","saturate","opacity"]);function lM(d){const[y,T]=d.slice(0,-1).split("(");if(y==="drop-shadow")return d;const[S]=T.match(u0)||[];if(!S)return d;const R=T.replace(S,"");let O=oM.has(y)?1:0;return S!==T&&(O*=100),y+"("+O+R+")"}const uM=/\b([a-z-]*)\(.*?\)/gu,k_={...Ih,getAnimatableNone:d=>{const y=d.match(uM);return y?y.map(lM).join(" "):d}},Cv={...zp,transform:Math.round},cM={rotate:zh,rotateX:zh,rotateY:zh,rotateZ:zh,scale:hy,scaleX:hy,scaleY:hy,scaleZ:hy,skew:zh,skewX:zh,skewY:zh,distance:ei,translateX:ei,translateY:ei,translateZ:ei,x:ei,y:ei,z:ei,perspective:ei,transformPerspective:ei,opacity:Km,originX:mv,originY:mv,originZ:ei},_0={borderWidth:ei,borderTopWidth:ei,borderRightWidth:ei,borderBottomWidth:ei,borderLeftWidth:ei,borderRadius:ei,radius:ei,borderTopLeftRadius:ei,borderTopRightRadius:ei,borderBottomRightRadius:ei,borderBottomLeftRadius:ei,width:ei,maxWidth:ei,height:ei,maxHeight:ei,top:ei,right:ei,bottom:ei,left:ei,padding:ei,paddingTop:ei,paddingRight:ei,paddingBottom:ei,paddingLeft:ei,margin:ei,marginTop:ei,marginRight:ei,marginBottom:ei,marginLeft:ei,backgroundPositionX:ei,backgroundPositionY:ei,...cM,zIndex:Cv,fillOpacity:Km,strokeOpacity:Km,numOctaves:Cv},hM={..._0,color:Mr,backgroundColor:Mr,outlineColor:Mr,fill:Mr,stroke:Mr,borderColor:Mr,borderTopColor:Mr,borderRightColor:Mr,borderBottomColor:Mr,borderLeftColor:Mr,filter:k_,WebkitFilter:k_},Bb=d=>hM[d];function Ob(d,y){let T=Bb(d);return T!==k_&&(T=Ih),T.getAnimatableNone?T.getAnimatableNone(y):void 0}const dM=new Set(["auto","none","0"]);function fM(d,y,T){let S=0,R;for(;S<d.length&&!R;){const O=d[S];typeof O=="string"&&!dM.has(O)&&Qm(O).values.length&&(R=d[S]),S++}if(R&&T)for(const O of y)d[O]=Ob(T,R)}class pM extends g0{constructor(y,T,S,R,O){super(y,T,S,R,O,!0)}readKeyframes(){const{unresolvedKeyframes:y,element:T,name:S}=this;if(!T||!T.current)return;super.readKeyframes();for(let j=0;j<y.length;j++){let Z=y[j];if(typeof Z=="string"&&(Z=Z.trim(),l0(Z))){const X=Rb(Z,T.current);X!==void 0&&(y[j]=X),j===y.length-1&&(this.finalKeyframe=Z)}}if(this.resolveNoneKeyframes(),!Ib.has(S)||y.length!==2)return;const[R,O]=y,M=Av(R),u=Av(O);if(M!==u)if(Tv(M)&&Tv(u))for(let j=0;j<y.length;j++){const Z=y[j];typeof Z=="string"&&(y[j]=parseFloat(Z))}else Yd[S]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:y,name:T}=this,S=[];for(let R=0;R<y.length;R++)(y[R]===null||sM(y[R]))&&S.push(R);S.length&&fM(y,S,T)}measureInitialState(){const{element:y,unresolvedKeyframes:T,name:S}=this;if(!y||!y.current)return;S==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Yd[S](y.measureViewportBox(),window.getComputedStyle(y.current)),T[0]=this.measuredOrigin;const R=T[T.length-1];R!==void 0&&y.getValue(S,R).jump(R,!1)}measureEndState(){const{element:y,name:T,unresolvedKeyframes:S}=this;if(!y||!y.current)return;const R=y.getValue(T);R&&R.jump(this.measuredOrigin,!1);const O=S.length-1,M=S[O];S[O]=Yd[T](y.measureViewportBox(),window.getComputedStyle(y.current)),M!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=M),this.removedTransforms?.length&&this.removedTransforms.forEach(([u,j])=>{y.getValue(u).set(j)}),this.resolveNoneKeyframes()}}function mM(d,y,T){if(d instanceof EventTarget)return[d];if(typeof d=="string"){let S=document;const R=T?.[d]??S.querySelectorAll(d);return R?Array.from(R):[]}return Array.from(d)}const Fb=(d,y)=>y&&typeof d=="number"?y.transform(d):d;function jb(d){return eb(d)&&"offsetHeight"in d}const Dv=30,gM=d=>!isNaN(parseFloat(d));class yM{constructor(y,T={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=S=>{const R=Is.now();if(this.updatedAt!==R&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(S),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const O of this.dependents)O.dirty()},this.hasAnimated=!1,this.setCurrent(y),this.owner=T.owner}setCurrent(y){this.current=y,this.updatedAt=Is.now(),this.canTrackVelocity===null&&y!==void 0&&(this.canTrackVelocity=gM(this.current))}setPrevFrameValue(y=this.current){this.prevFrameValue=y,this.prevUpdatedAt=this.updatedAt}onChange(y){return this.on("change",y)}on(y,T){this.events[y]||(this.events[y]=new a0);const S=this.events[y].add(T);return y==="change"?()=>{S(),Vn.read(()=>{this.events.change.getSize()||this.stop()})}:S}clearListeners(){for(const y in this.events)this.events[y].clear()}attach(y,T){this.passiveEffect=y,this.stopPassiveEffect=T}set(y){this.passiveEffect?this.passiveEffect(y,this.updateAndNotify):this.updateAndNotify(y)}setWithVelocity(y,T,S){this.set(T),this.prev=void 0,this.prevFrameValue=y,this.prevUpdatedAt=this.updatedAt-S}jump(y,T=!0){this.updateAndNotify(y),this.prev=y,this.prevUpdatedAt=this.prevFrameValue=void 0,T&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(y){this.dependents||(this.dependents=new Set),this.dependents.add(y)}removeDependent(y){this.dependents&&this.dependents.delete(y)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const y=Is.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||y-this.updatedAt>Dv)return 0;const T=Math.min(this.updatedAt-this.prevUpdatedAt,Dv);return ib(parseFloat(this.current)-parseFloat(this.prevFrameValue),T)}start(y){return this.stop(),new Promise(T=>{this.hasAnimated=!0,this.animation=y(T),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ap(d,y){return new yM(d,y)}const{schedule:v0}=fb(queueMicrotask,!1),Il={x:!1,y:!1};function Nb(){return Il.x||Il.y}function _M(d){return d==="x"||d==="y"?Il[d]?null:(Il[d]=!0,()=>{Il[d]=!1}):Il.x||Il.y?null:(Il.x=Il.y=!0,()=>{Il.x=Il.y=!1})}function Vb(d,y){const T=mM(d),S=new AbortController,R={passive:!0,...y,signal:S.signal};return[T,R,()=>S.abort()]}function Pv(d){return!(d.pointerType==="touch"||Nb())}function vM(d,y,T={}){const[S,R,O]=Vb(d,T),M=u=>{if(!Pv(u))return;const{target:j}=u,Z=y(j,u);if(typeof Z!="function"||!j)return;const X=te=>{Pv(te)&&(Z(te),j.removeEventListener("pointerleave",X))};j.addEventListener("pointerleave",X,R)};return S.forEach(u=>{u.addEventListener("pointerenter",M,R)}),O}const Ub=(d,y)=>y?d===y?!0:Ub(d,y.parentElement):!1,x0=d=>d.pointerType==="mouse"?typeof d.button!="number"||d.button<=0:d.isPrimary!==!1,xM=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function bM(d){return xM.has(d.tagName)||d.tabIndex!==-1}const _y=new WeakSet;function zv(d){return y=>{y.key==="Enter"&&d(y)}}function h_(d,y){d.dispatchEvent(new PointerEvent("pointer"+y,{isPrimary:!0,bubbles:!0}))}const wM=(d,y)=>{const T=d.currentTarget;if(!T)return;const S=zv(()=>{if(_y.has(T))return;h_(T,"down");const R=zv(()=>{h_(T,"up")}),O=()=>h_(T,"cancel");T.addEventListener("keyup",R,y),T.addEventListener("blur",O,y)});T.addEventListener("keydown",S,y),T.addEventListener("blur",()=>T.removeEventListener("keydown",S),y)};function Rv(d){return x0(d)&&!Nb()}function TM(d,y,T={}){const[S,R,O]=Vb(d,T),M=u=>{const j=u.currentTarget;if(!Rv(u))return;_y.add(j);const Z=y(j,u),X=(Ae,Ce)=>{window.removeEventListener("pointerup",te),window.removeEventListener("pointercancel",de),_y.has(j)&&_y.delete(j),Rv(Ae)&&typeof Z=="function"&&Z(Ae,{success:Ce})},te=Ae=>{X(Ae,j===window||j===document||T.useGlobalTarget||Ub(j,Ae.target))},de=Ae=>{X(Ae,!1)};window.addEventListener("pointerup",te,R),window.addEventListener("pointercancel",de,R)};return S.forEach(u=>{(T.useGlobalTarget?window:u).addEventListener("pointerdown",M,R),jb(u)&&(u.addEventListener("focus",Z=>wM(Z,R)),!bM(u)&&!u.hasAttribute("tabindex")&&(u.tabIndex=0))}),O}function Gb(d){return eb(d)&&"ownerSVGElement"in d}function SM(d){return Gb(d)&&d.tagName==="svg"}const Oa=d=>!!(d&&d.getVelocity),MM=[...kb,Mr,Ih],EM=d=>MM.find(Lb(d)),b0=we.createContext({transformPagePoint:d=>d,isStatic:!1,reducedMotion:"never"});function Iv(d,y){if(typeof d=="function")return d(y);d!=null&&(d.current=y)}function AM(...d){return y=>{let T=!1;const S=d.map(R=>{const O=Iv(R,y);return!T&&typeof O=="function"&&(T=!0),O});if(T)return()=>{for(let R=0;R<S.length;R++){const O=S[R];typeof O=="function"?O():Iv(d[R],null)}}}}function CM(...d){return we.useCallback(AM(...d),d)}class DM extends we.Component{getSnapshotBeforeUpdate(y){const T=this.props.childRef.current;if(T&&y.isPresent&&!this.props.isPresent){const S=T.offsetParent,R=jb(S)&&S.offsetWidth||0,O=this.props.sizeRef.current;O.height=T.offsetHeight||0,O.width=T.offsetWidth||0,O.top=T.offsetTop,O.left=T.offsetLeft,O.right=R-O.width-O.left}return null}componentDidUpdate(){}render(){return this.props.children}}function PM({children:d,isPresent:y,anchorX:T,root:S}){const R=we.useId(),O=we.useRef(null),M=we.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:u}=we.useContext(b0),j=CM(O,d?.ref);return we.useInsertionEffect(()=>{const{width:Z,height:X,top:te,left:de,right:Ae}=M.current;if(y||!O.current||!Z||!X)return;const Ce=T==="left"?`left: ${de}`:`right: ${Ae}`;O.current.dataset.motionPopId=R;const De=document.createElement("style");u&&(De.nonce=u);const oe=S??document.head;return oe.appendChild(De),De.sheet&&De.sheet.insertRule(`
          [data-motion-pop-id="${R}"] {
            position: absolute !important;
            width: ${Z}px !important;
            height: ${X}px !important;
            ${Ce}px !important;
            top: ${te}px !important;
          }
        `),()=>{oe.contains(De)&&oe.removeChild(De)}},[y]),he.jsx(DM,{isPresent:y,childRef:O,sizeRef:M,children:we.cloneElement(d,{ref:j})})}const zM=({children:d,initial:y,isPresent:T,onExitComplete:S,custom:R,presenceAffectsLayout:O,mode:M,anchorX:u,root:j})=>{const Z=J_(RM),X=we.useId();let te=!0,de=we.useMemo(()=>(te=!1,{id:X,initial:y,isPresent:T,custom:R,onExitComplete:Ae=>{Z.set(Ae,!0);for(const Ce of Z.values())if(!Ce)return;S&&S()},register:Ae=>(Z.set(Ae,!1),()=>Z.delete(Ae))}),[T,Z,S]);return O&&te&&(de={...de}),we.useMemo(()=>{Z.forEach((Ae,Ce)=>Z.set(Ce,!1))},[T]),we.useEffect(()=>{!T&&!Z.size&&S&&S()},[T]),M==="popLayout"&&(d=he.jsx(PM,{isPresent:T,anchorX:u,root:j,children:d})),he.jsx(Py.Provider,{value:de,children:d})};function RM(){return new Map}function qb(d=!0){const y=we.useContext(Py);if(y===null)return[!0,null];const{isPresent:T,onExitComplete:S,register:R}=y,O=we.useId();we.useEffect(()=>{if(d)return R(O)},[d]);const M=we.useCallback(()=>d&&S&&S(O),[O,S,d]);return!T&&S?[!1,M]:[!0]}const dy=d=>d.key||"";function Lv(d){const y=[];return we.Children.forEach(d,T=>{we.isValidElement(T)&&y.push(T)}),y}const IM=({children:d,custom:y,initial:T=!0,onExitComplete:S,presenceAffectsLayout:R=!0,mode:O="sync",propagate:M=!1,anchorX:u="left",root:j})=>{const[Z,X]=qb(M),te=we.useMemo(()=>Lv(d),[d]),de=M&&!Z?[]:te.map(dy),Ae=we.useRef(!0),Ce=we.useRef(te),De=J_(()=>new Map),[oe,We]=we.useState(te),[Ze,$e]=we.useState(te);Qx(()=>{Ae.current=!1,Ce.current=te;for(let vt=0;vt<Ze.length;vt++){const mt=dy(Ze[vt]);de.includes(mt)?De.delete(mt):De.get(mt)!==!0&&De.set(mt,!1)}},[Ze,de.length,de.join("-")]);const Ct=[];if(te!==oe){let vt=[...te];for(let mt=0;mt<Ze.length;mt++){const Et=Ze[mt],Xt=dy(Et);de.includes(Xt)||(vt.splice(mt,0,Et),Ct.push(Et))}return O==="wait"&&Ct.length&&(vt=Ct),$e(Lv(vt)),We(te),null}const{forceRender:Ke}=we.useContext(Q_);return he.jsx(he.Fragment,{children:Ze.map(vt=>{const mt=dy(vt),Et=M&&!Z?!1:te===Ze||de.includes(mt),Xt=()=>{if(De.has(mt))De.set(mt,!0);else return;let ct=!0;De.forEach(Yt=>{Yt||(ct=!1)}),ct&&(Ke?.(),$e(Ce.current),M&&X?.(),S&&S())};return he.jsx(zM,{isPresent:Et,initial:!Ae.current||T?void 0:!1,custom:y,presenceAffectsLayout:R,mode:O,root:j,onExitComplete:Et?void 0:Xt,anchorX:u,children:vt},mt)})})},Zb=we.createContext({strict:!1}),kv={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Cp={};for(const d in kv)Cp[d]={isEnabled:y=>kv[d].some(T=>!!y[T])};function LM(d){for(const y in d)Cp[y]={...Cp[y],...d[y]}}const kM=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function My(d){return d.startsWith("while")||d.startsWith("drag")&&d!=="draggable"||d.startsWith("layout")||d.startsWith("onTap")||d.startsWith("onPan")||d.startsWith("onLayout")||kM.has(d)}let Hb=d=>!My(d);function BM(d){typeof d=="function"&&(Hb=y=>y.startsWith("on")?!My(y):d(y))}try{BM(require("@emotion/is-prop-valid").default)}catch{}function OM(d,y,T){const S={};for(const R in d)R==="values"&&typeof d.values=="object"||(Hb(R)||T===!0&&My(R)||!y&&!My(R)||d.draggable&&R.startsWith("onDrag"))&&(S[R]=d[R]);return S}const zy=we.createContext({});function Ry(d){return d!==null&&typeof d=="object"&&typeof d.start=="function"}function Jm(d){return typeof d=="string"||Array.isArray(d)}const w0=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],T0=["initial",...w0];function Iy(d){return Ry(d.animate)||T0.some(y=>Jm(d[y]))}function $b(d){return!!(Iy(d)||d.variants)}function FM(d,y){if(Iy(d)){const{initial:T,animate:S}=d;return{initial:T===!1||Jm(T)?T:void 0,animate:Jm(S)?S:void 0}}return d.inherit!==!1?y:{}}function jM(d){const{initial:y,animate:T}=FM(d,we.useContext(zy));return we.useMemo(()=>({initial:y,animate:T}),[Bv(y),Bv(T)])}function Bv(d){return Array.isArray(d)?d.join(" "):d}function Ov(d,y){return y.max===y.min?0:d/(y.max-y.min)*100}const Gm={correct:(d,y)=>{if(!y.target)return d;if(typeof d=="string")if(ei.test(d))d=parseFloat(d);else return d;const T=Ov(d,y.target.x),S=Ov(d,y.target.y);return`${T}% ${S}%`}},NM={correct:(d,{treeScale:y,projectionDelta:T})=>{const S=d,R=Ih.parse(d);if(R.length>5)return S;const O=Ih.createTransformer(d),M=typeof R[0]!="number"?1:0,u=T.x.scale*y.x,j=T.y.scale*y.y;R[0+M]/=u,R[1+M]/=j;const Z=Xn(u,j,.5);return typeof R[2+M]=="number"&&(R[2+M]/=Z),typeof R[3+M]=="number"&&(R[3+M]/=Z),O(R)}},B_={borderRadius:{...Gm,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Gm,borderTopRightRadius:Gm,borderBottomLeftRadius:Gm,borderBottomRightRadius:Gm,boxShadow:NM};function Xb(d,{layout:y,layoutId:T}){return Ip.has(d)||d.startsWith("origin")||(y||T!==void 0)&&(!!B_[d]||d==="opacity")}const VM={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},UM=Rp.length;function GM(d,y,T){let S="",R=!0;for(let O=0;O<UM;O++){const M=Rp[O],u=d[M];if(u===void 0)continue;let j=!0;if(typeof u=="number"?j=u===(M.startsWith("scale")?1:0):j=parseFloat(u)===0,!j||T){const Z=Fb(u,_0[M]);if(!j){R=!1;const X=VM[M]||M;S+=`${X}(${Z}) `}T&&(y[M]=Z)}}return S=S.trim(),T?S=T(y,R?"":S):R&&(S="none"),S}function S0(d,y,T){const{style:S,vars:R,transformOrigin:O}=d;let M=!1,u=!1;for(const j in y){const Z=y[j];if(Ip.has(j)){M=!0;continue}else if(mb(j)){R[j]=Z;continue}else{const X=Fb(Z,_0[j]);j.startsWith("origin")?(u=!0,O[j]=X):S[j]=X}}if(y.transform||(M||T?S.transform=GM(y,d.transform,T):S.transform&&(S.transform="none")),u){const{originX:j="50%",originY:Z="50%",originZ:X=0}=O;S.transformOrigin=`${j} ${Z} ${X}`}}const M0=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Yb(d,y,T){for(const S in y)!Oa(y[S])&&!Xb(S,T)&&(d[S]=y[S])}function qM({transformTemplate:d},y){return we.useMemo(()=>{const T=M0();return S0(T,y,d),Object.assign({},T.vars,T.style)},[y])}function ZM(d,y){const T=d.style||{},S={};return Yb(S,T,d),Object.assign(S,qM(d,y)),S}function HM(d,y){const T={},S=ZM(d,y);return d.drag&&d.dragListener!==!1&&(T.draggable=!1,S.userSelect=S.WebkitUserSelect=S.WebkitTouchCallout="none",S.touchAction=d.drag===!0?"none":`pan-${d.drag==="x"?"y":"x"}`),d.tabIndex===void 0&&(d.onTap||d.onTapStart||d.whileTap)&&(T.tabIndex=0),T.style=S,T}const $M={offset:"stroke-dashoffset",array:"stroke-dasharray"},XM={offset:"strokeDashoffset",array:"strokeDasharray"};function YM(d,y,T=1,S=0,R=!0){d.pathLength=1;const O=R?$M:XM;d[O.offset]=ei.transform(-S);const M=ei.transform(y),u=ei.transform(T);d[O.array]=`${M} ${u}`}function Wb(d,{attrX:y,attrY:T,attrScale:S,pathLength:R,pathSpacing:O=1,pathOffset:M=0,...u},j,Z,X){if(S0(d,u,Z),j){d.style.viewBox&&(d.attrs.viewBox=d.style.viewBox);return}d.attrs=d.style,d.style={};const{attrs:te,style:de}=d;te.transform&&(de.transform=te.transform,delete te.transform),(de.transform||te.transformOrigin)&&(de.transformOrigin=te.transformOrigin??"50% 50%",delete te.transformOrigin),de.transform&&(de.transformBox=X?.transformBox??"fill-box",delete te.transformBox),y!==void 0&&(te.x=y),T!==void 0&&(te.y=T),S!==void 0&&(te.scale=S),R!==void 0&&YM(te,R,O,M,!1)}const Kb=()=>({...M0(),attrs:{}}),Qb=d=>typeof d=="string"&&d.toLowerCase()==="svg";function WM(d,y,T,S){const R=we.useMemo(()=>{const O=Kb();return Wb(O,y,Qb(S),d.transformTemplate,d.style),{...O.attrs,style:{...O.style}}},[y]);if(d.style){const O={};Yb(O,d.style,d),R.style={...O,...R.style}}return R}const KM=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function E0(d){return typeof d!="string"||d.includes("-")?!1:!!(KM.indexOf(d)>-1||/[A-Z]/u.test(d))}function QM(d,y,T,{latestValues:S},R,O=!1){const u=(E0(d)?WM:HM)(y,S,R,d),j=OM(y,typeof d=="string",O),Z=d!==we.Fragment?{...j,...u,ref:T}:{},{children:X}=y,te=we.useMemo(()=>Oa(X)?X.get():X,[X]);return we.createElement(d,{...Z,children:te})}function Fv(d){const y=[{},{}];return d?.values.forEach((T,S)=>{y[0][S]=T.get(),y[1][S]=T.getVelocity()}),y}function A0(d,y,T,S){if(typeof y=="function"){const[R,O]=Fv(S);y=y(T!==void 0?T:d.custom,R,O)}if(typeof y=="string"&&(y=d.variants&&d.variants[y]),typeof y=="function"){const[R,O]=Fv(S);y=y(T!==void 0?T:d.custom,R,O)}return y}function vy(d){return Oa(d)?d.get():d}function JM({scrapeMotionValuesFromProps:d,createRenderState:y},T,S,R){return{latestValues:eE(T,S,R,d),renderState:y()}}function eE(d,y,T,S){const R={},O=S(d,{});for(const de in O)R[de]=vy(O[de]);let{initial:M,animate:u}=d;const j=Iy(d),Z=$b(d);y&&Z&&!j&&d.inherit!==!1&&(M===void 0&&(M=y.initial),u===void 0&&(u=y.animate));let X=T?T.initial===!1:!1;X=X||M===!1;const te=X?u:M;if(te&&typeof te!="boolean"&&!Ry(te)){const de=Array.isArray(te)?te:[te];for(let Ae=0;Ae<de.length;Ae++){const Ce=A0(d,de[Ae]);if(Ce){const{transitionEnd:De,transition:oe,...We}=Ce;for(const Ze in We){let $e=We[Ze];if(Array.isArray($e)){const Ct=X?$e.length-1:0;$e=$e[Ct]}$e!==null&&(R[Ze]=$e)}for(const Ze in De)R[Ze]=De[Ze]}}}return R}const Jb=d=>(y,T)=>{const S=we.useContext(zy),R=we.useContext(Py),O=()=>JM(d,y,S,R);return T?O():J_(O)};function C0(d,y,T){const{style:S}=d,R={};for(const O in S)(Oa(S[O])||y.style&&Oa(y.style[O])||Xb(O,d)||T?.getValue(O)?.liveStyle!==void 0)&&(R[O]=S[O]);return R}const tE=Jb({scrapeMotionValuesFromProps:C0,createRenderState:M0});function e1(d,y,T){const S=C0(d,y,T);for(const R in d)if(Oa(d[R])||Oa(y[R])){const O=Rp.indexOf(R)!==-1?"attr"+R.charAt(0).toUpperCase()+R.substring(1):R;S[O]=d[R]}return S}const iE=Jb({scrapeMotionValuesFromProps:e1,createRenderState:Kb}),nE=Symbol.for("motionComponentSymbol");function wp(d){return d&&typeof d=="object"&&Object.prototype.hasOwnProperty.call(d,"current")}function rE(d,y,T){return we.useCallback(S=>{S&&d.onMount&&d.onMount(S),y&&(S?y.mount(S):y.unmount()),T&&(typeof T=="function"?T(S):wp(T)&&(T.current=S))},[y])}const D0=d=>d.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),aE="framerAppearId",t1="data-"+D0(aE),i1=we.createContext({});function sE(d,y,T,S,R){const{visualElement:O}=we.useContext(zy),M=we.useContext(Zb),u=we.useContext(Py),j=we.useContext(b0).reducedMotion,Z=we.useRef(null);S=S||M.renderer,!Z.current&&S&&(Z.current=S(d,{visualState:y,parent:O,props:T,presenceContext:u,blockInitialAnimation:u?u.initial===!1:!1,reducedMotionConfig:j}));const X=Z.current,te=we.useContext(i1);X&&!X.projection&&R&&(X.type==="html"||X.type==="svg")&&oE(Z.current,T,R,te);const de=we.useRef(!1);we.useInsertionEffect(()=>{X&&de.current&&X.update(T,u)});const Ae=T[t1],Ce=we.useRef(!!Ae&&!window.MotionHandoffIsComplete?.(Ae)&&window.MotionHasOptimisedAnimation?.(Ae));return Qx(()=>{X&&(de.current=!0,window.MotionIsMounted=!0,X.updateFeatures(),X.scheduleRenderMicrotask(),Ce.current&&X.animationState&&X.animationState.animateChanges())}),we.useEffect(()=>{X&&(!Ce.current&&X.animationState&&X.animationState.animateChanges(),Ce.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(Ae)}),Ce.current=!1),X.enteringChildren=void 0)}),X}function oE(d,y,T,S){const{layoutId:R,layout:O,drag:M,dragConstraints:u,layoutScroll:j,layoutRoot:Z,layoutCrossfade:X}=y;d.projection=new T(d.latestValues,y["data-framer-portal-id"]?void 0:n1(d.parent)),d.projection.setOptions({layoutId:R,layout:O,alwaysMeasureLayout:!!M||u&&wp(u),visualElement:d,animationType:typeof O=="string"?O:"both",initialPromotionConfig:S,crossfade:X,layoutScroll:j,layoutRoot:Z})}function n1(d){if(d)return d.options.allowProjection!==!1?d.projection:n1(d.parent)}function d_(d,{forwardMotionProps:y=!1}={},T,S){T&&LM(T);const R=E0(d)?iE:tE;function O(u,j){let Z;const X={...we.useContext(b0),...u,layoutId:lE(u)},{isStatic:te}=X,de=jM(u),Ae=R(u,te);if(!te&&e0){uE();const Ce=cE(X);Z=Ce.MeasureLayout,de.visualElement=sE(d,Ae,X,S,Ce.ProjectionNode)}return he.jsxs(zy.Provider,{value:de,children:[Z&&de.visualElement?he.jsx(Z,{visualElement:de.visualElement,...X}):null,QM(d,u,rE(Ae,de.visualElement,j),Ae,te,y)]})}O.displayName=`motion.${typeof d=="string"?d:`create(${d.displayName??d.name??""})`}`;const M=we.forwardRef(O);return M[nE]=d,M}function lE({layoutId:d}){const y=we.useContext(Q_).id;return y&&d!==void 0?y+"-"+d:d}function uE(d,y){we.useContext(Zb).strict}function cE(d){const{drag:y,layout:T}=Cp;if(!y&&!T)return{};const S={...y,...T};return{MeasureLayout:y?.isEnabled(d)||T?.isEnabled(d)?S.MeasureLayout:void 0,ProjectionNode:S.ProjectionNode}}function hE(d,y){if(typeof Proxy>"u")return d_;const T=new Map,S=(O,M)=>d_(O,M,d,y),R=(O,M)=>S(O,M);return new Proxy(R,{get:(O,M)=>M==="create"?S:(T.has(M)||T.set(M,d_(M,void 0,d,y)),T.get(M))})}function r1({top:d,left:y,right:T,bottom:S}){return{x:{min:y,max:T},y:{min:d,max:S}}}function dE({x:d,y}){return{top:y.min,right:d.max,bottom:y.max,left:d.min}}function fE(d,y){if(!y)return d;const T=y({x:d.left,y:d.top}),S=y({x:d.right,y:d.bottom});return{top:T.y,left:T.x,bottom:S.y,right:S.x}}function f_(d){return d===void 0||d===1}function O_({scale:d,scaleX:y,scaleY:T}){return!f_(d)||!f_(y)||!f_(T)}function Hd(d){return O_(d)||a1(d)||d.z||d.rotate||d.rotateX||d.rotateY||d.skewX||d.skewY}function a1(d){return jv(d.x)||jv(d.y)}function jv(d){return d&&d!=="0%"}function Ey(d,y,T){const S=d-T,R=y*S;return T+R}function Nv(d,y,T,S,R){return R!==void 0&&(d=Ey(d,R,S)),Ey(d,T,S)+y}function F_(d,y=0,T=1,S,R){d.min=Nv(d.min,y,T,S,R),d.max=Nv(d.max,y,T,S,R)}function s1(d,{x:y,y:T}){F_(d.x,y.translate,y.scale,y.originPoint),F_(d.y,T.translate,T.scale,T.originPoint)}const Vv=.999999999999,Uv=1.0000000000001;function pE(d,y,T,S=!1){const R=T.length;if(!R)return;y.x=y.y=1;let O,M;for(let u=0;u<R;u++){O=T[u],M=O.projectionDelta;const{visualElement:j}=O.options;j&&j.props.style&&j.props.style.display==="contents"||(S&&O.options.layoutScroll&&O.scroll&&O!==O.root&&Sp(d,{x:-O.scroll.offset.x,y:-O.scroll.offset.y}),M&&(y.x*=M.x.scale,y.y*=M.y.scale,s1(d,M)),S&&Hd(O.latestValues)&&Sp(d,O.latestValues))}y.x<Uv&&y.x>Vv&&(y.x=1),y.y<Uv&&y.y>Vv&&(y.y=1)}function Tp(d,y){d.min=d.min+y,d.max=d.max+y}function Gv(d,y,T,S,R=.5){const O=Xn(d.min,d.max,R);F_(d,y,T,O,S)}function Sp(d,y){Gv(d.x,y.x,y.scaleX,y.scale,y.originX),Gv(d.y,y.y,y.scaleY,y.scale,y.originY)}function o1(d,y){return r1(fE(d.getBoundingClientRect(),y))}function mE(d,y,T){const S=o1(d,T),{scroll:R}=y;return R&&(Tp(S.x,R.offset.x),Tp(S.y,R.offset.y)),S}const qv=()=>({translate:0,scale:1,origin:0,originPoint:0}),Mp=()=>({x:qv(),y:qv()}),Zv=()=>({min:0,max:0}),kr=()=>({x:Zv(),y:Zv()}),j_={current:null},l1={current:!1};function gE(){if(l1.current=!0,!!e0)if(window.matchMedia){const d=window.matchMedia("(prefers-reduced-motion)"),y=()=>j_.current=d.matches;d.addEventListener("change",y),y()}else j_.current=!1}const yE=new WeakMap;function _E(d,y,T){for(const S in y){const R=y[S],O=T[S];if(Oa(R))d.addValue(S,R);else if(Oa(O))d.addValue(S,Ap(R,{owner:d}));else if(O!==R)if(d.hasValue(S)){const M=d.getValue(S);M.liveStyle===!0?M.jump(R):M.hasAnimated||M.set(R)}else{const M=d.getStaticValue(S);d.addValue(S,Ap(M!==void 0?M:R,{owner:d}))}}for(const S in T)y[S]===void 0&&d.removeValue(S);return y}const Hv=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class vE{scrapeMotionValuesFromProps(y,T,S){return{}}constructor({parent:y,props:T,presenceContext:S,reducedMotionConfig:R,blockInitialAnimation:O,visualState:M},u={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=g0,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const de=Is.now();this.renderScheduledAt<de&&(this.renderScheduledAt=de,Vn.render(this.render,!1,!0))};const{latestValues:j,renderState:Z}=M;this.latestValues=j,this.baseTarget={...j},this.initialValues=T.initial?{...j}:{},this.renderState=Z,this.parent=y,this.props=T,this.presenceContext=S,this.depth=y?y.depth+1:0,this.reducedMotionConfig=R,this.options=u,this.blockInitialAnimation=!!O,this.isControllingVariants=Iy(T),this.isVariantNode=$b(T),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(y&&y.current);const{willChange:X,...te}=this.scrapeMotionValuesFromProps(T,{},this);for(const de in te){const Ae=te[de];j[de]!==void 0&&Oa(Ae)&&Ae.set(j[de])}}mount(y){this.current=y,yE.set(y,this),this.projection&&!this.projection.instance&&this.projection.mount(y),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((T,S)=>this.bindToMotionValue(S,T)),l1.current||gE(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:j_.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Rh(this.notifyUpdate),Rh(this.render),this.valueSubscriptions.forEach(y=>y()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const y in this.events)this.events[y].clear();for(const y in this.features){const T=this.features[y];T&&(T.unmount(),T.isMounted=!1)}this.current=null}addChild(y){this.children.add(y),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(y)}removeChild(y){this.children.delete(y),this.enteringChildren&&this.enteringChildren.delete(y)}bindToMotionValue(y,T){this.valueSubscriptions.has(y)&&this.valueSubscriptions.get(y)();const S=Ip.has(y);S&&this.onBindTransform&&this.onBindTransform();const R=T.on("change",M=>{this.latestValues[y]=M,this.props.onUpdate&&Vn.preRender(this.notifyUpdate),S&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let O;window.MotionCheckAppearSync&&(O=window.MotionCheckAppearSync(this,y,T)),this.valueSubscriptions.set(y,()=>{R(),O&&O(),T.owner&&T.stop()})}sortNodePosition(y){return!this.current||!this.sortInstanceNodePosition||this.type!==y.type?0:this.sortInstanceNodePosition(this.current,y.current)}updateFeatures(){let y="animation";for(y in Cp){const T=Cp[y];if(!T)continue;const{isEnabled:S,Feature:R}=T;if(!this.features[y]&&R&&S(this.props)&&(this.features[y]=new R(this)),this.features[y]){const O=this.features[y];O.isMounted?O.update():(O.mount(),O.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):kr()}getStaticValue(y){return this.latestValues[y]}setStaticValue(y,T){this.latestValues[y]=T}update(y,T){(y.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=y,this.prevPresenceContext=this.presenceContext,this.presenceContext=T;for(let S=0;S<Hv.length;S++){const R=Hv[S];this.propEventSubscriptions[R]&&(this.propEventSubscriptions[R](),delete this.propEventSubscriptions[R]);const O="on"+R,M=y[O];M&&(this.propEventSubscriptions[R]=this.on(R,M))}this.prevMotionValues=_E(this,this.scrapeMotionValuesFromProps(y,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(y){return this.props.variants?this.props.variants[y]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(y){const T=this.getClosestVariantNode();if(T)return T.variantChildren&&T.variantChildren.add(y),()=>T.variantChildren.delete(y)}addValue(y,T){const S=this.values.get(y);T!==S&&(S&&this.removeValue(y),this.bindToMotionValue(y,T),this.values.set(y,T),this.latestValues[y]=T.get())}removeValue(y){this.values.delete(y);const T=this.valueSubscriptions.get(y);T&&(T(),this.valueSubscriptions.delete(y)),delete this.latestValues[y],this.removeValueFromRenderState(y,this.renderState)}hasValue(y){return this.values.has(y)}getValue(y,T){if(this.props.values&&this.props.values[y])return this.props.values[y];let S=this.values.get(y);return S===void 0&&T!==void 0&&(S=Ap(T===null?void 0:T,{owner:this}),this.addValue(y,S)),S}readValue(y,T){let S=this.latestValues[y]!==void 0||!this.current?this.latestValues[y]:this.getBaseTargetFromProps(this.props,y)??this.readValueFromInstance(this.current,y,this.options);return S!=null&&(typeof S=="string"&&(Jx(S)||tb(S))?S=parseFloat(S):!EM(S)&&Ih.test(T)&&(S=Ob(y,T)),this.setBaseTarget(y,Oa(S)?S.get():S)),Oa(S)?S.get():S}setBaseTarget(y,T){this.baseTarget[y]=T}getBaseTarget(y){const{initial:T}=this.props;let S;if(typeof T=="string"||typeof T=="object"){const O=A0(this.props,T,this.presenceContext?.custom);O&&(S=O[y])}if(T&&S!==void 0)return S;const R=this.getBaseTargetFromProps(this.props,y);return R!==void 0&&!Oa(R)?R:this.initialValues[y]!==void 0&&S===void 0?void 0:this.baseTarget[y]}on(y,T){return this.events[y]||(this.events[y]=new a0),this.events[y].add(T)}notify(y,...T){this.events[y]&&this.events[y].notify(...T)}scheduleRenderMicrotask(){v0.render(this.render)}}class u1 extends vE{constructor(){super(...arguments),this.KeyframeResolver=pM}sortInstanceNodePosition(y,T){return y.compareDocumentPosition(T)&2?1:-1}getBaseTargetFromProps(y,T){return y.style?y.style[T]:void 0}removeValueFromRenderState(y,{vars:T,style:S}){delete T[y],delete S[y]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:y}=this.props;Oa(y)&&(this.childSubscription=y.on("change",T=>{this.current&&(this.current.textContent=`${T}`)}))}}function c1(d,{style:y,vars:T},S,R){const O=d.style;let M;for(M in y)O[M]=y[M];R?.applyProjectionStyles(O,S);for(M in T)O.setProperty(M,T[M])}function xE(d){return window.getComputedStyle(d)}class bE extends u1{constructor(){super(...arguments),this.type="html",this.renderInstance=c1}readValueFromInstance(y,T){if(Ip.has(T))return this.projection?.isProjecting?D_(T):IS(y,T);{const S=xE(y),R=(mb(T)?S.getPropertyValue(T):S[T])||0;return typeof R=="string"?R.trim():R}}measureInstanceViewportBox(y,{transformPagePoint:T}){return o1(y,T)}build(y,T,S){S0(y,T,S.transformTemplate)}scrapeMotionValuesFromProps(y,T,S){return C0(y,T,S)}}const h1=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function wE(d,y,T,S){c1(d,y,void 0,S);for(const R in y.attrs)d.setAttribute(h1.has(R)?R:D0(R),y.attrs[R])}class TE extends u1{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=kr}getBaseTargetFromProps(y,T){return y[T]}readValueFromInstance(y,T){if(Ip.has(T)){const S=Bb(T);return S&&S.default||0}return T=h1.has(T)?T:D0(T),y.getAttribute(T)}scrapeMotionValuesFromProps(y,T,S){return e1(y,T,S)}build(y,T,S){Wb(y,T,this.isSVGTag,S.transformTemplate,S.style)}renderInstance(y,T,S,R){wE(y,T,S,R)}mount(y){this.isSVGTag=Qb(y.tagName),super.mount(y)}}const SE=(d,y)=>E0(d)?new TE(y):new bE(y,{allowProjection:d!==we.Fragment});function Ep(d,y,T){const S=d.getProps();return A0(S,y,T!==void 0?T:S.custom,d)}const N_=d=>Array.isArray(d);function ME(d,y,T){d.hasValue(y)?d.getValue(y).set(T):d.addValue(y,Ap(T))}function EE(d){return N_(d)?d[d.length-1]||0:d}function AE(d,y){const T=Ep(d,y);let{transitionEnd:S={},transition:R={},...O}=T||{};O={...O,...S};for(const M in O){const u=EE(O[M]);ME(d,M,u)}}function CE(d){return!!(Oa(d)&&d.add)}function V_(d,y){const T=d.getValue("willChange");if(CE(T))return T.add(y);if(!T&&zc.WillChange){const S=new zc.WillChange("auto");d.addValue("willChange",S),S.add(y)}}function d1(d){return d.props[t1]}const DE=d=>d!==null;function PE(d,{repeat:y,repeatType:T="loop"},S){const R=d.filter(DE),O=y&&T!=="loop"&&y%2===1?0:R.length-1;return R[O]}const zE={type:"spring",stiffness:500,damping:25,restSpeed:10},RE=d=>({type:"spring",stiffness:550,damping:d===0?2*Math.sqrt(550):30,restSpeed:10}),IE={type:"keyframes",duration:.8},LE={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},kE=(d,{keyframes:y})=>y.length>2?IE:Ip.has(d)?d.startsWith("scale")?RE(y[1]):zE:LE;function BE({when:d,delay:y,delayChildren:T,staggerChildren:S,staggerDirection:R,repeat:O,repeatType:M,repeatDelay:u,from:j,elapsed:Z,...X}){return!!Object.keys(X).length}const P0=(d,y,T,S={},R,O)=>M=>{const u=y0(S,d)||{},j=u.delay||S.delay||0;let{elapsed:Z=0}=S;Z=Z-Au(j);const X={keyframes:Array.isArray(T)?T:[null,T],ease:"easeOut",velocity:y.getVelocity(),...u,delay:-Z,onUpdate:de=>{y.set(de),u.onUpdate&&u.onUpdate(de)},onComplete:()=>{M(),u.onComplete&&u.onComplete()},name:d,motionValue:y,element:O?void 0:R};BE(u)||Object.assign(X,kE(d,X)),X.duration&&(X.duration=Au(X.duration)),X.repeatDelay&&(X.repeatDelay=Au(X.repeatDelay)),X.from!==void 0&&(X.keyframes[0]=X.from);let te=!1;if((X.type===!1||X.duration===0&&!X.repeatDelay)&&(L_(X),X.delay===0&&(te=!0)),(zc.instantAnimations||zc.skipAnimations)&&(te=!0,L_(X),X.delay=0),X.allowFlatten=!u.type&&!u.ease,te&&!O&&y.get()!==void 0){const de=PE(X.keyframes,u);if(de!==void 0){Vn.update(()=>{X.onUpdate(de),X.onComplete()});return}}return u.isSync?new m0(X):new iM(X)};function OE({protectedKeys:d,needsAnimating:y},T){const S=d.hasOwnProperty(T)&&y[T]!==!0;return y[T]=!1,S}function f1(d,y,{delay:T=0,transitionOverride:S,type:R}={}){let{transition:O=d.getDefaultTransition(),transitionEnd:M,...u}=y;S&&(O=S);const j=[],Z=R&&d.animationState&&d.animationState.getState()[R];for(const X in u){const te=d.getValue(X,d.latestValues[X]??null),de=u[X];if(de===void 0||Z&&OE(Z,X))continue;const Ae={delay:T,...y0(O||{},X)},Ce=te.get();if(Ce!==void 0&&!te.isAnimating&&!Array.isArray(de)&&de===Ce&&!Ae.velocity)continue;let De=!1;if(window.MotionHandoffAnimation){const We=d1(d);if(We){const Ze=window.MotionHandoffAnimation(We,X,Vn);Ze!==null&&(Ae.startTime=Ze,De=!0)}}V_(d,X),te.start(P0(X,te,de,d.shouldReduceMotion&&Ib.has(X)?{type:!1}:Ae,d,De));const oe=te.animation;oe&&j.push(oe)}return M&&Promise.all(j).then(()=>{Vn.update(()=>{M&&AE(d,M)})}),j}function p1(d,y,T,S=0,R=1){const O=Array.from(d).sort((Z,X)=>Z.sortNodePosition(X)).indexOf(y),M=d.size,u=(M-1)*S;return typeof T=="function"?T(O,M):R===1?O*S:u-O*S}function U_(d,y,T={}){const S=Ep(d,y,T.type==="exit"?d.presenceContext?.custom:void 0);let{transition:R=d.getDefaultTransition()||{}}=S||{};T.transitionOverride&&(R=T.transitionOverride);const O=S?()=>Promise.all(f1(d,S,T)):()=>Promise.resolve(),M=d.variantChildren&&d.variantChildren.size?(j=0)=>{const{delayChildren:Z=0,staggerChildren:X,staggerDirection:te}=R;return FE(d,y,j,Z,X,te,T)}:()=>Promise.resolve(),{when:u}=R;if(u){const[j,Z]=u==="beforeChildren"?[O,M]:[M,O];return j().then(()=>Z())}else return Promise.all([O(),M(T.delay)])}function FE(d,y,T=0,S=0,R=0,O=1,M){const u=[];for(const j of d.variantChildren)j.notify("AnimationStart",y),u.push(U_(j,y,{...M,delay:T+(typeof S=="function"?0:S)+p1(d.variantChildren,j,S,R,O)}).then(()=>j.notify("AnimationComplete",y)));return Promise.all(u)}function jE(d,y,T={}){d.notify("AnimationStart",y);let S;if(Array.isArray(y)){const R=y.map(O=>U_(d,O,T));S=Promise.all(R)}else if(typeof y=="string")S=U_(d,y,T);else{const R=typeof y=="function"?Ep(d,y,T.custom):y;S=Promise.all(f1(d,R,T))}return S.then(()=>{d.notify("AnimationComplete",y)})}function m1(d,y){if(!Array.isArray(y))return!1;const T=y.length;if(T!==d.length)return!1;for(let S=0;S<T;S++)if(y[S]!==d[S])return!1;return!0}const NE=T0.length;function g1(d){if(!d)return;if(!d.isControllingVariants){const T=d.parent?g1(d.parent)||{}:{};return d.props.initial!==void 0&&(T.initial=d.props.initial),T}const y={};for(let T=0;T<NE;T++){const S=T0[T],R=d.props[S];(Jm(R)||R===!1)&&(y[S]=R)}return y}const VE=[...w0].reverse(),UE=w0.length;function GE(d){return y=>Promise.all(y.map(({animation:T,options:S})=>jE(d,T,S)))}function qE(d){let y=GE(d),T=$v(),S=!0;const R=j=>(Z,X)=>{const te=Ep(d,X,j==="exit"?d.presenceContext?.custom:void 0);if(te){const{transition:de,transitionEnd:Ae,...Ce}=te;Z={...Z,...Ce,...Ae}}return Z};function O(j){y=j(d)}function M(j){const{props:Z}=d,X=g1(d.parent)||{},te=[],de=new Set;let Ae={},Ce=1/0;for(let oe=0;oe<UE;oe++){const We=VE[oe],Ze=T[We],$e=Z[We]!==void 0?Z[We]:X[We],Ct=Jm($e),Ke=We===j?Ze.isActive:null;Ke===!1&&(Ce=oe);let vt=$e===X[We]&&$e!==Z[We]&&Ct;if(vt&&S&&d.manuallyAnimateOnMount&&(vt=!1),Ze.protectedKeys={...Ae},!Ze.isActive&&Ke===null||!$e&&!Ze.prevProp||Ry($e)||typeof $e=="boolean")continue;const mt=ZE(Ze.prevProp,$e);let Et=mt||We===j&&Ze.isActive&&!vt&&Ct||oe>Ce&&Ct,Xt=!1;const ct=Array.isArray($e)?$e:[$e];let Yt=ct.reduce(R(We),{});Ke===!1&&(Yt={});const{prevResolvedValues:ki={}}=Ze,wn={...ki,...Yt},mr=ht=>{Et=!0,de.has(ht)&&(Xt=!0,de.delete(ht)),Ze.needsAnimating[ht]=!0;const Rt=d.getValue(ht);Rt&&(Rt.liveStyle=!1)};for(const ht in wn){const Rt=Yt[ht],It=ki[ht];if(Ae.hasOwnProperty(ht))continue;let si=!1;N_(Rt)&&N_(It)?si=!m1(Rt,It):si=Rt!==It,si?Rt!=null?mr(ht):de.add(ht):Rt!==void 0&&de.has(ht)?mr(ht):Ze.protectedKeys[ht]=!0}Ze.prevProp=$e,Ze.prevResolvedValues=Yt,Ze.isActive&&(Ae={...Ae,...Yt}),S&&d.blockInitialAnimation&&(Et=!1);const Bn=vt&&mt;Et&&(!Bn||Xt)&&te.push(...ct.map(ht=>{const Rt={type:We};if(typeof ht=="string"&&S&&!Bn&&d.manuallyAnimateOnMount&&d.parent){const{parent:It}=d,si=Ep(It,ht);if(It.enteringChildren&&si){const{delayChildren:Me}=si.transition||{};Rt.delay=p1(It.enteringChildren,d,Me)}}return{animation:ht,options:Rt}}))}if(de.size){const oe={};if(typeof Z.initial!="boolean"){const We=Ep(d,Array.isArray(Z.initial)?Z.initial[0]:Z.initial);We&&We.transition&&(oe.transition=We.transition)}de.forEach(We=>{const Ze=d.getBaseTarget(We),$e=d.getValue(We);$e&&($e.liveStyle=!0),oe[We]=Ze??null}),te.push({animation:oe})}let De=!!te.length;return S&&(Z.initial===!1||Z.initial===Z.animate)&&!d.manuallyAnimateOnMount&&(De=!1),S=!1,De?y(te):Promise.resolve()}function u(j,Z){if(T[j].isActive===Z)return Promise.resolve();d.variantChildren?.forEach(te=>te.animationState?.setActive(j,Z)),T[j].isActive=Z;const X=M(j);for(const te in T)T[te].protectedKeys={};return X}return{animateChanges:M,setActive:u,setAnimateFunction:O,getState:()=>T,reset:()=>{T=$v()}}}function ZE(d,y){return typeof y=="string"?y!==d:Array.isArray(y)?!m1(y,d):!1}function Zd(d=!1){return{isActive:d,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function $v(){return{animate:Zd(!0),whileInView:Zd(),whileHover:Zd(),whileTap:Zd(),whileDrag:Zd(),whileFocus:Zd(),exit:Zd()}}class Lh{constructor(y){this.isMounted=!1,this.node=y}update(){}}class HE extends Lh{constructor(y){super(y),y.animationState||(y.animationState=qE(y))}updateAnimationControlsSubscription(){const{animate:y}=this.node.getProps();Ry(y)&&(this.unmountControls=y.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:y}=this.node.getProps(),{animate:T}=this.node.prevProps||{};y!==T&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let $E=0;class XE extends Lh{constructor(){super(...arguments),this.id=$E++}update(){if(!this.node.presenceContext)return;const{isPresent:y,onExitComplete:T}=this.node.presenceContext,{isPresent:S}=this.node.prevPresenceContext||{};if(!this.node.animationState||y===S)return;const R=this.node.animationState.setActive("exit",!y);T&&!y&&R.then(()=>{T(this.id)})}mount(){const{register:y,onExitComplete:T}=this.node.presenceContext||{};T&&T(this.id),y&&(this.unmount=y(this.id))}unmount(){}}const YE={animation:{Feature:HE},exit:{Feature:XE}};function eg(d,y,T,S={passive:!0}){return d.addEventListener(y,T,S),()=>d.removeEventListener(y,T)}function og(d){return{point:{x:d.pageX,y:d.pageY}}}const WE=d=>y=>x0(y)&&d(y,og(y));function $m(d,y,T,S){return eg(d,y,WE(T),S)}const y1=1e-4,KE=1-y1,QE=1+y1,_1=.01,JE=0-_1,eA=0+_1;function ns(d){return d.max-d.min}function tA(d,y,T){return Math.abs(d-y)<=T}function Xv(d,y,T,S=.5){d.origin=S,d.originPoint=Xn(y.min,y.max,d.origin),d.scale=ns(T)/ns(y),d.translate=Xn(T.min,T.max,d.origin)-d.originPoint,(d.scale>=KE&&d.scale<=QE||isNaN(d.scale))&&(d.scale=1),(d.translate>=JE&&d.translate<=eA||isNaN(d.translate))&&(d.translate=0)}function Xm(d,y,T,S){Xv(d.x,y.x,T.x,S?S.originX:void 0),Xv(d.y,y.y,T.y,S?S.originY:void 0)}function Yv(d,y,T){d.min=T.min+y.min,d.max=d.min+ns(y)}function iA(d,y,T){Yv(d.x,y.x,T.x),Yv(d.y,y.y,T.y)}function Wv(d,y,T){d.min=y.min-T.min,d.max=d.min+ns(y)}function Ay(d,y,T){Wv(d.x,y.x,T.x),Wv(d.y,y.y,T.y)}function Fo(d){return[d("x"),d("y")]}const v1=({current:d})=>d?d.ownerDocument.defaultView:null,Kv=(d,y)=>Math.abs(d-y);function nA(d,y){const T=Kv(d.x,y.x),S=Kv(d.y,y.y);return Math.sqrt(T**2+S**2)}class x1{constructor(y,T,{transformPagePoint:S,contextWindow:R=window,dragSnapToOrigin:O=!1,distanceThreshold:M=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const de=m_(this.lastMoveEventInfo,this.history),Ae=this.startEvent!==null,Ce=nA(de.offset,{x:0,y:0})>=this.distanceThreshold;if(!Ae&&!Ce)return;const{point:De}=de,{timestamp:oe}=ma;this.history.push({...De,timestamp:oe});const{onStart:We,onMove:Ze}=this.handlers;Ae||(We&&We(this.lastMoveEvent,de),this.startEvent=this.lastMoveEvent),Ze&&Ze(this.lastMoveEvent,de)},this.handlePointerMove=(de,Ae)=>{this.lastMoveEvent=de,this.lastMoveEventInfo=p_(Ae,this.transformPagePoint),Vn.update(this.updatePoint,!0)},this.handlePointerUp=(de,Ae)=>{this.end();const{onEnd:Ce,onSessionEnd:De,resumeAnimation:oe}=this.handlers;if(this.dragSnapToOrigin&&oe&&oe(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const We=m_(de.type==="pointercancel"?this.lastMoveEventInfo:p_(Ae,this.transformPagePoint),this.history);this.startEvent&&Ce&&Ce(de,We),De&&De(de,We)},!x0(y))return;this.dragSnapToOrigin=O,this.handlers=T,this.transformPagePoint=S,this.distanceThreshold=M,this.contextWindow=R||window;const u=og(y),j=p_(u,this.transformPagePoint),{point:Z}=j,{timestamp:X}=ma;this.history=[{...Z,timestamp:X}];const{onSessionStart:te}=T;te&&te(y,m_(j,this.history)),this.removeListeners=rg($m(this.contextWindow,"pointermove",this.handlePointerMove),$m(this.contextWindow,"pointerup",this.handlePointerUp),$m(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(y){this.handlers=y}end(){this.removeListeners&&this.removeListeners(),Rh(this.updatePoint)}}function p_(d,y){return y?{point:y(d.point)}:d}function Qv(d,y){return{x:d.x-y.x,y:d.y-y.y}}function m_({point:d},y){return{point:d,delta:Qv(d,b1(y)),offset:Qv(d,rA(y)),velocity:aA(y,.1)}}function rA(d){return d[0]}function b1(d){return d[d.length-1]}function aA(d,y){if(d.length<2)return{x:0,y:0};let T=d.length-1,S=null;const R=b1(d);for(;T>=0&&(S=d[T],!(R.timestamp-S.timestamp>Au(y)));)T--;if(!S)return{x:0,y:0};const O=jo(R.timestamp-S.timestamp);if(O===0)return{x:0,y:0};const M={x:(R.x-S.x)/O,y:(R.y-S.y)/O};return M.x===1/0&&(M.x=0),M.y===1/0&&(M.y=0),M}function sA(d,{min:y,max:T},S){return y!==void 0&&d<y?d=S?Xn(y,d,S.min):Math.max(d,y):T!==void 0&&d>T&&(d=S?Xn(T,d,S.max):Math.min(d,T)),d}function Jv(d,y,T){return{min:y!==void 0?d.min+y:void 0,max:T!==void 0?d.max+T-(d.max-d.min):void 0}}function oA(d,{top:y,left:T,bottom:S,right:R}){return{x:Jv(d.x,T,R),y:Jv(d.y,y,S)}}function ex(d,y){let T=y.min-d.min,S=y.max-d.max;return y.max-y.min<d.max-d.min&&([T,S]=[S,T]),{min:T,max:S}}function lA(d,y){return{x:ex(d.x,y.x),y:ex(d.y,y.y)}}function uA(d,y){let T=.5;const S=ns(d),R=ns(y);return R>S?T=Wm(y.min,y.max-S,d.min):S>R&&(T=Wm(d.min,d.max-R,y.min)),Pc(0,1,T)}function cA(d,y){const T={};return y.min!==void 0&&(T.min=y.min-d.min),y.max!==void 0&&(T.max=y.max-d.min),T}const G_=.35;function hA(d=G_){return d===!1?d=0:d===!0&&(d=G_),{x:tx(d,"left","right"),y:tx(d,"top","bottom")}}function tx(d,y,T){return{min:ix(d,y),max:ix(d,T)}}function ix(d,y){return typeof d=="number"?d:d[y]||0}const dA=new WeakMap;class fA{constructor(y){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=kr(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=y}start(y,{snapToCursor:T=!1,distanceThreshold:S}={}){const{presenceContext:R}=this.visualElement;if(R&&R.isPresent===!1)return;const O=te=>{const{dragSnapToOrigin:de}=this.getProps();de?this.pauseAnimation():this.stopAnimation(),T&&this.snapToCursor(og(te).point)},M=(te,de)=>{const{drag:Ae,dragPropagation:Ce,onDragStart:De}=this.getProps();if(Ae&&!Ce&&(this.openDragLock&&this.openDragLock(),this.openDragLock=_M(Ae),!this.openDragLock))return;this.latestPointerEvent=te,this.latestPanInfo=de,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Fo(We=>{let Ze=this.getAxisMotionValue(We).get()||0;if(Cu.test(Ze)){const{projection:$e}=this.visualElement;if($e&&$e.layout){const Ct=$e.layout.layoutBox[We];Ct&&(Ze=ns(Ct)*(parseFloat(Ze)/100))}}this.originPoint[We]=Ze}),De&&Vn.postRender(()=>De(te,de)),V_(this.visualElement,"transform");const{animationState:oe}=this.visualElement;oe&&oe.setActive("whileDrag",!0)},u=(te,de)=>{this.latestPointerEvent=te,this.latestPanInfo=de;const{dragPropagation:Ae,dragDirectionLock:Ce,onDirectionLock:De,onDrag:oe}=this.getProps();if(!Ae&&!this.openDragLock)return;const{offset:We}=de;if(Ce&&this.currentDirection===null){this.currentDirection=pA(We),this.currentDirection!==null&&De&&De(this.currentDirection);return}this.updateAxis("x",de.point,We),this.updateAxis("y",de.point,We),this.visualElement.render(),oe&&oe(te,de)},j=(te,de)=>{this.latestPointerEvent=te,this.latestPanInfo=de,this.stop(te,de),this.latestPointerEvent=null,this.latestPanInfo=null},Z=()=>Fo(te=>this.getAnimationState(te)==="paused"&&this.getAxisMotionValue(te).animation?.play()),{dragSnapToOrigin:X}=this.getProps();this.panSession=new x1(y,{onSessionStart:O,onStart:M,onMove:u,onSessionEnd:j,resumeAnimation:Z},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:X,distanceThreshold:S,contextWindow:v1(this.visualElement)})}stop(y,T){const S=y||this.latestPointerEvent,R=T||this.latestPanInfo,O=this.isDragging;if(this.cancel(),!O||!R||!S)return;const{velocity:M}=R;this.startAnimation(M);const{onDragEnd:u}=this.getProps();u&&Vn.postRender(()=>u(S,R))}cancel(){this.isDragging=!1;const{projection:y,animationState:T}=this.visualElement;y&&(y.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:S}=this.getProps();!S&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),T&&T.setActive("whileDrag",!1)}updateAxis(y,T,S){const{drag:R}=this.getProps();if(!S||!fy(y,R,this.currentDirection))return;const O=this.getAxisMotionValue(y);let M=this.originPoint[y]+S[y];this.constraints&&this.constraints[y]&&(M=sA(M,this.constraints[y],this.elastic[y])),O.set(M)}resolveConstraints(){const{dragConstraints:y,dragElastic:T}=this.getProps(),S=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,R=this.constraints;y&&wp(y)?this.constraints||(this.constraints=this.resolveRefConstraints()):y&&S?this.constraints=oA(S.layoutBox,y):this.constraints=!1,this.elastic=hA(T),R!==this.constraints&&S&&this.constraints&&!this.hasMutatedConstraints&&Fo(O=>{this.constraints!==!1&&this.getAxisMotionValue(O)&&(this.constraints[O]=cA(S.layoutBox[O],this.constraints[O]))})}resolveRefConstraints(){const{dragConstraints:y,onMeasureDragConstraints:T}=this.getProps();if(!y||!wp(y))return!1;const S=y.current,{projection:R}=this.visualElement;if(!R||!R.layout)return!1;const O=mE(S,R.root,this.visualElement.getTransformPagePoint());let M=lA(R.layout.layoutBox,O);if(T){const u=T(dE(M));this.hasMutatedConstraints=!!u,u&&(M=r1(u))}return M}startAnimation(y){const{drag:T,dragMomentum:S,dragElastic:R,dragTransition:O,dragSnapToOrigin:M,onDragTransitionEnd:u}=this.getProps(),j=this.constraints||{},Z=Fo(X=>{if(!fy(X,T,this.currentDirection))return;let te=j&&j[X]||{};M&&(te={min:0,max:0});const de=R?200:1e6,Ae=R?40:1e7,Ce={type:"inertia",velocity:S?y[X]:0,bounceStiffness:de,bounceDamping:Ae,timeConstant:750,restDelta:1,restSpeed:10,...O,...te};return this.startAxisValueAnimation(X,Ce)});return Promise.all(Z).then(u)}startAxisValueAnimation(y,T){const S=this.getAxisMotionValue(y);return V_(this.visualElement,y),S.start(P0(y,S,0,T,this.visualElement,!1))}stopAnimation(){Fo(y=>this.getAxisMotionValue(y).stop())}pauseAnimation(){Fo(y=>this.getAxisMotionValue(y).animation?.pause())}getAnimationState(y){return this.getAxisMotionValue(y).animation?.state}getAxisMotionValue(y){const T=`_drag${y.toUpperCase()}`,S=this.visualElement.getProps(),R=S[T];return R||this.visualElement.getValue(y,(S.initial?S.initial[y]:void 0)||0)}snapToCursor(y){Fo(T=>{const{drag:S}=this.getProps();if(!fy(T,S,this.currentDirection))return;const{projection:R}=this.visualElement,O=this.getAxisMotionValue(T);if(R&&R.layout){const{min:M,max:u}=R.layout.layoutBox[T];O.set(y[T]-Xn(M,u,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:y,dragConstraints:T}=this.getProps(),{projection:S}=this.visualElement;if(!wp(T)||!S||!this.constraints)return;this.stopAnimation();const R={x:0,y:0};Fo(M=>{const u=this.getAxisMotionValue(M);if(u&&this.constraints!==!1){const j=u.get();R[M]=uA({min:j,max:j},this.constraints[M])}});const{transformTemplate:O}=this.visualElement.getProps();this.visualElement.current.style.transform=O?O({},""):"none",S.root&&S.root.updateScroll(),S.updateLayout(),this.resolveConstraints(),Fo(M=>{if(!fy(M,y,null))return;const u=this.getAxisMotionValue(M),{min:j,max:Z}=this.constraints[M];u.set(Xn(j,Z,R[M]))})}addListeners(){if(!this.visualElement.current)return;dA.set(this.visualElement,this);const y=this.visualElement.current,T=$m(y,"pointerdown",j=>{const{drag:Z,dragListener:X=!0}=this.getProps();Z&&X&&this.start(j)}),S=()=>{const{dragConstraints:j}=this.getProps();wp(j)&&j.current&&(this.constraints=this.resolveRefConstraints())},{projection:R}=this.visualElement,O=R.addEventListener("measure",S);R&&!R.layout&&(R.root&&R.root.updateScroll(),R.updateLayout()),Vn.read(S);const M=eg(window,"resize",()=>this.scalePositionWithinConstraints()),u=R.addEventListener("didUpdate",(({delta:j,hasLayoutChanged:Z})=>{this.isDragging&&Z&&(Fo(X=>{const te=this.getAxisMotionValue(X);te&&(this.originPoint[X]+=j[X].translate,te.set(te.get()+j[X].translate))}),this.visualElement.render())}));return()=>{M(),T(),O(),u&&u()}}getProps(){const y=this.visualElement.getProps(),{drag:T=!1,dragDirectionLock:S=!1,dragPropagation:R=!1,dragConstraints:O=!1,dragElastic:M=G_,dragMomentum:u=!0}=y;return{...y,drag:T,dragDirectionLock:S,dragPropagation:R,dragConstraints:O,dragElastic:M,dragMomentum:u}}}function fy(d,y,T){return(y===!0||y===d)&&(T===null||T===d)}function pA(d,y=10){let T=null;return Math.abs(d.y)>y?T="y":Math.abs(d.x)>y&&(T="x"),T}class mA extends Lh{constructor(y){super(y),this.removeGroupControls=No,this.removeListeners=No,this.controls=new fA(y)}mount(){const{dragControls:y}=this.node.getProps();y&&(this.removeGroupControls=y.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||No}unmount(){this.removeGroupControls(),this.removeListeners()}}const nx=d=>(y,T)=>{d&&Vn.postRender(()=>d(y,T))};class gA extends Lh{constructor(){super(...arguments),this.removePointerDownListener=No}onPointerDown(y){this.session=new x1(y,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:v1(this.node)})}createPanHandlers(){const{onPanSessionStart:y,onPanStart:T,onPan:S,onPanEnd:R}=this.node.getProps();return{onSessionStart:nx(y),onStart:nx(T),onMove:S,onEnd:(O,M)=>{delete this.session,R&&Vn.postRender(()=>R(O,M))}}}mount(){this.removePointerDownListener=$m(this.node.current,"pointerdown",y=>this.onPointerDown(y))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const xy={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let g_=!1;class yA extends we.Component{componentDidMount(){const{visualElement:y,layoutGroup:T,switchLayoutGroup:S,layoutId:R}=this.props,{projection:O}=y;O&&(T.group&&T.group.add(O),S&&S.register&&R&&S.register(O),g_&&O.root.didUpdate(),O.addEventListener("animationComplete",()=>{this.safeToRemove()}),O.setOptions({...O.options,onExitComplete:()=>this.safeToRemove()})),xy.hasEverUpdated=!0}getSnapshotBeforeUpdate(y){const{layoutDependency:T,visualElement:S,drag:R,isPresent:O}=this.props,{projection:M}=S;return M&&(M.isPresent=O,g_=!0,R||y.layoutDependency!==T||T===void 0||y.isPresent!==O?M.willUpdate():this.safeToRemove(),y.isPresent!==O&&(O?M.promote():M.relegate()||Vn.postRender(()=>{const u=M.getStack();(!u||!u.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:y}=this.props.visualElement;y&&(y.root.didUpdate(),v0.postRender(()=>{!y.currentAnimation&&y.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:y,layoutGroup:T,switchLayoutGroup:S}=this.props,{projection:R}=y;g_=!0,R&&(R.scheduleCheckAfterUnmount(),T&&T.group&&T.group.remove(R),S&&S.deregister&&S.deregister(R))}safeToRemove(){const{safeToRemove:y}=this.props;y&&y()}render(){return null}}function w1(d){const[y,T]=qb(),S=we.useContext(Q_);return he.jsx(yA,{...d,layoutGroup:S,switchLayoutGroup:we.useContext(i1),isPresent:y,safeToRemove:T})}function _A(d,y,T){const S=Oa(d)?d:Ap(d);return S.start(P0("",S,y,T)),S.animation}const vA=(d,y)=>d.depth-y.depth;class xA{constructor(){this.children=[],this.isDirty=!1}add(y){t0(this.children,y),this.isDirty=!0}remove(y){i0(this.children,y),this.isDirty=!0}forEach(y){this.isDirty&&this.children.sort(vA),this.isDirty=!1,this.children.forEach(y)}}function bA(d,y){const T=Is.now(),S=({timestamp:R})=>{const O=R-T;O>=y&&(Rh(S),d(O-y))};return Vn.setup(S,!0),()=>Rh(S)}const T1=["TopLeft","TopRight","BottomLeft","BottomRight"],wA=T1.length,rx=d=>typeof d=="string"?parseFloat(d):d,ax=d=>typeof d=="number"||ei.test(d);function TA(d,y,T,S,R,O){R?(d.opacity=Xn(0,T.opacity??1,SA(S)),d.opacityExit=Xn(y.opacity??1,0,MA(S))):O&&(d.opacity=Xn(y.opacity??1,T.opacity??1,S));for(let M=0;M<wA;M++){const u=`border${T1[M]}Radius`;let j=sx(y,u),Z=sx(T,u);if(j===void 0&&Z===void 0)continue;j||(j=0),Z||(Z=0),j===0||Z===0||ax(j)===ax(Z)?(d[u]=Math.max(Xn(rx(j),rx(Z),S),0),(Cu.test(Z)||Cu.test(j))&&(d[u]+="%")):d[u]=Z}(y.rotate||T.rotate)&&(d.rotate=Xn(y.rotate||0,T.rotate||0,S))}function sx(d,y){return d[y]!==void 0?d[y]:d.borderRadius}const SA=S1(0,.5,ub),MA=S1(.5,.95,No);function S1(d,y,T){return S=>S<d?0:S>y?1:T(Wm(d,y,S))}function ox(d,y){d.min=y.min,d.max=y.max}function Rl(d,y){ox(d.x,y.x),ox(d.y,y.y)}function lx(d,y){d.translate=y.translate,d.scale=y.scale,d.originPoint=y.originPoint,d.origin=y.origin}function ux(d,y,T,S,R){return d-=y,d=Ey(d,1/T,S),R!==void 0&&(d=Ey(d,1/R,S)),d}function EA(d,y=0,T=1,S=.5,R,O=d,M=d){if(Cu.test(y)&&(y=parseFloat(y),y=Xn(M.min,M.max,y/100)-M.min),typeof y!="number")return;let u=Xn(O.min,O.max,S);d===O&&(u-=y),d.min=ux(d.min,y,T,u,R),d.max=ux(d.max,y,T,u,R)}function cx(d,y,[T,S,R],O,M){EA(d,y[T],y[S],y[R],y.scale,O,M)}const AA=["x","scaleX","originX"],CA=["y","scaleY","originY"];function hx(d,y,T,S){cx(d.x,y,AA,T?T.x:void 0,S?S.x:void 0),cx(d.y,y,CA,T?T.y:void 0,S?S.y:void 0)}function dx(d){return d.translate===0&&d.scale===1}function M1(d){return dx(d.x)&&dx(d.y)}function fx(d,y){return d.min===y.min&&d.max===y.max}function DA(d,y){return fx(d.x,y.x)&&fx(d.y,y.y)}function px(d,y){return Math.round(d.min)===Math.round(y.min)&&Math.round(d.max)===Math.round(y.max)}function E1(d,y){return px(d.x,y.x)&&px(d.y,y.y)}function mx(d){return ns(d.x)/ns(d.y)}function gx(d,y){return d.translate===y.translate&&d.scale===y.scale&&d.originPoint===y.originPoint}class PA{constructor(){this.members=[]}add(y){t0(this.members,y),y.scheduleRender()}remove(y){if(i0(this.members,y),y===this.prevLead&&(this.prevLead=void 0),y===this.lead){const T=this.members[this.members.length-1];T&&this.promote(T)}}relegate(y){const T=this.members.findIndex(R=>y===R);if(T===0)return!1;let S;for(let R=T;R>=0;R--){const O=this.members[R];if(O.isPresent!==!1){S=O;break}}return S?(this.promote(S),!0):!1}promote(y,T){const S=this.lead;if(y!==S&&(this.prevLead=S,this.lead=y,y.show(),S)){S.instance&&S.scheduleRender(),y.scheduleRender(),y.resumeFrom=S,T&&(y.resumeFrom.preserveOpacity=!0),S.snapshot&&(y.snapshot=S.snapshot,y.snapshot.latestValues=S.animationValues||S.latestValues),y.root&&y.root.isUpdating&&(y.isLayoutDirty=!0);const{crossfade:R}=y.options;R===!1&&S.hide()}}exitAnimationComplete(){this.members.forEach(y=>{const{options:T,resumingFrom:S}=y;T.onExitComplete&&T.onExitComplete(),S&&S.options.onExitComplete&&S.options.onExitComplete()})}scheduleRender(){this.members.forEach(y=>{y.instance&&y.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function zA(d,y,T){let S="";const R=d.x.translate/y.x,O=d.y.translate/y.y,M=T?.z||0;if((R||O||M)&&(S=`translate3d(${R}px, ${O}px, ${M}px) `),(y.x!==1||y.y!==1)&&(S+=`scale(${1/y.x}, ${1/y.y}) `),T){const{transformPerspective:Z,rotate:X,rotateX:te,rotateY:de,skewX:Ae,skewY:Ce}=T;Z&&(S=`perspective(${Z}px) ${S}`),X&&(S+=`rotate(${X}deg) `),te&&(S+=`rotateX(${te}deg) `),de&&(S+=`rotateY(${de}deg) `),Ae&&(S+=`skewX(${Ae}deg) `),Ce&&(S+=`skewY(${Ce}deg) `)}const u=d.x.scale*y.x,j=d.y.scale*y.y;return(u!==1||j!==1)&&(S+=`scale(${u}, ${j})`),S||"none"}const y_=["","X","Y","Z"],RA=1e3;let IA=0;function __(d,y,T,S){const{latestValues:R}=y;R[d]&&(T[d]=R[d],y.setStaticValue(d,0),S&&(S[d]=0))}function A1(d){if(d.hasCheckedOptimisedAppear=!0,d.root===d)return;const{visualElement:y}=d.options;if(!y)return;const T=d1(y);if(window.MotionHasOptimisedAnimation(T,"transform")){const{layout:R,layoutId:O}=d.options;window.MotionCancelOptimisedAnimation(T,"transform",Vn,!(R||O))}const{parent:S}=d;S&&!S.hasCheckedOptimisedAppear&&A1(S)}function C1({attachResizeListener:d,defaultParent:y,measureScroll:T,checkIsScrollRoot:S,resetTransform:R}){return class{constructor(M={},u=y?.()){this.id=IA++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(BA),this.nodes.forEach(NA),this.nodes.forEach(VA),this.nodes.forEach(OA)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=M,this.root=u?u.root||u:this,this.path=u?[...u.path,u]:[],this.parent=u,this.depth=u?u.depth+1:0;for(let j=0;j<this.path.length;j++)this.path[j].shouldResetTransform=!0;this.root===this&&(this.nodes=new xA)}addEventListener(M,u){return this.eventHandlers.has(M)||this.eventHandlers.set(M,new a0),this.eventHandlers.get(M).add(u)}notifyListeners(M,...u){const j=this.eventHandlers.get(M);j&&j.notify(...u)}hasListeners(M){return this.eventHandlers.has(M)}mount(M){if(this.instance)return;this.isSVG=Gb(M)&&!SM(M),this.instance=M;const{layoutId:u,layout:j,visualElement:Z}=this.options;if(Z&&!Z.current&&Z.mount(M),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(j||u)&&(this.isLayoutDirty=!0),d){let X,te=0;const de=()=>this.root.updateBlockedByResize=!1;Vn.read(()=>{te=window.innerWidth}),d(M,()=>{const Ae=window.innerWidth;Ae!==te&&(te=Ae,this.root.updateBlockedByResize=!0,X&&X(),X=bA(de,250),xy.hasAnimatedSinceResize&&(xy.hasAnimatedSinceResize=!1,this.nodes.forEach(vx)))})}u&&this.root.registerSharedNode(u,this),this.options.animate!==!1&&Z&&(u||j)&&this.addEventListener("didUpdate",({delta:X,hasLayoutChanged:te,hasRelativeLayoutChanged:de,layout:Ae})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Ce=this.options.transition||Z.getDefaultTransition()||HA,{onLayoutAnimationStart:De,onLayoutAnimationComplete:oe}=Z.getProps(),We=!this.targetLayout||!E1(this.targetLayout,Ae),Ze=!te&&de;if(this.options.layoutRoot||this.resumeFrom||Ze||te&&(We||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const $e={...y0(Ce,"layout"),onPlay:De,onComplete:oe};(Z.shouldReduceMotion||this.options.layoutRoot)&&($e.delay=0,$e.type=!1),this.startAnimation($e),this.setAnimationOrigin(X,Ze)}else te||vx(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Ae})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const M=this.getStack();M&&M.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Rh(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(UA),this.animationId++)}getTransformTemplate(){const{visualElement:M}=this.options;return M&&M.getProps().transformTemplate}willUpdate(M=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&A1(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let X=0;X<this.path.length;X++){const te=this.path[X];te.shouldResetTransform=!0,te.updateScroll("snapshot"),te.options.layoutRoot&&te.willUpdate(!1)}const{layoutId:u,layout:j}=this.options;if(u===void 0&&!j)return;const Z=this.getTransformTemplate();this.prevTransformTemplateValue=Z?Z(this.latestValues,""):void 0,this.updateSnapshot(),M&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(yx);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(_x);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(jA),this.nodes.forEach(LA),this.nodes.forEach(kA)):this.nodes.forEach(_x),this.clearAllSnapshots();const u=Is.now();ma.delta=Pc(0,1e3/60,u-ma.timestamp),ma.timestamp=u,ma.isProcessing=!0,s_.update.process(ma),s_.preRender.process(ma),s_.render.process(ma),ma.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,v0.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(FA),this.sharedNodes.forEach(GA)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Vn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Vn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ns(this.snapshot.measuredBox.x)&&!ns(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let j=0;j<this.path.length;j++)this.path[j].updateScroll();const M=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=kr(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:u}=this.options;u&&u.notify("LayoutMeasure",this.layout.layoutBox,M?M.layoutBox:void 0)}updateScroll(M="measure"){let u=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===M&&(u=!1),u&&this.instance){const j=S(this.instance);this.scroll={animationId:this.root.animationId,phase:M,isRoot:j,offset:T(this.instance),wasRoot:this.scroll?this.scroll.isRoot:j}}}resetTransform(){if(!R)return;const M=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,u=this.projectionDelta&&!M1(this.projectionDelta),j=this.getTransformTemplate(),Z=j?j(this.latestValues,""):void 0,X=Z!==this.prevTransformTemplateValue;M&&this.instance&&(u||Hd(this.latestValues)||X)&&(R(this.instance,Z),this.shouldResetTransform=!1,this.scheduleRender())}measure(M=!0){const u=this.measurePageBox();let j=this.removeElementScroll(u);return M&&(j=this.removeTransform(j)),$A(j),{animationId:this.root.animationId,measuredBox:u,layoutBox:j,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:M}=this.options;if(!M)return kr();const u=M.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(XA))){const{scroll:Z}=this.root;Z&&(Tp(u.x,Z.offset.x),Tp(u.y,Z.offset.y))}return u}removeElementScroll(M){const u=kr();if(Rl(u,M),this.scroll?.wasRoot)return u;for(let j=0;j<this.path.length;j++){const Z=this.path[j],{scroll:X,options:te}=Z;Z!==this.root&&X&&te.layoutScroll&&(X.wasRoot&&Rl(u,M),Tp(u.x,X.offset.x),Tp(u.y,X.offset.y))}return u}applyTransform(M,u=!1){const j=kr();Rl(j,M);for(let Z=0;Z<this.path.length;Z++){const X=this.path[Z];!u&&X.options.layoutScroll&&X.scroll&&X!==X.root&&Sp(j,{x:-X.scroll.offset.x,y:-X.scroll.offset.y}),Hd(X.latestValues)&&Sp(j,X.latestValues)}return Hd(this.latestValues)&&Sp(j,this.latestValues),j}removeTransform(M){const u=kr();Rl(u,M);for(let j=0;j<this.path.length;j++){const Z=this.path[j];if(!Z.instance||!Hd(Z.latestValues))continue;O_(Z.latestValues)&&Z.updateSnapshot();const X=kr(),te=Z.measurePageBox();Rl(X,te),hx(u,Z.latestValues,Z.snapshot?Z.snapshot.layoutBox:void 0,X)}return Hd(this.latestValues)&&hx(u,this.latestValues),u}setTargetDelta(M){this.targetDelta=M,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(M){this.options={...this.options,...M,crossfade:M.crossfade!==void 0?M.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ma.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(M=!1){const u=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=u.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=u.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=u.isSharedProjectionDirty);const j=!!this.resumingFrom||this!==u;if(!(M||j&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:X,layoutId:te}=this.options;if(!this.layout||!(X||te))return;this.resolvedRelativeTargetAt=ma.timestamp;const de=this.getClosestProjectingParent();de&&this.linkedParentVersion!==de.layoutVersion&&!de.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(de&&de.layout?this.createRelativeTarget(de,this.layout.layoutBox,de.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=kr(),this.targetWithTransforms=kr()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),iA(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Rl(this.target,this.layout.layoutBox),s1(this.target,this.targetDelta)):Rl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,de&&!!de.resumingFrom==!!this.resumingFrom&&!de.options.layoutScroll&&de.target&&this.animationProgress!==1?this.createRelativeTarget(de,this.target,de.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||O_(this.parent.latestValues)||a1(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(M,u,j){this.relativeParent=M,this.linkedParentVersion=M.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=kr(),this.relativeTargetOrigin=kr(),Ay(this.relativeTargetOrigin,u,j),Rl(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const M=this.getLead(),u=!!this.resumingFrom||this!==M;let j=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(j=!1),u&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(j=!1),this.resolvedRelativeTargetAt===ma.timestamp&&(j=!1),j)return;const{layout:Z,layoutId:X}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(Z||X))return;Rl(this.layoutCorrected,this.layout.layoutBox);const te=this.treeScale.x,de=this.treeScale.y;pE(this.layoutCorrected,this.treeScale,this.path,u),M.layout&&!M.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(M.target=M.layout.layoutBox,M.targetWithTransforms=kr());const{target:Ae}=M;if(!Ae){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(lx(this.prevProjectionDelta.x,this.projectionDelta.x),lx(this.prevProjectionDelta.y,this.projectionDelta.y)),Xm(this.projectionDelta,this.layoutCorrected,Ae,this.latestValues),(this.treeScale.x!==te||this.treeScale.y!==de||!gx(this.projectionDelta.x,this.prevProjectionDelta.x)||!gx(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Ae))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(M=!0){if(this.options.visualElement?.scheduleRender(),M){const u=this.getStack();u&&u.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Mp(),this.projectionDelta=Mp(),this.projectionDeltaWithTransform=Mp()}setAnimationOrigin(M,u=!1){const j=this.snapshot,Z=j?j.latestValues:{},X={...this.latestValues},te=Mp();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!u;const de=kr(),Ae=j?j.source:void 0,Ce=this.layout?this.layout.source:void 0,De=Ae!==Ce,oe=this.getStack(),We=!oe||oe.members.length<=1,Ze=!!(De&&!We&&this.options.crossfade===!0&&!this.path.some(ZA));this.animationProgress=0;let $e;this.mixTargetDelta=Ct=>{const Ke=Ct/1e3;xx(te.x,M.x,Ke),xx(te.y,M.y,Ke),this.setTargetDelta(te),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ay(de,this.layout.layoutBox,this.relativeParent.layout.layoutBox),qA(this.relativeTarget,this.relativeTargetOrigin,de,Ke),$e&&DA(this.relativeTarget,$e)&&(this.isProjectionDirty=!1),$e||($e=kr()),Rl($e,this.relativeTarget)),De&&(this.animationValues=X,TA(X,Z,this.latestValues,Ke,Ze,We)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Ke},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(M){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Rh(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Vn.update(()=>{xy.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Ap(0)),this.currentAnimation=_A(this.motionValue,[0,1e3],{...M,velocity:0,isSync:!0,onUpdate:u=>{this.mixTargetDelta(u),M.onUpdate&&M.onUpdate(u)},onStop:()=>{},onComplete:()=>{M.onComplete&&M.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const M=this.getStack();M&&M.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(RA),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const M=this.getLead();let{targetWithTransforms:u,target:j,layout:Z,latestValues:X}=M;if(!(!u||!j||!Z)){if(this!==M&&this.layout&&Z&&D1(this.options.animationType,this.layout.layoutBox,Z.layoutBox)){j=this.target||kr();const te=ns(this.layout.layoutBox.x);j.x.min=M.target.x.min,j.x.max=j.x.min+te;const de=ns(this.layout.layoutBox.y);j.y.min=M.target.y.min,j.y.max=j.y.min+de}Rl(u,j),Sp(u,X),Xm(this.projectionDeltaWithTransform,this.layoutCorrected,u,X)}}registerSharedNode(M,u){this.sharedNodes.has(M)||this.sharedNodes.set(M,new PA),this.sharedNodes.get(M).add(u);const Z=u.options.initialPromotionConfig;u.promote({transition:Z?Z.transition:void 0,preserveFollowOpacity:Z&&Z.shouldPreserveFollowOpacity?Z.shouldPreserveFollowOpacity(u):void 0})}isLead(){const M=this.getStack();return M?M.lead===this:!0}getLead(){const{layoutId:M}=this.options;return M?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:M}=this.options;return M?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:M}=this.options;if(M)return this.root.sharedNodes.get(M)}promote({needsReset:M,transition:u,preserveFollowOpacity:j}={}){const Z=this.getStack();Z&&Z.promote(this,j),M&&(this.projectionDelta=void 0,this.needsReset=!0),u&&this.setOptions({transition:u})}relegate(){const M=this.getStack();return M?M.relegate(this):!1}resetSkewAndRotation(){const{visualElement:M}=this.options;if(!M)return;let u=!1;const{latestValues:j}=M;if((j.z||j.rotate||j.rotateX||j.rotateY||j.rotateZ||j.skewX||j.skewY)&&(u=!0),!u)return;const Z={};j.z&&__("z",M,Z,this.animationValues);for(let X=0;X<y_.length;X++)__(`rotate${y_[X]}`,M,Z,this.animationValues),__(`skew${y_[X]}`,M,Z,this.animationValues);M.render();for(const X in Z)M.setStaticValue(X,Z[X]),this.animationValues&&(this.animationValues[X]=Z[X]);M.scheduleRender()}applyProjectionStyles(M,u){if(!this.instance||this.isSVG)return;if(!this.isVisible){M.visibility="hidden";return}const j=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,M.visibility="",M.opacity="",M.pointerEvents=vy(u?.pointerEvents)||"",M.transform=j?j(this.latestValues,""):"none";return}const Z=this.getLead();if(!this.projectionDelta||!this.layout||!Z.target){this.options.layoutId&&(M.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,M.pointerEvents=vy(u?.pointerEvents)||""),this.hasProjected&&!Hd(this.latestValues)&&(M.transform=j?j({},""):"none",this.hasProjected=!1);return}M.visibility="";const X=Z.animationValues||Z.latestValues;this.applyTransformsToTarget();let te=zA(this.projectionDeltaWithTransform,this.treeScale,X);j&&(te=j(X,te)),M.transform=te;const{x:de,y:Ae}=this.projectionDelta;M.transformOrigin=`${de.origin*100}% ${Ae.origin*100}% 0`,Z.animationValues?M.opacity=Z===this?X.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:X.opacityExit:M.opacity=Z===this?X.opacity!==void 0?X.opacity:"":X.opacityExit!==void 0?X.opacityExit:0;for(const Ce in B_){if(X[Ce]===void 0)continue;const{correct:De,applyTo:oe,isCSSVariable:We}=B_[Ce],Ze=te==="none"?X[Ce]:De(X[Ce],Z);if(oe){const $e=oe.length;for(let Ct=0;Ct<$e;Ct++)M[oe[Ct]]=Ze}else We?this.options.visualElement.renderState.vars[Ce]=Ze:M[Ce]=Ze}this.options.layoutId&&(M.pointerEvents=Z===this?vy(u?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(M=>M.currentAnimation?.stop()),this.root.nodes.forEach(yx),this.root.sharedNodes.clear()}}}function LA(d){d.updateLayout()}function kA(d){const y=d.resumeFrom?.snapshot||d.snapshot;if(d.isLead()&&d.layout&&y&&d.hasListeners("didUpdate")){const{layoutBox:T,measuredBox:S}=d.layout,{animationType:R}=d.options,O=y.source!==d.layout.source;R==="size"?Fo(X=>{const te=O?y.measuredBox[X]:y.layoutBox[X],de=ns(te);te.min=T[X].min,te.max=te.min+de}):D1(R,y.layoutBox,T)&&Fo(X=>{const te=O?y.measuredBox[X]:y.layoutBox[X],de=ns(T[X]);te.max=te.min+de,d.relativeTarget&&!d.currentAnimation&&(d.isProjectionDirty=!0,d.relativeTarget[X].max=d.relativeTarget[X].min+de)});const M=Mp();Xm(M,T,y.layoutBox);const u=Mp();O?Xm(u,d.applyTransform(S,!0),y.measuredBox):Xm(u,T,y.layoutBox);const j=!M1(M);let Z=!1;if(!d.resumeFrom){const X=d.getClosestProjectingParent();if(X&&!X.resumeFrom){const{snapshot:te,layout:de}=X;if(te&&de){const Ae=kr();Ay(Ae,y.layoutBox,te.layoutBox);const Ce=kr();Ay(Ce,T,de.layoutBox),E1(Ae,Ce)||(Z=!0),X.options.layoutRoot&&(d.relativeTarget=Ce,d.relativeTargetOrigin=Ae,d.relativeParent=X)}}}d.notifyListeners("didUpdate",{layout:T,snapshot:y,delta:u,layoutDelta:M,hasLayoutChanged:j,hasRelativeLayoutChanged:Z})}else if(d.isLead()){const{onExitComplete:T}=d.options;T&&T()}d.options.transition=void 0}function BA(d){d.parent&&(d.isProjecting()||(d.isProjectionDirty=d.parent.isProjectionDirty),d.isSharedProjectionDirty||(d.isSharedProjectionDirty=!!(d.isProjectionDirty||d.parent.isProjectionDirty||d.parent.isSharedProjectionDirty)),d.isTransformDirty||(d.isTransformDirty=d.parent.isTransformDirty))}function OA(d){d.isProjectionDirty=d.isSharedProjectionDirty=d.isTransformDirty=!1}function FA(d){d.clearSnapshot()}function yx(d){d.clearMeasurements()}function _x(d){d.isLayoutDirty=!1}function jA(d){const{visualElement:y}=d.options;y&&y.getProps().onBeforeLayoutMeasure&&y.notify("BeforeLayoutMeasure"),d.resetTransform()}function vx(d){d.finishAnimation(),d.targetDelta=d.relativeTarget=d.target=void 0,d.isProjectionDirty=!0}function NA(d){d.resolveTargetDelta()}function VA(d){d.calcProjection()}function UA(d){d.resetSkewAndRotation()}function GA(d){d.removeLeadSnapshot()}function xx(d,y,T){d.translate=Xn(y.translate,0,T),d.scale=Xn(y.scale,1,T),d.origin=y.origin,d.originPoint=y.originPoint}function bx(d,y,T,S){d.min=Xn(y.min,T.min,S),d.max=Xn(y.max,T.max,S)}function qA(d,y,T,S){bx(d.x,y.x,T.x,S),bx(d.y,y.y,T.y,S)}function ZA(d){return d.animationValues&&d.animationValues.opacityExit!==void 0}const HA={duration:.45,ease:[.4,0,.1,1]},wx=d=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(d),Tx=wx("applewebkit/")&&!wx("chrome/")?Math.round:No;function Sx(d){d.min=Tx(d.min),d.max=Tx(d.max)}function $A(d){Sx(d.x),Sx(d.y)}function D1(d,y,T){return d==="position"||d==="preserve-aspect"&&!tA(mx(y),mx(T),.2)}function XA(d){return d!==d.root&&d.scroll?.wasRoot}const YA=C1({attachResizeListener:(d,y)=>eg(d,"resize",y),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),v_={current:void 0},P1=C1({measureScroll:d=>({x:d.scrollLeft,y:d.scrollTop}),defaultParent:()=>{if(!v_.current){const d=new YA({});d.mount(window),d.setOptions({layoutScroll:!0}),v_.current=d}return v_.current},resetTransform:(d,y)=>{d.style.transform=y!==void 0?y:"none"},checkIsScrollRoot:d=>window.getComputedStyle(d).position==="fixed"}),WA={pan:{Feature:gA},drag:{Feature:mA,ProjectionNode:P1,MeasureLayout:w1}};function Mx(d,y,T){const{props:S}=d;d.animationState&&S.whileHover&&d.animationState.setActive("whileHover",T==="Start");const R="onHover"+T,O=S[R];O&&Vn.postRender(()=>O(y,og(y)))}class KA extends Lh{mount(){const{current:y}=this.node;y&&(this.unmount=vM(y,(T,S)=>(Mx(this.node,S,"Start"),R=>Mx(this.node,R,"End"))))}unmount(){}}class QA extends Lh{constructor(){super(...arguments),this.isActive=!1}onFocus(){let y=!1;try{y=this.node.current.matches(":focus-visible")}catch{y=!0}!y||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=rg(eg(this.node.current,"focus",()=>this.onFocus()),eg(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Ex(d,y,T){const{props:S}=d;if(d.current instanceof HTMLButtonElement&&d.current.disabled)return;d.animationState&&S.whileTap&&d.animationState.setActive("whileTap",T==="Start");const R="onTap"+(T==="End"?"":T),O=S[R];O&&Vn.postRender(()=>O(y,og(y)))}class JA extends Lh{mount(){const{current:y}=this.node;y&&(this.unmount=TM(y,(T,S)=>(Ex(this.node,S,"Start"),(R,{success:O})=>Ex(this.node,R,O?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const q_=new WeakMap,x_=new WeakMap,eC=d=>{const y=q_.get(d.target);y&&y(d)},tC=d=>{d.forEach(eC)};function iC({root:d,...y}){const T=d||document;x_.has(T)||x_.set(T,{});const S=x_.get(T),R=JSON.stringify(y);return S[R]||(S[R]=new IntersectionObserver(tC,{root:d,...y})),S[R]}function nC(d,y,T){const S=iC(y);return q_.set(d,T),S.observe(d),()=>{q_.delete(d),S.unobserve(d)}}const rC={some:0,all:1};class aC extends Lh{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:y={}}=this.node.getProps(),{root:T,margin:S,amount:R="some",once:O}=y,M={root:T?T.current:void 0,rootMargin:S,threshold:typeof R=="number"?R:rC[R]},u=j=>{const{isIntersecting:Z}=j;if(this.isInView===Z||(this.isInView=Z,O&&!Z&&this.hasEnteredView))return;Z&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",Z);const{onViewportEnter:X,onViewportLeave:te}=this.node.getProps(),de=Z?X:te;de&&de(j)};return nC(this.node.current,M,u)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:y,prevProps:T}=this.node;["amount","margin","root"].some(sC(y,T))&&this.startObserver()}unmount(){}}function sC({viewport:d={}},{viewport:y={}}={}){return T=>d[T]!==y[T]}const oC={inView:{Feature:aC},tap:{Feature:JA},focus:{Feature:QA},hover:{Feature:KA}},lC={layout:{ProjectionNode:P1,MeasureLayout:w1}},uC={...YE,...oC,...WA,...lC},cC=hE(uC,SE),hC=()=>{const[d,y]=we.useState(0),[T,S]=we.useState(new Date),[R,O]=we.useState(!1),M=["WEATHER","FARMING","EPHEMERIDES","APOD","NEWS"];return we.useEffect(()=>{const u=setInterval(()=>S(new Date),1e3);return()=>clearInterval(u)},[]),we.useEffect(()=>{let u=!0;return(async()=>{for(;u&&(O(!1),await new Promise(Z=>setTimeout(Z,45e3)),!(!u||(O(!0),await new Promise(Z=>setTimeout(Z,2e4)),!u)));)y(Z=>(Z+1)%M.length)})(),()=>{u=!1}},[]),he.jsxs("div",{className:"dashboard-container",style:{position:"relative",overflow:"hidden",background:"#000"},children:[he.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0},children:he.jsx(PT,{})}),he.jsx(IM,{children:R&&he.jsxs(cC.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:1},style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:10,background:"rgba(0, 0, 0, 0.85)",backdropFilter:"blur(5px)"},children:[d===0&&he.jsx(bT,{}),d===1&&he.jsx(TT,{}),d===2&&he.jsx(ST,{}),d===3&&he.jsx(MT,{}),d===4&&he.jsx(ET,{})]})}),he.jsx("div",{style:{position:"absolute",top:"1rem",right:"2rem",zIndex:100,color:"white",textShadow:"0 2px 4px rgba(0,0,0,0.8)",fontFamily:"monospace",fontSize:"2rem",fontWeight:"bold",pointerEvents:"none"},children:T.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})})]})},dC={meteoblue_api_key:"Meteoblue Weather",openweathermap_api_key:"OpenWeatherMap",maptiler_key:"MapTiler (Maps)",opensky_username:"OpenSky Username",opensky_password:"OpenSky Password",aisstream_api_key:"AIS Stream (Ships)"},fC=()=>{const[d,y]=we.useState([]),[T,S]=we.useState(!1),[R,O]=we.useState(null),[M,u]=we.useState(""),[j,Z]=we.useState({}),[X,te]=we.useState({}),[de,Ae]=we.useState(!1),[Ce,De]=we.useState({module_cycle_seconds:20,news_feeds:[],location:{name:"",lat:39.9378,lon:-.1014}}),[oe,We]=we.useState("");we.useEffect(()=>{Ze()},[]);const Ze=async()=>{try{const Yt=await(await fetch("/api/system/secrets")).json();Z(Yt)}catch(ct){console.error(ct)}try{const ct=await fetch("/api/system/wifi/scan");if(ct.ok){const Yt=await ct.json();y(Yt)}}catch(ct){console.error("WiFi Scan error",ct),y([{ssid:"Error_Scan",strength:0,security:"None",active:!1}])}try{fetch("/api/system/config/display").then(ct=>ct.json()).then(ct=>{De({module_cycle_seconds:ct.module_cycle_seconds||20,news_feeds:ct.news_feeds||[],location:ct.location||{name:"",lat:39.9378,lon:-.1014}})}).catch(ct=>console.error(ct))}catch{}},$e=async()=>{try{const ct={module_cycle_seconds:Ce.module_cycle_seconds,news_feeds:Ce.news_feeds,location_name:Ce.location?.name,location_lat:Ce.location?.lat,location_lon:Ce.location?.lon};await fetch("/api/system/config/display",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ct)}),alert("Configuracin de Pantalla guardada")}catch{alert("Error al guardar config")}},Ct=()=>{oe.trim()&&(De(ct=>({...ct,news_feeds:[...ct.news_feeds||[],oe.trim()]})),We(""))},Ke=ct=>{De(Yt=>({...Yt,news_feeds:Yt.news_feeds.filter((ki,wn)=>wn!==ct)}))},vt=async()=>{S(!0);try{const ct=await fetch("/api/system/wifi/scan");if(ct.ok){const Yt=await ct.json();y(Yt)}}catch(ct){console.error(ct)}finally{S(!1)}},mt=async()=>{try{const ct=await fetch("/api/system/secrets");if(ct.ok){const Yt=await ct.json();Z(Yt)}}catch(ct){console.error(ct)}},Et=async()=>{if(R)try{(await fetch("/api/system/wifi/connect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ssid:R,password:M})})).ok?(alert(`Conectado a ${R} `),O(null),u(""),vt()):alert("Error al conectar")}catch{alert("Error de conexin")}},Xt=async()=>{Ae(!0);try{(await fetch("/api/system/secrets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:X})})).ok&&(te({}),mt(),alert("Claves guardadas correctamente"))}catch{alert("Error al guardar claves")}finally{Ae(!1)}};return he.jsxs("div",{className:"settings-container",children:[he.jsx(K_,{to:"/",className:"settings-close-btn",children:he.jsx(vT,{size:24})}),he.jsx("h1",{className:"settings-title",children:"Configuracin del Sistema"}),he.jsxs("div",{className:"settings-grid",children:[he.jsxs("div",{className:"settings-card",children:[he.jsxs("div",{className:"card-header",children:[he.jsx(mT,{size:24}),he.jsx("h2",{children:"Conexin WiFi"}),he.jsx("button",{onClick:vt,className:"icon-btn",disabled:T,children:he.jsx(tT,{size:20,className:T?"spin":""})})]}),he.jsxs("div",{className:"wifi-list",children:[d.length===0&&!T&&he.jsx("p",{className:"empty-msg",children:"No se encontraron redes"}),d.map((ct,Yt)=>he.jsxs("div",{className:`wifi-item ${ct.active?"active":""} `,onClick:()=>O(ct.ssid),children:[he.jsxs("div",{className:"wifi-info",children:[he.jsx("span",{className:"wifi-ssid",children:ct.ssid}),he.jsxs("span",{className:"wifi-meta",children:[ct.security,"  ",ct.strength,"%"]})]}),ct.active&&he.jsx(G2,{size:18,className:"text-green-400"})]},Yt))]}),R&&he.jsxs("div",{className:"wifi-modal",children:[he.jsxs("h3",{children:["Conectar a ",R]}),he.jsx("input",{type:"password",placeholder:"Contrasea WiFi",value:M,onChange:ct=>u(ct.target.value)}),he.jsxs("div",{className:"modal-actions",children:[he.jsx("button",{onClick:()=>O(null),children:"Cancelar"}),he.jsx("button",{className:"primary",onClick:Et,children:"Conectar"})]})]})]}),he.jsxs("div",{className:"settings-card",children:[he.jsxs("div",{className:"section-header",children:[he.jsx(Wx,{size:20,className:"text-yellow-400"}),he.jsx("h2",{children:"Pantalla, Noticias y Ubicacin"})]}),he.jsxs("div",{className:"form-group",children:[he.jsx("label",{children:"Tiempo por pantalla (segundos)"}),he.jsx("div",{className:"input-row",children:he.jsx("input",{type:"number",value:Ce.module_cycle_seconds,onChange:ct=>De({...Ce,module_cycle_seconds:parseInt(ct.target.value)}),className:"secret-input"})})]}),he.jsxs("div",{className:"form-group",style:{marginTop:"1rem"},children:[he.jsx("label",{children:"Ubicacin del Dispositivo"}),he.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:he.jsx("input",{type:"text",placeholder:"Nombre Ciudad (ej. Vila-real)",value:Ce.location?.name||"",onChange:ct=>De({...Ce,location:{...Ce.location,name:ct.target.value}}),className:"secret-input",style:{flex:2}})}),he.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[he.jsx("input",{type:"number",placeholder:"Latitud",value:Ce.location?.lat||"",onChange:ct=>De({...Ce,location:{...Ce.location,lat:parseFloat(ct.target.value)}}),className:"secret-input",style:{flex:1}}),he.jsx("input",{type:"number",placeholder:"Longitud",value:Ce.location?.lon||"",onChange:ct=>De({...Ce,location:{...Ce.location,lon:parseFloat(ct.target.value)}}),className:"secret-input",style:{flex:1}})]})]}),he.jsxs("div",{className:"form-group",style:{marginTop:"1rem"},children:[he.jsx("label",{children:"Fuentes RSS de Noticias"}),he.jsxs("div",{className:"input-row",children:[he.jsx("input",{type:"text",placeholder:"https://ejemplo.com/rss",value:oe,onChange:ct=>We(ct.target.value),className:"secret-input"}),he.jsx("button",{className:"connect-btn",onClick:Ct,children:"Aadir"})]}),he.jsx("div",{className:"feeds-list",style:{marginTop:"0.5rem",maxHeight:"150px",overflowY:"auto"},children:(Ce.news_feeds||[]).map((ct,Yt)=>he.jsxs("div",{className:"feed-item",style:{display:"flex",justifyContent:"space-between",padding:"0.5rem",background:"rgba(255,255,255,0.05)",marginBottom:"4px",borderRadius:"4px"},children:[he.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis"},children:ct}),he.jsx("button",{onClick:()=>Ke(Yt),style:{color:"red",border:"none",background:"none",cursor:"pointer"},children:""})]},Yt))}),he.jsxs("button",{className:"primary full-width",onClick:$e,style:{marginTop:"1rem"},children:[he.jsx(hv,{size:16})," Guardar Configuracin Pantalla"]})]}),he.jsxs("div",{className:"section-header",style:{marginTop:"2rem"},children:[he.jsx(Q2,{size:20,className:"text-red-400"}),he.jsx("h2",{children:"Claves API y Calendario"})]}),he.jsx("p",{className:"card-desc",style:{marginBottom:"1rem"},children:"Introduce las claves para activar los servicios."}),he.jsxs("div",{className:"keys-list",children:[he.jsxs("div",{className:"key-item",children:[he.jsxs("div",{className:"key-label-row",children:[he.jsx("span",{className:"key-label",children:"Calendario ICS (URL Pblica)"}),j.calendar_ics_url?he.jsx("span",{className:"status-badge set",children:"Configurado"}):he.jsx("span",{className:"status-badge missing",children:"Falta"})]}),he.jsx("input",{type:"text",placeholder:j.calendar_ics_url?"URL Oculta (Escriba para cambiar)":"https://calendar.google.com/...",value:X.calendar_ics_url||"",onChange:ct=>te(Yt=>({...Yt,calendar_ics_url:ct.target.value}))})]}),he.jsxs("div",{className:"key-item",children:[he.jsxs("div",{className:"key-label-row",children:[he.jsx("span",{className:"key-label",children:"NASA API Key (APOD)"}),j.nasa_api_key?he.jsx("span",{className:"status-badge set",children:"Configurado"}):he.jsx("span",{className:"status-badge missing",children:"Opcional"})]}),he.jsx("input",{type:"password",placeholder:j.nasa_api_key?"":"DEMO_KEY por defecto...",value:X.nasa_api_key||"",onChange:ct=>te(Yt=>({...Yt,nasa_api_key:ct.target.value}))})]}),Object.entries(dC).map(([ct,Yt])=>he.jsxs("div",{className:"key-item",children:[he.jsxs("div",{className:"key-label-row",children:[he.jsx("span",{className:"key-label",children:Yt}),j[ct]?he.jsx("span",{className:"status-badge set",children:"Configurado"}):he.jsx("span",{className:"status-badge missing",children:"Falta"})]}),he.jsx("input",{type:"password",placeholder:j[ct]?"":"Introduce clave...",value:X[ct]||"",onChange:ki=>te(wn=>({...wn,[ct]:ki.target.value}))})]},ct))]}),he.jsx("div",{className:"card-footer",children:he.jsxs("button",{className:"primary full-width",onClick:Xt,disabled:de,children:[de?"Guardando...":"Guardar Claves API"," ",he.jsx(hv,{size:18,style:{marginLeft:8}})]})})]})]})]})},xp=({title:d})=>he.jsxs("div",{style:{padding:"2rem"},children:[he.jsx("h1",{style:{fontSize:"2rem",marginBottom:"1rem"},children:d}),he.jsx("p",{style:{color:"var(--text-muted)"},children:"Mdulo en construccin..."})]});function pC(){return he.jsx(E2,{children:he.jsx(i2,{children:he.jsxs(Eu,{path:"/",element:he.jsx(xT,{}),children:[he.jsx(Eu,{index:!0,element:he.jsx(hC,{})}),he.jsx(Eu,{path:"map",element:he.jsx(xp,{title:"Mapa Global"})}),he.jsx(Eu,{path:"weather",element:he.jsx(xp,{title:"Tiempo Detallado"})}),he.jsx(Eu,{path:"flights",element:he.jsx(xp,{title:"Trfico Areo"})}),he.jsx(Eu,{path:"ships",element:he.jsx(xp,{title:"Trfico Martimo"})}),he.jsx(Eu,{path:"radar",element:he.jsx(xp,{title:"Radar de Lluvia"})}),he.jsx(Eu,{path:"calendar",element:he.jsx(xp,{title:"Agenda"})}),he.jsx(Eu,{path:"settings",element:he.jsx(fC,{})})]})})})}tw.createRoot(document.getElementById("root")).render(he.jsx(we.StrictMode,{children:he.jsx(pC,{})}));
