#!/usr/bin/env bash
set -euo pipefail

BACKEND_DIR=/opt/pantalla-reloj/backend
BACKEND_ROOT=$(dirname "$BACKEND_DIR")
PYTHON_BIN="$BACKEND_DIR/.venv/bin/python"

if [[ ! -x "$PYTHON_BIN" ]]; then
  echo "[backend-launch] python executable not found: $PYTHON_BIN" >&2
  exit 1
fi

cd "$BACKEND_DIR"
if [[ -n "${PYTHONPATH:-}" ]]; then
  export PYTHONPATH="$BACKEND_ROOT:$PYTHONPATH"
else
  export PYTHONPATH="$BACKEND_ROOT"
fi
exec "$PYTHON_BIN" -m uvicorn backend.main:app \
  --host 127.0.0.1 \
  --port 8081 \
  --proxy-headers \
  --timeout-keep-alive 30
