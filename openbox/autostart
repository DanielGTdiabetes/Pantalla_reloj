#!/usr/bin/env bash
# Pantalla_reloj Openbox autostart script

xset -dpms
xset s off
xset s noblank

export DISPLAY=:0
export XAUTHORITY="${XAUTHORITY:-/home/dani/.Xauthority}"

XR_OUTPUT="$(xrandr --query 2>/dev/null | awk '/ connected/{print $1; exit}')"
if [[ -n "$XR_OUTPUT" ]]; then
  xrandr --output "$XR_OUTPUT" --rotate left --primary || true
fi

sleep 2

EPIPHANY_BIN="$(command -v epiphany-browser 2>/dev/null || true)"
if [[ -n "$EPIPHANY_BIN" ]]; then
  if ! pgrep -x epiphany-browser >/dev/null 2>&1; then
    setsid -f "$EPIPHANY_BIN" --new-window http://127.0.0.1/ >/dev/null 2>&1 &
  fi
else
  FIREFOX_BIN="$(command -v firefox 2>/dev/null || true)"
  if [[ -n "$FIREFOX_BIN" ]] && ! pgrep -x firefox >/dev/null 2>&1; then
    setsid -f "$FIREFOX_BIN" --no-remote --kiosk http://127.0.0.1/ >/dev/null 2>&1 &
  fi
fi
